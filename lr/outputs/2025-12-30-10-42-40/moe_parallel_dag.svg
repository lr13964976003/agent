<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="56635pt" height="5625pt"
 viewBox="0.00 0.00 56635.00 5625.08" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 5621.08)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-5621.08 56631,-5621.08 56631,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_dp</title>
<path fill="lightgray" stroke="black" d="M20,-8C20,-8 56607,-8 56607,-8 56613,-8 56619,-14 56619,-20 56619,-20 56619,-5597.08 56619,-5597.08 56619,-5603.08 56613,-5609.08 56607,-5609.08 56607,-5609.08 20,-5609.08 20,-5609.08 14,-5609.08 8,-5603.08 8,-5597.08 8,-5597.08 8,-20 8,-20 8,-14 14,-8 20,-8"/>
<text text-anchor="middle" x="28313.5" y="-5593.88" font-family="bold" font-size="14.00">DP=2 (Request Parallelism)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_replica1</title>
<path fill="lightblue" stroke="black" d="M28329,-16C28329,-16 56599,-16 56599,-16 56605,-16 56611,-22 56611,-28 56611,-28 56611,-5566.08 56611,-5566.08 56611,-5572.08 56605,-5578.08 56599,-5578.08 56599,-5578.08 28329,-5578.08 28329,-5578.08 28323,-5578.08 28317,-5572.08 28317,-5566.08 28317,-5566.08 28317,-28 28317,-28 28317,-22 28323,-16 28329,-16"/>
<text text-anchor="middle" x="42464" y="-5562.88" font-family="bold" font-size="14.00">Pipeline Replica 1 (64 GPUs)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_R1_Stage1</title>
<path fill="lightgreen" stroke="black" d="M28699,-3432C28699,-3432 35648,-3432 35648,-3432 35654,-3432 35660,-3438 35660,-3444 35660,-3444 35660,-5535.08 35660,-5535.08 35660,-5541.08 35654,-5547.08 35648,-5547.08 35648,-5547.08 28699,-5547.08 28699,-5547.08 28693,-5547.08 28687,-5541.08 28687,-5535.08 28687,-5535.08 28687,-3444 28687,-3444 28687,-3438 28693,-3432 28699,-3432"/>
<text text-anchor="middle" x="32173.5" y="-5531.88" font-family="bold" font-size="14.00">Stage1: Layers 1&#45;4 (16 GPUs)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_R1_Stage2</title>
<path fill="lightgreen" stroke="black" d="M35680,-2314C35680,-2314 42629,-2314 42629,-2314 42635,-2314 42641,-2320 42641,-2326 42641,-2326 42641,-4635 42641,-4635 42641,-4641 42635,-4647 42629,-4647 42629,-4647 35680,-4647 35680,-4647 35674,-4647 35668,-4641 35668,-4635 35668,-4635 35668,-2326 35668,-2326 35668,-2320 35674,-2314 35680,-2314"/>
<text text-anchor="middle" x="39154.5" y="-4631.8" font-family="bold" font-size="14.00">Stage2: Layers 5&#45;8 (16 GPUs)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_R1_Stage3</title>
<path fill="lightgreen" stroke="black" d="M42661,-1196C42661,-1196 49610,-1196 49610,-1196 49616,-1196 49622,-1202 49622,-1208 49622,-1208 49622,-3517 49622,-3517 49622,-3523 49616,-3529 49610,-3529 49610,-3529 42661,-3529 42661,-3529 42655,-3529 42649,-3523 42649,-3517 42649,-3517 42649,-1208 42649,-1208 42649,-1202 42655,-1196 42661,-1196"/>
<text text-anchor="middle" x="46135.5" y="-3513.8" font-family="bold" font-size="14.00">Stage3: Layers 9&#45;12 (16 GPUs)</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_R1_Stage4</title>
<path fill="lightgreen" stroke="black" d="M49642,-161C49642,-161 56591,-161 56591,-161 56597,-161 56603,-167 56603,-173 56603,-173 56603,-2399 56603,-2399 56603,-2405 56597,-2411 56591,-2411 56591,-2411 49642,-2411 49642,-2411 49636,-2411 49630,-2405 49630,-2399 49630,-2399 49630,-173 49630,-173 49630,-167 49636,-161 49642,-161"/>
<text text-anchor="middle" x="53116.5" y="-2395.8" font-family="bold" font-size="14.00">Stage4: Layers 13&#45;16 (16 GPUs)</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_replica2</title>
<path fill="lightblue" stroke="black" d="M28,-16C28,-16 28297,-16 28297,-16 28303,-16 28309,-22 28309,-28 28309,-28 28309,-5566.08 28309,-5566.08 28309,-5572.08 28303,-5578.08 28297,-5578.08 28297,-5578.08 28,-5578.08 28,-5578.08 22,-5578.08 16,-5572.08 16,-5566.08 16,-5566.08 16,-28 16,-28 16,-22 22,-16 28,-16"/>
<text text-anchor="middle" x="14162.5" y="-5562.88" font-family="bold" font-size="14.00">Pipeline Replica 2 (64 GPUs)</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_R2_Stage1</title>
<path fill="lightgreen" stroke="black" d="M7378,-3432C7378,-3432 14327,-3432 14327,-3432 14333,-3432 14339,-3438 14339,-3444 14339,-3444 14339,-5535.08 14339,-5535.08 14339,-5541.08 14333,-5547.08 14327,-5547.08 14327,-5547.08 7378,-5547.08 7378,-5547.08 7372,-5547.08 7366,-5541.08 7366,-5535.08 7366,-5535.08 7366,-3444 7366,-3444 7366,-3438 7372,-3432 7378,-3432"/>
<text text-anchor="middle" x="10852.5" y="-5531.88" font-family="bold" font-size="14.00">Stage1: Layers 1&#45;4 (16 GPUs)</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_R2_Stage2</title>
<path fill="lightgreen" stroke="black" d="M36,-2314C36,-2314 6984,-2314 6984,-2314 6990,-2314 6996,-2320 6996,-2326 6996,-2326 6996,-4635 6996,-4635 6996,-4641 6990,-4647 6984,-4647 6984,-4647 36,-4647 36,-4647 30,-4647 24,-4641 24,-4635 24,-4635 24,-2326 24,-2326 24,-2320 30,-2314 36,-2314"/>
<text text-anchor="middle" x="3510" y="-4631.8" font-family="bold" font-size="14.00">Stage2: Layers 5&#45;8 (16 GPUs)</text>
</g>
<g id="clust10" class="cluster">
<title>cluster_R2_Stage3</title>
<path fill="lightgreen" stroke="black" d="M14359,-1196C14359,-1196 21308,-1196 21308,-1196 21314,-1196 21320,-1202 21320,-1208 21320,-1208 21320,-3517 21320,-3517 21320,-3523 21314,-3529 21308,-3529 21308,-3529 14359,-3529 14359,-3529 14353,-3529 14347,-3523 14347,-3517 14347,-3517 14347,-1208 14347,-1208 14347,-1202 14353,-1196 14359,-1196"/>
<text text-anchor="middle" x="17833.5" y="-3513.8" font-family="bold" font-size="14.00">Stage3: Layers 9&#45;12 (16 GPUs)</text>
</g>
<g id="clust11" class="cluster">
<title>cluster_R2_Stage4</title>
<path fill="lightgreen" stroke="black" d="M21340,-161C21340,-161 28289,-161 28289,-161 28295,-161 28301,-167 28301,-173 28301,-173 28301,-2399 28301,-2399 28301,-2405 28295,-2411 28289,-2411 28289,-2411 21340,-2411 21340,-2411 21334,-2411 21328,-2405 21328,-2399 21328,-2399 21328,-173 21328,-173 21328,-167 21334,-161 21340,-161"/>
<text text-anchor="middle" x="24814.5" y="-2395.8" font-family="bold" font-size="14.00">Stage4: Layers 13&#45;16 (16 GPUs)</text>
</g>
<!-- R1_Input -->
<g id="node1" class="node">
<title>R1_Input</title>
<ellipse fill="lightblue" stroke="black" cx="28502" cy="-4587" rx="177.36" ry="29"/>
<text text-anchor="middle" x="28502" y="-4595.5" font-family="Times,serif" font-size="10.00">Input</text>
<text text-anchor="middle" x="28502" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="28502" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R1_Stage1_Input -->
<g id="node2" class="node">
<title>R1_Stage1_Input</title>
<ellipse fill="lightblue" stroke="black" cx="30041" cy="-4396" rx="177.36" ry="29"/>
<text text-anchor="middle" x="30041" y="-4404.5" font-family="Times,serif" font-size="10.00">Stage1 Input</text>
<text text-anchor="middle" x="30041" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="30041" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R1_Input&#45;&gt;R1_Stage1_Input -->
<g id="edge1" class="edge">
<title>R1_Input&#45;&gt;R1_Stage1_Input</title>
<path fill="none" stroke="black" d="M28502,-4557.81C28502,-4525.22 28502,-4477 28502,-4477 28502,-4477 29904.38,-4477 29904.38,-4477 29904.38,-4477 29904.38,-4424.79 29904.38,-4424.79"/>
<polygon fill="black" stroke="black" points="29907.88,-4424.79 29904.38,-4414.79 29900.88,-4424.79 29907.88,-4424.79"/>
</g>
<!-- R1_Stage1_L1_Output -->
<g id="node3" class="node">
<title>R1_Stage1_L1_Output</title>
<ellipse fill="lightblue" stroke="black" cx="34337" cy="-4205" rx="225.5" ry="29"/>
<text text-anchor="middle" x="34337" y="-4213.5" font-family="Times,serif" font-size="10.00">Layer 1 Output</text>
<text text-anchor="middle" x="34337" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="34337" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_Input&#45;&gt;R1_Stage1_L1_Output -->
<g id="edge2" class="edge">
<title>R1_Stage1_Input&#45;&gt;R1_Stage1_L1_Output</title>
<path fill="none" stroke="black" d="M30134.62,-4371.14C30134.62,-4353.89 30134.62,-4334 30134.62,-4334 30134.62,-4334 34126.62,-4334 34126.62,-4334 34126.62,-4334 34126.62,-4225.56 34126.62,-4225.56"/>
<polygon fill="black" stroke="black" points="34130.13,-4225.56 34126.62,-4215.56 34123.13,-4225.56 34130.13,-4225.56"/>
</g>
<!-- R1_Stage1_L2_Output -->
<g id="node4" class="node">
<title>R1_Stage1_L2_Output</title>
<ellipse fill="lightblue" stroke="black" cx="34354" cy="-4014" rx="225.5" ry="29"/>
<text text-anchor="middle" x="34354" y="-4022.5" font-family="Times,serif" font-size="10.00">Layer 2 Output</text>
<text text-anchor="middle" x="34354" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="34354" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Output&#45;&gt;R1_Stage1_L2_Output -->
<g id="edge3" class="edge">
<title>R1_Stage1_L1_Output&#45;&gt;R1_Stage1_L2_Output</title>
<path fill="none" stroke="black" d="M34345.5,-4175.99C34345.5,-4175.99 34345.5,-4053.28 34345.5,-4053.28"/>
<polygon fill="black" stroke="black" points="34349,-4053.28 34345.5,-4043.28 34342,-4053.28 34349,-4053.28"/>
</g>
<!-- R1_Stage1_L3_Output -->
<g id="node5" class="node">
<title>R1_Stage1_L3_Output</title>
<ellipse fill="lightblue" stroke="black" cx="33978" cy="-3837" rx="225.5" ry="29"/>
<text text-anchor="middle" x="33978" y="-3845.5" font-family="Times,serif" font-size="10.00">Layer 3 Output</text>
<text text-anchor="middle" x="33978" y="-3834.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="33978" y="-3823.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Output&#45;&gt;R1_Stage1_L3_Output -->
<g id="edge4" class="edge">
<title>R1_Stage1_L2_Output&#45;&gt;R1_Stage1_L3_Output</title>
<path fill="none" stroke="black" d="M34166,-3997.98C34166,-3997.98 34166,-3863.11 34166,-3863.11"/>
<polygon fill="black" stroke="black" points="34169.5,-3863.11 34166,-3853.11 34162.5,-3863.11 34169.5,-3863.11"/>
</g>
<!-- R1_Stage1_L4_Output -->
<g id="node6" class="node">
<title>R1_Stage1_L4_Output</title>
<ellipse fill="lightblue" stroke="black" cx="33978" cy="-3660" rx="225.5" ry="29"/>
<text text-anchor="middle" x="33978" y="-3668.5" font-family="Times,serif" font-size="10.00">Layer 4 Output</text>
<text text-anchor="middle" x="33978" y="-3657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="33978" y="-3646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Output&#45;&gt;R1_Stage1_L4_Output -->
<g id="edge5" class="edge">
<title>R1_Stage1_L3_Output&#45;&gt;R1_Stage1_L4_Output</title>
<path fill="none" stroke="black" d="M34053.17,-3809.34C34053.17,-3809.34 34053.17,-3697.46 34053.17,-3697.46"/>
<polygon fill="black" stroke="black" points="34056.67,-3697.46 34053.17,-3687.46 34049.67,-3697.46 34056.67,-3697.46"/>
</g>
<!-- R1_Stage1_Output -->
<g id="node7" class="node">
<title>R1_Stage1_Output</title>
<ellipse fill="lightblue" stroke="black" cx="35117" cy="-3469" rx="177.36" ry="29"/>
<text text-anchor="middle" x="35117" y="-3477.5" font-family="Times,serif" font-size="10.00">Stage1 Output</text>
<text text-anchor="middle" x="35117" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="35117" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R1_Stage1_L4_Output&#45;&gt;R1_Stage1_Output -->
<g id="edge6" class="edge">
<title>R1_Stage1_L4_Output&#45;&gt;R1_Stage1_Output</title>
<path fill="none" stroke="black" d="M34203.63,-3660C34531.17,-3660 35099.65,-3660 35099.65,-3660 35099.65,-3660 35099.65,-3508.01 35099.65,-3508.01"/>
<polygon fill="black" stroke="black" points="35103.15,-3508.01 35099.65,-3498.01 35096.15,-3508.01 35103.15,-3508.01"/>
</g>
<!-- R1_Stage2_Input -->
<g id="node8" class="node">
<title>R1_Stage2_Input</title>
<ellipse fill="lightblue" stroke="black" cx="37022" cy="-3278" rx="177.36" ry="29"/>
<text text-anchor="middle" x="37022" y="-3286.5" font-family="Times,serif" font-size="10.00">Stage2 Input</text>
<text text-anchor="middle" x="37022" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="37022" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R1_Stage1_Output&#45;&gt;R1_Stage2_Input -->
<g id="edge7" class="edge">
<title>R1_Stage1_Output&#45;&gt;R1_Stage2_Input</title>
<path fill="none" stroke="black" d="M35277.08,-3481.96C35277.08,-3494.94 35277.08,-3513 35277.08,-3513 35277.08,-3513 36964,-3513 36964,-3513 36964,-3513 36964,-3315.42 36964,-3315.42"/>
<polygon fill="black" stroke="black" points="36967.5,-3315.42 36964,-3305.42 36960.5,-3315.42 36967.5,-3315.42"/>
<text text-anchor="middle" x="35763" y="-3369.8" font-family="Times,serif" font-size="14.00">PP Communication</text>
</g>
<!-- R1_Stage2_L5_Output -->
<g id="node9" class="node">
<title>R1_Stage2_L5_Output</title>
<ellipse fill="lightblue" stroke="black" cx="41318" cy="-3087" rx="225.5" ry="29"/>
<text text-anchor="middle" x="41318" y="-3095.5" font-family="Times,serif" font-size="10.00">Layer 5 Output</text>
<text text-anchor="middle" x="41318" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="41318" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_Input&#45;&gt;R1_Stage2_L5_Output -->
<g id="edge8" class="edge">
<title>R1_Stage2_Input&#45;&gt;R1_Stage2_L5_Output</title>
<path fill="none" stroke="black" d="M37115.62,-3253.32C37115.62,-3237.15 37115.62,-3219 37115.62,-3219 37115.62,-3219 41107.62,-3219 41107.62,-3219 41107.62,-3219 41107.62,-3107.8 41107.62,-3107.8"/>
<polygon fill="black" stroke="black" points="41111.13,-3107.8 41107.62,-3097.8 41104.13,-3107.8 41111.13,-3107.8"/>
</g>
<!-- R1_Stage2_L6_Output -->
<g id="node10" class="node">
<title>R1_Stage2_L6_Output</title>
<ellipse fill="lightblue" stroke="black" cx="41335" cy="-2896" rx="225.5" ry="29"/>
<text text-anchor="middle" x="41335" y="-2904.5" font-family="Times,serif" font-size="10.00">Layer 6 Output</text>
<text text-anchor="middle" x="41335" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="41335" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Output&#45;&gt;R1_Stage2_L6_Output -->
<g id="edge9" class="edge">
<title>R1_Stage2_L5_Output&#45;&gt;R1_Stage2_L6_Output</title>
<path fill="none" stroke="black" d="M41326.5,-3057.99C41326.5,-3057.99 41326.5,-2935.28 41326.5,-2935.28"/>
<polygon fill="black" stroke="black" points="41330,-2935.28 41326.5,-2925.28 41323,-2935.28 41330,-2935.28"/>
</g>
<!-- R1_Stage2_L7_Output -->
<g id="node11" class="node">
<title>R1_Stage2_L7_Output</title>
<ellipse fill="lightblue" stroke="black" cx="40959" cy="-2719" rx="225.5" ry="29"/>
<text text-anchor="middle" x="40959" y="-2727.5" font-family="Times,serif" font-size="10.00">Layer 7 Output</text>
<text text-anchor="middle" x="40959" y="-2716.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="40959" y="-2705.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Output&#45;&gt;R1_Stage2_L7_Output -->
<g id="edge10" class="edge">
<title>R1_Stage2_L6_Output&#45;&gt;R1_Stage2_L7_Output</title>
<path fill="none" stroke="black" d="M41147,-2879.98C41147,-2879.98 41147,-2745.11 41147,-2745.11"/>
<polygon fill="black" stroke="black" points="41150.5,-2745.11 41147,-2735.11 41143.5,-2745.11 41150.5,-2745.11"/>
</g>
<!-- R1_Stage2_L8_Output -->
<g id="node12" class="node">
<title>R1_Stage2_L8_Output</title>
<ellipse fill="lightblue" stroke="black" cx="40959" cy="-2542" rx="225.5" ry="29"/>
<text text-anchor="middle" x="40959" y="-2550.5" font-family="Times,serif" font-size="10.00">Layer 8 Output</text>
<text text-anchor="middle" x="40959" y="-2539.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="40959" y="-2528.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Output&#45;&gt;R1_Stage2_L8_Output -->
<g id="edge11" class="edge">
<title>R1_Stage2_L7_Output&#45;&gt;R1_Stage2_L8_Output</title>
<path fill="none" stroke="black" d="M41034.17,-2691.34C41034.17,-2691.34 41034.17,-2579.46 41034.17,-2579.46"/>
<polygon fill="black" stroke="black" points="41037.67,-2579.46 41034.17,-2569.46 41030.67,-2579.46 41037.67,-2579.46"/>
</g>
<!-- R1_Stage2_Output -->
<g id="node13" class="node">
<title>R1_Stage2_Output</title>
<ellipse fill="lightblue" stroke="black" cx="42098" cy="-2351" rx="177.36" ry="29"/>
<text text-anchor="middle" x="42098" y="-2359.5" font-family="Times,serif" font-size="10.00">Stage2 Output</text>
<text text-anchor="middle" x="42098" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="42098" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R1_Stage2_L8_Output&#45;&gt;R1_Stage2_Output -->
<g id="edge12" class="edge">
<title>R1_Stage2_L8_Output&#45;&gt;R1_Stage2_Output</title>
<path fill="none" stroke="black" d="M41184.63,-2542C41512.17,-2542 42080.65,-2542 42080.65,-2542 42080.65,-2542 42080.65,-2390.01 42080.65,-2390.01"/>
<polygon fill="black" stroke="black" points="42084.15,-2390.01 42080.65,-2380.01 42077.15,-2390.01 42084.15,-2390.01"/>
</g>
<!-- R1_Stage3_Input -->
<g id="node14" class="node">
<title>R1_Stage3_Input</title>
<ellipse fill="lightblue" stroke="black" cx="44003" cy="-2160" rx="177.36" ry="29"/>
<text text-anchor="middle" x="44003" y="-2168.5" font-family="Times,serif" font-size="10.00">Stage3 Input</text>
<text text-anchor="middle" x="44003" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="44003" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R1_Stage2_Output&#45;&gt;R1_Stage3_Input -->
<g id="edge13" class="edge">
<title>R1_Stage2_Output&#45;&gt;R1_Stage3_Input</title>
<path fill="none" stroke="black" d="M42258.08,-2363.96C42258.08,-2376.94 42258.08,-2395 42258.08,-2395 42258.08,-2395 43945,-2395 43945,-2395 43945,-2395 43945,-2197.42 43945,-2197.42"/>
<polygon fill="black" stroke="black" points="43948.5,-2197.42 43945,-2187.42 43941.5,-2197.42 43948.5,-2197.42"/>
<text text-anchor="middle" x="42744" y="-2251.8" font-family="Times,serif" font-size="14.00">PP Communication</text>
</g>
<!-- R1_Stage3_L9_Output -->
<g id="node15" class="node">
<title>R1_Stage3_L9_Output</title>
<ellipse fill="lightblue" stroke="black" cx="48299" cy="-1969" rx="225.5" ry="29"/>
<text text-anchor="middle" x="48299" y="-1977.5" font-family="Times,serif" font-size="10.00">Layer 9 Output</text>
<text text-anchor="middle" x="48299" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="48299" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_Input&#45;&gt;R1_Stage3_L9_Output -->
<g id="edge14" class="edge">
<title>R1_Stage3_Input&#45;&gt;R1_Stage3_L9_Output</title>
<path fill="none" stroke="black" d="M44096.62,-2135.14C44096.62,-2117.89 44096.62,-2098 44096.62,-2098 44096.62,-2098 48088.62,-2098 48088.62,-2098 48088.62,-2098 48088.62,-1989.56 48088.62,-1989.56"/>
<polygon fill="black" stroke="black" points="48092.13,-1989.56 48088.62,-1979.56 48085.13,-1989.56 48092.13,-1989.56"/>
</g>
<!-- R1_Stage3_L10_Output -->
<g id="node16" class="node">
<title>R1_Stage3_L10_Output</title>
<ellipse fill="lightblue" stroke="black" cx="48316" cy="-1778" rx="225.5" ry="29"/>
<text text-anchor="middle" x="48316" y="-1786.5" font-family="Times,serif" font-size="10.00">Layer 10 Output</text>
<text text-anchor="middle" x="48316" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="48316" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Output&#45;&gt;R1_Stage3_L10_Output -->
<g id="edge15" class="edge">
<title>R1_Stage3_L9_Output&#45;&gt;R1_Stage3_L10_Output</title>
<path fill="none" stroke="black" d="M48307.5,-1939.99C48307.5,-1939.99 48307.5,-1817.28 48307.5,-1817.28"/>
<polygon fill="black" stroke="black" points="48311,-1817.28 48307.5,-1807.28 48304,-1817.28 48311,-1817.28"/>
</g>
<!-- R1_Stage3_L11_Output -->
<g id="node17" class="node">
<title>R1_Stage3_L11_Output</title>
<ellipse fill="lightblue" stroke="black" cx="47940" cy="-1601" rx="225.5" ry="29"/>
<text text-anchor="middle" x="47940" y="-1609.5" font-family="Times,serif" font-size="10.00">Layer 11 Output</text>
<text text-anchor="middle" x="47940" y="-1598.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="47940" y="-1587.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Output&#45;&gt;R1_Stage3_L11_Output -->
<g id="edge16" class="edge">
<title>R1_Stage3_L10_Output&#45;&gt;R1_Stage3_L11_Output</title>
<path fill="none" stroke="black" d="M48128,-1761.98C48128,-1761.98 48128,-1627.11 48128,-1627.11"/>
<polygon fill="black" stroke="black" points="48131.5,-1627.11 48128,-1617.11 48124.5,-1627.11 48131.5,-1627.11"/>
</g>
<!-- R1_Stage3_L12_Output -->
<g id="node18" class="node">
<title>R1_Stage3_L12_Output</title>
<ellipse fill="lightblue" stroke="black" cx="47940" cy="-1424" rx="225.5" ry="29"/>
<text text-anchor="middle" x="47940" y="-1432.5" font-family="Times,serif" font-size="10.00">Layer 12 Output</text>
<text text-anchor="middle" x="47940" y="-1421.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="47940" y="-1410.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Output&#45;&gt;R1_Stage3_L12_Output -->
<g id="edge17" class="edge">
<title>R1_Stage3_L11_Output&#45;&gt;R1_Stage3_L12_Output</title>
<path fill="none" stroke="black" d="M48015.17,-1573.34C48015.17,-1573.34 48015.17,-1461.46 48015.17,-1461.46"/>
<polygon fill="black" stroke="black" points="48018.67,-1461.46 48015.17,-1451.46 48011.67,-1461.46 48018.67,-1461.46"/>
</g>
<!-- R1_Stage3_Output -->
<g id="node19" class="node">
<title>R1_Stage3_Output</title>
<ellipse fill="lightblue" stroke="black" cx="49079" cy="-1233" rx="177.36" ry="29"/>
<text text-anchor="middle" x="49079" y="-1241.5" font-family="Times,serif" font-size="10.00">Stage3 Output</text>
<text text-anchor="middle" x="49079" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="49079" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R1_Stage3_L12_Output&#45;&gt;R1_Stage3_Output -->
<g id="edge18" class="edge">
<title>R1_Stage3_L12_Output&#45;&gt;R1_Stage3_Output</title>
<path fill="none" stroke="black" d="M48165.63,-1424C48493.17,-1424 49061.65,-1424 49061.65,-1424 49061.65,-1424 49061.65,-1272.01 49061.65,-1272.01"/>
<polygon fill="black" stroke="black" points="49065.15,-1272.01 49061.65,-1262.01 49058.15,-1272.01 49065.15,-1272.01"/>
</g>
<!-- R1_Stage4_Input -->
<g id="node20" class="node">
<title>R1_Stage4_Input</title>
<ellipse fill="lightblue" stroke="black" cx="50984" cy="-1042" rx="177.36" ry="29"/>
<text text-anchor="middle" x="50984" y="-1050.5" font-family="Times,serif" font-size="10.00">Stage4 Input</text>
<text text-anchor="middle" x="50984" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="50984" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R1_Stage3_Output&#45;&gt;R1_Stage4_Input -->
<g id="edge19" class="edge">
<title>R1_Stage3_Output&#45;&gt;R1_Stage4_Input</title>
<path fill="none" stroke="black" d="M49239.08,-1245.96C49239.08,-1258.94 49239.08,-1277 49239.08,-1277 49239.08,-1277 50926,-1277 50926,-1277 50926,-1277 50926,-1079.42 50926,-1079.42"/>
<polygon fill="black" stroke="black" points="50929.5,-1079.42 50926,-1069.42 50922.5,-1079.42 50929.5,-1079.42"/>
<text text-anchor="middle" x="49725" y="-1133.8" font-family="Times,serif" font-size="14.00">PP Communication</text>
</g>
<!-- R1_Stage4_L13_Output -->
<g id="node21" class="node">
<title>R1_Stage4_L13_Output</title>
<ellipse fill="lightblue" stroke="black" cx="55280" cy="-851" rx="225.5" ry="29"/>
<text text-anchor="middle" x="55280" y="-859.5" font-family="Times,serif" font-size="10.00">Layer 13 Output</text>
<text text-anchor="middle" x="55280" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="55280" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_Input&#45;&gt;R1_Stage4_L13_Output -->
<g id="edge20" class="edge">
<title>R1_Stage4_Input&#45;&gt;R1_Stage4_L13_Output</title>
<path fill="none" stroke="black" d="M51077.62,-1017.14C51077.62,-999.89 51077.62,-980 51077.62,-980 51077.62,-980 55069.62,-980 55069.62,-980 55069.62,-980 55069.62,-871.56 55069.62,-871.56"/>
<polygon fill="black" stroke="black" points="55073.13,-871.56 55069.62,-861.56 55066.13,-871.56 55073.13,-871.56"/>
</g>
<!-- R1_Stage4_L14_Output -->
<g id="node22" class="node">
<title>R1_Stage4_L14_Output</title>
<ellipse fill="lightblue" stroke="black" cx="55297" cy="-660" rx="225.5" ry="29"/>
<text text-anchor="middle" x="55297" y="-668.5" font-family="Times,serif" font-size="10.00">Layer 14 Output</text>
<text text-anchor="middle" x="55297" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="55297" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Output&#45;&gt;R1_Stage4_L14_Output -->
<g id="edge21" class="edge">
<title>R1_Stage4_L13_Output&#45;&gt;R1_Stage4_L14_Output</title>
<path fill="none" stroke="black" d="M55288.5,-821.99C55288.5,-821.99 55288.5,-699.28 55288.5,-699.28"/>
<polygon fill="black" stroke="black" points="55292,-699.28 55288.5,-689.28 55285,-699.28 55292,-699.28"/>
</g>
<!-- R1_Stage4_L15_Output -->
<g id="node23" class="node">
<title>R1_Stage4_L15_Output</title>
<ellipse fill="lightblue" stroke="black" cx="54705" cy="-483" rx="225.5" ry="29"/>
<text text-anchor="middle" x="54705" y="-491.5" font-family="Times,serif" font-size="10.00">Layer 15 Output</text>
<text text-anchor="middle" x="54705" y="-480.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="54705" y="-469.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Output&#45;&gt;R1_Stage4_L15_Output -->
<g id="edge22" class="edge">
<title>R1_Stage4_L14_Output&#45;&gt;R1_Stage4_L15_Output</title>
<path fill="none" stroke="black" d="M55297,-630.77C55297,-580.5 55297,-483 55297,-483 55297,-483 54940.92,-483 54940.92,-483"/>
<polygon fill="black" stroke="black" points="54940.92,-479.5 54930.92,-483 54940.92,-486.5 54940.92,-479.5"/>
</g>
<!-- R1_Stage4_L16_Output -->
<g id="node24" class="node">
<title>R1_Stage4_L16_Output</title>
<ellipse fill="lightblue" stroke="black" cx="53420" cy="-329" rx="225.5" ry="29"/>
<text text-anchor="middle" x="53420" y="-337.5" font-family="Times,serif" font-size="10.00">Layer 16 Output</text>
<text text-anchor="middle" x="53420" y="-326.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="53420" y="-315.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Output&#45;&gt;R1_Stage4_L16_Output -->
<g id="edge23" class="edge">
<title>R1_Stage4_L15_Output&#45;&gt;R1_Stage4_L16_Output</title>
<path fill="none" stroke="black" d="M54479.17,-483C54153.94,-483 53592.33,-483 53592.33,-483 53592.33,-483 53592.33,-357.88 53592.33,-357.88"/>
<polygon fill="black" stroke="black" points="53595.83,-357.88 53592.33,-347.88 53588.83,-357.88 53595.83,-357.88"/>
</g>
<!-- R1_Stage4_Output -->
<g id="node25" class="node">
<title>R1_Stage4_Output</title>
<ellipse fill="lightblue" stroke="black" cx="53420" cy="-198" rx="177.36" ry="29"/>
<text text-anchor="middle" x="53420" y="-206.5" font-family="Times,serif" font-size="10.00">Stage4 Output</text>
<text text-anchor="middle" x="53420" y="-195.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="53420" y="-184.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R1_Stage4_L16_Output&#45;&gt;R1_Stage4_Output -->
<g id="edge24" class="edge">
<title>R1_Stage4_L16_Output&#45;&gt;R1_Stage4_Output</title>
<path fill="none" stroke="black" d="M53420,-299.93C53420,-299.93 53420,-237.44 53420,-237.44"/>
<polygon fill="black" stroke="black" points="53423.5,-237.44 53420,-227.44 53416.5,-237.44 53423.5,-237.44"/>
</g>
<!-- R1_Output -->
<g id="node26" class="node">
<title>R1_Output</title>
<ellipse fill="lightblue" stroke="black" cx="53420" cy="-53" rx="177.36" ry="29"/>
<text text-anchor="middle" x="53420" y="-61.5" font-family="Times,serif" font-size="10.00">Output</text>
<text text-anchor="middle" x="53420" y="-50.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="53420" y="-39.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R1_Stage4_Output&#45;&gt;R1_Output -->
<g id="edge25" class="edge">
<title>R1_Stage4_Output&#45;&gt;R1_Output</title>
<path fill="none" stroke="black" d="M53420,-168.66C53420,-168.66 53420,-92.3 53420,-92.3"/>
<polygon fill="black" stroke="black" points="53423.5,-92.3 53420,-82.3 53416.5,-92.3 53423.5,-92.3"/>
<text text-anchor="middle" x="53465.5" y="-121.8" font-family="Times,serif" font-size="14.00">Final Output</text>
</g>
<!-- R2_Input -->
<g id="node27" class="node">
<title>R2_Input</title>
<ellipse fill="lightblue" stroke="black" cx="7181" cy="-4587" rx="177.36" ry="29"/>
<text text-anchor="middle" x="7181" y="-4595.5" font-family="Times,serif" font-size="10.00">Input</text>
<text text-anchor="middle" x="7181" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="7181" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R2_Stage1_Input -->
<g id="node28" class="node">
<title>R2_Stage1_Input</title>
<ellipse fill="lightblue" stroke="black" cx="8720" cy="-4396" rx="177.36" ry="29"/>
<text text-anchor="middle" x="8720" y="-4404.5" font-family="Times,serif" font-size="10.00">Stage1 Input</text>
<text text-anchor="middle" x="8720" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="8720" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R2_Input&#45;&gt;R2_Stage1_Input -->
<g id="edge26" class="edge">
<title>R2_Input&#45;&gt;R2_Stage1_Input</title>
<path fill="none" stroke="black" d="M7181,-4557.76C7181,-4534.56 7181,-4506 7181,-4506 7181,-4506 8583.38,-4506 8583.38,-4506 8583.38,-4506 8583.38,-4424.66 8583.38,-4424.66"/>
<polygon fill="black" stroke="black" points="8586.88,-4424.66 8583.38,-4414.66 8579.88,-4424.66 8586.88,-4424.66"/>
</g>
<!-- R2_Stage1_L1_Output -->
<g id="node29" class="node">
<title>R2_Stage1_L1_Output</title>
<ellipse fill="lightblue" stroke="black" cx="13016" cy="-4205" rx="225.5" ry="29"/>
<text text-anchor="middle" x="13016" y="-4213.5" font-family="Times,serif" font-size="10.00">Layer 1 Output</text>
<text text-anchor="middle" x="13016" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="13016" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_Input&#45;&gt;R2_Stage1_L1_Output -->
<g id="edge27" class="edge">
<title>R2_Stage1_Input&#45;&gt;R2_Stage1_L1_Output</title>
<path fill="none" stroke="black" d="M8813.62,-4371.27C8813.62,-4356.27 8813.62,-4340 8813.62,-4340 8813.62,-4340 12805.62,-4340 12805.62,-4340 12805.62,-4340 12805.62,-4225.59 12805.62,-4225.59"/>
<polygon fill="black" stroke="black" points="12809.13,-4225.59 12805.62,-4215.59 12802.13,-4225.59 12809.13,-4225.59"/>
</g>
<!-- R2_Stage1_L2_Output -->
<g id="node30" class="node">
<title>R2_Stage1_L2_Output</title>
<ellipse fill="lightblue" stroke="black" cx="13033" cy="-4014" rx="225.5" ry="29"/>
<text text-anchor="middle" x="13033" y="-4022.5" font-family="Times,serif" font-size="10.00">Layer 2 Output</text>
<text text-anchor="middle" x="13033" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="13033" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Output&#45;&gt;R2_Stage1_L2_Output -->
<g id="edge28" class="edge">
<title>R2_Stage1_L1_Output&#45;&gt;R2_Stage1_L2_Output</title>
<path fill="none" stroke="black" d="M13024.5,-4175.99C13024.5,-4175.99 13024.5,-4053.28 13024.5,-4053.28"/>
<polygon fill="black" stroke="black" points="13028,-4053.28 13024.5,-4043.28 13021,-4053.28 13028,-4053.28"/>
</g>
<!-- R2_Stage1_L3_Output -->
<g id="node31" class="node">
<title>R2_Stage1_L3_Output</title>
<ellipse fill="lightblue" stroke="black" cx="12441" cy="-3837" rx="225.5" ry="29"/>
<text text-anchor="middle" x="12441" y="-3845.5" font-family="Times,serif" font-size="10.00">Layer 3 Output</text>
<text text-anchor="middle" x="12441" y="-3834.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="12441" y="-3823.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Output&#45;&gt;R2_Stage1_L3_Output -->
<g id="edge29" class="edge">
<title>R2_Stage1_L2_Output&#45;&gt;R2_Stage1_L3_Output</title>
<path fill="none" stroke="black" d="M13033,-3984.77C13033,-3934.5 13033,-3837 13033,-3837 13033,-3837 12676.92,-3837 12676.92,-3837"/>
<polygon fill="black" stroke="black" points="12676.92,-3833.5 12666.92,-3837 12676.92,-3840.5 12676.92,-3833.5"/>
</g>
<!-- R2_Stage1_L4_Output -->
<g id="node32" class="node">
<title>R2_Stage1_L4_Output</title>
<ellipse fill="lightblue" stroke="black" cx="9725" cy="-3660" rx="225.5" ry="29"/>
<text text-anchor="middle" x="9725" y="-3668.5" font-family="Times,serif" font-size="10.00">Layer 4 Output</text>
<text text-anchor="middle" x="9725" y="-3657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="9725" y="-3646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Output&#45;&gt;R2_Stage1_L4_Output -->
<g id="edge30" class="edge">
<title>R2_Stage1_L3_Output&#45;&gt;R2_Stage1_L4_Output</title>
<path fill="none" stroke="black" d="M12441,-3807.77C12441,-3757.5 12441,-3660 12441,-3660 12441,-3660 9960.73,-3660 9960.73,-3660"/>
<polygon fill="black" stroke="black" points="9960.73,-3656.5 9950.73,-3660 9960.73,-3663.5 9960.73,-3656.5"/>
</g>
<!-- R2_Stage1_Output -->
<g id="node33" class="node">
<title>R2_Stage1_Output</title>
<ellipse fill="lightblue" stroke="black" cx="8711" cy="-3469" rx="177.36" ry="29"/>
<text text-anchor="middle" x="8711" y="-3477.5" font-family="Times,serif" font-size="10.00">Stage1 Output</text>
<text text-anchor="middle" x="8711" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="8711" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R2_Stage1_L4_Output&#45;&gt;R2_Stage1_Output -->
<g id="edge31" class="edge">
<title>R2_Stage1_L4_Output&#45;&gt;R2_Stage1_Output</title>
<path fill="none" stroke="black" d="M9499.28,-3660C9246.33,-3660 8871.22,-3660 8871.22,-3660 8871.22,-3660 8871.22,-3491.53 8871.22,-3491.53"/>
<polygon fill="black" stroke="black" points="8874.72,-3491.53 8871.22,-3481.53 8867.72,-3491.53 8874.72,-3491.53"/>
</g>
<!-- R2_Stage2_Input -->
<g id="node34" class="node">
<title>R2_Stage2_Input</title>
<ellipse fill="lightblue" stroke="black" cx="6811" cy="-3278" rx="177.36" ry="29"/>
<text text-anchor="middle" x="6811" y="-3286.5" font-family="Times,serif" font-size="10.00">Stage2 Input</text>
<text text-anchor="middle" x="6811" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="6811" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R2_Stage1_Output&#45;&gt;R2_Stage2_Input -->
<g id="edge32" class="edge">
<title>R2_Stage1_Output&#45;&gt;R2_Stage2_Input</title>
<path fill="none" stroke="black" d="M8711,-3439.99C8711,-3386.56 8711,-3278 8711,-3278 8711,-3278 6998.47,-3278 6998.47,-3278"/>
<polygon fill="black" stroke="black" points="6998.47,-3274.5 6988.47,-3278 6998.47,-3281.5 6998.47,-3274.5"/>
<text text-anchor="middle" x="7829" y="-3369.8" font-family="Times,serif" font-size="14.00">PP Communication</text>
</g>
<!-- R2_Stage2_L5_Output -->
<g id="node35" class="node">
<title>R2_Stage2_L5_Output</title>
<ellipse fill="lightblue" stroke="black" cx="6371" cy="-3087" rx="225.5" ry="29"/>
<text text-anchor="middle" x="6371" y="-3095.5" font-family="Times,serif" font-size="10.00">Layer 5 Output</text>
<text text-anchor="middle" x="6371" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="6371" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_Input&#45;&gt;R2_Stage2_L5_Output -->
<g id="edge33" class="edge">
<title>R2_Stage2_Input&#45;&gt;R2_Stage2_L5_Output</title>
<path fill="none" stroke="black" d="M6746.5,-3250.63C6746.5,-3197.82 6746.5,-3087 6746.5,-3087 6746.5,-3087 6606.74,-3087 6606.74,-3087"/>
<polygon fill="black" stroke="black" points="6606.74,-3083.5 6596.74,-3087 6606.74,-3090.5 6606.74,-3083.5"/>
</g>
<!-- R2_Stage2_L6_Output -->
<g id="node36" class="node">
<title>R2_Stage2_L6_Output</title>
<ellipse fill="lightblue" stroke="black" cx="5779" cy="-2896" rx="225.5" ry="29"/>
<text text-anchor="middle" x="5779" y="-2904.5" font-family="Times,serif" font-size="10.00">Layer 6 Output</text>
<text text-anchor="middle" x="5779" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="5779" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Output&#45;&gt;R2_Stage2_L6_Output -->
<g id="edge34" class="edge">
<title>R2_Stage2_L5_Output&#45;&gt;R2_Stage2_L6_Output</title>
<path fill="none" stroke="black" d="M6325.03,-3058.41C6325.03,-3005.12 6325.03,-2896 6325.03,-2896 6325.03,-2896 6014.64,-2896 6014.64,-2896"/>
<polygon fill="black" stroke="black" points="6014.64,-2892.5 6004.64,-2896 6014.64,-2899.5 6014.64,-2892.5"/>
</g>
<!-- R2_Stage2_L7_Output -->
<g id="node37" class="node">
<title>R2_Stage2_L7_Output</title>
<ellipse fill="lightblue" stroke="black" cx="5398" cy="-2719" rx="225.5" ry="29"/>
<text text-anchor="middle" x="5398" y="-2727.5" font-family="Times,serif" font-size="10.00">Layer 7 Output</text>
<text text-anchor="middle" x="5398" y="-2716.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="5398" y="-2705.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Output&#45;&gt;R2_Stage2_L7_Output -->
<g id="edge35" class="edge">
<title>R2_Stage2_L6_Output&#45;&gt;R2_Stage2_L7_Output</title>
<path fill="none" stroke="black" d="M5588.5,-2880.29C5588.5,-2880.29 5588.5,-2744.67 5588.5,-2744.67"/>
<polygon fill="black" stroke="black" points="5592,-2744.67 5588.5,-2734.67 5585,-2744.67 5592,-2744.67"/>
</g>
<!-- R2_Stage2_L8_Output -->
<g id="node38" class="node">
<title>R2_Stage2_L8_Output</title>
<ellipse fill="lightblue" stroke="black" cx="5398" cy="-2542" rx="225.5" ry="29"/>
<text text-anchor="middle" x="5398" y="-2550.5" font-family="Times,serif" font-size="10.00">Layer 8 Output</text>
<text text-anchor="middle" x="5398" y="-2539.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="5398" y="-2528.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Output&#45;&gt;R2_Stage2_L8_Output -->
<g id="edge36" class="edge">
<title>R2_Stage2_L7_Output&#45;&gt;R2_Stage2_L8_Output</title>
<path fill="none" stroke="black" d="M5473.17,-2691.34C5473.17,-2691.34 5473.17,-2579.46 5473.17,-2579.46"/>
<polygon fill="black" stroke="black" points="5476.67,-2579.46 5473.17,-2569.46 5469.67,-2579.46 5476.67,-2579.46"/>
</g>
<!-- R2_Stage2_Output -->
<g id="node39" class="node">
<title>R2_Stage2_Output</title>
<ellipse fill="lightblue" stroke="black" cx="6682" cy="-2351" rx="177.36" ry="29"/>
<text text-anchor="middle" x="6682" y="-2359.5" font-family="Times,serif" font-size="10.00">Stage2 Output</text>
<text text-anchor="middle" x="6682" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="6682" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R2_Stage2_L8_Output&#45;&gt;R2_Stage2_Output -->
<g id="edge37" class="edge">
<title>R2_Stage2_L8_Output&#45;&gt;R2_Stage2_Output</title>
<path fill="none" stroke="black" d="M5623.64,-2542C5959.17,-2542 6550.53,-2542 6550.53,-2542 6550.53,-2542 6550.53,-2380.72 6550.53,-2380.72"/>
<polygon fill="black" stroke="black" points="6554.03,-2380.72 6550.53,-2370.72 6547.03,-2380.72 6554.03,-2380.72"/>
</g>
<!-- R2_Stage3_Input -->
<g id="node40" class="node">
<title>R2_Stage3_Input</title>
<ellipse fill="lightblue" stroke="black" cx="15701" cy="-2160" rx="177.36" ry="29"/>
<text text-anchor="middle" x="15701" y="-2168.5" font-family="Times,serif" font-size="10.00">Stage3 Input</text>
<text text-anchor="middle" x="15701" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="15701" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R2_Stage2_Output&#45;&gt;R2_Stage3_Input -->
<g id="edge38" class="edge">
<title>R2_Stage2_Output&#45;&gt;R2_Stage3_Input</title>
<path fill="none" stroke="black" d="M6682,-2321.94C6682,-2293.68 6682,-2255 6682,-2255 6682,-2255 15557.38,-2255 15557.38,-2255 15557.38,-2255 15557.38,-2187.42 15557.38,-2187.42"/>
<polygon fill="black" stroke="black" points="15560.88,-2187.42 15557.38,-2177.42 15553.88,-2187.42 15560.88,-2187.42"/>
<text text-anchor="middle" x="10996" y="-2251.8" font-family="Times,serif" font-size="14.00">PP Communication</text>
</g>
<!-- R2_Stage3_L9_Output -->
<g id="node41" class="node">
<title>R2_Stage3_L9_Output</title>
<ellipse fill="lightblue" stroke="black" cx="19997" cy="-1969" rx="225.5" ry="29"/>
<text text-anchor="middle" x="19997" y="-1977.5" font-family="Times,serif" font-size="10.00">Layer 9 Output</text>
<text text-anchor="middle" x="19997" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="19997" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_Input&#45;&gt;R2_Stage3_L9_Output -->
<g id="edge39" class="edge">
<title>R2_Stage3_Input&#45;&gt;R2_Stage3_L9_Output</title>
<path fill="none" stroke="black" d="M15794.62,-2135.27C15794.62,-2120.27 15794.62,-2104 15794.62,-2104 15794.62,-2104 19786.62,-2104 19786.62,-2104 19786.62,-2104 19786.62,-1989.59 19786.62,-1989.59"/>
<polygon fill="black" stroke="black" points="19790.13,-1989.59 19786.62,-1979.59 19783.13,-1989.59 19790.13,-1989.59"/>
</g>
<!-- R2_Stage3_L10_Output -->
<g id="node42" class="node">
<title>R2_Stage3_L10_Output</title>
<ellipse fill="lightblue" stroke="black" cx="20014" cy="-1778" rx="225.5" ry="29"/>
<text text-anchor="middle" x="20014" y="-1786.5" font-family="Times,serif" font-size="10.00">Layer 10 Output</text>
<text text-anchor="middle" x="20014" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="20014" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Output&#45;&gt;R2_Stage3_L10_Output -->
<g id="edge40" class="edge">
<title>R2_Stage3_L9_Output&#45;&gt;R2_Stage3_L10_Output</title>
<path fill="none" stroke="black" d="M20005.5,-1939.99C20005.5,-1939.99 20005.5,-1817.28 20005.5,-1817.28"/>
<polygon fill="black" stroke="black" points="20009,-1817.28 20005.5,-1807.28 20002,-1817.28 20009,-1817.28"/>
</g>
<!-- R2_Stage3_L11_Output -->
<g id="node43" class="node">
<title>R2_Stage3_L11_Output</title>
<ellipse fill="lightblue" stroke="black" cx="19638" cy="-1601" rx="225.5" ry="29"/>
<text text-anchor="middle" x="19638" y="-1609.5" font-family="Times,serif" font-size="10.00">Layer 11 Output</text>
<text text-anchor="middle" x="19638" y="-1598.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="19638" y="-1587.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Output&#45;&gt;R2_Stage3_L11_Output -->
<g id="edge41" class="edge">
<title>R2_Stage3_L10_Output&#45;&gt;R2_Stage3_L11_Output</title>
<path fill="none" stroke="black" d="M19826,-1761.98C19826,-1761.98 19826,-1627.11 19826,-1627.11"/>
<polygon fill="black" stroke="black" points="19829.5,-1627.11 19826,-1617.11 19822.5,-1627.11 19829.5,-1627.11"/>
</g>
<!-- R2_Stage3_L12_Output -->
<g id="node44" class="node">
<title>R2_Stage3_L12_Output</title>
<ellipse fill="lightblue" stroke="black" cx="19638" cy="-1424" rx="225.5" ry="29"/>
<text text-anchor="middle" x="19638" y="-1432.5" font-family="Times,serif" font-size="10.00">Layer 12 Output</text>
<text text-anchor="middle" x="19638" y="-1421.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="19638" y="-1410.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Output&#45;&gt;R2_Stage3_L12_Output -->
<g id="edge42" class="edge">
<title>R2_Stage3_L11_Output&#45;&gt;R2_Stage3_L12_Output</title>
<path fill="none" stroke="black" d="M19713.17,-1573.34C19713.17,-1573.34 19713.17,-1461.46 19713.17,-1461.46"/>
<polygon fill="black" stroke="black" points="19716.67,-1461.46 19713.17,-1451.46 19709.67,-1461.46 19716.67,-1461.46"/>
</g>
<!-- R2_Stage3_Output -->
<g id="node45" class="node">
<title>R2_Stage3_Output</title>
<ellipse fill="lightblue" stroke="black" cx="20777" cy="-1233" rx="177.36" ry="29"/>
<text text-anchor="middle" x="20777" y="-1241.5" font-family="Times,serif" font-size="10.00">Stage3 Output</text>
<text text-anchor="middle" x="20777" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="20777" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R2_Stage3_L12_Output&#45;&gt;R2_Stage3_Output -->
<g id="edge43" class="edge">
<title>R2_Stage3_L12_Output&#45;&gt;R2_Stage3_Output</title>
<path fill="none" stroke="black" d="M19863.63,-1424C20191.17,-1424 20759.65,-1424 20759.65,-1424 20759.65,-1424 20759.65,-1272.01 20759.65,-1272.01"/>
<polygon fill="black" stroke="black" points="20763.15,-1272.01 20759.65,-1262.01 20756.15,-1272.01 20763.15,-1272.01"/>
</g>
<!-- R2_Stage4_Input -->
<g id="node46" class="node">
<title>R2_Stage4_Input</title>
<ellipse fill="lightblue" stroke="black" cx="22682" cy="-1042" rx="177.36" ry="29"/>
<text text-anchor="middle" x="22682" y="-1050.5" font-family="Times,serif" font-size="10.00">Stage4 Input</text>
<text text-anchor="middle" x="22682" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="22682" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R2_Stage3_Output&#45;&gt;R2_Stage4_Input -->
<g id="edge44" class="edge">
<title>R2_Stage3_Output&#45;&gt;R2_Stage4_Input</title>
<path fill="none" stroke="black" d="M20937.08,-1245.96C20937.08,-1258.94 20937.08,-1277 20937.08,-1277 20937.08,-1277 22624,-1277 22624,-1277 22624,-1277 22624,-1079.42 22624,-1079.42"/>
<polygon fill="black" stroke="black" points="22627.5,-1079.42 22624,-1069.42 22620.5,-1079.42 22627.5,-1079.42"/>
<text text-anchor="middle" x="21423" y="-1133.8" font-family="Times,serif" font-size="14.00">PP Communication</text>
</g>
<!-- R2_Stage4_L13_Output -->
<g id="node47" class="node">
<title>R2_Stage4_L13_Output</title>
<ellipse fill="lightblue" stroke="black" cx="26978" cy="-851" rx="225.5" ry="29"/>
<text text-anchor="middle" x="26978" y="-859.5" font-family="Times,serif" font-size="10.00">Layer 13 Output</text>
<text text-anchor="middle" x="26978" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="26978" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_Input&#45;&gt;R2_Stage4_L13_Output -->
<g id="edge45" class="edge">
<title>R2_Stage4_Input&#45;&gt;R2_Stage4_L13_Output</title>
<path fill="none" stroke="black" d="M22775.62,-1017.27C22775.62,-1002.27 22775.62,-986 22775.62,-986 22775.62,-986 26767.62,-986 26767.62,-986 26767.62,-986 26767.62,-871.59 26767.62,-871.59"/>
<polygon fill="black" stroke="black" points="26771.13,-871.59 26767.62,-861.59 26764.13,-871.59 26771.13,-871.59"/>
</g>
<!-- R2_Stage4_L14_Output -->
<g id="node48" class="node">
<title>R2_Stage4_L14_Output</title>
<ellipse fill="lightblue" stroke="black" cx="26995" cy="-660" rx="225.5" ry="29"/>
<text text-anchor="middle" x="26995" y="-668.5" font-family="Times,serif" font-size="10.00">Layer 14 Output</text>
<text text-anchor="middle" x="26995" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="26995" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Output&#45;&gt;R2_Stage4_L14_Output -->
<g id="edge46" class="edge">
<title>R2_Stage4_L13_Output&#45;&gt;R2_Stage4_L14_Output</title>
<path fill="none" stroke="black" d="M26986.5,-821.99C26986.5,-821.99 26986.5,-699.28 26986.5,-699.28"/>
<polygon fill="black" stroke="black" points="26990,-699.28 26986.5,-689.28 26983,-699.28 26990,-699.28"/>
</g>
<!-- R2_Stage4_L15_Output -->
<g id="node49" class="node">
<title>R2_Stage4_L15_Output</title>
<ellipse fill="lightblue" stroke="black" cx="26403" cy="-483" rx="225.5" ry="29"/>
<text text-anchor="middle" x="26403" y="-491.5" font-family="Times,serif" font-size="10.00">Layer 15 Output</text>
<text text-anchor="middle" x="26403" y="-480.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="26403" y="-469.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Output&#45;&gt;R2_Stage4_L15_Output -->
<g id="edge47" class="edge">
<title>R2_Stage4_L14_Output&#45;&gt;R2_Stage4_L15_Output</title>
<path fill="none" stroke="black" d="M26995,-630.77C26995,-580.5 26995,-483 26995,-483 26995,-483 26638.92,-483 26638.92,-483"/>
<polygon fill="black" stroke="black" points="26638.92,-479.5 26628.92,-483 26638.92,-486.5 26638.92,-479.5"/>
</g>
<!-- R2_Stage4_L16_Output -->
<g id="node50" class="node">
<title>R2_Stage4_L16_Output</title>
<ellipse fill="lightblue" stroke="black" cx="25118" cy="-329" rx="225.5" ry="29"/>
<text text-anchor="middle" x="25118" y="-337.5" font-family="Times,serif" font-size="10.00">Layer 16 Output</text>
<text text-anchor="middle" x="25118" y="-326.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="25118" y="-315.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Output&#45;&gt;R2_Stage4_L16_Output -->
<g id="edge48" class="edge">
<title>R2_Stage4_L15_Output&#45;&gt;R2_Stage4_L16_Output</title>
<path fill="none" stroke="black" d="M26177.17,-483C25851.94,-483 25290.33,-483 25290.33,-483 25290.33,-483 25290.33,-357.88 25290.33,-357.88"/>
<polygon fill="black" stroke="black" points="25293.83,-357.88 25290.33,-347.88 25286.83,-357.88 25293.83,-357.88"/>
</g>
<!-- R2_Stage4_Output -->
<g id="node51" class="node">
<title>R2_Stage4_Output</title>
<ellipse fill="lightblue" stroke="black" cx="25118" cy="-198" rx="177.36" ry="29"/>
<text text-anchor="middle" x="25118" y="-206.5" font-family="Times,serif" font-size="10.00">Stage4 Output</text>
<text text-anchor="middle" x="25118" y="-195.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="25118" y="-184.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R2_Stage4_L16_Output&#45;&gt;R2_Stage4_Output -->
<g id="edge49" class="edge">
<title>R2_Stage4_L16_Output&#45;&gt;R2_Stage4_Output</title>
<path fill="none" stroke="black" d="M25118,-299.93C25118,-299.93 25118,-237.44 25118,-237.44"/>
<polygon fill="black" stroke="black" points="25121.5,-237.44 25118,-227.44 25114.5,-237.44 25121.5,-237.44"/>
</g>
<!-- R2_Output -->
<g id="node52" class="node">
<title>R2_Output</title>
<ellipse fill="lightblue" stroke="black" cx="25118" cy="-53" rx="177.36" ry="29"/>
<text text-anchor="middle" x="25118" y="-61.5" font-family="Times,serif" font-size="10.00">Output</text>
<text text-anchor="middle" x="25118" y="-50.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240]</text>
<text text-anchor="middle" x="25118" y="-39.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240]</text>
</g>
<!-- R2_Stage4_Output&#45;&gt;R2_Output -->
<g id="edge50" class="edge">
<title>R2_Stage4_Output&#45;&gt;R2_Output</title>
<path fill="none" stroke="black" d="M25118,-168.66C25118,-168.66 25118,-92.3 25118,-92.3"/>
<polygon fill="black" stroke="black" points="25121.5,-92.3 25118,-82.3 25114.5,-92.3 25121.5,-92.3"/>
<text text-anchor="middle" x="25163.5" y="-121.8" font-family="Times,serif" font-size="14.00">Final Output</text>
</g>
<!-- R1_Stage1_L1_Input -->
<g id="node53" class="node">
<title>R1_Stage1_L1_Input</title>
<ellipse fill="lightblue" stroke="black" cx="32095" cy="-5487.08" rx="225.5" ry="29"/>
<text text-anchor="middle" x="32095" y="-5495.58" font-family="Times,serif" font-size="10.00">Layer 1 Input</text>
<text text-anchor="middle" x="32095" y="-5484.58" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="32095" y="-5473.58" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Attn_Input -->
<g id="node54" class="node">
<title>R1_Stage1_L1_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="32095" cy="-5356.08" rx="225.5" ry="29"/>
<text text-anchor="middle" x="32095" y="-5364.58" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="32095" y="-5353.58" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="32095" y="-5342.58" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Input&#45;&gt;R1_Stage1_L1_Attn_Input -->
<g id="edge51" class="edge">
<title>R1_Stage1_L1_Input&#45;&gt;R1_Stage1_L1_Attn_Input</title>
<path fill="none" stroke="black" d="M32095,-5458.01C32095,-5458.01 32095,-5395.52 32095,-5395.52"/>
<polygon fill="black" stroke="black" points="32098.5,-5395.52 32095,-5385.52 32091.5,-5395.52 32098.5,-5395.52"/>
</g>
<!-- R1_Stage1_L1_Attn_TP1 -->
<g id="node55" class="node">
<title>R1_Stage1_L1_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="32077,-5254.08 31731,-5254.08 31731,-5196.08 32077,-5196.08 32077,-5254.08"/>
<text text-anchor="middle" x="31904" y="-5239.08" font-family="Times,serif" font-size="10.00">Attention TP GPU 0</text>
<text text-anchor="middle" x="31904" y="-5228.08" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="31904" y="-5217.08" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="31904" y="-5206.08" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage1_L1_Attn_Input&#45;&gt;R1_Stage1_L1_Attn_TP1 -->
<g id="edge52" class="edge">
<title>R1_Stage1_L1_Attn_Input&#45;&gt;R1_Stage1_L1_Attn_TP1</title>
<path fill="none" stroke="black" d="M31973.25,-5331.44C31973.25,-5331.44 31973.25,-5264.18 31973.25,-5264.18"/>
<polygon fill="black" stroke="black" points="31976.75,-5264.18 31973.25,-5254.18 31969.75,-5264.18 31976.75,-5264.18"/>
</g>
<!-- R1_Stage1_L1_Attn_TP2 -->
<g id="node56" class="node">
<title>R1_Stage1_L1_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="32459,-5254.08 32113,-5254.08 32113,-5196.08 32459,-5196.08 32459,-5254.08"/>
<text text-anchor="middle" x="32286" y="-5239.08" font-family="Times,serif" font-size="10.00">Attention TP GPU 1</text>
<text text-anchor="middle" x="32286" y="-5228.08" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="32286" y="-5217.08" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="32286" y="-5206.08" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage1_L1_Attn_Input&#45;&gt;R1_Stage1_L1_Attn_TP2 -->
<g id="edge53" class="edge">
<title>R1_Stage1_L1_Attn_Input&#45;&gt;R1_Stage1_L1_Attn_TP2</title>
<path fill="none" stroke="black" d="M32216.75,-5331.44C32216.75,-5331.44 32216.75,-5264.18 32216.75,-5264.18"/>
<polygon fill="black" stroke="black" points="32220.25,-5264.18 32216.75,-5254.18 32213.25,-5264.18 32220.25,-5264.18"/>
</g>
<!-- R1_Stage1_L1_Attn_Output -->
<g id="node57" class="node">
<title>R1_Stage1_L1_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="32050" cy="-5086.31" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="32050" y="-5100.31" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="32050" y="-5089.31" font-family="Times,serif" font-size="10.00">AllReduce GPUs 0&#45;1</text>
<text text-anchor="middle" x="32050" y="-5078.31" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="32050" y="-5067.31" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Attn_TP1&#45;&gt;R1_Stage1_L1_Attn_Output -->
<g id="edge54" class="edge">
<title>R1_Stage1_L1_Attn_TP1&#45;&gt;R1_Stage1_L1_Attn_Output</title>
<path fill="none" stroke="black" d="M31941.88,-5195.99C31941.88,-5195.99 31941.88,-5129.25 31941.88,-5129.25"/>
<polygon fill="black" stroke="black" points="31945.38,-5129.25 31941.88,-5119.25 31938.38,-5129.25 31945.38,-5129.25"/>
</g>
<!-- R1_Stage1_L1_Attn_TP2&#45;&gt;R1_Stage1_L1_Attn_Output -->
<g id="edge55" class="edge">
<title>R1_Stage1_L1_Attn_TP2&#45;&gt;R1_Stage1_L1_Attn_Output</title>
<path fill="none" stroke="black" d="M32203.12,-5195.99C32203.12,-5195.99 32203.12,-5124.89 32203.12,-5124.89"/>
<polygon fill="black" stroke="black" points="32206.62,-5124.89 32203.12,-5114.89 32199.62,-5124.89 32206.62,-5124.89"/>
</g>
<!-- R1_Stage1_L1_MoE_Input -->
<g id="node58" class="node">
<title>R1_Stage1_L1_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="32050" cy="-4939.77" rx="225.5" ry="29"/>
<text text-anchor="middle" x="32050" y="-4948.27" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="32050" y="-4937.27" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="32050" y="-4926.27" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Attn_Output&#45;&gt;R1_Stage1_L1_MoE_Input -->
<g id="edge56" class="edge">
<title>R1_Stage1_L1_Attn_Output&#45;&gt;R1_Stage1_L1_MoE_Input</title>
<path fill="none" stroke="black" d="M32050,-5049.33C32050,-5049.33 32050,-4978.89 32050,-4978.89"/>
<polygon fill="black" stroke="black" points="32053.5,-4978.89 32050,-4968.89 32046.5,-4978.89 32053.5,-4978.89"/>
</g>
<!-- R1_Stage1_L1_Router -->
<g id="node59" class="node">
<title>R1_Stage1_L1_Router</title>
<polygon fill="lightyellow" stroke="black" points="32372.36,-4830 31859.56,-4830 31727.64,-4726 32240.44,-4726 32372.36,-4830"/>
<text text-anchor="middle" x="32050" y="-4792" font-family="Times,serif" font-size="10.00">Router GPU 0</text>
<text text-anchor="middle" x="32050" y="-4781" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="32050" y="-4770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="32050" y="-4759" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage1_L1_MoE_Input&#45;&gt;R1_Stage1_L1_Router -->
<g id="edge57" class="edge">
<title>R1_Stage1_L1_MoE_Input&#45;&gt;R1_Stage1_L1_Router</title>
<path fill="none" stroke="black" d="M32050,-4910.47C32050,-4910.47 32050,-4840.3 32050,-4840.3"/>
<polygon fill="black" stroke="black" points="32053.5,-4840.3 32050,-4830.3 32046.5,-4840.3 32053.5,-4840.3"/>
</g>
<!-- R1_Stage1_L1_Expert0 -->
<g id="node60" class="node">
<title>R1_Stage1_L1_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="34130,-4616 33870,-4616 33870,-4558 34130,-4558 34130,-4616"/>
<text text-anchor="middle" x="34000" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 0</text>
<text text-anchor="middle" x="34000" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="34000" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert0 -->
<g id="edge58" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M32261,-4742C32765.52,-4742 34000,-4742 34000,-4742 34000,-4742 34000,-4626.15 34000,-4626.15"/>
<polygon fill="black" stroke="black" points="34003.5,-4626.15 34000,-4616.15 33996.5,-4626.15 34003.5,-4626.15"/>
<text text-anchor="middle" x="33809.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert1 -->
<g id="node61" class="node">
<title>R1_Stage1_L1_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="34426,-4616 34166,-4616 34166,-4558 34426,-4558 34426,-4616"/>
<text text-anchor="middle" x="34296" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 1</text>
<text text-anchor="middle" x="34296" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="34296" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert1 -->
<g id="edge59" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M32264.59,-4745C32826.18,-4745 34296,-4745 34296,-4745 34296,-4745 34296,-4626.35 34296,-4626.35"/>
<polygon fill="black" stroke="black" points="34299.5,-4626.35 34296,-4616.35 34292.5,-4626.35 34299.5,-4626.35"/>
<text text-anchor="middle" x="34105.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert2 -->
<g id="node62" class="node">
<title>R1_Stage1_L1_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="29986,-4616 29726,-4616 29726,-4558 29986,-4558 29986,-4616"/>
<text text-anchor="middle" x="29856" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 2</text>
<text text-anchor="middle" x="29856" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="29856" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert2 -->
<g id="edge60" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M31742.72,-4738C31163.02,-4738 29965.62,-4738 29965.62,-4738 29965.62,-4738 29965.62,-4626.11 29965.62,-4626.11"/>
<polygon fill="black" stroke="black" points="29969.12,-4626.11 29965.62,-4616.11 29962.12,-4626.11 29969.12,-4626.11"/>
<text text-anchor="middle" x="30087.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert3 -->
<g id="node63" class="node">
<title>R1_Stage1_L1_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="30282,-4616 30022,-4616 30022,-4558 30282,-4558 30282,-4616"/>
<text text-anchor="middle" x="30152" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 3</text>
<text text-anchor="middle" x="30152" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30152" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert3 -->
<g id="edge61" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M31740.16,-4736C31227.33,-4736 30258,-4736 30258,-4736 30258,-4736 30258,-4626.08 30258,-4626.08"/>
<polygon fill="black" stroke="black" points="30261.5,-4626.08 30258,-4616.08 30254.5,-4626.08 30261.5,-4626.08"/>
<text text-anchor="middle" x="30382.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert4 -->
<g id="node64" class="node">
<title>R1_Stage1_L1_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="30578,-4616 30318,-4616 30318,-4558 30578,-4558 30578,-4616"/>
<text text-anchor="middle" x="30448" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 4</text>
<text text-anchor="middle" x="30448" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30448" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert4 -->
<g id="edge62" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M31737.32,-4734C31271.1,-4734 30448,-4734 30448,-4734 30448,-4734 30448,-4626.04 30448,-4626.04"/>
<polygon fill="black" stroke="black" points="30451.5,-4626.04 30448,-4616.04 30444.5,-4626.04 30451.5,-4626.04"/>
<text text-anchor="middle" x="30676.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert5 -->
<g id="node65" class="node">
<title>R1_Stage1_L1_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="30874,-4616 30614,-4616 30614,-4558 30874,-4558 30874,-4616"/>
<text text-anchor="middle" x="30744" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 5</text>
<text text-anchor="middle" x="30744" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30744" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert5 -->
<g id="edge63" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M31733.85,-4731C31347.34,-4731 30744,-4731 30744,-4731 30744,-4731 30744,-4626.14 30744,-4626.14"/>
<polygon fill="black" stroke="black" points="30747.5,-4626.14 30744,-4616.14 30740.5,-4626.14 30747.5,-4626.14"/>
<text text-anchor="middle" x="30967.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert6 -->
<g id="node66" class="node">
<title>R1_Stage1_L1_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="31170,-4616 30910,-4616 30910,-4558 31170,-4558 31170,-4616"/>
<text text-anchor="middle" x="31040" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 6</text>
<text text-anchor="middle" x="31040" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31040" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert6 -->
<g id="edge64" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M31731.12,-4729C31435.15,-4729 31040,-4729 31040,-4729 31040,-4729 31040,-4626.08 31040,-4626.08"/>
<polygon fill="black" stroke="black" points="31043.5,-4626.08 31040,-4616.08 31036.5,-4626.08 31043.5,-4626.08"/>
<text text-anchor="middle" x="31253.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert7 -->
<g id="node67" class="node">
<title>R1_Stage1_L1_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="31466,-4616 31206,-4616 31206,-4558 31466,-4558 31466,-4616"/>
<text text-anchor="middle" x="31336" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 7</text>
<text text-anchor="middle" x="31336" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31336" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert7 -->
<g id="edge65" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M31728.77,-4727C31539.18,-4727 31336,-4727 31336,-4727 31336,-4727 31336,-4626.01 31336,-4626.01"/>
<polygon fill="black" stroke="black" points="31339.5,-4626.01 31336,-4616.01 31332.5,-4626.01 31339.5,-4626.01"/>
<text text-anchor="middle" x="31529.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert8 -->
<g id="node68" class="node">
<title>R1_Stage1_L1_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="31762,-4616 31502,-4616 31502,-4558 31762,-4558 31762,-4616"/>
<text text-anchor="middle" x="31632" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 8</text>
<text text-anchor="middle" x="31632" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31632" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert8 -->
<g id="edge66" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M31744.78,-4777.86C31744.78,-4777.86 31744.78,-4626.01 31744.78,-4626.01"/>
<polygon fill="black" stroke="black" points="31748.28,-4626.01 31744.78,-4616.01 31741.28,-4626.01 31748.28,-4626.01"/>
<text text-anchor="middle" x="31785.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert9 -->
<g id="node69" class="node">
<title>R1_Stage1_L1_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="32058,-4616 31798,-4616 31798,-4558 32058,-4558 32058,-4616"/>
<text text-anchor="middle" x="31928" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 9</text>
<text text-anchor="middle" x="31928" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31928" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert9 -->
<g id="edge67" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M31928,-4725.81C31928,-4725.81 31928,-4626.01 31928,-4626.01"/>
<polygon fill="black" stroke="black" points="31931.5,-4626.01 31928,-4616.01 31924.5,-4626.01 31931.5,-4626.01"/>
<text text-anchor="middle" x="32002.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert10 -->
<g id="node70" class="node">
<title>R1_Stage1_L1_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="32354,-4616 32094,-4616 32094,-4558 32354,-4558 32354,-4616"/>
<text text-anchor="middle" x="32224" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 10</text>
<text text-anchor="middle" x="32224" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32224" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert10 -->
<g id="edge68" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M32224,-4725.81C32224,-4725.81 32224,-4626.01 32224,-4626.01"/>
<polygon fill="black" stroke="black" points="32227.5,-4626.01 32224,-4616.01 32220.5,-4626.01 32227.5,-4626.01"/>
<text text-anchor="middle" x="32139.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert11 -->
<g id="node71" class="node">
<title>R1_Stage1_L1_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="32650,-4616 32390,-4616 32390,-4558 32650,-4558 32650,-4616"/>
<text text-anchor="middle" x="32520" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 11</text>
<text text-anchor="middle" x="32520" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32520" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert11 -->
<g id="edge69" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M32363.22,-4777.86C32363.22,-4772.08 32363.22,-4587 32363.22,-4587 32363.22,-4587 32379.81,-4587 32379.81,-4587"/>
<polygon fill="black" stroke="black" points="32379.81,-4590.5 32389.81,-4587 32379.81,-4583.5 32379.81,-4590.5"/>
<text text-anchor="middle" x="32435.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert12 -->
<g id="node72" class="node">
<title>R1_Stage1_L1_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="32946,-4616 32686,-4616 32686,-4558 32946,-4558 32946,-4616"/>
<text text-anchor="middle" x="32816" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 12</text>
<text text-anchor="middle" x="32816" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32816" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert12 -->
<g id="edge70" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M32244.28,-4729C32471.22,-4729 32816,-4729 32816,-4729 32816,-4729 32816,-4626.08 32816,-4626.08"/>
<polygon fill="black" stroke="black" points="32819.5,-4626.08 32816,-4616.08 32812.5,-4626.08 32819.5,-4626.08"/>
<text text-anchor="middle" x="32678.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert13 -->
<g id="node73" class="node">
<title>R1_Stage1_L1_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="33242,-4616 32982,-4616 32982,-4558 33242,-4558 33242,-4616"/>
<text text-anchor="middle" x="33112" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 13</text>
<text text-anchor="middle" x="33112" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33112" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert13 -->
<g id="edge71" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M32248.2,-4732C32555.51,-4732 33112,-4732 33112,-4732 33112,-4732 33112,-4626.34 33112,-4626.34"/>
<polygon fill="black" stroke="black" points="33115.5,-4626.34 33112,-4616.34 33108.5,-4626.34 33115.5,-4626.34"/>
<text text-anchor="middle" x="32921.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert14 -->
<g id="node74" class="node">
<title>R1_Stage1_L1_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="33538,-4616 33278,-4616 33278,-4558 33538,-4558 33538,-4616"/>
<text text-anchor="middle" x="33408" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 14</text>
<text text-anchor="middle" x="33408" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33408" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert14 -->
<g id="edge72" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M32252.21,-4735C32630.64,-4735 33408,-4735 33408,-4735 33408,-4735 33408,-4626.24 33408,-4626.24"/>
<polygon fill="black" stroke="black" points="33411.5,-4626.24 33408,-4616.24 33404.5,-4626.24 33411.5,-4626.24"/>
<text text-anchor="middle" x="33217.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_Expert15 -->
<g id="node75" class="node">
<title>R1_Stage1_L1_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="33834,-4616 33574,-4616 33574,-4558 33834,-4558 33834,-4616"/>
<text text-anchor="middle" x="33704" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 15</text>
<text text-anchor="middle" x="33704" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33704" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert15 -->
<g id="edge73" class="edge">
<title>R1_Stage1_L1_Router&#45;&gt;R1_Stage1_L1_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M32256.97,-4739C32700.78,-4739 33704,-4739 33704,-4739 33704,-4739 33704,-4626.31 33704,-4626.31"/>
<polygon fill="black" stroke="black" points="33707.5,-4626.31 33704,-4616.31 33700.5,-4626.31 33707.5,-4626.31"/>
<text text-anchor="middle" x="33513.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L1_MoE_Output -->
<g id="node76" class="node">
<title>R1_Stage1_L1_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="30915.95,-4448 30389.48,-4448 30254.05,-4344 30780.52,-4344 30915.95,-4448"/>
<text text-anchor="middle" x="30585" y="-4410" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="30585" y="-4399" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="30585" y="-4388" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="30585" y="-4377" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L1_Expert0&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge74" class="edge">
<title>R1_Stage1_L1_Expert0&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M33894,-4557.84C33894,-4511.93 33894,-4428 33894,-4428 33894,-4428 30900,-4428 30900,-4428"/>
<polygon fill="black" stroke="black" points="30900,-4424.5 30890,-4428 30900,-4431.5 30900,-4424.5"/>
</g>
<!-- R1_Stage1_L1_Expert1&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge75" class="edge">
<title>R1_Stage1_L1_Expert1&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M34190,-4557.84C34190,-4511.45 34190,-4426 34190,-4426 34190,-4426 30897.32,-4426 30897.32,-4426"/>
<polygon fill="black" stroke="black" points="30897.32,-4422.5 30887.32,-4426 30897.32,-4429.5 30897.32,-4422.5"/>
</g>
<!-- R1_Stage1_L1_Expert2&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge76" class="edge">
<title>R1_Stage1_L1_Expert2&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M29945.19,-4557.89C29945.19,-4514.01 29945.19,-4436 29945.19,-4436 29945.19,-4436 30363.73,-4436 30363.73,-4436"/>
<polygon fill="black" stroke="black" points="30363.73,-4439.5 30373.73,-4436 30363.73,-4432.5 30363.73,-4439.5"/>
</g>
<!-- R1_Stage1_L1_Expert3&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge77" class="edge">
<title>R1_Stage1_L1_Expert3&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M30268.14,-4557.99C30268.14,-4557.99 30268.14,-4406.08 30268.14,-4406.08"/>
<polygon fill="black" stroke="black" points="30271.64,-4406.08 30268.14,-4396.08 30264.64,-4406.08 30271.64,-4406.08"/>
</g>
<!-- R1_Stage1_L1_Expert4&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge78" class="edge">
<title>R1_Stage1_L1_Expert4&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M30448,-4557.99C30448,-4557.99 30448,-4458.02 30448,-4458.02"/>
<polygon fill="black" stroke="black" points="30451.5,-4458.02 30448,-4448.02 30444.5,-4458.02 30451.5,-4458.02"/>
</g>
<!-- R1_Stage1_L1_Expert5&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge79" class="edge">
<title>R1_Stage1_L1_Expert5&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M30744,-4557.99C30744,-4557.99 30744,-4458.02 30744,-4458.02"/>
<polygon fill="black" stroke="black" points="30747.5,-4458.02 30744,-4448.02 30740.5,-4458.02 30747.5,-4458.02"/>
</g>
<!-- R1_Stage1_L1_Expert6&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge80" class="edge">
<title>R1_Stage1_L1_Expert6&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M30933.86,-4557.78C30933.86,-4516.48 30933.86,-4446 30933.86,-4446 30933.86,-4446 30923.6,-4446 30923.6,-4446"/>
<polygon fill="black" stroke="black" points="30923.6,-4442.5 30913.6,-4446 30923.6,-4449.5 30923.6,-4442.5"/>
</g>
<!-- R1_Stage1_L1_Expert7&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge81" class="edge">
<title>R1_Stage1_L1_Expert7&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M31230,-4557.72C31230,-4515.88 31230,-4444 31230,-4444 31230,-4444 30920.81,-4444 30920.81,-4444"/>
<polygon fill="black" stroke="black" points="30920.81,-4440.5 30910.81,-4444 30920.81,-4447.5 30920.81,-4440.5"/>
</g>
<!-- R1_Stage1_L1_Expert8&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge82" class="edge">
<title>R1_Stage1_L1_Expert8&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M31526,-4557.66C31526,-4515.29 31526,-4442 31526,-4442 31526,-4442 30918.18,-4442 30918.18,-4442"/>
<polygon fill="black" stroke="black" points="30918.18,-4438.5 30908.18,-4442 30918.18,-4445.5 30918.18,-4438.5"/>
</g>
<!-- R1_Stage1_L1_Expert9&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge83" class="edge">
<title>R1_Stage1_L1_Expert9&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M31822,-4557.96C31822,-4515.12 31822,-4440 31822,-4440 31822,-4440 30915.57,-4440 30915.57,-4440"/>
<polygon fill="black" stroke="black" points="30915.57,-4436.5 30905.57,-4440 30915.57,-4443.5 30915.57,-4436.5"/>
</g>
<!-- R1_Stage1_L1_Expert10&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge84" class="edge">
<title>R1_Stage1_L1_Expert10&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M32118,-4557.76C32118,-4514.63 32118,-4439 32118,-4439 32118,-4439 30914.5,-4439 30914.5,-4439"/>
<polygon fill="black" stroke="black" points="30914.5,-4435.5 30904.5,-4439 30914.5,-4442.5 30914.5,-4435.5"/>
</g>
<!-- R1_Stage1_L1_Expert11&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge85" class="edge">
<title>R1_Stage1_L1_Expert11&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M32414,-4557.72C32414,-4514.07 32414,-4437 32414,-4437 32414,-4437 30911.76,-4437 30911.76,-4437"/>
<polygon fill="black" stroke="black" points="30911.76,-4433.5 30901.76,-4437 30911.76,-4440.5 30911.76,-4433.5"/>
</g>
<!-- R1_Stage1_L1_Expert12&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge86" class="edge">
<title>R1_Stage1_L1_Expert12&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M32710,-4557.69C32710,-4513.52 32710,-4435 32710,-4435 32710,-4435 30909.12,-4435 30909.12,-4435"/>
<polygon fill="black" stroke="black" points="30909.12,-4431.5 30899.12,-4435 30909.12,-4438.5 30909.12,-4431.5"/>
</g>
<!-- R1_Stage1_L1_Expert13&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge87" class="edge">
<title>R1_Stage1_L1_Expert13&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M33006,-4557.67C33006,-4512.99 33006,-4433 33006,-4433 33006,-4433 30906.55,-4433 30906.55,-4433"/>
<polygon fill="black" stroke="black" points="30906.55,-4429.5 30896.55,-4433 30906.55,-4436.5 30906.55,-4429.5"/>
</g>
<!-- R1_Stage1_L1_Expert14&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge88" class="edge">
<title>R1_Stage1_L1_Expert14&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M33302,-4557.85C33302,-4512.95 33302,-4432 33302,-4432 33302,-4432 30905.35,-4432 30905.35,-4432"/>
<polygon fill="black" stroke="black" points="30905.35,-4428.5 30895.35,-4432 30905.35,-4435.5 30905.35,-4428.5"/>
</g>
<!-- R1_Stage1_L1_Expert15&#45;&gt;R1_Stage1_L1_MoE_Output -->
<g id="edge89" class="edge">
<title>R1_Stage1_L1_Expert15&#45;&gt;R1_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M33598,-4557.84C33598,-4512.43 33598,-4430 33598,-4430 33598,-4430 30902.58,-4430 30902.58,-4430"/>
<polygon fill="black" stroke="black" points="30902.58,-4426.5 30892.58,-4430 30902.58,-4433.5 30902.58,-4426.5"/>
</g>
<!-- R1_Stage1_L1_MoE_Output&#45;&gt;R1_Stage1_L1_Output -->
<g id="edge90" class="edge">
<title>R1_Stage1_L1_MoE_Output&#45;&gt;R1_Stage1_L1_Output</title>
<path fill="none" stroke="black" d="M30794.87,-4355C31558.1,-4355 34141.75,-4355 34141.75,-4355 34141.75,-4355 34141.75,-4229.66 34141.75,-4229.66"/>
<polygon fill="black" stroke="black" points="34145.25,-4229.66 34141.75,-4219.66 34138.25,-4229.66 34145.25,-4229.66"/>
</g>
<!-- R1_Stage1_L2_Input -->
<g id="node77" class="node">
<title>R1_Stage1_L2_Input</title>
<ellipse fill="lightblue" stroke="black" cx="34877" cy="-5356.08" rx="225.5" ry="29"/>
<text text-anchor="middle" x="34877" y="-5364.58" font-family="Times,serif" font-size="10.00">Layer 2 Input</text>
<text text-anchor="middle" x="34877" y="-5353.58" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="34877" y="-5342.58" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Attn_Input -->
<g id="node78" class="node">
<title>R1_Stage1_L2_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="34877" cy="-5225.08" rx="225.5" ry="29"/>
<text text-anchor="middle" x="34877" y="-5233.58" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="34877" y="-5222.58" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="34877" y="-5211.58" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Input&#45;&gt;R1_Stage1_L2_Attn_Input -->
<g id="edge91" class="edge">
<title>R1_Stage1_L2_Input&#45;&gt;R1_Stage1_L2_Attn_Input</title>
<path fill="none" stroke="black" d="M34877,-5327.01C34877,-5327.01 34877,-5264.52 34877,-5264.52"/>
<polygon fill="black" stroke="black" points="34880.5,-5264.52 34877,-5254.52 34873.5,-5264.52 34880.5,-5264.52"/>
</g>
<!-- R1_Stage1_L2_Attn_TP1 -->
<g id="node79" class="node">
<title>R1_Stage1_L2_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="35241,-5115.31 34895,-5115.31 34895,-5057.31 35241,-5057.31 35241,-5115.31"/>
<text text-anchor="middle" x="35068" y="-5100.31" font-family="Times,serif" font-size="10.00">Attention TP GPU 0</text>
<text text-anchor="middle" x="35068" y="-5089.31" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="35068" y="-5078.31" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="35068" y="-5067.31" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage1_L2_Attn_Input&#45;&gt;R1_Stage1_L2_Attn_TP1 -->
<g id="edge92" class="edge">
<title>R1_Stage1_L2_Attn_Input&#45;&gt;R1_Stage1_L2_Attn_TP1</title>
<path fill="none" stroke="black" d="M34998.75,-5200.59C34998.75,-5200.59 34998.75,-5125.36 34998.75,-5125.36"/>
<polygon fill="black" stroke="black" points="35002.25,-5125.36 34998.75,-5115.36 34995.25,-5125.36 35002.25,-5125.36"/>
</g>
<!-- R1_Stage1_L2_Attn_TP2 -->
<g id="node80" class="node">
<title>R1_Stage1_L2_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="34859,-5115.31 34513,-5115.31 34513,-5057.31 34859,-5057.31 34859,-5115.31"/>
<text text-anchor="middle" x="34686" y="-5100.31" font-family="Times,serif" font-size="10.00">Attention TP GPU 1</text>
<text text-anchor="middle" x="34686" y="-5089.31" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="34686" y="-5078.31" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="34686" y="-5067.31" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage1_L2_Attn_Input&#45;&gt;R1_Stage1_L2_Attn_TP2 -->
<g id="edge93" class="edge">
<title>R1_Stage1_L2_Attn_Input&#45;&gt;R1_Stage1_L2_Attn_TP2</title>
<path fill="none" stroke="black" d="M34755.25,-5200.59C34755.25,-5200.59 34755.25,-5125.36 34755.25,-5125.36"/>
<polygon fill="black" stroke="black" points="34758.75,-5125.36 34755.25,-5115.36 34751.75,-5125.36 34758.75,-5125.36"/>
</g>
<!-- R1_Stage1_L2_Attn_Output -->
<g id="node81" class="node">
<title>R1_Stage1_L2_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="34784" cy="-4939.77" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="34784" y="-4953.77" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="34784" y="-4942.77" font-family="Times,serif" font-size="10.00">AllReduce GPUs 0&#45;1</text>
<text text-anchor="middle" x="34784" y="-4931.77" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="34784" y="-4920.77" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Attn_TP1&#45;&gt;R1_Stage1_L2_Attn_Output -->
<g id="edge94" class="edge">
<title>R1_Stage1_L2_Attn_TP1&#45;&gt;R1_Stage1_L2_Attn_Output</title>
<path fill="none" stroke="black" d="M34961.12,-5057.01C34961.12,-5057.01 34961.12,-4975.11 34961.12,-4975.11"/>
<polygon fill="black" stroke="black" points="34964.62,-4975.11 34961.12,-4965.11 34957.62,-4975.11 34964.62,-4975.11"/>
</g>
<!-- R1_Stage1_L2_Attn_TP2&#45;&gt;R1_Stage1_L2_Attn_Output -->
<g id="edge95" class="edge">
<title>R1_Stage1_L2_Attn_TP2&#45;&gt;R1_Stage1_L2_Attn_Output</title>
<path fill="none" stroke="black" d="M34699.88,-5057.01C34699.88,-5057.01 34699.88,-4984.43 34699.88,-4984.43"/>
<polygon fill="black" stroke="black" points="34703.38,-4984.43 34699.88,-4974.43 34696.38,-4984.43 34703.38,-4984.43"/>
</g>
<!-- R1_Stage1_L2_MoE_Input -->
<g id="node82" class="node">
<title>R1_Stage1_L2_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="34784" cy="-4778" rx="225.5" ry="29"/>
<text text-anchor="middle" x="34784" y="-4786.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="34784" y="-4775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="34784" y="-4764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Attn_Output&#45;&gt;R1_Stage1_L2_MoE_Input -->
<g id="edge96" class="edge">
<title>R1_Stage1_L2_Attn_Output&#45;&gt;R1_Stage1_L2_MoE_Input</title>
<path fill="none" stroke="black" d="M34784,-4902.66C34784,-4902.66 34784,-4817.14 34784,-4817.14"/>
<polygon fill="black" stroke="black" points="34787.5,-4817.14 34784,-4807.14 34780.5,-4817.14 34787.5,-4817.14"/>
</g>
<!-- R1_Stage1_L2_Router -->
<g id="node83" class="node">
<title>R1_Stage1_L2_Router</title>
<polygon fill="lightyellow" stroke="black" points="35106.36,-4639 34593.56,-4639 34461.64,-4535 34974.44,-4535 35106.36,-4639"/>
<text text-anchor="middle" x="34784" y="-4601" font-family="Times,serif" font-size="10.00">Router GPU 0</text>
<text text-anchor="middle" x="34784" y="-4590" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="34784" y="-4579" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="34784" y="-4568" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage1_L2_MoE_Input&#45;&gt;R1_Stage1_L2_Router -->
<g id="edge97" class="edge">
<title>R1_Stage1_L2_MoE_Input&#45;&gt;R1_Stage1_L2_Router</title>
<path fill="none" stroke="black" d="M34784,-4748.99C34784,-4748.99 34784,-4649.02 34784,-4649.02"/>
<polygon fill="black" stroke="black" points="34787.5,-4649.02 34784,-4639.02 34780.5,-4649.02 34787.5,-4649.02"/>
</g>
<!-- R1_Stage1_L2_Expert0 -->
<g id="node84" class="node">
<title>R1_Stage1_L2_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="33876,-4425 33616,-4425 33616,-4367 33876,-4367 33876,-4425"/>
<text text-anchor="middle" x="33746" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 0</text>
<text text-anchor="middle" x="33746" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33746" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert0 -->
<g id="edge98" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34469.12,-4541C34198.64,-4541 33852,-4541 33852,-4541 33852,-4541 33852,-4435.34 33852,-4435.34"/>
<polygon fill="black" stroke="black" points="33855.5,-4435.34 33852,-4425.34 33848.5,-4435.34 33855.5,-4435.34"/>
<text text-anchor="middle" x="33956.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert1 -->
<g id="node85" class="node">
<title>R1_Stage1_L2_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="34172,-4425 33912,-4425 33912,-4367 34172,-4367 34172,-4425"/>
<text text-anchor="middle" x="34042" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 1</text>
<text text-anchor="middle" x="34042" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="34042" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert1 -->
<g id="edge99" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34467.86,-4540C34308.24,-4540 34148,-4540 34148,-4540 34148,-4540 34148,-4435.14 34148,-4435.14"/>
<polygon fill="black" stroke="black" points="34151.5,-4435.14 34148,-4425.14 34144.5,-4435.14 34151.5,-4435.14"/>
<text text-anchor="middle" x="34230.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert2 -->
<g id="node86" class="node">
<title>R1_Stage1_L2_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="34468,-4425 34208,-4425 34208,-4367 34468,-4367 34468,-4425"/>
<text text-anchor="middle" x="34338" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 2</text>
<text text-anchor="middle" x="34338" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="34338" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert2 -->
<g id="edge100" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34462.56,-4536C34450.7,-4536 34443.78,-4536 34443.78,-4536 34443.78,-4536 34443.78,-4435.01 34443.78,-4435.01"/>
<polygon fill="black" stroke="black" points="34447.28,-4435.01 34443.78,-4425.01 34440.28,-4435.01 34447.28,-4435.01"/>
<text text-anchor="middle" x="34481.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert3 -->
<g id="node87" class="node">
<title>R1_Stage1_L2_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="34764,-4425 34504,-4425 34504,-4367 34764,-4367 34764,-4425"/>
<text text-anchor="middle" x="34634" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 3</text>
<text text-anchor="middle" x="34634" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="34634" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert3 -->
<g id="edge101" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34634,-4534.81C34634,-4534.81 34634,-4435.01 34634,-4435.01"/>
<polygon fill="black" stroke="black" points="34637.5,-4435.01 34634,-4425.01 34630.5,-4435.01 34637.5,-4435.01"/>
<text text-anchor="middle" x="34688.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert4 -->
<g id="node88" class="node">
<title>R1_Stage1_L2_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="35060,-4425 34800,-4425 34800,-4367 35060,-4367 35060,-4425"/>
<text text-anchor="middle" x="34930" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 4</text>
<text text-anchor="middle" x="34930" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="34930" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert4 -->
<g id="edge102" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34930,-4534.81C34930,-4534.81 34930,-4435.01 34930,-4435.01"/>
<polygon fill="black" stroke="black" points="34933.5,-4435.01 34930,-4425.01 34926.5,-4435.01 34933.5,-4435.01"/>
<text text-anchor="middle" x="34878.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert5 -->
<g id="node89" class="node">
<title>R1_Stage1_L2_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="35356,-4425 35096,-4425 35096,-4367 35356,-4367 35356,-4425"/>
<text text-anchor="middle" x="35226" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 5</text>
<text text-anchor="middle" x="35226" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="35226" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert5 -->
<g id="edge103" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M35101.22,-4586.86C35101.22,-4586.86 35101.22,-4435.01 35101.22,-4435.01"/>
<polygon fill="black" stroke="black" points="35104.72,-4435.01 35101.22,-4425.01 35097.72,-4435.01 35104.72,-4435.01"/>
<text text-anchor="middle" x="35141.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert6 -->
<g id="node90" class="node">
<title>R1_Stage1_L2_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="35652,-4425 35392,-4425 35392,-4367 35652,-4367 35652,-4425"/>
<text text-anchor="middle" x="35522" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 6</text>
<text text-anchor="middle" x="35522" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="35522" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert6 -->
<g id="edge104" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34988.59,-4546C35207,-4546 35522,-4546 35522,-4546 35522,-4546 35522,-4435.28 35522,-4435.28"/>
<polygon fill="black" stroke="black" points="35525.5,-4435.28 35522,-4425.28 35518.5,-4435.28 35525.5,-4435.28"/>
<text text-anchor="middle" x="35420.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert7 -->
<g id="node91" class="node">
<title>R1_Stage1_L2_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="31212,-4425 30952,-4425 30952,-4367 31212,-4367 31212,-4425"/>
<text text-anchor="middle" x="31082" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 7</text>
<text text-anchor="middle" x="31082" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31082" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert7 -->
<g id="edge105" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34570.49,-4621C33797.17,-4621 31188,-4621 31188,-4621 31188,-4621 31188,-4435.41 31188,-4435.41"/>
<polygon fill="black" stroke="black" points="31191.5,-4435.41 31188,-4425.41 31184.5,-4435.41 31191.5,-4435.41"/>
<text text-anchor="middle" x="31314.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert8 -->
<g id="node92" class="node">
<title>R1_Stage1_L2_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="31508,-4425 31248,-4425 31248,-4367 31508,-4367 31508,-4425"/>
<text text-anchor="middle" x="31378" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 8</text>
<text text-anchor="middle" x="31378" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31378" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert8 -->
<g id="edge106" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34566.84,-4618C33831.96,-4618 31484,-4618 31484,-4618 31484,-4618 31484,-4435.02 31484,-4435.02"/>
<polygon fill="black" stroke="black" points="31487.5,-4435.02 31484,-4425.02 31480.5,-4435.02 31487.5,-4435.02"/>
<text text-anchor="middle" x="31610.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert9 -->
<g id="node93" class="node">
<title>R1_Stage1_L2_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="31804,-4425 31544,-4425 31544,-4367 31804,-4367 31804,-4425"/>
<text text-anchor="middle" x="31674" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 9</text>
<text text-anchor="middle" x="31674" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31674" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert9 -->
<g id="edge107" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34488.09,-4556C33730.47,-4556 31780,-4556 31780,-4556 31780,-4556 31780,-4435.35 31780,-4435.35"/>
<polygon fill="black" stroke="black" points="31783.5,-4435.35 31780,-4425.35 31776.5,-4435.35 31783.5,-4435.35"/>
<text text-anchor="middle" x="31905.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert10 -->
<g id="node94" class="node">
<title>R1_Stage1_L2_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="32100,-4425 31840,-4425 31840,-4367 32100,-4367 32100,-4425"/>
<text text-anchor="middle" x="31970" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 10</text>
<text text-anchor="middle" x="31970" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31970" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert10 -->
<g id="edge108" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34485.48,-4554C33781.41,-4554 32076,-4554 32076,-4554 32076,-4554 32076,-4435.35 32076,-4435.35"/>
<polygon fill="black" stroke="black" points="32079.5,-4435.35 32076,-4425.35 32072.5,-4435.35 32079.5,-4435.35"/>
<text text-anchor="middle" x="32199.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert11 -->
<g id="node95" class="node">
<title>R1_Stage1_L2_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="32396,-4425 32136,-4425 32136,-4367 32396,-4367 32396,-4425"/>
<text text-anchor="middle" x="32266" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 11</text>
<text text-anchor="middle" x="32266" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32266" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert11 -->
<g id="edge109" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34483.03,-4552C33838.15,-4552 32381.22,-4552 32381.22,-4552 32381.22,-4552 32381.22,-4435.34 32381.22,-4435.34"/>
<polygon fill="black" stroke="black" points="32384.72,-4435.34 32381.22,-4425.34 32377.72,-4435.34 32384.72,-4435.34"/>
<text text-anchor="middle" x="32492.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert12 -->
<g id="node96" class="node">
<title>R1_Stage1_L2_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="32692,-4425 32432,-4425 32432,-4367 32692,-4367 32692,-4425"/>
<text text-anchor="middle" x="32562" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 12</text>
<text text-anchor="middle" x="32562" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32562" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert12 -->
<g id="edge110" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34478.01,-4548C33891.8,-4548 32668,-4548 32668,-4548 32668,-4548 32668,-4435.31 32668,-4435.31"/>
<polygon fill="black" stroke="black" points="32671.5,-4435.31 32668,-4425.31 32664.5,-4435.31 32671.5,-4435.31"/>
<text text-anchor="middle" x="32781.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert13 -->
<g id="node97" class="node">
<title>R1_Stage1_L2_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="32988,-4425 32728,-4425 32728,-4367 32988,-4367 32988,-4425"/>
<text text-anchor="middle" x="32858" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 13</text>
<text text-anchor="middle" x="32858" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32858" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert13 -->
<g id="edge111" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34475.52,-4546C33956.34,-4546 32964,-4546 32964,-4546 32964,-4546 32964,-4435.28 32964,-4435.28"/>
<polygon fill="black" stroke="black" points="32967.5,-4435.28 32964,-4425.28 32960.5,-4435.28 32967.5,-4435.28"/>
<text text-anchor="middle" x="33064.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert14 -->
<g id="node98" class="node">
<title>R1_Stage1_L2_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="33284,-4425 33024,-4425 33024,-4367 33284,-4367 33284,-4425"/>
<text text-anchor="middle" x="33154" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 14</text>
<text text-anchor="middle" x="33154" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33154" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert14 -->
<g id="edge112" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34474.22,-4545C34028.69,-4545 33260,-4545 33260,-4545 33260,-4545 33260,-4435.08 33260,-4435.08"/>
<polygon fill="black" stroke="black" points="33263.5,-4435.08 33260,-4425.08 33256.5,-4435.08 33263.5,-4435.08"/>
<text text-anchor="middle" x="33334.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_Expert15 -->
<g id="node99" class="node">
<title>R1_Stage1_L2_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="33580,-4425 33320,-4425 33320,-4367 33580,-4367 33580,-4425"/>
<text text-anchor="middle" x="33450" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 15</text>
<text text-anchor="middle" x="33450" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33450" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert15 -->
<g id="edge113" class="edge">
<title>R1_Stage1_L2_Router&#45;&gt;R1_Stage1_L2_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M34471.74,-4543C34107.92,-4543 33556,-4543 33556,-4543 33556,-4543 33556,-4435.04 33556,-4435.04"/>
<polygon fill="black" stroke="black" points="33559.5,-4435.04 33556,-4425.04 33552.5,-4435.04 33559.5,-4435.04"/>
<text text-anchor="middle" x="33577.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L2_MoE_Output -->
<g id="node100" class="node">
<title>R1_Stage1_L2_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="35259.95,-4257 34733.48,-4257 34598.05,-4153 35124.52,-4153 35259.95,-4257"/>
<text text-anchor="middle" x="34929" y="-4219" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="34929" y="-4208" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="34929" y="-4197" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="34929" y="-4186" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L2_Expert0&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge114" class="edge">
<title>R1_Stage1_L2_Expert0&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M33855.67,-4366.86C33855.67,-4324.78 33855.67,-4252 33855.67,-4252 33855.67,-4252 34716.8,-4252 34716.8,-4252"/>
<polygon fill="black" stroke="black" points="34716.8,-4255.5 34726.8,-4252 34716.8,-4248.5 34716.8,-4255.5"/>
</g>
<!-- R1_Stage1_L2_Expert1&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge115" class="edge">
<title>R1_Stage1_L2_Expert1&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M34156.87,-4366.72C34156.87,-4324.88 34156.87,-4253 34156.87,-4253 34156.87,-4253 34718.15,-4253 34718.15,-4253"/>
<polygon fill="black" stroke="black" points="34718.15,-4256.5 34728.15,-4253 34718.15,-4249.5 34718.15,-4256.5"/>
</g>
<!-- R1_Stage1_L2_Expert2&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge116" class="edge">
<title>R1_Stage1_L2_Expert2&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M34338,-4366.78C34338,-4325.48 34338,-4255 34338,-4255 34338,-4255 34720.56,-4255 34720.56,-4255"/>
<polygon fill="black" stroke="black" points="34720.56,-4258.5 34730.56,-4255 34720.56,-4251.5 34720.56,-4258.5"/>
</g>
<!-- R1_Stage1_L2_Expert3&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge117" class="edge">
<title>R1_Stage1_L2_Expert3&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M34681.14,-4366.99C34681.14,-4366.99 34681.14,-4227.07 34681.14,-4227.07"/>
<polygon fill="black" stroke="black" points="34684.64,-4227.07 34681.14,-4217.07 34677.64,-4227.07 34684.64,-4227.07"/>
</g>
<!-- R1_Stage1_L2_Expert4&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge118" class="edge">
<title>R1_Stage1_L2_Expert4&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M34930,-4366.99C34930,-4366.99 34930,-4267.02 34930,-4267.02"/>
<polygon fill="black" stroke="black" points="34933.5,-4267.02 34930,-4257.02 34926.5,-4267.02 34933.5,-4267.02"/>
</g>
<!-- R1_Stage1_L2_Expert5&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge119" class="edge">
<title>R1_Stage1_L2_Expert5&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M35177.86,-4366.99C35177.86,-4366.99 35177.86,-4267.02 35177.86,-4267.02"/>
<polygon fill="black" stroke="black" points="35181.36,-4267.02 35177.86,-4257.02 35174.36,-4267.02 35181.36,-4267.02"/>
</g>
<!-- R1_Stage1_L2_Expert6&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge120" class="edge">
<title>R1_Stage1_L2_Expert6&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M35522,-4366.89C35522,-4323.01 35522,-4245 35522,-4245 35522,-4245 35254.6,-4245 35254.6,-4245"/>
<polygon fill="black" stroke="black" points="35254.6,-4241.5 35244.6,-4245 35254.6,-4248.5 35254.6,-4241.5"/>
</g>
<!-- R1_Stage1_L2_Expert7&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge121" class="edge">
<title>R1_Stage1_L2_Expert7&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M31191.67,-4366.65C31191.67,-4320.96 31191.67,-4238 31191.67,-4238 31191.67,-4238 34698.48,-4238 34698.48,-4238"/>
<polygon fill="black" stroke="black" points="34698.48,-4241.5 34708.48,-4238 34698.48,-4234.5 34698.48,-4241.5"/>
</g>
<!-- R1_Stage1_L2_Expert8&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge122" class="edge">
<title>R1_Stage1_L2_Expert8&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M31487.67,-4366.66C31487.67,-4321.47 31487.67,-4240 31487.67,-4240 31487.67,-4240 34701.12,-4240 34701.12,-4240"/>
<polygon fill="black" stroke="black" points="34701.12,-4243.5 34711.12,-4240 34701.12,-4236.5 34701.12,-4243.5"/>
</g>
<!-- R1_Stage1_L2_Expert9&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge123" class="edge">
<title>R1_Stage1_L2_Expert9&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M31783.67,-4366.85C31783.67,-4321.95 31783.67,-4241 31783.67,-4241 31783.67,-4241 34702.5,-4241 34702.5,-4241"/>
<polygon fill="black" stroke="black" points="34702.5,-4244.5 34712.5,-4241 34702.5,-4237.5 34702.5,-4244.5"/>
</g>
<!-- R1_Stage1_L2_Expert10&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge124" class="edge">
<title>R1_Stage1_L2_Expert10&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M32079.67,-4366.86C32079.67,-4322.47 32079.67,-4243 32079.67,-4243 32079.67,-4243 34705.13,-4243 34705.13,-4243"/>
<polygon fill="black" stroke="black" points="34705.13,-4246.5 34715.13,-4243 34705.13,-4239.5 34705.13,-4246.5"/>
</g>
<!-- R1_Stage1_L2_Expert11&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge125" class="edge">
<title>R1_Stage1_L2_Expert11&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M32375.67,-4366.69C32375.67,-4322.52 32375.67,-4244 32375.67,-4244 32375.67,-4244 34706.52,-4244 34706.52,-4244"/>
<polygon fill="black" stroke="black" points="34706.52,-4247.5 34716.52,-4244 34706.52,-4240.5 34706.52,-4247.5"/>
</g>
<!-- R1_Stage1_L2_Expert12&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge126" class="edge">
<title>R1_Stage1_L2_Expert12&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M32671.67,-4366.72C32671.67,-4323.07 32671.67,-4246 32671.67,-4246 32671.67,-4246 34708.92,-4246 34708.92,-4246"/>
<polygon fill="black" stroke="black" points="34708.92,-4249.5 34718.92,-4246 34708.92,-4242.5 34708.92,-4249.5"/>
</g>
<!-- R1_Stage1_L2_Expert13&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge127" class="edge">
<title>R1_Stage1_L2_Expert13&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M32967.67,-4366.92C32967.67,-4323.56 32967.67,-4247 32967.67,-4247 32967.67,-4247 34710.03,-4247 34710.03,-4247"/>
<polygon fill="black" stroke="black" points="34710.03,-4250.5 34720.03,-4247 34710.03,-4243.5 34710.03,-4250.5"/>
</g>
<!-- R1_Stage1_L2_Expert14&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge128" class="edge">
<title>R1_Stage1_L2_Expert14&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M33263.67,-4366.96C33263.67,-4324.12 33263.67,-4249 33263.67,-4249 33263.67,-4249 34712.71,-4249 34712.71,-4249"/>
<polygon fill="black" stroke="black" points="34712.71,-4252.5 34722.71,-4249 34712.71,-4245.5 34712.71,-4252.5"/>
</g>
<!-- R1_Stage1_L2_Expert15&#45;&gt;R1_Stage1_L2_MoE_Output -->
<g id="edge129" class="edge">
<title>R1_Stage1_L2_Expert15&#45;&gt;R1_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M33559.67,-4366.81C33559.67,-4324.2 33559.67,-4250 33559.67,-4250 33559.67,-4250 34714.37,-4250 34714.37,-4250"/>
<polygon fill="black" stroke="black" points="34714.37,-4253.5 34724.37,-4250 34714.37,-4246.5 34714.37,-4253.5"/>
</g>
<!-- R1_Stage1_L2_MoE_Output&#45;&gt;R1_Stage1_L2_Output -->
<g id="edge130" class="edge">
<title>R1_Stage1_L2_MoE_Output&#45;&gt;R1_Stage1_L2_Output</title>
<path fill="none" stroke="black" d="M34599.09,-4154C34581.58,-4154 34571,-4154 34571,-4154 34571,-4154 34571,-4031.93 34571,-4031.93"/>
<polygon fill="black" stroke="black" points="34574.5,-4031.93 34571,-4021.93 34567.5,-4031.93 34574.5,-4031.93"/>
</g>
<!-- R1_Stage1_L3_Input -->
<g id="node101" class="node">
<title>R1_Stage1_L3_Input</title>
<ellipse fill="lightblue" stroke="black" cx="29809" cy="-5225.08" rx="225.5" ry="29"/>
<text text-anchor="middle" x="29809" y="-5233.58" font-family="Times,serif" font-size="10.00">Layer 3 Input</text>
<text text-anchor="middle" x="29809" y="-5222.58" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="29809" y="-5211.58" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Attn_Input -->
<g id="node102" class="node">
<title>R1_Stage1_L3_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="29809" cy="-5086.31" rx="225.5" ry="29"/>
<text text-anchor="middle" x="29809" y="-5094.81" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="29809" y="-5083.81" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="29809" y="-5072.81" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Input&#45;&gt;R1_Stage1_L3_Attn_Input -->
<g id="edge131" class="edge">
<title>R1_Stage1_L3_Input&#45;&gt;R1_Stage1_L3_Attn_Input</title>
<path fill="none" stroke="black" d="M29809,-5195.99C29809,-5195.99 29809,-5125.36 29809,-5125.36"/>
<polygon fill="black" stroke="black" points="29812.5,-5125.36 29809,-5115.36 29805.5,-5125.36 29812.5,-5125.36"/>
</g>
<!-- R1_Stage1_L3_Attn_TP1 -->
<g id="node103" class="node">
<title>R1_Stage1_L3_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="29852,-4968.77 29506,-4968.77 29506,-4910.77 29852,-4910.77 29852,-4968.77"/>
<text text-anchor="middle" x="29679" y="-4953.77" font-family="Times,serif" font-size="10.00">Attention TP GPU 0</text>
<text text-anchor="middle" x="29679" y="-4942.77" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="29679" y="-4931.77" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="29679" y="-4920.77" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage1_L3_Attn_Input&#45;&gt;R1_Stage1_L3_Attn_TP1 -->
<g id="edge132" class="edge">
<title>R1_Stage1_L3_Attn_Input&#45;&gt;R1_Stage1_L3_Attn_TP1</title>
<path fill="none" stroke="black" d="M29717.75,-5059.77C29717.75,-5059.77 29717.75,-4978.87 29717.75,-4978.87"/>
<polygon fill="black" stroke="black" points="29721.25,-4978.87 29717.75,-4968.87 29714.25,-4978.87 29721.25,-4978.87"/>
</g>
<!-- R1_Stage1_L3_Attn_TP2 -->
<g id="node104" class="node">
<title>R1_Stage1_L3_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="30234,-4968.77 29888,-4968.77 29888,-4910.77 30234,-4910.77 30234,-4968.77"/>
<text text-anchor="middle" x="30061" y="-4953.77" font-family="Times,serif" font-size="10.00">Attention TP GPU 1</text>
<text text-anchor="middle" x="30061" y="-4942.77" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="30061" y="-4931.77" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="30061" y="-4920.77" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage1_L3_Attn_Input&#45;&gt;R1_Stage1_L3_Attn_TP2 -->
<g id="edge133" class="edge">
<title>R1_Stage1_L3_Attn_Input&#45;&gt;R1_Stage1_L3_Attn_TP2</title>
<path fill="none" stroke="black" d="M29961.25,-5064.69C29961.25,-5064.69 29961.25,-4978.81 29961.25,-4978.81"/>
<polygon fill="black" stroke="black" points="29964.75,-4978.81 29961.25,-4968.81 29957.75,-4978.81 29964.75,-4978.81"/>
</g>
<!-- R1_Stage1_L3_Attn_Output -->
<g id="node105" class="node">
<title>R1_Stage1_L3_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="29702" cy="-4778" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="29702" y="-4792" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="29702" y="-4781" font-family="Times,serif" font-size="10.00">AllReduce GPUs 0&#45;1</text>
<text text-anchor="middle" x="29702" y="-4770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="29702" y="-4759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Attn_TP1&#45;&gt;R1_Stage1_L3_Attn_Output -->
<g id="edge134" class="edge">
<title>R1_Stage1_L3_Attn_TP1&#45;&gt;R1_Stage1_L3_Attn_Output</title>
<path fill="none" stroke="black" d="M29679,-4910.47C29679,-4910.47 29679,-4824.74 29679,-4824.74"/>
<polygon fill="black" stroke="black" points="29682.5,-4824.74 29679,-4814.74 29675.5,-4824.74 29682.5,-4824.74"/>
</g>
<!-- R1_Stage1_L3_Attn_TP2&#45;&gt;R1_Stage1_L3_Attn_Output -->
<g id="edge135" class="edge">
<title>R1_Stage1_L3_Attn_TP2&#45;&gt;R1_Stage1_L3_Attn_Output</title>
<path fill="none" stroke="black" d="M29916.62,-4910.47C29916.62,-4910.47 29916.62,-4805.59 29916.62,-4805.59"/>
<polygon fill="black" stroke="black" points="29920.12,-4805.59 29916.62,-4795.59 29913.12,-4805.59 29920.12,-4805.59"/>
</g>
<!-- R1_Stage1_L3_MoE_Input -->
<g id="node106" class="node">
<title>R1_Stage1_L3_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="29464" cy="-4587" rx="225.5" ry="29"/>
<text text-anchor="middle" x="29464" y="-4595.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="29464" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="29464" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Attn_Output&#45;&gt;R1_Stage1_L3_MoE_Input -->
<g id="edge136" class="edge">
<title>R1_Stage1_L3_Attn_Output&#45;&gt;R1_Stage1_L3_MoE_Input</title>
<path fill="none" stroke="black" d="M29574.13,-4746.46C29574.13,-4746.46 29574.13,-4622.47 29574.13,-4622.47"/>
<polygon fill="black" stroke="black" points="29577.63,-4622.47 29574.13,-4612.47 29570.63,-4622.47 29577.63,-4622.47"/>
</g>
<!-- R1_Stage1_L3_Router -->
<g id="node107" class="node">
<title>R1_Stage1_L3_Router</title>
<polygon fill="lightyellow" stroke="black" points="29827.36,-4448 29314.56,-4448 29182.64,-4344 29695.44,-4344 29827.36,-4448"/>
<text text-anchor="middle" x="29505" y="-4410" font-family="Times,serif" font-size="10.00">Router GPU 0</text>
<text text-anchor="middle" x="29505" y="-4399" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="29505" y="-4388" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="29505" y="-4377" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage1_L3_MoE_Input&#45;&gt;R1_Stage1_L3_Router -->
<g id="edge137" class="edge">
<title>R1_Stage1_L3_MoE_Input&#45;&gt;R1_Stage1_L3_Router</title>
<path fill="none" stroke="black" d="M29464,-4557.99C29464,-4557.99 29464,-4458.02 29464,-4458.02"/>
<polygon fill="black" stroke="black" points="29467.5,-4458.02 29464,-4448.02 29460.5,-4458.02 29467.5,-4458.02"/>
</g>
<!-- R1_Stage1_L3_Expert0 -->
<g id="node108" class="node">
<title>R1_Stage1_L3_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="34075,-4234 33815,-4234 33815,-4176 34075,-4176 34075,-4234"/>
<text text-anchor="middle" x="33945" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 0</text>
<text text-anchor="middle" x="33945" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33945" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert0 -->
<g id="edge138" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29805.08,-4395.95C29805.08,-4393.98 29805.08,-4331 29805.08,-4331 29805.08,-4331 33835.33,-4331 33835.33,-4331 33835.33,-4331 33835.33,-4244.22 33835.33,-4244.22"/>
<polygon fill="black" stroke="black" points="33838.83,-4244.22 33835.33,-4234.22 33831.83,-4244.22 33838.83,-4244.22"/>
<text text-anchor="middle" x="31183.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert1 -->
<g id="node109" class="node">
<title>R1_Stage1_L3_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="29635,-4234 29375,-4234 29375,-4176 29635,-4176 29635,-4234"/>
<text text-anchor="middle" x="29505" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 1</text>
<text text-anchor="middle" x="29505" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="29505" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert1 -->
<g id="edge139" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29505,-4343.81C29505,-4343.81 29505,-4244.01 29505,-4244.01"/>
<polygon fill="black" stroke="black" points="29508.5,-4244.01 29505,-4234.01 29501.5,-4244.01 29508.5,-4244.01"/>
<text text-anchor="middle" x="29526.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert2 -->
<g id="node110" class="node">
<title>R1_Stage1_L3_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="30227,-4234 29967,-4234 29967,-4176 30227,-4176 30227,-4234"/>
<text text-anchor="middle" x="30097" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 2</text>
<text text-anchor="middle" x="30097" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30097" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert2 -->
<g id="edge140" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29704.37,-4351C29860.29,-4351 30050.81,-4351 30050.81,-4351 30050.81,-4351 30050.81,-4244.19 30050.81,-4244.19"/>
<polygon fill="black" stroke="black" points="30054.31,-4244.19 30050.81,-4234.19 30047.31,-4244.19 30054.31,-4244.19"/>
<text text-anchor="middle" x="29874.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert3 -->
<g id="node111" class="node">
<title>R1_Stage1_L3_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="30523,-4234 30263,-4234 30263,-4176 30523,-4176 30523,-4234"/>
<text text-anchor="middle" x="30393" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 3</text>
<text text-anchor="middle" x="30393" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30393" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert3 -->
<g id="edge141" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29714.82,-4359C29932.25,-4359 30240.64,-4359 30240.64,-4359 30240.64,-4359 30240.64,-4205 30240.64,-4205 30240.64,-4205 30252.79,-4205 30252.79,-4205"/>
<polygon fill="black" stroke="black" points="30252.79,-4208.5 30262.79,-4205 30252.79,-4201.5 30252.79,-4208.5"/>
<text text-anchor="middle" x="29995.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert4 -->
<g id="node112" class="node">
<title>R1_Stage1_L3_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="30819,-4234 30559,-4234 30559,-4176 30819,-4176 30819,-4234"/>
<text text-anchor="middle" x="30689" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 4</text>
<text text-anchor="middle" x="30689" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30689" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert4 -->
<g id="edge142" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29682.17,-4343.81C29682.17,-4305.46 29682.17,-4260 29682.17,-4260 29682.17,-4260 30689,-4260 30689,-4260 30689,-4260 30689,-4244.11 30689,-4244.11"/>
<polygon fill="black" stroke="black" points="30692.5,-4244.11 30689,-4234.11 30685.5,-4244.11 30692.5,-4244.11"/>
<text text-anchor="middle" x="30097.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert5 -->
<g id="node113" class="node">
<title>R1_Stage1_L3_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="31115,-4234 30855,-4234 30855,-4176 31115,-4176 31115,-4234"/>
<text text-anchor="middle" x="30985" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 5</text>
<text text-anchor="middle" x="30985" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30985" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert5 -->
<g id="edge143" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29693.35,-4343.87C29693.35,-4307.71 29693.35,-4266 29693.35,-4266 29693.35,-4266 30885.36,-4266 30885.36,-4266 30885.36,-4266 30885.36,-4244.07 30885.36,-4244.07"/>
<polygon fill="black" stroke="black" points="30888.86,-4244.07 30885.36,-4234.07 30881.86,-4244.07 30888.86,-4244.07"/>
<text text-anchor="middle" x="30190.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert6 -->
<g id="node114" class="node">
<title>R1_Stage1_L3_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="31411,-4234 31151,-4234 31151,-4176 31411,-4176 31411,-4234"/>
<text text-anchor="middle" x="31281" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 6</text>
<text text-anchor="middle" x="31281" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31281" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert6 -->
<g id="edge144" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29704.52,-4350.9C29704.52,-4315.79 29704.52,-4273 29704.52,-4273 29704.52,-4273 31171.33,-4273 31171.33,-4273 31171.33,-4273 31171.33,-4244.23 31171.33,-4244.23"/>
<polygon fill="black" stroke="black" points="31174.83,-4244.23 31171.33,-4234.23 31167.83,-4244.23 31174.83,-4244.23"/>
<text text-anchor="middle" x="30279.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert7 -->
<g id="node115" class="node">
<title>R1_Stage1_L3_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="31707,-4234 31447,-4234 31447,-4176 31707,-4176 31707,-4234"/>
<text text-anchor="middle" x="31577" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 7</text>
<text text-anchor="middle" x="31577" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31577" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert7 -->
<g id="edge145" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29715.69,-4359.94C29715.69,-4325.56 29715.69,-4279 29715.69,-4279 29715.69,-4279 31467.33,-4279 31467.33,-4279 31467.33,-4279 31467.33,-4244.25 31467.33,-4244.25"/>
<polygon fill="black" stroke="black" points="31470.83,-4244.25 31467.33,-4234.25 31463.83,-4244.25 31470.83,-4244.25"/>
<text text-anchor="middle" x="30365.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert8 -->
<g id="node116" class="node">
<title>R1_Stage1_L3_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="33483,-4234 33223,-4234 33223,-4176 33483,-4176 33483,-4234"/>
<text text-anchor="middle" x="33353" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 8</text>
<text text-anchor="middle" x="33353" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33353" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert8 -->
<g id="edge146" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29782.74,-4395.94C29782.74,-4393.58 29782.74,-4318 29782.74,-4318 29782.74,-4318 33243.33,-4318 33243.33,-4318 33243.33,-4318 33243.33,-4244.1 33243.33,-4244.1"/>
<polygon fill="black" stroke="black" points="33246.83,-4244.1 33243.33,-4234.1 33239.83,-4244.1 33246.83,-4244.1"/>
<text text-anchor="middle" x="31015.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert9 -->
<g id="node117" class="node">
<title>R1_Stage1_L3_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="32003,-4234 31743,-4234 31743,-4176 32003,-4176 32003,-4234"/>
<text text-anchor="middle" x="31873" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 9</text>
<text text-anchor="middle" x="31873" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31873" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert9 -->
<g id="edge147" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29726.87,-4368.53C29726.87,-4335.94 29726.87,-4286 29726.87,-4286 29726.87,-4286 31763.33,-4286 31763.33,-4286 31763.33,-4286 31763.33,-4244.24 31763.33,-4244.24"/>
<polygon fill="black" stroke="black" points="31766.83,-4244.24 31763.33,-4234.24 31759.83,-4244.24 31766.83,-4244.24"/>
<text text-anchor="middle" x="30450.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert10 -->
<g id="node118" class="node">
<title>R1_Stage1_L3_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="29931,-4234 29671,-4234 29671,-4176 29931,-4176 29931,-4234"/>
<text text-anchor="middle" x="29801" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 10</text>
<text text-anchor="middle" x="29801" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="29801" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert10 -->
<g id="edge148" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29816.26,-4395.86C29816.26,-4395.86 29816.26,-4244.01 29816.26,-4244.01"/>
<polygon fill="black" stroke="black" points="29819.76,-4244.01 29816.26,-4234.01 29812.76,-4244.01 29819.76,-4244.01"/>
<text text-anchor="middle" x="29716.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert11 -->
<g id="node119" class="node">
<title>R1_Stage1_L3_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="32299,-4234 32039,-4234 32039,-4176 32299,-4176 32299,-4234"/>
<text text-anchor="middle" x="32169" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 11</text>
<text text-anchor="middle" x="32169" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32169" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert11 -->
<g id="edge149" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29738.04,-4377.41C29738.04,-4347.49 29738.04,-4292 29738.04,-4292 29738.04,-4292 32059.33,-4292 32059.33,-4292 32059.33,-4292 32059.33,-4244.45 32059.33,-4244.45"/>
<polygon fill="black" stroke="black" points="32062.83,-4244.45 32059.33,-4234.45 32055.83,-4244.45 32062.83,-4244.45"/>
<text text-anchor="middle" x="30535.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert12 -->
<g id="node120" class="node">
<title>R1_Stage1_L3_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="32891,-4234 32631,-4234 32631,-4176 32891,-4176 32891,-4234"/>
<text text-anchor="middle" x="32761" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 12</text>
<text text-anchor="middle" x="32761" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32761" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert12 -->
<g id="edge150" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29760.39,-4394.98C29760.39,-4384.98 29760.39,-4305 29760.39,-4305 29760.39,-4305 32651.33,-4305 32651.33,-4305 32651.33,-4305 32651.33,-4244.19 32651.33,-4244.19"/>
<polygon fill="black" stroke="black" points="32654.83,-4244.19 32651.33,-4234.19 32647.83,-4244.19 32654.83,-4244.19"/>
<text text-anchor="middle" x="30847.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert13 -->
<g id="node121" class="node">
<title>R1_Stage1_L3_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="32595,-4234 32335,-4234 32335,-4176 32595,-4176 32595,-4234"/>
<text text-anchor="middle" x="32465" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 13</text>
<text text-anchor="middle" x="32465" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32465" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert13 -->
<g id="edge151" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29749.22,-4386.25C29749.22,-4361.46 29749.22,-4298 29749.22,-4298 29749.22,-4298 32355.33,-4298 32355.33,-4298 32355.33,-4298 32355.33,-4244.17 32355.33,-4244.17"/>
<polygon fill="black" stroke="black" points="32358.83,-4244.17 32355.33,-4234.17 32351.83,-4244.17 32358.83,-4244.17"/>
<text text-anchor="middle" x="30763.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert14 -->
<g id="node122" class="node">
<title>R1_Stage1_L3_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="33187,-4234 32927,-4234 32927,-4176 33187,-4176 33187,-4234"/>
<text text-anchor="middle" x="33057" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 14</text>
<text text-anchor="middle" x="33057" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33057" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert14 -->
<g id="edge152" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29771.56,-4395.94C29771.56,-4393.36 29771.56,-4311 29771.56,-4311 29771.56,-4311 32947.33,-4311 32947.33,-4311 32947.33,-4311 32947.33,-4244.25 32947.33,-4244.25"/>
<polygon fill="black" stroke="black" points="32950.83,-4244.25 32947.33,-4234.25 32943.83,-4244.25 32950.83,-4244.25"/>
<text text-anchor="middle" x="30931.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_Expert15 -->
<g id="node123" class="node">
<title>R1_Stage1_L3_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="33779,-4234 33519,-4234 33519,-4176 33779,-4176 33779,-4234"/>
<text text-anchor="middle" x="33649" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 15</text>
<text text-anchor="middle" x="33649" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33649" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert15 -->
<g id="edge153" class="edge">
<title>R1_Stage1_L3_Router&#45;&gt;R1_Stage1_L3_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29793.91,-4395.95C29793.91,-4393.77 29793.91,-4324 29793.91,-4324 29793.91,-4324 33539.33,-4324 33539.33,-4324 33539.33,-4324 33539.33,-4244.11 33539.33,-4244.11"/>
<polygon fill="black" stroke="black" points="33542.83,-4244.11 33539.33,-4234.11 33535.83,-4244.11 33542.83,-4244.11"/>
<text text-anchor="middle" x="31099.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L3_MoE_Output -->
<g id="node124" class="node">
<title>R1_Stage1_L3_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="34092.95,-4066 33566.48,-4066 33431.05,-3962 33957.52,-3962 34092.95,-4066"/>
<text text-anchor="middle" x="33762" y="-4028" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="33762" y="-4017" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="33762" y="-4006" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="33762" y="-3995" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L3_Expert0&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge154" class="edge">
<title>R1_Stage1_L3_Expert0&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M33945,-4175.99C33945,-4175.99 33945,-4076.02 33945,-4076.02"/>
<polygon fill="black" stroke="black" points="33948.5,-4076.02 33945,-4066.02 33941.5,-4076.02 33948.5,-4076.02"/>
</g>
<!-- R1_Stage1_L3_Expert1&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge155" class="edge">
<title>R1_Stage1_L3_Expert1&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M29617.67,-4175.84C29617.67,-4129.45 29617.67,-4044 29617.67,-4044 29617.67,-4044 33527.71,-4044 33527.71,-4044"/>
<polygon fill="black" stroke="black" points="33527.71,-4047.5 33537.71,-4044 33527.71,-4040.5 33527.71,-4047.5"/>
</g>
<!-- R1_Stage1_L3_Expert2&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge156" class="edge">
<title>R1_Stage1_L3_Expert2&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M30209.67,-4175.65C30209.67,-4129.96 30209.67,-4047 30209.67,-4047 30209.67,-4047 33531.46,-4047 33531.46,-4047"/>
<polygon fill="black" stroke="black" points="33531.46,-4050.5 33541.46,-4047 33531.46,-4043.5 33531.46,-4050.5"/>
</g>
<!-- R1_Stage1_L3_Expert3&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge157" class="edge">
<title>R1_Stage1_L3_Expert3&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M30505.67,-4175.66C30505.67,-4130.47 30505.67,-4049 30505.67,-4049 30505.67,-4049 33534.24,-4049 33534.24,-4049"/>
<polygon fill="black" stroke="black" points="33534.24,-4052.5 33544.24,-4049 33534.24,-4045.5 33534.24,-4052.5"/>
</g>
<!-- R1_Stage1_L3_Expert4&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge158" class="edge">
<title>R1_Stage1_L3_Expert4&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M30801.67,-4175.67C30801.67,-4130.99 30801.67,-4051 30801.67,-4051 30801.67,-4051 33536.72,-4051 33536.72,-4051"/>
<polygon fill="black" stroke="black" points="33536.72,-4054.5 33546.72,-4051 33536.72,-4047.5 33536.72,-4054.5"/>
</g>
<!-- R1_Stage1_L3_Expert5&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge159" class="edge">
<title>R1_Stage1_L3_Expert5&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M31097.67,-4175.86C31097.67,-4131.47 31097.67,-4052 31097.67,-4052 31097.67,-4052 33538.19,-4052 33538.19,-4052"/>
<polygon fill="black" stroke="black" points="33538.19,-4055.5 33548.19,-4052 33538.19,-4048.5 33538.19,-4055.5"/>
</g>
<!-- R1_Stage1_L3_Expert6&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge160" class="edge">
<title>R1_Stage1_L3_Expert6&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M31393.67,-4175.89C31393.67,-4132.01 31393.67,-4054 31393.67,-4054 31393.67,-4054 33540.79,-4054 33540.79,-4054"/>
<polygon fill="black" stroke="black" points="33540.79,-4057.5 33550.79,-4054 33540.79,-4050.5 33540.79,-4057.5"/>
</g>
<!-- R1_Stage1_L3_Expert7&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge161" class="edge">
<title>R1_Stage1_L3_Expert7&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M31689.67,-4175.92C31689.67,-4132.56 31689.67,-4056 31689.67,-4056 31689.67,-4056 33543.33,-4056 33543.33,-4056"/>
<polygon fill="black" stroke="black" points="33543.33,-4059.5 33553.33,-4056 33543.33,-4052.5 33543.33,-4059.5"/>
</g>
<!-- R1_Stage1_L3_Expert8&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge162" class="edge">
<title>R1_Stage1_L3_Expert8&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M33457.14,-4175.99C33457.14,-4175.99 33457.14,-4024.08 33457.14,-4024.08"/>
<polygon fill="black" stroke="black" points="33460.64,-4024.08 33457.14,-4014.08 33453.64,-4024.08 33460.64,-4024.08"/>
</g>
<!-- R1_Stage1_L3_Expert9&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge163" class="edge">
<title>R1_Stage1_L3_Expert9&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M31985.67,-4175.76C31985.67,-4132.63 31985.67,-4057 31985.67,-4057 31985.67,-4057 33544.76,-4057 33544.76,-4057"/>
<polygon fill="black" stroke="black" points="33544.76,-4060.5 33554.76,-4057 33544.76,-4053.5 33544.76,-4060.5"/>
</g>
<!-- R1_Stage1_L3_Expert10&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge164" class="edge">
<title>R1_Stage1_L3_Expert10&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M29913.67,-4175.84C29913.67,-4129.93 29913.67,-4046 29913.67,-4046 29913.67,-4046 33530.22,-4046 33530.22,-4046"/>
<polygon fill="black" stroke="black" points="33530.22,-4049.5 33540.22,-4046 33530.22,-4042.5 33530.22,-4049.5"/>
</g>
<!-- R1_Stage1_L3_Expert11&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge165" class="edge">
<title>R1_Stage1_L3_Expert11&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M32281.67,-4175.81C32281.67,-4133.2 32281.67,-4059 32281.67,-4059 32281.67,-4059 33547.33,-4059 33547.33,-4059"/>
<polygon fill="black" stroke="black" points="33547.33,-4062.5 33557.33,-4059 33547.33,-4055.5 33547.33,-4062.5"/>
</g>
<!-- R1_Stage1_L3_Expert12&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge166" class="edge">
<title>R1_Stage1_L3_Expert12&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M32865,-4175.72C32865,-4133.88 32865,-4062 32865,-4062 32865,-4062 33551.25,-4062 33551.25,-4062"/>
<polygon fill="black" stroke="black" points="33551.25,-4065.5 33561.25,-4062 33551.25,-4058.5 33551.25,-4065.5"/>
</g>
<!-- R1_Stage1_L3_Expert13&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge167" class="edge">
<title>R1_Stage1_L3_Expert13&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M32577.67,-4175.86C32577.67,-4133.78 32577.67,-4061 32577.67,-4061 32577.67,-4061 33549.75,-4061 33549.75,-4061"/>
<polygon fill="black" stroke="black" points="33549.75,-4064.5 33559.75,-4061 33549.75,-4057.5 33549.75,-4064.5"/>
</g>
<!-- R1_Stage1_L3_Expert14&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge168" class="edge">
<title>R1_Stage1_L3_Expert14&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M33161,-4175.78C33161,-4134.48 33161,-4064 33161,-4064 33161,-4064 33553.54,-4064 33553.54,-4064"/>
<polygon fill="black" stroke="black" points="33553.54,-4067.5 33563.54,-4064 33553.54,-4060.5 33553.54,-4067.5"/>
</g>
<!-- R1_Stage1_L3_Expert15&#45;&gt;R1_Stage1_L3_MoE_Output -->
<g id="edge169" class="edge">
<title>R1_Stage1_L3_Expert15&#45;&gt;R1_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M33649,-4175.99C33649,-4175.99 33649,-4076.02 33649,-4076.02"/>
<polygon fill="black" stroke="black" points="33652.5,-4076.02 33649,-4066.02 33645.5,-4076.02 33652.5,-4076.02"/>
</g>
<!-- R1_Stage1_L3_MoE_Output&#45;&gt;R1_Stage1_L3_Output -->
<g id="edge170" class="edge">
<title>R1_Stage1_L3_MoE_Output&#45;&gt;R1_Stage1_L3_Output</title>
<path fill="none" stroke="black" d="M33922.61,-3961.85C33922.61,-3961.85 33922.61,-3875.21 33922.61,-3875.21"/>
<polygon fill="black" stroke="black" points="33926.11,-3875.21 33922.61,-3865.21 33919.11,-3875.21 33926.11,-3875.21"/>
</g>
<!-- R1_Stage1_L4_Input -->
<g id="node125" class="node">
<title>R1_Stage1_L4_Input</title>
<ellipse fill="lightblue" stroke="black" cx="29142" cy="-5086.31" rx="225.5" ry="29"/>
<text text-anchor="middle" x="29142" y="-5094.81" font-family="Times,serif" font-size="10.00">Layer 4 Input</text>
<text text-anchor="middle" x="29142" y="-5083.81" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="29142" y="-5072.81" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Attn_Input -->
<g id="node126" class="node">
<title>R1_Stage1_L4_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="29142" cy="-4939.77" rx="225.5" ry="29"/>
<text text-anchor="middle" x="29142" y="-4948.27" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="29142" y="-4937.27" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="29142" y="-4926.27" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Input&#45;&gt;R1_Stage1_L4_Attn_Input -->
<g id="edge171" class="edge">
<title>R1_Stage1_L4_Input&#45;&gt;R1_Stage1_L4_Attn_Input</title>
<path fill="none" stroke="black" d="M29142,-5057.01C29142,-5057.01 29142,-4979.02 29142,-4979.02"/>
<polygon fill="black" stroke="black" points="29145.5,-4979.02 29142,-4969.02 29138.5,-4979.02 29145.5,-4979.02"/>
</g>
<!-- R1_Stage1_L4_Attn_TP1 -->
<g id="node127" class="node">
<title>R1_Stage1_L4_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="29041,-4807 28695,-4807 28695,-4749 29041,-4749 29041,-4807"/>
<text text-anchor="middle" x="28868" y="-4792" font-family="Times,serif" font-size="10.00">Attention TP GPU 0</text>
<text text-anchor="middle" x="28868" y="-4781" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="28868" y="-4770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="28868" y="-4759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage1_L4_Attn_Input&#45;&gt;R1_Stage1_L4_Attn_TP1 -->
<g id="edge172" class="edge">
<title>R1_Stage1_L4_Attn_Input&#45;&gt;R1_Stage1_L4_Attn_TP1</title>
<path fill="none" stroke="black" d="M28978.75,-4919.61C28978.75,-4919.61 28978.75,-4817.19 28978.75,-4817.19"/>
<polygon fill="black" stroke="black" points="28982.25,-4817.19 28978.75,-4807.19 28975.25,-4817.19 28982.25,-4817.19"/>
</g>
<!-- R1_Stage1_L4_Attn_TP2 -->
<g id="node128" class="node">
<title>R1_Stage1_L4_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="29423,-4807 29077,-4807 29077,-4749 29423,-4749 29423,-4807"/>
<text text-anchor="middle" x="29250" y="-4792" font-family="Times,serif" font-size="10.00">Attention TP GPU 1</text>
<text text-anchor="middle" x="29250" y="-4781" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="29250" y="-4770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="29250" y="-4759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage1_L4_Attn_Input&#45;&gt;R1_Stage1_L4_Attn_TP2 -->
<g id="edge173" class="edge">
<title>R1_Stage1_L4_Attn_Input&#45;&gt;R1_Stage1_L4_Attn_TP2</title>
<path fill="none" stroke="black" d="M29222.25,-4912.33C29222.25,-4912.33 29222.25,-4817.22 29222.25,-4817.22"/>
<polygon fill="black" stroke="black" points="29225.75,-4817.22 29222.25,-4807.22 29218.75,-4817.22 29225.75,-4817.22"/>
</g>
<!-- R1_Stage1_L4_Attn_Output -->
<g id="node129" class="node">
<title>R1_Stage1_L4_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="28959" cy="-4587" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="28959" y="-4601" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="28959" y="-4590" font-family="Times,serif" font-size="10.00">AllReduce GPUs 0&#45;1</text>
<text text-anchor="middle" x="28959" y="-4579" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="28959" y="-4568" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Attn_TP1&#45;&gt;R1_Stage1_L4_Attn_Output -->
<g id="edge174" class="edge">
<title>R1_Stage1_L4_Attn_TP1&#45;&gt;R1_Stage1_L4_Attn_Output</title>
<path fill="none" stroke="black" d="M28878.38,-4748.99C28878.38,-4748.99 28878.38,-4631.8 28878.38,-4631.8"/>
<polygon fill="black" stroke="black" points="28881.88,-4631.8 28878.38,-4621.8 28874.88,-4631.8 28881.88,-4631.8"/>
</g>
<!-- R1_Stage1_L4_Attn_TP2&#45;&gt;R1_Stage1_L4_Attn_Output -->
<g id="edge175" class="edge">
<title>R1_Stage1_L4_Attn_TP2&#45;&gt;R1_Stage1_L4_Attn_Output</title>
<path fill="none" stroke="black" d="M29139.62,-4748.99C29139.62,-4748.99 29139.62,-4621.71 29139.62,-4621.71"/>
<polygon fill="black" stroke="black" points="29143.12,-4621.71 29139.62,-4611.71 29136.12,-4621.71 29143.12,-4621.71"/>
</g>
<!-- R1_Stage1_L4_MoE_Input -->
<g id="node130" class="node">
<title>R1_Stage1_L4_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="28921" cy="-4396" rx="225.5" ry="29"/>
<text text-anchor="middle" x="28921" y="-4404.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="28921" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="28921" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Attn_Output&#45;&gt;R1_Stage1_L4_MoE_Input -->
<g id="edge176" class="edge">
<title>R1_Stage1_L4_Attn_Output&#45;&gt;R1_Stage1_L4_MoE_Input</title>
<path fill="none" stroke="black" d="M28931.13,-4550.17C28931.13,-4550.17 28931.13,-4435.22 28931.13,-4435.22"/>
<polygon fill="black" stroke="black" points="28934.63,-4435.22 28931.13,-4425.22 28927.63,-4435.22 28934.63,-4435.22"/>
</g>
<!-- R1_Stage1_L4_Router -->
<g id="node131" class="node">
<title>R1_Stage1_L4_Router</title>
<polygon fill="lightyellow" stroke="black" points="29339.36,-4257 28826.56,-4257 28694.64,-4153 29207.44,-4153 29339.36,-4257"/>
<text text-anchor="middle" x="29017" y="-4219" font-family="Times,serif" font-size="10.00">Router GPU 0</text>
<text text-anchor="middle" x="29017" y="-4208" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="29017" y="-4197" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="29017" y="-4186" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage1_L4_MoE_Input&#45;&gt;R1_Stage1_L4_Router -->
<g id="edge177" class="edge">
<title>R1_Stage1_L4_MoE_Input&#45;&gt;R1_Stage1_L4_Router</title>
<path fill="none" stroke="black" d="M28921,-4366.99C28921,-4366.99 28921,-4267.02 28921,-4267.02"/>
<polygon fill="black" stroke="black" points="28924.5,-4267.02 28921,-4257.02 28917.5,-4267.02 28924.5,-4267.02"/>
</g>
<!-- R1_Stage1_L4_Expert0 -->
<g id="node132" class="node">
<title>R1_Stage1_L4_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="31323,-4043 31063,-4043 31063,-3985 31323,-3985 31323,-4043"/>
<text text-anchor="middle" x="31193" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 0</text>
<text text-anchor="middle" x="31193" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31193" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert0 -->
<g id="edge178" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29222.86,-4165C29745.09,-4165 31080.33,-4165 31080.33,-4165 31080.33,-4165 31080.33,-4053.11 31080.33,-4053.11"/>
<polygon fill="black" stroke="black" points="31083.83,-4053.11 31080.33,-4043.11 31076.83,-4053.11 31083.83,-4053.11"/>
<text text-anchor="middle" x="29923.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert1 -->
<g id="node133" class="node">
<title>R1_Stage1_L4_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="31619,-4043 31359,-4043 31359,-3985 31619,-3985 31619,-4043"/>
<text text-anchor="middle" x="31489" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 1</text>
<text text-anchor="middle" x="31489" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31489" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert1 -->
<g id="edge179" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29225.34,-4167C29801.91,-4167 31376.33,-4167 31376.33,-4167 31376.33,-4167 31376.33,-4053.14 31376.33,-4053.14"/>
<polygon fill="black" stroke="black" points="31379.83,-4053.14 31376.33,-4043.14 31372.83,-4053.14 31379.83,-4053.14"/>
<text text-anchor="middle" x="30008.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert2 -->
<g id="node134" class="node">
<title>R1_Stage1_L4_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="31915,-4043 31655,-4043 31655,-3985 31915,-3985 31915,-4043"/>
<text text-anchor="middle" x="31785" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 2</text>
<text text-anchor="middle" x="31785" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="31785" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert2 -->
<g id="edge180" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29226.75,-4168C29854.01,-4168 31672.33,-4168 31672.33,-4168 31672.33,-4168 31672.33,-4053.33 31672.33,-4053.33"/>
<polygon fill="black" stroke="black" points="31675.83,-4053.33 31672.33,-4043.33 31668.83,-4053.33 31675.83,-4053.33"/>
<text text-anchor="middle" x="30093.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert3 -->
<g id="node135" class="node">
<title>R1_Stage1_L4_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="32211,-4043 31951,-4043 31951,-3985 32211,-3985 32211,-4043"/>
<text text-anchor="middle" x="32081" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 3</text>
<text text-anchor="middle" x="32081" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32081" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert3 -->
<g id="edge181" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29229.25,-4170C29905.97,-4170 31968.33,-4170 31968.33,-4170 31968.33,-4170 31968.33,-4053.34 31968.33,-4053.34"/>
<polygon fill="black" stroke="black" points="31971.83,-4053.34 31968.33,-4043.34 31964.83,-4053.34 31971.83,-4053.34"/>
<text text-anchor="middle" x="30177.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert4 -->
<g id="node136" class="node">
<title>R1_Stage1_L4_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="32507,-4043 32247,-4043 32247,-3985 32507,-3985 32507,-4043"/>
<text text-anchor="middle" x="32377" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 4</text>
<text text-anchor="middle" x="32377" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32377" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert4 -->
<g id="edge182" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29231.64,-4172C29955.85,-4172 32264.33,-4172 32264.33,-4172 32264.33,-4172 32264.33,-4053.35 32264.33,-4053.35"/>
<polygon fill="black" stroke="black" points="32267.83,-4053.35 32264.33,-4043.35 32260.83,-4053.35 32267.83,-4053.35"/>
<text text-anchor="middle" x="30261.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert5 -->
<g id="node137" class="node">
<title>R1_Stage1_L4_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="32803,-4043 32543,-4043 32543,-3985 32803,-3985 32803,-4043"/>
<text text-anchor="middle" x="32673" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 5</text>
<text text-anchor="middle" x="32673" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32673" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert5 -->
<g id="edge183" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29234.31,-4174C30004.83,-4174 32560.33,-4174 32560.33,-4174 32560.33,-4174 32560.33,-4053.35 32560.33,-4053.35"/>
<polygon fill="black" stroke="black" points="32563.83,-4053.35 32560.33,-4043.35 32556.83,-4053.35 32563.83,-4053.35"/>
<text text-anchor="middle" x="30345.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert6 -->
<g id="node138" class="node">
<title>R1_Stage1_L4_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="33099,-4043 32839,-4043 32839,-3985 33099,-3985 33099,-4043"/>
<text text-anchor="middle" x="32969" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 6</text>
<text text-anchor="middle" x="32969" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="32969" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert6 -->
<g id="edge184" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29311.53,-4235C30218.61,-4235 32909,-4235 32909,-4235 32909,-4235 32909,-4053.35 32909,-4053.35"/>
<polygon fill="black" stroke="black" points="32912.5,-4053.35 32909,-4043.35 32905.5,-4053.35 32912.5,-4053.35"/>
<text text-anchor="middle" x="30429.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert7 -->
<g id="node139" class="node">
<title>R1_Stage1_L4_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="33395,-4043 33135,-4043 33135,-3985 33395,-3985 33395,-4043"/>
<text text-anchor="middle" x="33265" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 7</text>
<text text-anchor="middle" x="33265" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="33265" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert7 -->
<g id="edge185" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29314,-4237C30269.91,-4237 33205,-4237 33205,-4237 33205,-4237 33205,-4053.15 33205,-4053.15"/>
<polygon fill="black" stroke="black" points="33208.5,-4053.15 33205,-4043.15 33201.5,-4053.15 33208.5,-4053.15"/>
<text text-anchor="middle" x="30513.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert8 -->
<g id="node140" class="node">
<title>R1_Stage1_L4_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="28955,-4043 28695,-4043 28695,-3985 28955,-3985 28955,-4043"/>
<text text-anchor="middle" x="28825" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 8</text>
<text text-anchor="middle" x="28825" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="28825" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert8 -->
<g id="edge186" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M28825,-4152.81C28825,-4152.81 28825,-4053.01 28825,-4053.01"/>
<polygon fill="black" stroke="black" points="28828.5,-4053.01 28825,-4043.01 28821.5,-4053.01 28828.5,-4053.01"/>
<text text-anchor="middle" x="28900.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert9 -->
<g id="node141" class="node">
<title>R1_Stage1_L4_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="29251,-4043 28991,-4043 28991,-3985 29251,-3985 29251,-4043"/>
<text text-anchor="middle" x="29121" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 9</text>
<text text-anchor="middle" x="29121" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="29121" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert9 -->
<g id="edge187" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29121,-4152.81C29121,-4152.81 29121,-4053.01 29121,-4053.01"/>
<polygon fill="black" stroke="black" points="29124.5,-4053.01 29121,-4043.01 29117.5,-4053.01 29124.5,-4053.01"/>
<text text-anchor="middle" x="29090.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert10 -->
<g id="node142" class="node">
<title>R1_Stage1_L4_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="29547,-4043 29287,-4043 29287,-3985 29547,-3985 29547,-4043"/>
<text text-anchor="middle" x="29417" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 10</text>
<text text-anchor="middle" x="29417" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="29417" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert10 -->
<g id="edge188" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29313.22,-4204.86C29313.22,-4204.86 29313.22,-4053.01 29313.22,-4053.01"/>
<polygon fill="black" stroke="black" points="29316.72,-4053.01 29313.22,-4043.01 29309.72,-4053.01 29316.72,-4053.01"/>
<text text-anchor="middle" x="29239.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert11 -->
<g id="node143" class="node">
<title>R1_Stage1_L4_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="29843,-4043 29583,-4043 29583,-3985 29843,-3985 29843,-4043"/>
<text text-anchor="middle" x="29713" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 11</text>
<text text-anchor="middle" x="29713" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="29713" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert11 -->
<g id="edge189" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29211.65,-4156C29381.28,-4156 29600.33,-4156 29600.33,-4156 29600.33,-4156 29600.33,-4053.08 29600.33,-4053.08"/>
<polygon fill="black" stroke="black" points="29603.83,-4053.08 29600.33,-4043.08 29596.83,-4053.08 29603.83,-4053.08"/>
<text text-anchor="middle" x="29355.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert12 -->
<g id="node144" class="node">
<title>R1_Stage1_L4_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="30139,-4043 29879,-4043 29879,-3985 30139,-3985 30139,-4043"/>
<text text-anchor="middle" x="30009" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 12</text>
<text text-anchor="middle" x="30009" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30009" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert12 -->
<g id="edge190" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29213.79,-4158C29473,-4158 29896.33,-4158 29896.33,-4158 29896.33,-4158 29896.33,-4053.14 29896.33,-4053.14"/>
<polygon fill="black" stroke="black" points="29899.83,-4053.14 29896.33,-4043.14 29892.83,-4053.14 29899.83,-4053.14"/>
<text text-anchor="middle" x="29557.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert13 -->
<g id="node145" class="node">
<title>R1_Stage1_L4_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="30435,-4043 30175,-4043 30175,-3985 30435,-3985 30435,-4043"/>
<text text-anchor="middle" x="30305" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 13</text>
<text text-anchor="middle" x="30305" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30305" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert13 -->
<g id="edge191" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29216.38,-4160C29551.71,-4160 30192.33,-4160 30192.33,-4160 30192.33,-4160 30192.33,-4053.19 30192.33,-4053.19"/>
<polygon fill="black" stroke="black" points="30195.83,-4053.19 30192.33,-4043.19 30188.83,-4053.19 30195.83,-4053.19"/>
<text text-anchor="middle" x="29657.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert14 -->
<g id="node146" class="node">
<title>R1_Stage1_L4_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="30731,-4043 30471,-4043 30471,-3985 30731,-3985 30731,-4043"/>
<text text-anchor="middle" x="30601" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 14</text>
<text text-anchor="middle" x="30601" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30601" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert14 -->
<g id="edge192" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29217.73,-4161C29620.36,-4161 30488.33,-4161 30488.33,-4161 30488.33,-4161 30488.33,-4053.04 30488.33,-4053.04"/>
<polygon fill="black" stroke="black" points="30491.83,-4053.04 30488.33,-4043.04 30484.83,-4053.04 30491.83,-4053.04"/>
<text text-anchor="middle" x="29749.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_Expert15 -->
<g id="node147" class="node">
<title>R1_Stage1_L4_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="31027,-4043 30767,-4043 30767,-3985 31027,-3985 31027,-4043"/>
<text text-anchor="middle" x="30897" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 15</text>
<text text-anchor="middle" x="30897" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="30897" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert15 -->
<g id="edge193" class="edge">
<title>R1_Stage1_L4_Router&#45;&gt;R1_Stage1_L4_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M29220.17,-4163C29684.64,-4163 30784.33,-4163 30784.33,-4163 30784.33,-4163 30784.33,-4053.08 30784.33,-4053.08"/>
<polygon fill="black" stroke="black" points="30787.83,-4053.08 30784.33,-4043.08 30780.83,-4053.08 30787.83,-4053.08"/>
<text text-anchor="middle" x="29837.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage1_L4_MoE_Output -->
<g id="node148" class="node">
<title>R1_Stage1_L4_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="31523.95,-3889 30997.48,-3889 30862.05,-3785 31388.52,-3785 31523.95,-3889"/>
<text text-anchor="middle" x="31193" y="-3851" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="31193" y="-3840" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="31193" y="-3829" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="31193" y="-3818" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage1_L4_Expert0&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge194" class="edge">
<title>R1_Stage1_L4_Expert0&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M31193,-3984.77C31193,-3984.77 31193,-3899.18 31193,-3899.18"/>
<polygon fill="black" stroke="black" points="31196.5,-3899.18 31193,-3889.18 31189.5,-3899.18 31196.5,-3899.18"/>
</g>
<!-- R1_Stage1_L4_Expert1&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge195" class="edge">
<title>R1_Stage1_L4_Expert1&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M31441.36,-3984.77C31441.36,-3984.77 31441.36,-3899.18 31441.36,-3899.18"/>
<polygon fill="black" stroke="black" points="31444.86,-3899.18 31441.36,-3889.18 31437.86,-3899.18 31444.86,-3899.18"/>
</g>
<!-- R1_Stage1_L4_Expert2&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge196" class="edge">
<title>R1_Stage1_L4_Expert2&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M31785,-3984.95C31785,-3947.19 31785,-3886 31785,-3886 31785,-3886 31530.17,-3886 31530.17,-3886"/>
<polygon fill="black" stroke="black" points="31530.17,-3882.5 31520.17,-3886 31530.17,-3889.5 31530.17,-3882.5"/>
</g>
<!-- R1_Stage1_L4_Expert3&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge197" class="edge">
<title>R1_Stage1_L4_Expert3&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M32081,-3984.83C32081,-3946.5 32081,-3884 32081,-3884 32081,-3884 31527.67,-3884 31527.67,-3884"/>
<polygon fill="black" stroke="black" points="31527.67,-3880.5 31517.67,-3884 31527.67,-3887.5 31527.67,-3880.5"/>
</g>
<!-- R1_Stage1_L4_Expert4&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge198" class="edge">
<title>R1_Stage1_L4_Expert4&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M32377,-3984.7C32377,-3945.82 32377,-3882 32377,-3882 32377,-3882 31524.97,-3882 31524.97,-3882"/>
<polygon fill="black" stroke="black" points="31524.97,-3878.5 31514.97,-3882 31524.97,-3885.5 31524.97,-3878.5"/>
</g>
<!-- R1_Stage1_L4_Expert5&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge199" class="edge">
<title>R1_Stage1_L4_Expert5&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M32673,-3984.92C32673,-3945.51 32673,-3880 32673,-3880 32673,-3880 31522.32,-3880 31522.32,-3880"/>
<polygon fill="black" stroke="black" points="31522.32,-3876.5 31512.32,-3880 31522.32,-3883.5 31522.32,-3876.5"/>
</g>
<!-- R1_Stage1_L4_Expert6&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge200" class="edge">
<title>R1_Stage1_L4_Expert6&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M32969,-3984.82C32969,-3944.86 32969,-3878 32969,-3878 32969,-3878 31519.75,-3878 31519.75,-3878"/>
<polygon fill="black" stroke="black" points="31519.75,-3874.5 31509.75,-3878 31519.75,-3881.5 31519.75,-3874.5"/>
</g>
<!-- R1_Stage1_L4_Expert7&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge201" class="edge">
<title>R1_Stage1_L4_Expert7&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M33265,-3984.86C33265,-3944.1 33265,-3875 33265,-3875 33265,-3875 31515.72,-3875 31515.72,-3875"/>
<polygon fill="black" stroke="black" points="31515.72,-3871.5 31505.72,-3875 31515.72,-3878.5 31515.72,-3871.5"/>
</g>
<!-- R1_Stage1_L4_Expert8&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge202" class="edge">
<title>R1_Stage1_L4_Expert8&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M28825,-3984.96C28825,-3942.12 28825,-3867 28825,-3867 28825,-3867 30958.62,-3867 30958.62,-3867"/>
<polygon fill="black" stroke="black" points="30958.62,-3870.5 30968.62,-3867 30958.62,-3863.5 30958.62,-3870.5"/>
</g>
<!-- R1_Stage1_L4_Expert9&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge203" class="edge">
<title>R1_Stage1_L4_Expert9&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M29121,-3984.66C29121,-3942.29 29121,-3869 29121,-3869 29121,-3869 30961.26,-3869 30961.26,-3869"/>
<polygon fill="black" stroke="black" points="30961.26,-3872.5 30971.26,-3869 30961.26,-3865.5 30961.26,-3872.5"/>
</g>
<!-- R1_Stage1_L4_Expert10&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge204" class="edge">
<title>R1_Stage1_L4_Expert10&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M29417,-3984.86C29417,-3942.78 29417,-3870 29417,-3870 29417,-3870 30962.55,-3870 30962.55,-3870"/>
<polygon fill="black" stroke="black" points="30962.55,-3873.5 30972.55,-3870 30962.55,-3866.5 30962.55,-3873.5"/>
</g>
<!-- R1_Stage1_L4_Expert11&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge205" class="edge">
<title>R1_Stage1_L4_Expert11&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M29713,-3984.92C29713,-3943.38 29713,-3872 29713,-3872 29713,-3872 30965.02,-3872 30965.02,-3872"/>
<polygon fill="black" stroke="black" points="30965.02,-3875.5 30975.02,-3872 30965.02,-3868.5 30965.02,-3875.5"/>
</g>
<!-- R1_Stage1_L4_Expert12&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge206" class="edge">
<title>R1_Stage1_L4_Expert12&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M30009,-3984.99C30009,-3943.99 30009,-3874 30009,-3874 30009,-3874 30967.9,-3874 30967.9,-3874"/>
<polygon fill="black" stroke="black" points="30967.9,-3877.5 30977.9,-3874 30967.9,-3870.5 30967.9,-3877.5"/>
</g>
<!-- R1_Stage1_L4_Expert13&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge207" class="edge">
<title>R1_Stage1_L4_Expert13&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M30305,-3984.86C30305,-3944.1 30305,-3875 30305,-3875 30305,-3875 30969.17,-3875 30969.17,-3875"/>
<polygon fill="black" stroke="black" points="30969.17,-3878.5 30979.17,-3875 30969.17,-3871.5 30969.17,-3878.5"/>
</g>
<!-- R1_Stage1_L4_Expert14&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge208" class="edge">
<title>R1_Stage1_L4_Expert14&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M30601,-3984.95C30601,-3944.73 30601,-3877 30601,-3877 30601,-3877 30971.78,-3877 30971.78,-3877"/>
<polygon fill="black" stroke="black" points="30971.78,-3880.5 30981.78,-3877 30971.78,-3873.5 30971.78,-3880.5"/>
</g>
<!-- R1_Stage1_L4_Expert15&#45;&gt;R1_Stage1_L4_MoE_Output -->
<g id="edge209" class="edge">
<title>R1_Stage1_L4_Expert15&#45;&gt;R1_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M30944.64,-3984.77C30944.64,-3984.77 30944.64,-3858.66 30944.64,-3858.66"/>
<polygon fill="black" stroke="black" points="30948.14,-3858.66 30944.64,-3848.66 30941.14,-3858.66 30948.14,-3858.66"/>
</g>
<!-- R1_Stage1_L4_MoE_Output&#45;&gt;R1_Stage1_L4_Output -->
<g id="edge210" class="edge">
<title>R1_Stage1_L4_MoE_Output&#45;&gt;R1_Stage1_L4_Output</title>
<path fill="none" stroke="black" d="M31397.79,-3792C32029.08,-3792 33902.83,-3792 33902.83,-3792 33902.83,-3792 33902.83,-3697.35 33902.83,-3697.35"/>
<polygon fill="black" stroke="black" points="33906.33,-3697.35 33902.83,-3687.35 33899.33,-3697.35 33906.33,-3697.35"/>
</g>
<!-- R1_Stage2_L5_Input -->
<g id="node149" class="node">
<title>R1_Stage2_L5_Input</title>
<ellipse fill="lightblue" stroke="black" cx="39129" cy="-4587" rx="225.5" ry="29"/>
<text text-anchor="middle" x="39129" y="-4595.5" font-family="Times,serif" font-size="10.00">Layer 5 Input</text>
<text text-anchor="middle" x="39129" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="39129" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Attn_Input -->
<g id="node150" class="node">
<title>R1_Stage2_L5_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="39129" cy="-4396" rx="225.5" ry="29"/>
<text text-anchor="middle" x="39129" y="-4404.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="39129" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="39129" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Input&#45;&gt;R1_Stage2_L5_Attn_Input -->
<g id="edge211" class="edge">
<title>R1_Stage2_L5_Input&#45;&gt;R1_Stage2_L5_Attn_Input</title>
<path fill="none" stroke="black" d="M39129,-4557.99C39129,-4557.99 39129,-4435.28 39129,-4435.28"/>
<polygon fill="black" stroke="black" points="39132.5,-4435.28 39129,-4425.28 39125.5,-4435.28 39132.5,-4435.28"/>
</g>
<!-- R1_Stage2_L5_Attn_TP1 -->
<g id="node151" class="node">
<title>R1_Stage2_L5_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="39111,-4234 38765,-4234 38765,-4176 39111,-4176 39111,-4234"/>
<text text-anchor="middle" x="38938" y="-4219" font-family="Times,serif" font-size="10.00">Attention TP GPU 16</text>
<text text-anchor="middle" x="38938" y="-4208" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="38938" y="-4197" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="38938" y="-4186" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage2_L5_Attn_Input&#45;&gt;R1_Stage2_L5_Attn_TP1 -->
<g id="edge212" class="edge">
<title>R1_Stage2_L5_Attn_Input&#45;&gt;R1_Stage2_L5_Attn_TP1</title>
<path fill="none" stroke="black" d="M39007.25,-4371.42C39007.25,-4371.42 39007.25,-4244.17 39007.25,-4244.17"/>
<polygon fill="black" stroke="black" points="39010.75,-4244.17 39007.25,-4234.17 39003.75,-4244.17 39010.75,-4244.17"/>
</g>
<!-- R1_Stage2_L5_Attn_TP2 -->
<g id="node152" class="node">
<title>R1_Stage2_L5_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="39493,-4234 39147,-4234 39147,-4176 39493,-4176 39493,-4234"/>
<text text-anchor="middle" x="39320" y="-4219" font-family="Times,serif" font-size="10.00">Attention TP GPU 17</text>
<text text-anchor="middle" x="39320" y="-4208" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="39320" y="-4197" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="39320" y="-4186" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage2_L5_Attn_Input&#45;&gt;R1_Stage2_L5_Attn_TP2 -->
<g id="edge213" class="edge">
<title>R1_Stage2_L5_Attn_Input&#45;&gt;R1_Stage2_L5_Attn_TP2</title>
<path fill="none" stroke="black" d="M39250.75,-4371.42C39250.75,-4371.42 39250.75,-4244.17 39250.75,-4244.17"/>
<polygon fill="black" stroke="black" points="39254.25,-4244.17 39250.75,-4234.17 39247.25,-4244.17 39254.25,-4244.17"/>
</g>
<!-- R1_Stage2_L5_Attn_Output -->
<g id="node153" class="node">
<title>R1_Stage2_L5_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="39036" cy="-4014" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="39036" y="-4028" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="39036" y="-4017" font-family="Times,serif" font-size="10.00">AllReduce GPUs 16&#45;17</text>
<text text-anchor="middle" x="39036" y="-4006" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="39036" y="-3995" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Attn_TP1&#45;&gt;R1_Stage2_L5_Attn_Output -->
<g id="edge214" class="edge">
<title>R1_Stage2_L5_Attn_TP1&#45;&gt;R1_Stage2_L5_Attn_Output</title>
<path fill="none" stroke="black" d="M38951.88,-4175.99C38951.88,-4175.99 38951.88,-4058.8 38951.88,-4058.8"/>
<polygon fill="black" stroke="black" points="38955.38,-4058.8 38951.88,-4048.8 38948.38,-4058.8 38955.38,-4058.8"/>
</g>
<!-- R1_Stage2_L5_Attn_TP2&#45;&gt;R1_Stage2_L5_Attn_Output -->
<g id="edge215" class="edge">
<title>R1_Stage2_L5_Attn_TP2&#45;&gt;R1_Stage2_L5_Attn_Output</title>
<path fill="none" stroke="black" d="M39213.12,-4175.99C39213.12,-4175.99 39213.12,-4049.31 39213.12,-4049.31"/>
<polygon fill="black" stroke="black" points="39216.62,-4049.31 39213.12,-4039.31 39209.62,-4049.31 39216.62,-4049.31"/>
</g>
<!-- R1_Stage2_L5_MoE_Input -->
<g id="node154" class="node">
<title>R1_Stage2_L5_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="39036" cy="-3837" rx="225.5" ry="29"/>
<text text-anchor="middle" x="39036" y="-3845.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="39036" y="-3834.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="39036" y="-3823.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Attn_Output&#45;&gt;R1_Stage2_L5_MoE_Input -->
<g id="edge216" class="edge">
<title>R1_Stage2_L5_Attn_Output&#45;&gt;R1_Stage2_L5_MoE_Input</title>
<path fill="none" stroke="black" d="M39036,-3976.89C39036,-3976.89 39036,-3876.17 39036,-3876.17"/>
<polygon fill="black" stroke="black" points="39039.5,-3876.17 39036,-3866.17 39032.5,-3876.17 39039.5,-3876.17"/>
</g>
<!-- R1_Stage2_L5_Router -->
<g id="node155" class="node">
<title>R1_Stage2_L5_Router</title>
<polygon fill="lightyellow" stroke="black" points="39358.36,-3712 38845.56,-3712 38713.64,-3608 39226.44,-3608 39358.36,-3712"/>
<text text-anchor="middle" x="39036" y="-3674" font-family="Times,serif" font-size="10.00">Router GPU 16</text>
<text text-anchor="middle" x="39036" y="-3663" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="39036" y="-3652" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="39036" y="-3641" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage2_L5_MoE_Input&#45;&gt;R1_Stage2_L5_Router -->
<g id="edge217" class="edge">
<title>R1_Stage2_L5_MoE_Input&#45;&gt;R1_Stage2_L5_Router</title>
<path fill="none" stroke="black" d="M39036,-3807.77C39036,-3807.77 39036,-3722.18 39036,-3722.18"/>
<polygon fill="black" stroke="black" points="39039.5,-3722.18 39036,-3712.18 39032.5,-3722.18 39039.5,-3722.18"/>
</g>
<!-- R1_Stage2_L5_Expert0 -->
<g id="node156" class="node">
<title>R1_Stage2_L5_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="39906,-3498 39646,-3498 39646,-3440 39906,-3440 39906,-3498"/>
<text text-anchor="middle" x="39776" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 16</text>
<text text-anchor="middle" x="39776" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39776" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert0 -->
<g id="edge218" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M39230.43,-3611C39449.68,-3611 39776,-3611 39776,-3611 39776,-3611 39776,-3508.08 39776,-3508.08"/>
<polygon fill="black" stroke="black" points="39779.5,-3508.08 39776,-3498.08 39772.5,-3508.08 39779.5,-3508.08"/>
<text text-anchor="middle" x="39664.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert1 -->
<g id="node157" class="node">
<title>R1_Stage2_L5_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="40202,-3498 39942,-3498 39942,-3440 40202,-3440 40202,-3498"/>
<text text-anchor="middle" x="40072" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 17</text>
<text text-anchor="middle" x="40072" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40072" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert1 -->
<g id="edge219" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M39234.22,-3614C39534.98,-3614 40072,-3614 40072,-3614 40072,-3614 40072,-3508.34 40072,-3508.34"/>
<polygon fill="black" stroke="black" points="40075.5,-3508.34 40072,-3498.34 40068.5,-3508.34 40075.5,-3508.34"/>
<text text-anchor="middle" x="39947.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert2 -->
<g id="node158" class="node">
<title>R1_Stage2_L5_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="40498,-3498 40238,-3498 40238,-3440 40498,-3440 40498,-3498"/>
<text text-anchor="middle" x="40368" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 18</text>
<text text-anchor="middle" x="40368" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40368" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert2 -->
<g id="edge220" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M39237.94,-3617C39610.43,-3617 40368,-3617 40368,-3617 40368,-3617 40368,-3508.24 40368,-3508.24"/>
<polygon fill="black" stroke="black" points="40371.5,-3508.24 40368,-3498.24 40364.5,-3508.24 40371.5,-3508.24"/>
<text text-anchor="middle" x="40236.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert3 -->
<g id="node159" class="node">
<title>R1_Stage2_L5_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="40794,-3498 40534,-3498 40534,-3440 40794,-3440 40794,-3498"/>
<text text-anchor="middle" x="40664" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 19</text>
<text text-anchor="middle" x="40664" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40664" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert3 -->
<g id="edge221" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M39243.01,-3621C39681.49,-3621 40664,-3621 40664,-3621 40664,-3621 40664,-3508.31 40664,-3508.31"/>
<polygon fill="black" stroke="black" points="40667.5,-3508.31 40664,-3498.31 40660.5,-3508.31 40667.5,-3508.31"/>
<text text-anchor="middle" x="40425.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert4 -->
<g id="node160" class="node">
<title>R1_Stage2_L5_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="41090,-3498 40830,-3498 40830,-3440 41090,-3440 41090,-3498"/>
<text text-anchor="middle" x="40960" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 20</text>
<text text-anchor="middle" x="40960" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40960" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert4 -->
<g id="edge222" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M39246.94,-3624C39746.46,-3624 40960,-3624 40960,-3624 40960,-3624 40960,-3508.15 40960,-3508.15"/>
<polygon fill="black" stroke="black" points="40963.5,-3508.15 40960,-3498.15 40956.5,-3508.15 40963.5,-3508.15"/>
<text text-anchor="middle" x="40824.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert5 -->
<g id="node161" class="node">
<title>R1_Stage2_L5_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="41386,-3498 41126,-3498 41126,-3440 41386,-3440 41386,-3498"/>
<text text-anchor="middle" x="41256" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 21</text>
<text text-anchor="middle" x="41256" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="41256" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert5 -->
<g id="edge223" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M39250.63,-3627C39807.58,-3627 41256,-3627 41256,-3627 41256,-3627 41256,-3508.35 41256,-3508.35"/>
<polygon fill="black" stroke="black" points="41259.5,-3508.35 41256,-3498.35 41252.5,-3508.35 41259.5,-3508.35"/>
<text text-anchor="middle" x="41171.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert6 -->
<g id="node162" class="node">
<title>R1_Stage2_L5_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="36946,-3498 36686,-3498 36686,-3440 36946,-3440 36946,-3498"/>
<text text-anchor="middle" x="36816" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 22</text>
<text text-anchor="middle" x="36816" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="36816" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert6 -->
<g id="edge224" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M38728.69,-3620C38145.54,-3620 36936.12,-3620 36936.12,-3620 36936.12,-3620 36936.12,-3508.11 36936.12,-3508.11"/>
<polygon fill="black" stroke="black" points="36939.62,-3508.11 36936.12,-3498.11 36932.62,-3508.11 36939.62,-3508.11"/>
<text text-anchor="middle" x="37048.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert7 -->
<g id="node163" class="node">
<title>R1_Stage2_L5_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="37242,-3498 36982,-3498 36982,-3440 37242,-3440 37242,-3498"/>
<text text-anchor="middle" x="37112" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 23</text>
<text text-anchor="middle" x="37112" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="37112" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert7 -->
<g id="edge225" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M38726.11,-3618C38198.68,-3618 37183,-3618 37183,-3618 37183,-3618 37183,-3508.08 37183,-3508.08"/>
<polygon fill="black" stroke="black" points="37186.5,-3508.08 37183,-3498.08 37179.5,-3508.08 37186.5,-3508.08"/>
<text text-anchor="middle" x="37343.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert8 -->
<g id="node164" class="node">
<title>R1_Stage2_L5_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="37538,-3498 37278,-3498 37278,-3440 37538,-3440 37538,-3498"/>
<text text-anchor="middle" x="37408" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 24</text>
<text text-anchor="middle" x="37408" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="37408" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert8 -->
<g id="edge226" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M38723.55,-3616C38250.74,-3616 37408,-3616 37408,-3616 37408,-3616 37408,-3508.04 37408,-3508.04"/>
<polygon fill="black" stroke="black" points="37411.5,-3508.04 37408,-3498.04 37404.5,-3508.04 37411.5,-3508.04"/>
<text text-anchor="middle" x="37637.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert9 -->
<g id="node165" class="node">
<title>R1_Stage2_L5_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="37834,-3498 37574,-3498 37574,-3440 37834,-3440 37834,-3498"/>
<text text-anchor="middle" x="37704" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 25</text>
<text text-anchor="middle" x="37704" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="37704" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert9 -->
<g id="edge227" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M38719.91,-3613C38326,-3613 37704,-3613 37704,-3613 37704,-3613 37704,-3508.14 37704,-3508.14"/>
<polygon fill="black" stroke="black" points="37707.5,-3508.14 37704,-3498.14 37700.5,-3508.14 37707.5,-3508.14"/>
<text text-anchor="middle" x="37930.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert10 -->
<g id="node166" class="node">
<title>R1_Stage2_L5_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="38130,-3498 37870,-3498 37870,-3440 38130,-3440 38130,-3498"/>
<text text-anchor="middle" x="38000" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 26</text>
<text text-anchor="middle" x="38000" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38000" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert10 -->
<g id="edge228" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M38717.42,-3611C38412.95,-3611 38000,-3611 38000,-3611 38000,-3611 38000,-3508.08 38000,-3508.08"/>
<polygon fill="black" stroke="black" points="38003.5,-3508.08 38000,-3498.08 37996.5,-3508.08 38003.5,-3508.08"/>
<text text-anchor="middle" x="38219.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert11 -->
<g id="node167" class="node">
<title>R1_Stage2_L5_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="38426,-3498 38166,-3498 38166,-3440 38426,-3440 38426,-3498"/>
<text text-anchor="middle" x="38296" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 27</text>
<text text-anchor="middle" x="38296" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38296" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert11 -->
<g id="edge229" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M38714.65,-3609C38514.95,-3609 38296,-3609 38296,-3609 38296,-3609 38296,-3508.01 38296,-3508.01"/>
<polygon fill="black" stroke="black" points="38299.5,-3508.01 38296,-3498.01 38292.5,-3508.01 38299.5,-3508.01"/>
<text text-anchor="middle" x="38502.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert12 -->
<g id="node168" class="node">
<title>R1_Stage2_L5_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="38722,-3498 38462,-3498 38462,-3440 38722,-3440 38722,-3498"/>
<text text-anchor="middle" x="38592" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 28</text>
<text text-anchor="middle" x="38592" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38592" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert12 -->
<g id="edge230" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M38717.78,-3659.86C38717.78,-3659.86 38717.78,-3508.01 38717.78,-3508.01"/>
<polygon fill="black" stroke="black" points="38721.28,-3508.01 38717.78,-3498.01 38714.28,-3508.01 38721.28,-3508.01"/>
<text text-anchor="middle" x="38772.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert13 -->
<g id="node169" class="node">
<title>R1_Stage2_L5_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="39018,-3498 38758,-3498 38758,-3440 39018,-3440 39018,-3498"/>
<text text-anchor="middle" x="38888" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 29</text>
<text text-anchor="middle" x="38888" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38888" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert13 -->
<g id="edge231" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M38888,-3607.81C38888,-3607.81 38888,-3508.01 38888,-3508.01"/>
<polygon fill="black" stroke="black" points="38891.5,-3508.01 38888,-3498.01 38884.5,-3508.01 38891.5,-3508.01"/>
<text text-anchor="middle" x="38962.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert14 -->
<g id="node170" class="node">
<title>R1_Stage2_L5_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="39314,-3498 39054,-3498 39054,-3440 39314,-3440 39314,-3498"/>
<text text-anchor="middle" x="39184" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 30</text>
<text text-anchor="middle" x="39184" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39184" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert14 -->
<g id="edge232" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M39184,-3607.81C39184,-3607.81 39184,-3508.01 39184,-3508.01"/>
<polygon fill="black" stroke="black" points="39187.5,-3508.01 39184,-3498.01 39180.5,-3508.01 39187.5,-3508.01"/>
<text text-anchor="middle" x="39152.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_Expert15 -->
<g id="node171" class="node">
<title>R1_Stage2_L5_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="39610,-3498 39350,-3498 39350,-3440 39610,-3440 39610,-3498"/>
<text text-anchor="middle" x="39480" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 31</text>
<text text-anchor="middle" x="39480" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39480" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert15 -->
<g id="edge233" class="edge">
<title>R1_Stage2_L5_Router&#45;&gt;R1_Stage2_L5_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M39354.22,-3659.86C39354.22,-3659.86 39354.22,-3508.01 39354.22,-3508.01"/>
<polygon fill="black" stroke="black" points="39357.72,-3508.01 39354.22,-3498.01 39350.72,-3508.01 39357.72,-3508.01"/>
<text text-anchor="middle" x="39395.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L5_MoE_Output -->
<g id="node172" class="node">
<title>R1_Stage2_L5_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="37896.95,-3330 37370.48,-3330 37235.05,-3226 37761.52,-3226 37896.95,-3330"/>
<text text-anchor="middle" x="37566" y="-3292" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="37566" y="-3281" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="37566" y="-3270" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="37566" y="-3259" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L5_Expert0&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge234" class="edge">
<title>R1_Stage2_L5_Expert0&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M39655,-3439.89C39655,-3396.01 39655,-3318 39655,-3318 39655,-3318 37891.57,-3318 37891.57,-3318"/>
<polygon fill="black" stroke="black" points="37891.57,-3314.5 37881.57,-3318 37891.57,-3321.5 37891.57,-3314.5"/>
</g>
<!-- R1_Stage2_L5_Expert1&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge235" class="edge">
<title>R1_Stage2_L5_Expert1&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M39951,-3439.86C39951,-3395.47 39951,-3316 39951,-3316 39951,-3316 37889.02,-3316 37889.02,-3316"/>
<polygon fill="black" stroke="black" points="37889.02,-3312.5 37879.02,-3316 37889.02,-3319.5 37889.02,-3312.5"/>
</g>
<!-- R1_Stage2_L5_Expert2&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge236" class="edge">
<title>R1_Stage2_L5_Expert2&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M40247,-3439.85C40247,-3394.95 40247,-3314 40247,-3314 40247,-3314 37886.16,-3314 37886.16,-3314"/>
<polygon fill="black" stroke="black" points="37886.16,-3310.5 37876.16,-3314 37886.16,-3317.5 37886.16,-3310.5"/>
</g>
<!-- R1_Stage2_L5_Expert3&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge237" class="edge">
<title>R1_Stage2_L5_Expert3&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M40543,-3439.84C40543,-3394.43 40543,-3312 40543,-3312 40543,-3312 37883.73,-3312 37883.73,-3312"/>
<polygon fill="black" stroke="black" points="37883.73,-3308.5 37873.73,-3312 37883.73,-3315.5 37883.73,-3308.5"/>
</g>
<!-- R1_Stage2_L5_Expert4&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge238" class="edge">
<title>R1_Stage2_L5_Expert4&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M40839,-3439.84C40839,-3393.93 40839,-3310 40839,-3310 40839,-3310 37880.98,-3310 37880.98,-3310"/>
<polygon fill="black" stroke="black" points="37880.98,-3306.5 37870.98,-3310 37880.98,-3313.5 37880.98,-3306.5"/>
</g>
<!-- R1_Stage2_L5_Expert5&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge239" class="edge">
<title>R1_Stage2_L5_Expert5&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M41135,-3439.84C41135,-3393.45 41135,-3308 41135,-3308 41135,-3308 37878.37,-3308 37878.37,-3308"/>
<polygon fill="black" stroke="black" points="37878.37,-3304.5 37868.37,-3308 37878.37,-3311.5 37878.37,-3304.5"/>
</g>
<!-- R1_Stage2_L5_Expert6&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge240" class="edge">
<title>R1_Stage2_L5_Expert6&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M36895.28,-3439.96C36895.28,-3397.12 36895.28,-3322 36895.28,-3322 36895.28,-3322 37349.75,-3322 37349.75,-3322"/>
<polygon fill="black" stroke="black" points="37349.75,-3325.5 37359.75,-3322 37349.75,-3318.5 37349.75,-3325.5"/>
</g>
<!-- R1_Stage2_L5_Expert7&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge241" class="edge">
<title>R1_Stage2_L5_Expert7&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M37226.18,-3439.85C37226.18,-3394.95 37226.18,-3314 37226.18,-3314 37226.18,-3314 37339.35,-3314 37339.35,-3314"/>
<polygon fill="black" stroke="black" points="37339.35,-3317.5 37349.35,-3314 37339.35,-3310.5 37339.35,-3317.5"/>
</g>
<!-- R1_Stage2_L5_Expert8&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge242" class="edge">
<title>R1_Stage2_L5_Expert8&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M37408,-3439.99C37408,-3439.99 37408,-3340.02 37408,-3340.02"/>
<polygon fill="black" stroke="black" points="37411.5,-3340.02 37408,-3330.02 37404.5,-3340.02 37411.5,-3340.02"/>
</g>
<!-- R1_Stage2_L5_Expert9&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge243" class="edge">
<title>R1_Stage2_L5_Expert9&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M37704,-3439.99C37704,-3439.99 37704,-3340.02 37704,-3340.02"/>
<polygon fill="black" stroke="black" points="37707.5,-3340.02 37704,-3330.02 37700.5,-3340.02 37707.5,-3340.02"/>
</g>
<!-- R1_Stage2_L5_Expert10&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge244" class="edge">
<title>R1_Stage2_L5_Expert10&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M37883.36,-3439.99C37883.36,-3439.99 37883.36,-3288.08 37883.36,-3288.08"/>
<polygon fill="black" stroke="black" points="37886.86,-3288.08 37883.36,-3278.08 37879.86,-3288.08 37886.86,-3288.08"/>
</g>
<!-- R1_Stage2_L5_Expert11&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge245" class="edge">
<title>R1_Stage2_L5_Expert11&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M38179.5,-3439.78C38179.5,-3398.48 38179.5,-3328 38179.5,-3328 38179.5,-3328 37904.75,-3328 37904.75,-3328"/>
<polygon fill="black" stroke="black" points="37904.75,-3324.5 37894.75,-3328 37904.75,-3331.5 37904.75,-3324.5"/>
</g>
<!-- R1_Stage2_L5_Expert12&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge246" class="edge">
<title>R1_Stage2_L5_Expert12&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M38471,-3439.72C38471,-3397.88 38471,-3326 38471,-3326 38471,-3326 37901.77,-3326 37901.77,-3326"/>
<polygon fill="black" stroke="black" points="37901.77,-3322.5 37891.77,-3326 37901.77,-3329.5 37901.77,-3322.5"/>
</g>
<!-- R1_Stage2_L5_Expert13&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge247" class="edge">
<title>R1_Stage2_L5_Expert13&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M38767,-3439.66C38767,-3397.29 38767,-3324 38767,-3324 38767,-3324 37899.43,-3324 37899.43,-3324"/>
<polygon fill="black" stroke="black" points="37899.43,-3320.5 37889.43,-3324 37899.43,-3327.5 37899.43,-3320.5"/>
</g>
<!-- R1_Stage2_L5_Expert14&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge248" class="edge">
<title>R1_Stage2_L5_Expert14&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M39063,-3439.96C39063,-3397.12 39063,-3322 39063,-3322 39063,-3322 37896.68,-3322 37896.68,-3322"/>
<polygon fill="black" stroke="black" points="37896.68,-3318.5 37886.68,-3322 37896.68,-3325.5 37896.68,-3318.5"/>
</g>
<!-- R1_Stage2_L5_Expert15&#45;&gt;R1_Stage2_L5_MoE_Output -->
<g id="edge249" class="edge">
<title>R1_Stage2_L5_Expert15&#45;&gt;R1_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M39359,-3439.92C39359,-3396.56 39359,-3320 39359,-3320 39359,-3320 37893.97,-3320 37893.97,-3320"/>
<polygon fill="black" stroke="black" points="37893.97,-3316.5 37883.97,-3320 37893.97,-3323.5 37893.97,-3316.5"/>
</g>
<!-- R1_Stage2_L5_MoE_Output&#45;&gt;R1_Stage2_L5_Output -->
<g id="edge250" class="edge">
<title>R1_Stage2_L5_MoE_Output&#45;&gt;R1_Stage2_L5_Output</title>
<path fill="none" stroke="black" d="M37775.87,-3237C38539.1,-3237 41122.75,-3237 41122.75,-3237 41122.75,-3237 41122.75,-3111.66 41122.75,-3111.66"/>
<polygon fill="black" stroke="black" points="41126.25,-3111.66 41122.75,-3101.66 41119.25,-3111.66 41126.25,-3111.66"/>
</g>
<!-- R1_Stage2_L6_Input -->
<g id="node173" class="node">
<title>R1_Stage2_L6_Input</title>
<ellipse fill="lightblue" stroke="black" cx="41837" cy="-4396" rx="225.5" ry="29"/>
<text text-anchor="middle" x="41837" y="-4404.5" font-family="Times,serif" font-size="10.00">Layer 6 Input</text>
<text text-anchor="middle" x="41837" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="41837" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Attn_Input -->
<g id="node174" class="node">
<title>R1_Stage2_L6_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="41837" cy="-4205" rx="225.5" ry="29"/>
<text text-anchor="middle" x="41837" y="-4213.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="41837" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="41837" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Input&#45;&gt;R1_Stage2_L6_Attn_Input -->
<g id="edge251" class="edge">
<title>R1_Stage2_L6_Input&#45;&gt;R1_Stage2_L6_Attn_Input</title>
<path fill="none" stroke="black" d="M41837,-4366.99C41837,-4366.99 41837,-4244.28 41837,-4244.28"/>
<polygon fill="black" stroke="black" points="41840.5,-4244.28 41837,-4234.28 41833.5,-4244.28 41840.5,-4244.28"/>
</g>
<!-- R1_Stage2_L6_Attn_TP1 -->
<g id="node175" class="node">
<title>R1_Stage2_L6_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="42201,-4043 41855,-4043 41855,-3985 42201,-3985 42201,-4043"/>
<text text-anchor="middle" x="42028" y="-4028" font-family="Times,serif" font-size="10.00">Attention TP GPU 16</text>
<text text-anchor="middle" x="42028" y="-4017" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="42028" y="-4006" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="42028" y="-3995" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage2_L6_Attn_Input&#45;&gt;R1_Stage2_L6_Attn_TP1 -->
<g id="edge252" class="edge">
<title>R1_Stage2_L6_Attn_Input&#45;&gt;R1_Stage2_L6_Attn_TP1</title>
<path fill="none" stroke="black" d="M41958.75,-4180.42C41958.75,-4180.42 41958.75,-4053.17 41958.75,-4053.17"/>
<polygon fill="black" stroke="black" points="41962.25,-4053.17 41958.75,-4043.17 41955.25,-4053.17 41962.25,-4053.17"/>
</g>
<!-- R1_Stage2_L6_Attn_TP2 -->
<g id="node176" class="node">
<title>R1_Stage2_L6_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="41819,-4043 41473,-4043 41473,-3985 41819,-3985 41819,-4043"/>
<text text-anchor="middle" x="41646" y="-4028" font-family="Times,serif" font-size="10.00">Attention TP GPU 17</text>
<text text-anchor="middle" x="41646" y="-4017" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="41646" y="-4006" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="41646" y="-3995" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage2_L6_Attn_Input&#45;&gt;R1_Stage2_L6_Attn_TP2 -->
<g id="edge253" class="edge">
<title>R1_Stage2_L6_Attn_Input&#45;&gt;R1_Stage2_L6_Attn_TP2</title>
<path fill="none" stroke="black" d="M41715.25,-4180.42C41715.25,-4180.42 41715.25,-4053.17 41715.25,-4053.17"/>
<polygon fill="black" stroke="black" points="41718.75,-4053.17 41715.25,-4043.17 41711.75,-4053.17 41718.75,-4053.17"/>
</g>
<!-- R1_Stage2_L6_Attn_Output -->
<g id="node177" class="node">
<title>R1_Stage2_L6_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="41744" cy="-3837" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="41744" y="-3851" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="41744" y="-3840" font-family="Times,serif" font-size="10.00">AllReduce GPUs 16&#45;17</text>
<text text-anchor="middle" x="41744" y="-3829" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="41744" y="-3818" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Attn_TP1&#45;&gt;R1_Stage2_L6_Attn_Output -->
<g id="edge254" class="edge">
<title>R1_Stage2_L6_Attn_TP1&#45;&gt;R1_Stage2_L6_Attn_Output</title>
<path fill="none" stroke="black" d="M41921.12,-3984.77C41921.12,-3984.77 41921.12,-3872.25 41921.12,-3872.25"/>
<polygon fill="black" stroke="black" points="41924.62,-3872.25 41921.12,-3862.25 41917.62,-3872.25 41924.62,-3872.25"/>
</g>
<!-- R1_Stage2_L6_Attn_TP2&#45;&gt;R1_Stage2_L6_Attn_Output -->
<g id="edge255" class="edge">
<title>R1_Stage2_L6_Attn_TP2&#45;&gt;R1_Stage2_L6_Attn_Output</title>
<path fill="none" stroke="black" d="M41659.88,-3984.77C41659.88,-3984.77 41659.88,-3881.75 41659.88,-3881.75"/>
<polygon fill="black" stroke="black" points="41663.38,-3881.75 41659.88,-3871.75 41656.38,-3881.75 41663.38,-3881.75"/>
</g>
<!-- R1_Stage2_L6_MoE_Input -->
<g id="node178" class="node">
<title>R1_Stage2_L6_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="41744" cy="-3660" rx="225.5" ry="29"/>
<text text-anchor="middle" x="41744" y="-3668.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="41744" y="-3657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="41744" y="-3646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Attn_Output&#45;&gt;R1_Stage2_L6_MoE_Input -->
<g id="edge256" class="edge">
<title>R1_Stage2_L6_Attn_Output&#45;&gt;R1_Stage2_L6_MoE_Input</title>
<path fill="none" stroke="black" d="M41744,-3799.89C41744,-3799.89 41744,-3699.17 41744,-3699.17"/>
<polygon fill="black" stroke="black" points="41747.5,-3699.17 41744,-3689.17 41740.5,-3699.17 41747.5,-3699.17"/>
</g>
<!-- R1_Stage2_L6_Router -->
<g id="node179" class="node">
<title>R1_Stage2_L6_Router</title>
<polygon fill="lightyellow" stroke="black" points="42066.36,-3521 41553.56,-3521 41421.64,-3417 41934.44,-3417 42066.36,-3521"/>
<text text-anchor="middle" x="41744" y="-3483" font-family="Times,serif" font-size="10.00">Router GPU 16</text>
<text text-anchor="middle" x="41744" y="-3472" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="41744" y="-3461" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="41744" y="-3450" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage2_L6_MoE_Input&#45;&gt;R1_Stage2_L6_Router -->
<g id="edge257" class="edge">
<title>R1_Stage2_L6_MoE_Input&#45;&gt;R1_Stage2_L6_Router</title>
<path fill="none" stroke="black" d="M41744,-3630.99C41744,-3630.99 41744,-3531.02 41744,-3531.02"/>
<polygon fill="black" stroke="black" points="41747.5,-3531.02 41744,-3521.02 41740.5,-3531.02 41747.5,-3531.02"/>
</g>
<!-- R1_Stage2_L6_Expert0 -->
<g id="node180" class="node">
<title>R1_Stage2_L6_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="40857,-3307 40597,-3307 40597,-3249 40857,-3249 40857,-3307"/>
<text text-anchor="middle" x="40727" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 16</text>
<text text-anchor="middle" x="40727" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40727" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert0 -->
<g id="edge258" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41426.53,-3421C41168.83,-3421 40848,-3421 40848,-3421 40848,-3421 40848,-3317.28 40848,-3317.28"/>
<polygon fill="black" stroke="black" points="40851.5,-3317.28 40848,-3307.28 40844.5,-3317.28 40851.5,-3317.28"/>
<text text-anchor="middle" x="40936.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert1 -->
<g id="node181" class="node">
<title>R1_Stage2_L6_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="41153,-3307 40893,-3307 40893,-3249 41153,-3249 41153,-3307"/>
<text text-anchor="middle" x="41023" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 17</text>
<text text-anchor="middle" x="41023" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="41023" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert1 -->
<g id="edge259" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41423.8,-3419C41280.83,-3419 41144,-3419 41144,-3419 41144,-3419 41144,-3317.22 41144,-3317.22"/>
<polygon fill="black" stroke="black" points="41147.5,-3317.22 41144,-3307.22 41140.5,-3317.22 41147.5,-3317.22"/>
<text text-anchor="middle" x="41208.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert2 -->
<g id="node182" class="node">
<title>R1_Stage2_L6_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="41449,-3307 41189,-3307 41189,-3249 41449,-3249 41449,-3307"/>
<text text-anchor="middle" x="41319" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 18</text>
<text text-anchor="middle" x="41319" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="41319" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert2 -->
<g id="edge260" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41435.28,-3468.86C41435.28,-3468.86 41435.28,-3317.01 41435.28,-3317.01"/>
<polygon fill="black" stroke="black" points="41438.78,-3317.01 41435.28,-3307.01 41431.78,-3317.01 41438.78,-3317.01"/>
<text text-anchor="middle" x="41457.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert3 -->
<g id="node183" class="node">
<title>R1_Stage2_L6_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="41745,-3307 41485,-3307 41485,-3249 41745,-3249 41745,-3307"/>
<text text-anchor="middle" x="41615" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 19</text>
<text text-anchor="middle" x="41615" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="41615" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert3 -->
<g id="edge261" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41615,-3416.81C41615,-3416.81 41615,-3317.01 41615,-3317.01"/>
<polygon fill="black" stroke="black" points="41618.5,-3317.01 41615,-3307.01 41611.5,-3317.01 41618.5,-3317.01"/>
<text text-anchor="middle" x="41658.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert4 -->
<g id="node184" class="node">
<title>R1_Stage2_L6_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="42041,-3307 41781,-3307 41781,-3249 42041,-3249 42041,-3307"/>
<text text-anchor="middle" x="41911" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 20</text>
<text text-anchor="middle" x="41911" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="41911" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert4 -->
<g id="edge262" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41911,-3416.81C41911,-3416.81 41911,-3317.01 41911,-3317.01"/>
<polygon fill="black" stroke="black" points="41914.5,-3317.01 41911,-3307.01 41907.5,-3317.01 41914.5,-3317.01"/>
<text text-anchor="middle" x="41848.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert5 -->
<g id="node185" class="node">
<title>R1_Stage2_L6_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="42337,-3307 42077,-3307 42077,-3249 42337,-3249 42337,-3307"/>
<text text-anchor="middle" x="42207" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 21</text>
<text text-anchor="middle" x="42207" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="42207" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert5 -->
<g id="edge263" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M42053.72,-3468.86C42053.72,-3463.08 42053.72,-3278 42053.72,-3278 42053.72,-3278 42067,-3278 42067,-3278"/>
<polygon fill="black" stroke="black" points="42067,-3281.5 42077,-3278 42067,-3274.5 42067,-3281.5"/>
<text text-anchor="middle" x="42121.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert6 -->
<g id="node186" class="node">
<title>R1_Stage2_L6_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="42633,-3307 42373,-3307 42373,-3249 42633,-3249 42633,-3307"/>
<text text-anchor="middle" x="42503" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 22</text>
<text text-anchor="middle" x="42503" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="42503" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert6 -->
<g id="edge264" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41948.4,-3428C42173.2,-3428 42503,-3428 42503,-3428 42503,-3428 42503,-3317.28 42503,-3317.28"/>
<polygon fill="black" stroke="black" points="42506.5,-3317.28 42503,-3307.28 42499.5,-3317.28 42506.5,-3317.28"/>
<text text-anchor="middle" x="42406.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert7 -->
<g id="node187" class="node">
<title>R1_Stage2_L6_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="38193,-3307 37933,-3307 37933,-3249 38193,-3249 38193,-3307"/>
<text text-anchor="middle" x="38063" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 23</text>
<text text-anchor="middle" x="38063" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38063" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert7 -->
<g id="edge265" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41528.16,-3501C40751.93,-3501 38148,-3501 38148,-3501 38148,-3501 38148,-3317.15 38148,-3317.15"/>
<polygon fill="black" stroke="black" points="38151.5,-3317.15 38148,-3307.15 38144.5,-3317.15 38151.5,-3317.15"/>
<text text-anchor="middle" x="38295.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert8 -->
<g id="node188" class="node">
<title>R1_Stage2_L6_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="38489,-3307 38229,-3307 38229,-3249 38489,-3249 38489,-3307"/>
<text text-anchor="middle" x="38359" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 24</text>
<text text-anchor="middle" x="38359" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38359" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert8 -->
<g id="edge266" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41448.22,-3438C40644.47,-3438 38480,-3438 38480,-3438 38480,-3438 38480,-3317.35 38480,-3317.35"/>
<polygon fill="black" stroke="black" points="38483.5,-3317.35 38480,-3307.35 38476.5,-3317.35 38483.5,-3317.35"/>
<text text-anchor="middle" x="38591.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert9 -->
<g id="node189" class="node">
<title>R1_Stage2_L6_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="38785,-3307 38525,-3307 38525,-3249 38785,-3249 38785,-3307"/>
<text text-anchor="middle" x="38655" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 25</text>
<text text-anchor="middle" x="38655" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38655" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert9 -->
<g id="edge267" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41445.48,-3436C40692.6,-3436 38776,-3436 38776,-3436 38776,-3436 38776,-3317.35 38776,-3317.35"/>
<polygon fill="black" stroke="black" points="38779.5,-3317.35 38776,-3307.35 38772.5,-3317.35 38779.5,-3317.35"/>
<text text-anchor="middle" x="38886.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert10 -->
<g id="node190" class="node">
<title>R1_Stage2_L6_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="39081,-3307 38821,-3307 38821,-3249 39081,-3249 39081,-3307"/>
<text text-anchor="middle" x="38951" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 26</text>
<text text-anchor="middle" x="38951" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38951" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert10 -->
<g id="edge268" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41443.01,-3434C40744.4,-3434 39072,-3434 39072,-3434 39072,-3434 39072,-3317.34 39072,-3317.34"/>
<polygon fill="black" stroke="black" points="39075.5,-3317.34 39072,-3307.34 39068.5,-3317.34 39075.5,-3317.34"/>
<text text-anchor="middle" x="39180.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert11 -->
<g id="node191" class="node">
<title>R1_Stage2_L6_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="39377,-3307 39117,-3307 39117,-3249 39377,-3249 39377,-3307"/>
<text text-anchor="middle" x="39247" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 27</text>
<text text-anchor="middle" x="39247" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39247" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert11 -->
<g id="edge269" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41439.15,-3431C40797.87,-3431 39368,-3431 39368,-3431 39368,-3431 39368,-3317.14 39368,-3317.14"/>
<polygon fill="black" stroke="black" points="39371.5,-3317.14 39368,-3307.14 39364.5,-3317.14 39371.5,-3317.14"/>
<text text-anchor="middle" x="39473.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert12 -->
<g id="node192" class="node">
<title>R1_Stage2_L6_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="39673,-3307 39413,-3307 39413,-3249 39673,-3249 39673,-3307"/>
<text text-anchor="middle" x="39543" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 28</text>
<text text-anchor="middle" x="39543" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39543" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert12 -->
<g id="edge270" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41436.81,-3429C40858.12,-3429 39664,-3429 39664,-3429 39664,-3429 39664,-3317.11 39664,-3317.11"/>
<polygon fill="black" stroke="black" points="39667.5,-3317.11 39664,-3307.11 39660.5,-3317.11 39667.5,-3317.11"/>
<text text-anchor="middle" x="39762.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert13 -->
<g id="node193" class="node">
<title>R1_Stage2_L6_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="39969,-3307 39709,-3307 39709,-3249 39969,-3249 39969,-3307"/>
<text text-anchor="middle" x="39839" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 29</text>
<text text-anchor="middle" x="39839" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39839" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert13 -->
<g id="edge271" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41434.27,-3427C40923.4,-3427 39960,-3427 39960,-3427 39960,-3427 39960,-3317.08 39960,-3317.08"/>
<polygon fill="black" stroke="black" points="39963.5,-3317.08 39960,-3307.08 39956.5,-3317.08 39963.5,-3317.08"/>
<text text-anchor="middle" x="40045.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert14 -->
<g id="node194" class="node">
<title>R1_Stage2_L6_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="40265,-3307 40005,-3307 40005,-3249 40265,-3249 40265,-3307"/>
<text text-anchor="middle" x="40135" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 30</text>
<text text-anchor="middle" x="40135" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40135" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert14 -->
<g id="edge272" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41431.61,-3425C40995.22,-3425 40256,-3425 40256,-3425 40256,-3425 40256,-3317.04 40256,-3317.04"/>
<polygon fill="black" stroke="black" points="40259.5,-3317.04 40256,-3307.04 40252.5,-3317.04 40259.5,-3317.04"/>
<text text-anchor="middle" x="40315.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_Expert15 -->
<g id="node195" class="node">
<title>R1_Stage2_L6_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="40561,-3307 40301,-3307 40301,-3249 40561,-3249 40561,-3307"/>
<text text-anchor="middle" x="40431" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 31</text>
<text text-anchor="middle" x="40431" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40431" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert15 -->
<g id="edge273" class="edge">
<title>R1_Stage2_L6_Router&#45;&gt;R1_Stage2_L6_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M41428.87,-3423C41075.72,-3423 40552,-3423 40552,-3423 40552,-3423 40552,-3317.34 40552,-3317.34"/>
<polygon fill="black" stroke="black" points="40555.5,-3317.34 40552,-3307.34 40548.5,-3317.34 40555.5,-3317.34"/>
<text text-anchor="middle" x="40558.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L6_MoE_Output -->
<g id="node196" class="node">
<title>R1_Stage2_L6_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="42240.95,-3139 41714.48,-3139 41579.05,-3035 42105.52,-3035 42240.95,-3139"/>
<text text-anchor="middle" x="41910" y="-3101" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="41910" y="-3090" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="41910" y="-3079" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="41910" y="-3068" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L6_Expert0&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge274" class="edge">
<title>R1_Stage2_L6_Expert0&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M40836.67,-3248.86C40836.67,-3206.78 40836.67,-3134 40836.67,-3134 40836.67,-3134 41697.8,-3134 41697.8,-3134"/>
<polygon fill="black" stroke="black" points="41697.8,-3137.5 41707.8,-3134 41697.8,-3130.5 41697.8,-3137.5"/>
</g>
<!-- R1_Stage2_L6_Expert1&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge275" class="edge">
<title>R1_Stage2_L6_Expert1&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M41137.87,-3248.72C41137.87,-3206.88 41137.87,-3135 41137.87,-3135 41137.87,-3135 41699.15,-3135 41699.15,-3135"/>
<polygon fill="black" stroke="black" points="41699.15,-3138.5 41709.15,-3135 41699.15,-3131.5 41699.15,-3138.5"/>
</g>
<!-- R1_Stage2_L6_Expert2&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge276" class="edge">
<title>R1_Stage2_L6_Expert2&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M41319,-3248.78C41319,-3207.48 41319,-3137 41319,-3137 41319,-3137 41701.56,-3137 41701.56,-3137"/>
<polygon fill="black" stroke="black" points="41701.56,-3140.5 41711.56,-3137 41701.56,-3133.5 41701.56,-3140.5"/>
</g>
<!-- R1_Stage2_L6_Expert3&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge277" class="edge">
<title>R1_Stage2_L6_Expert3&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M41662.14,-3248.99C41662.14,-3248.99 41662.14,-3109.07 41662.14,-3109.07"/>
<polygon fill="black" stroke="black" points="41665.64,-3109.07 41662.14,-3099.07 41658.64,-3109.07 41665.64,-3109.07"/>
</g>
<!-- R1_Stage2_L6_Expert4&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge278" class="edge">
<title>R1_Stage2_L6_Expert4&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M41911,-3248.99C41911,-3248.99 41911,-3149.02 41911,-3149.02"/>
<polygon fill="black" stroke="black" points="41914.5,-3149.02 41911,-3139.02 41907.5,-3149.02 41914.5,-3149.02"/>
</g>
<!-- R1_Stage2_L6_Expert5&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge279" class="edge">
<title>R1_Stage2_L6_Expert5&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M42158.86,-3248.99C42158.86,-3248.99 42158.86,-3149.02 42158.86,-3149.02"/>
<polygon fill="black" stroke="black" points="42162.36,-3149.02 42158.86,-3139.02 42155.36,-3149.02 42162.36,-3149.02"/>
</g>
<!-- R1_Stage2_L6_Expert6&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge280" class="edge">
<title>R1_Stage2_L6_Expert6&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M42503,-3248.89C42503,-3205.01 42503,-3127 42503,-3127 42503,-3127 42235.6,-3127 42235.6,-3127"/>
<polygon fill="black" stroke="black" points="42235.6,-3123.5 42225.6,-3127 42235.6,-3130.5 42235.6,-3123.5"/>
</g>
<!-- R1_Stage2_L6_Expert7&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge281" class="edge">
<title>R1_Stage2_L6_Expert7&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M38172.67,-3248.65C38172.67,-3202.96 38172.67,-3120 38172.67,-3120 38172.67,-3120 41679.48,-3120 41679.48,-3120"/>
<polygon fill="black" stroke="black" points="41679.48,-3123.5 41689.48,-3120 41679.48,-3116.5 41679.48,-3123.5"/>
</g>
<!-- R1_Stage2_L6_Expert8&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge282" class="edge">
<title>R1_Stage2_L6_Expert8&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M38468.67,-3248.66C38468.67,-3203.47 38468.67,-3122 38468.67,-3122 38468.67,-3122 41682.12,-3122 41682.12,-3122"/>
<polygon fill="black" stroke="black" points="41682.12,-3125.5 41692.12,-3122 41682.12,-3118.5 41682.12,-3125.5"/>
</g>
<!-- R1_Stage2_L6_Expert9&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge283" class="edge">
<title>R1_Stage2_L6_Expert9&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M38764.67,-3248.85C38764.67,-3203.95 38764.67,-3123 38764.67,-3123 38764.67,-3123 41683.5,-3123 41683.5,-3123"/>
<polygon fill="black" stroke="black" points="41683.5,-3126.5 41693.5,-3123 41683.5,-3119.5 41683.5,-3126.5"/>
</g>
<!-- R1_Stage2_L6_Expert10&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge284" class="edge">
<title>R1_Stage2_L6_Expert10&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M39060.67,-3248.86C39060.67,-3204.47 39060.67,-3125 39060.67,-3125 39060.67,-3125 41686.13,-3125 41686.13,-3125"/>
<polygon fill="black" stroke="black" points="41686.13,-3128.5 41696.13,-3125 41686.13,-3121.5 41686.13,-3128.5"/>
</g>
<!-- R1_Stage2_L6_Expert11&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge285" class="edge">
<title>R1_Stage2_L6_Expert11&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M39356.67,-3248.69C39356.67,-3204.52 39356.67,-3126 39356.67,-3126 39356.67,-3126 41687.52,-3126 41687.52,-3126"/>
<polygon fill="black" stroke="black" points="41687.52,-3129.5 41697.52,-3126 41687.52,-3122.5 41687.52,-3129.5"/>
</g>
<!-- R1_Stage2_L6_Expert12&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge286" class="edge">
<title>R1_Stage2_L6_Expert12&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M39652.67,-3248.72C39652.67,-3205.07 39652.67,-3128 39652.67,-3128 39652.67,-3128 41689.92,-3128 41689.92,-3128"/>
<polygon fill="black" stroke="black" points="41689.92,-3131.5 41699.92,-3128 41689.92,-3124.5 41689.92,-3131.5"/>
</g>
<!-- R1_Stage2_L6_Expert13&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge287" class="edge">
<title>R1_Stage2_L6_Expert13&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M39948.67,-3248.92C39948.67,-3205.56 39948.67,-3129 39948.67,-3129 39948.67,-3129 41691.03,-3129 41691.03,-3129"/>
<polygon fill="black" stroke="black" points="41691.03,-3132.5 41701.03,-3129 41691.03,-3125.5 41691.03,-3132.5"/>
</g>
<!-- R1_Stage2_L6_Expert14&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge288" class="edge">
<title>R1_Stage2_L6_Expert14&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M40244.67,-3248.96C40244.67,-3206.12 40244.67,-3131 40244.67,-3131 40244.67,-3131 41693.71,-3131 41693.71,-3131"/>
<polygon fill="black" stroke="black" points="41693.71,-3134.5 41703.71,-3131 41693.71,-3127.5 41693.71,-3134.5"/>
</g>
<!-- R1_Stage2_L6_Expert15&#45;&gt;R1_Stage2_L6_MoE_Output -->
<g id="edge289" class="edge">
<title>R1_Stage2_L6_Expert15&#45;&gt;R1_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M40540.67,-3248.81C40540.67,-3206.2 40540.67,-3132 40540.67,-3132 40540.67,-3132 41695.37,-3132 41695.37,-3132"/>
<polygon fill="black" stroke="black" points="41695.37,-3135.5 41705.37,-3132 41695.37,-3128.5 41695.37,-3135.5"/>
</g>
<!-- R1_Stage2_L6_MoE_Output&#45;&gt;R1_Stage2_L6_Output -->
<g id="edge290" class="edge">
<title>R1_Stage2_L6_MoE_Output&#45;&gt;R1_Stage2_L6_Output</title>
<path fill="none" stroke="black" d="M41580.09,-3036C41562.58,-3036 41552,-3036 41552,-3036 41552,-3036 41552,-2913.93 41552,-2913.93"/>
<polygon fill="black" stroke="black" points="41555.5,-2913.93 41552,-2903.93 41548.5,-2913.93 41555.5,-2913.93"/>
</g>
<!-- R1_Stage2_L7_Input -->
<g id="node197" class="node">
<title>R1_Stage2_L7_Input</title>
<ellipse fill="lightblue" stroke="black" cx="36760" cy="-4205" rx="225.5" ry="29"/>
<text text-anchor="middle" x="36760" y="-4213.5" font-family="Times,serif" font-size="10.00">Layer 7 Input</text>
<text text-anchor="middle" x="36760" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="36760" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Attn_Input -->
<g id="node198" class="node">
<title>R1_Stage2_L7_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="36760" cy="-4014" rx="225.5" ry="29"/>
<text text-anchor="middle" x="36760" y="-4022.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="36760" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="36760" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Input&#45;&gt;R1_Stage2_L7_Attn_Input -->
<g id="edge291" class="edge">
<title>R1_Stage2_L7_Input&#45;&gt;R1_Stage2_L7_Attn_Input</title>
<path fill="none" stroke="black" d="M36760,-4175.99C36760,-4175.99 36760,-4053.28 36760,-4053.28"/>
<polygon fill="black" stroke="black" points="36763.5,-4053.28 36760,-4043.28 36756.5,-4053.28 36763.5,-4053.28"/>
</g>
<!-- R1_Stage2_L7_Attn_TP1 -->
<g id="node199" class="node">
<title>R1_Stage2_L7_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="36742,-3866 36396,-3866 36396,-3808 36742,-3808 36742,-3866"/>
<text text-anchor="middle" x="36569" y="-3851" font-family="Times,serif" font-size="10.00">Attention TP GPU 16</text>
<text text-anchor="middle" x="36569" y="-3840" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="36569" y="-3829" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="36569" y="-3818" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage2_L7_Attn_Input&#45;&gt;R1_Stage2_L7_Attn_TP1 -->
<g id="edge292" class="edge">
<title>R1_Stage2_L7_Attn_Input&#45;&gt;R1_Stage2_L7_Attn_TP1</title>
<path fill="none" stroke="black" d="M36638.25,-3989.39C36638.25,-3989.39 36638.25,-3876.1 36638.25,-3876.1"/>
<polygon fill="black" stroke="black" points="36641.75,-3876.1 36638.25,-3866.1 36634.75,-3876.1 36641.75,-3876.1"/>
</g>
<!-- R1_Stage2_L7_Attn_TP2 -->
<g id="node200" class="node">
<title>R1_Stage2_L7_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="37124,-3866 36778,-3866 36778,-3808 37124,-3808 37124,-3866"/>
<text text-anchor="middle" x="36951" y="-3851" font-family="Times,serif" font-size="10.00">Attention TP GPU 17</text>
<text text-anchor="middle" x="36951" y="-3840" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="36951" y="-3829" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="36951" y="-3818" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage2_L7_Attn_Input&#45;&gt;R1_Stage2_L7_Attn_TP2 -->
<g id="edge293" class="edge">
<title>R1_Stage2_L7_Attn_Input&#45;&gt;R1_Stage2_L7_Attn_TP2</title>
<path fill="none" stroke="black" d="M36881.75,-3989.39C36881.75,-3989.39 36881.75,-3876.1 36881.75,-3876.1"/>
<polygon fill="black" stroke="black" points="36885.25,-3876.1 36881.75,-3866.1 36878.25,-3876.1 36885.25,-3876.1"/>
</g>
<!-- R1_Stage2_L7_Attn_Output -->
<g id="node201" class="node">
<title>R1_Stage2_L7_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="36683" cy="-3660" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="36683" y="-3674" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="36683" y="-3663" font-family="Times,serif" font-size="10.00">AllReduce GPUs 16&#45;17</text>
<text text-anchor="middle" x="36683" y="-3652" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="36683" y="-3641" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Attn_TP1&#45;&gt;R1_Stage2_L7_Attn_Output -->
<g id="edge294" class="edge">
<title>R1_Stage2_L7_Attn_TP1&#45;&gt;R1_Stage2_L7_Attn_Output</title>
<path fill="none" stroke="black" d="M36590.88,-3807.77C36590.88,-3807.77 36590.88,-3704.12 36590.88,-3704.12"/>
<polygon fill="black" stroke="black" points="36594.38,-3704.12 36590.88,-3694.12 36587.38,-3704.12 36594.38,-3704.12"/>
</g>
<!-- R1_Stage2_L7_Attn_TP2&#45;&gt;R1_Stage2_L7_Attn_Output -->
<g id="edge295" class="edge">
<title>R1_Stage2_L7_Attn_TP2&#45;&gt;R1_Stage2_L7_Attn_Output</title>
<path fill="none" stroke="black" d="M36852.12,-3807.77C36852.12,-3807.77 36852.12,-3696.66 36852.12,-3696.66"/>
<polygon fill="black" stroke="black" points="36855.62,-3696.66 36852.12,-3686.66 36848.62,-3696.66 36855.62,-3696.66"/>
</g>
<!-- R1_Stage2_L7_MoE_Input -->
<g id="node202" class="node">
<title>R1_Stage2_L7_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="36424" cy="-3469" rx="225.5" ry="29"/>
<text text-anchor="middle" x="36424" y="-3477.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="36424" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="36424" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Attn_Output&#45;&gt;R1_Stage2_L7_MoE_Input -->
<g id="edge296" class="edge">
<title>R1_Stage2_L7_Attn_Output&#45;&gt;R1_Stage2_L7_MoE_Input</title>
<path fill="none" stroke="black" d="M36544.63,-3629.74C36544.63,-3629.74 36544.63,-3503.66 36544.63,-3503.66"/>
<polygon fill="black" stroke="black" points="36548.13,-3503.66 36544.63,-3493.66 36541.13,-3503.66 36548.13,-3503.66"/>
</g>
<!-- R1_Stage2_L7_Router -->
<g id="node203" class="node">
<title>R1_Stage2_L7_Router</title>
<polygon fill="lightyellow" stroke="black" points="36808.36,-3330 36295.56,-3330 36163.64,-3226 36676.44,-3226 36808.36,-3330"/>
<text text-anchor="middle" x="36486" y="-3292" font-family="Times,serif" font-size="10.00">Router GPU 16</text>
<text text-anchor="middle" x="36486" y="-3281" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="36486" y="-3270" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="36486" y="-3259" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage2_L7_MoE_Input&#45;&gt;R1_Stage2_L7_Router -->
<g id="edge297" class="edge">
<title>R1_Stage2_L7_MoE_Input&#45;&gt;R1_Stage2_L7_Router</title>
<path fill="none" stroke="black" d="M36424,-3439.99C36424,-3439.99 36424,-3340.02 36424,-3340.02"/>
<polygon fill="black" stroke="black" points="36427.5,-3340.02 36424,-3330.02 36420.5,-3340.02 36427.5,-3340.02"/>
</g>
<!-- R1_Stage2_L7_Expert0 -->
<g id="node204" class="node">
<title>R1_Stage2_L7_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="40760,-3116 40500,-3116 40500,-3058 40760,-3058 40760,-3116"/>
<text text-anchor="middle" x="40630" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 16</text>
<text text-anchor="middle" x="40630" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40630" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert0 -->
<g id="edge298" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36774.91,-3277.95C36774.91,-3275.8 36774.91,-3207 36774.91,-3207 36774.91,-3207 40520.33,-3207 40520.33,-3207 40520.33,-3207 40520.33,-3126.05 40520.33,-3126.05"/>
<polygon fill="black" stroke="black" points="40523.83,-3126.05 40520.33,-3116.05 40516.83,-3126.05 40523.83,-3126.05"/>
<text text-anchor="middle" x="38080.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert1 -->
<g id="node205" class="node">
<title>R1_Stage2_L7_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="41056,-3116 40796,-3116 40796,-3058 41056,-3058 41056,-3116"/>
<text text-anchor="middle" x="40926" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 17</text>
<text text-anchor="middle" x="40926" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40926" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert1 -->
<g id="edge299" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36786.08,-3277.95C36786.08,-3275.98 36786.08,-3213 36786.08,-3213 36786.08,-3213 40816.33,-3213 40816.33,-3213 40816.33,-3213 40816.33,-3126.22 40816.33,-3126.22"/>
<polygon fill="black" stroke="black" points="40819.83,-3126.22 40816.33,-3116.22 40812.83,-3126.22 40819.83,-3126.22"/>
<text text-anchor="middle" x="38164.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert2 -->
<g id="node206" class="node">
<title>R1_Stage2_L7_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="36616,-3116 36356,-3116 36356,-3058 36616,-3058 36616,-3116"/>
<text text-anchor="middle" x="36486" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 18</text>
<text text-anchor="middle" x="36486" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="36486" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert2 -->
<g id="edge300" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36486,-3225.81C36486,-3225.81 36486,-3126.01 36486,-3126.01"/>
<polygon fill="black" stroke="black" points="36489.5,-3126.01 36486,-3116.01 36482.5,-3126.01 36489.5,-3126.01"/>
<text text-anchor="middle" x="36507.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert3 -->
<g id="node207" class="node">
<title>R1_Stage2_L7_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="37208,-3116 36948,-3116 36948,-3058 37208,-3058 37208,-3116"/>
<text text-anchor="middle" x="37078" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 19</text>
<text text-anchor="middle" x="37078" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="37078" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert3 -->
<g id="edge301" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36685.37,-3233C36841.29,-3233 37031.81,-3233 37031.81,-3233 37031.81,-3233 37031.81,-3126.19 37031.81,-3126.19"/>
<polygon fill="black" stroke="black" points="37035.31,-3126.19 37031.81,-3116.19 37028.31,-3126.19 37035.31,-3126.19"/>
<text text-anchor="middle" x="36855.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert4 -->
<g id="node208" class="node">
<title>R1_Stage2_L7_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="37504,-3116 37244,-3116 37244,-3058 37504,-3058 37504,-3116"/>
<text text-anchor="middle" x="37374" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 20</text>
<text text-anchor="middle" x="37374" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="37374" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert4 -->
<g id="edge302" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36695.5,-3241C36911.54,-3241 37217.09,-3241 37217.09,-3241 37217.09,-3241 37217.09,-3087 37217.09,-3087 37217.09,-3087 37233.71,-3087 37233.71,-3087"/>
<polygon fill="black" stroke="black" points="37233.71,-3090.5 37243.71,-3087 37233.71,-3083.5 37233.71,-3090.5"/>
<text text-anchor="middle" x="36976.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert5 -->
<g id="node209" class="node">
<title>R1_Stage2_L7_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="37800,-3116 37540,-3116 37540,-3058 37800,-3058 37800,-3116"/>
<text text-anchor="middle" x="37670" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 21</text>
<text text-anchor="middle" x="37670" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="37670" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert5 -->
<g id="edge303" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36663.17,-3225.82C36663.17,-3188.56 36663.17,-3145 36663.17,-3145 36663.17,-3145 37670,-3145 37670,-3145 37670,-3145 37670,-3126 37670,-3126"/>
<polygon fill="black" stroke="black" points="37673.5,-3126 37670,-3116 37666.5,-3126 37673.5,-3126"/>
<text text-anchor="middle" x="37078.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert6 -->
<g id="node210" class="node">
<title>R1_Stage2_L7_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="38096,-3116 37836,-3116 37836,-3058 38096,-3058 38096,-3116"/>
<text text-anchor="middle" x="37966" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 22</text>
<text text-anchor="middle" x="37966" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="37966" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert6 -->
<g id="edge304" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36674.35,-3225.98C36674.35,-3190.91 36674.35,-3151 36674.35,-3151 36674.35,-3151 37866.36,-3151 37866.36,-3151 37866.36,-3151 37866.36,-3126 37866.36,-3126"/>
<polygon fill="black" stroke="black" points="37869.86,-3126 37866.36,-3116 37862.86,-3126 37869.86,-3126"/>
<text text-anchor="middle" x="37171.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert7 -->
<g id="node211" class="node">
<title>R1_Stage2_L7_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="38392,-3116 38132,-3116 38132,-3058 38392,-3058 38392,-3116"/>
<text text-anchor="middle" x="38262" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 23</text>
<text text-anchor="middle" x="38262" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38262" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert7 -->
<g id="edge305" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36685.52,-3232.94C36685.52,-3198.54 36685.52,-3157 36685.52,-3157 36685.52,-3157 38152.33,-3157 38152.33,-3157 38152.33,-3157 38152.33,-3126.28 38152.33,-3126.28"/>
<polygon fill="black" stroke="black" points="38155.83,-3126.28 38152.33,-3116.28 38148.83,-3126.28 38155.83,-3126.28"/>
<text text-anchor="middle" x="37260.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert8 -->
<g id="node212" class="node">
<title>R1_Stage2_L7_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="40168,-3116 39908,-3116 39908,-3058 40168,-3058 40168,-3116"/>
<text text-anchor="middle" x="40038" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 24</text>
<text text-anchor="middle" x="40038" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40038" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert8 -->
<g id="edge306" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36752.56,-3277.94C36752.56,-3275.4 36752.56,-3194 36752.56,-3194 36752.56,-3194 39928.33,-3194 39928.33,-3194 39928.33,-3194 39928.33,-3126.24 39928.33,-3126.24"/>
<polygon fill="black" stroke="black" points="39931.83,-3126.24 39928.33,-3116.24 39924.83,-3126.24 39931.83,-3126.24"/>
<text text-anchor="middle" x="37912.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert9 -->
<g id="node213" class="node">
<title>R1_Stage2_L7_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="38688,-3116 38428,-3116 38428,-3058 38688,-3058 38688,-3116"/>
<text text-anchor="middle" x="38558" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 25</text>
<text text-anchor="middle" x="38558" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38558" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert9 -->
<g id="edge307" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36696.69,-3241.93C36696.69,-3208.2 36696.69,-3163 36696.69,-3163 36696.69,-3163 38448.33,-3163 38448.33,-3163 38448.33,-3163 38448.33,-3126.17 38448.33,-3126.17"/>
<polygon fill="black" stroke="black" points="38451.83,-3126.17 38448.33,-3116.17 38444.83,-3126.17 38451.83,-3126.17"/>
<text text-anchor="middle" x="37346.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert10 -->
<g id="node214" class="node">
<title>R1_Stage2_L7_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="38984,-3116 38724,-3116 38724,-3058 38984,-3058 38984,-3116"/>
<text text-anchor="middle" x="38854" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 26</text>
<text text-anchor="middle" x="38854" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38854" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert10 -->
<g id="edge308" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36707.87,-3250.75C36707.87,-3218.75 36707.87,-3170 36707.87,-3170 36707.87,-3170 38744.33,-3170 38744.33,-3170 38744.33,-3170 38744.33,-3126.03 38744.33,-3126.03"/>
<polygon fill="black" stroke="black" points="38747.83,-3126.03 38744.33,-3116.03 38740.83,-3126.03 38747.83,-3126.03"/>
<text text-anchor="middle" x="37431.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert11 -->
<g id="node215" class="node">
<title>R1_Stage2_L7_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="39280,-3116 39020,-3116 39020,-3058 39280,-3058 39280,-3116"/>
<text text-anchor="middle" x="39150" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 27</text>
<text text-anchor="middle" x="39150" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39150" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert11 -->
<g id="edge309" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36719.04,-3259.29C36719.04,-3229.85 36719.04,-3176 36719.04,-3176 36719.04,-3176 39040.33,-3176 39040.33,-3176 39040.33,-3176 39040.33,-3126.14 39040.33,-3126.14"/>
<polygon fill="black" stroke="black" points="39043.83,-3126.14 39040.33,-3116.14 39036.83,-3126.14 39043.83,-3126.14"/>
<text text-anchor="middle" x="37516.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert12 -->
<g id="node216" class="node">
<title>R1_Stage2_L7_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="39576,-3116 39316,-3116 39316,-3058 39576,-3058 39576,-3116"/>
<text text-anchor="middle" x="39446" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 28</text>
<text text-anchor="middle" x="39446" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39446" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert12 -->
<g id="edge310" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36730.22,-3268.09C36730.22,-3243.56 36730.22,-3182 36730.22,-3182 36730.22,-3182 39336.33,-3182 39336.33,-3182 39336.33,-3182 39336.33,-3126.02 39336.33,-3126.02"/>
<polygon fill="black" stroke="black" points="39339.83,-3126.02 39336.33,-3116.02 39332.83,-3126.02 39339.83,-3126.02"/>
<text text-anchor="middle" x="37744.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert13 -->
<g id="node217" class="node">
<title>R1_Stage2_L7_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="36912,-3116 36652,-3116 36652,-3058 36912,-3058 36912,-3116"/>
<text text-anchor="middle" x="36782" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 29</text>
<text text-anchor="middle" x="36782" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="36782" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert13 -->
<g id="edge311" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36797.26,-3277.86C36797.26,-3277.86 36797.26,-3126.01 36797.26,-3126.01"/>
<polygon fill="black" stroke="black" points="36800.76,-3126.01 36797.26,-3116.01 36793.76,-3126.01 36800.76,-3126.01"/>
<text text-anchor="middle" x="36697.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert14 -->
<g id="node218" class="node">
<title>R1_Stage2_L7_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="39872,-3116 39612,-3116 39612,-3058 39872,-3058 39872,-3116"/>
<text text-anchor="middle" x="39742" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 30</text>
<text text-anchor="middle" x="39742" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39742" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert14 -->
<g id="edge312" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36741.39,-3276.99C36741.39,-3267.1 36741.39,-3188 36741.39,-3188 36741.39,-3188 39632.33,-3188 39632.33,-3188 39632.33,-3188 39632.33,-3126.21 39632.33,-3126.21"/>
<polygon fill="black" stroke="black" points="39635.83,-3126.21 39632.33,-3116.21 39628.83,-3126.21 39635.83,-3126.21"/>
<text text-anchor="middle" x="37828.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_Expert15 -->
<g id="node219" class="node">
<title>R1_Stage2_L7_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="40464,-3116 40204,-3116 40204,-3058 40464,-3058 40464,-3116"/>
<text text-anchor="middle" x="40334" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 31</text>
<text text-anchor="middle" x="40334" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40334" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert15 -->
<g id="edge313" class="edge">
<title>R1_Stage2_L7_Router&#45;&gt;R1_Stage2_L7_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36763.74,-3277.94C36763.74,-3275.61 36763.74,-3201 36763.74,-3201 36763.74,-3201 40224.33,-3201 40224.33,-3201 40224.33,-3201 40224.33,-3126.06 40224.33,-3126.06"/>
<polygon fill="black" stroke="black" points="40227.83,-3126.06 40224.33,-3116.06 40220.83,-3126.06 40227.83,-3126.06"/>
<text text-anchor="middle" x="37996.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L7_MoE_Output -->
<g id="node220" class="node">
<title>R1_Stage2_L7_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="41073.95,-2948 40547.48,-2948 40412.05,-2844 40938.52,-2844 41073.95,-2948"/>
<text text-anchor="middle" x="40743" y="-2910" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="40743" y="-2899" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="40743" y="-2888" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="40743" y="-2877" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L7_Expert0&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge314" class="edge">
<title>R1_Stage2_L7_Expert0&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M40630,-3057.99C40630,-3057.99 40630,-2958.02 40630,-2958.02"/>
<polygon fill="black" stroke="black" points="40633.5,-2958.02 40630,-2948.02 40626.5,-2958.02 40633.5,-2958.02"/>
</g>
<!-- R1_Stage2_L7_Expert1&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge315" class="edge">
<title>R1_Stage2_L7_Expert1&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M40926,-3057.99C40926,-3057.99 40926,-2958.02 40926,-2958.02"/>
<polygon fill="black" stroke="black" points="40929.5,-2958.02 40926,-2948.02 40922.5,-2958.02 40929.5,-2958.02"/>
</g>
<!-- R1_Stage2_L7_Expert2&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge316" class="edge">
<title>R1_Stage2_L7_Expert2&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M36598.67,-3057.67C36598.67,-3012.99 36598.67,-2933 36598.67,-2933 36598.67,-2933 40517.83,-2933 40517.83,-2933"/>
<polygon fill="black" stroke="black" points="40517.83,-2936.5 40527.83,-2933 40517.83,-2929.5 40517.83,-2936.5"/>
</g>
<!-- R1_Stage2_L7_Expert3&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge317" class="edge">
<title>R1_Stage2_L7_Expert3&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M37190.67,-3057.89C37190.67,-3014.01 37190.67,-2936 37190.67,-2936 37190.67,-2936 40521.75,-2936 40521.75,-2936"/>
<polygon fill="black" stroke="black" points="40521.75,-2939.5 40531.75,-2936 40521.75,-2932.5 40521.75,-2939.5"/>
</g>
<!-- R1_Stage2_L7_Expert4&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge318" class="edge">
<title>R1_Stage2_L7_Expert4&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M37486.67,-3057.72C37486.67,-3014.07 37486.67,-2937 37486.67,-2937 37486.67,-2937 40523.1,-2937 40523.1,-2937"/>
<polygon fill="black" stroke="black" points="40523.1,-2940.5 40533.1,-2937 40523.1,-2933.5 40523.1,-2940.5"/>
</g>
<!-- R1_Stage2_L7_Expert5&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge319" class="edge">
<title>R1_Stage2_L7_Expert5&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M37782.67,-3057.92C37782.67,-3014.56 37782.67,-2938 37782.67,-2938 37782.67,-2938 40524.25,-2938 40524.25,-2938"/>
<polygon fill="black" stroke="black" points="40524.25,-2941.5 40534.25,-2938 40524.25,-2934.5 40524.25,-2941.5"/>
</g>
<!-- R1_Stage2_L7_Expert6&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge320" class="edge">
<title>R1_Stage2_L7_Expert6&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M38078.67,-3057.76C38078.67,-3014.63 38078.67,-2939 38078.67,-2939 38078.67,-2939 40525.6,-2939 40525.6,-2939"/>
<polygon fill="black" stroke="black" points="40525.6,-2942.5 40535.6,-2939 40525.6,-2935.5 40525.6,-2942.5"/>
</g>
<!-- R1_Stage2_L7_Expert7&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge321" class="edge">
<title>R1_Stage2_L7_Expert7&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M38374.67,-3057.96C38374.67,-3015.12 38374.67,-2940 38374.67,-2940 38374.67,-2940 40526.97,-2940 40526.97,-2940"/>
<polygon fill="black" stroke="black" points="40526.97,-2943.5 40536.97,-2940 40526.97,-2936.5 40526.97,-2943.5"/>
</g>
<!-- R1_Stage2_L7_Expert8&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge322" class="edge">
<title>R1_Stage2_L7_Expert8&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M40142,-3057.78C40142,-3016.48 40142,-2946 40142,-2946 40142,-2946 40534.54,-2946 40534.54,-2946"/>
<polygon fill="black" stroke="black" points="40534.54,-2949.5 40544.54,-2946 40534.54,-2942.5 40534.54,-2949.5"/>
</g>
<!-- R1_Stage2_L7_Expert9&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge323" class="edge">
<title>R1_Stage2_L7_Expert9&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M38670.67,-3057.81C38670.67,-3015.2 38670.67,-2941 38670.67,-2941 38670.67,-2941 40528.15,-2941 40528.15,-2941"/>
<polygon fill="black" stroke="black" points="40528.15,-2944.5 40538.15,-2941 40528.15,-2937.5 40528.15,-2944.5"/>
</g>
<!-- R1_Stage2_L7_Expert10&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge324" class="edge">
<title>R1_Stage2_L7_Expert10&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M38966.67,-3057.66C38966.67,-3015.29 38966.67,-2942 38966.67,-2942 38966.67,-2942 40529.66,-2942 40529.66,-2942"/>
<polygon fill="black" stroke="black" points="40529.66,-2945.5 40539.66,-2942 40529.66,-2938.5 40529.66,-2945.5"/>
</g>
<!-- R1_Stage2_L7_Expert11&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge325" class="edge">
<title>R1_Stage2_L7_Expert11&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M39262.67,-3057.86C39262.67,-3015.78 39262.67,-2943 39262.67,-2943 39262.67,-2943 40530.66,-2943 40530.66,-2943"/>
<polygon fill="black" stroke="black" points="40530.66,-2946.5 40540.66,-2943 40530.66,-2939.5 40530.66,-2946.5"/>
</g>
<!-- R1_Stage2_L7_Expert12&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge326" class="edge">
<title>R1_Stage2_L7_Expert12&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M39558.67,-3057.72C39558.67,-3015.88 39558.67,-2944 39558.67,-2944 39558.67,-2944 40532.09,-2944 40532.09,-2944"/>
<polygon fill="black" stroke="black" points="40532.09,-2947.5 40542.09,-2944 40532.09,-2940.5 40532.09,-2947.5"/>
</g>
<!-- R1_Stage2_L7_Expert13&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge327" class="edge">
<title>R1_Stage2_L7_Expert13&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M36894.67,-3057.86C36894.67,-3013.47 36894.67,-2934 36894.67,-2934 36894.67,-2934 40519.23,-2934 40519.23,-2934"/>
<polygon fill="black" stroke="black" points="40519.24,-2937.5 40529.23,-2934 40519.23,-2930.5 40519.24,-2937.5"/>
</g>
<!-- R1_Stage2_L7_Expert14&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge328" class="edge">
<title>R1_Stage2_L7_Expert14&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M39846,-3057.92C39846,-3016.38 39846,-2945 39846,-2945 39846,-2945 40533.37,-2945 40533.37,-2945"/>
<polygon fill="black" stroke="black" points="40533.37,-2948.5 40543.37,-2945 40533.37,-2941.5 40533.37,-2948.5"/>
</g>
<!-- R1_Stage2_L7_Expert15&#45;&gt;R1_Stage2_L7_MoE_Output -->
<g id="edge329" class="edge">
<title>R1_Stage2_L7_Expert15&#45;&gt;R1_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M40438.14,-3057.99C40438.14,-3057.99 40438.14,-2906.08 40438.14,-2906.08"/>
<polygon fill="black" stroke="black" points="40441.64,-2906.08 40438.14,-2896.08 40434.64,-2906.08 40441.64,-2906.08"/>
</g>
<!-- R1_Stage2_L7_MoE_Output&#45;&gt;R1_Stage2_L7_Output -->
<g id="edge330" class="edge">
<title>R1_Stage2_L7_MoE_Output&#45;&gt;R1_Stage2_L7_Output</title>
<path fill="none" stroke="black" d="M40903.61,-2843.85C40903.61,-2843.85 40903.61,-2757.21 40903.61,-2757.21"/>
<polygon fill="black" stroke="black" points="40907.11,-2757.21 40903.61,-2747.21 40900.11,-2757.21 40907.11,-2757.21"/>
</g>
<!-- R1_Stage2_L8_Input -->
<g id="node221" class="node">
<title>R1_Stage2_L8_Input</title>
<ellipse fill="lightblue" stroke="black" cx="36066" cy="-4014" rx="225.5" ry="29"/>
<text text-anchor="middle" x="36066" y="-4022.5" font-family="Times,serif" font-size="10.00">Layer 8 Input</text>
<text text-anchor="middle" x="36066" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="36066" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Attn_Input -->
<g id="node222" class="node">
<title>R1_Stage2_L8_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="36066" cy="-3837" rx="225.5" ry="29"/>
<text text-anchor="middle" x="36066" y="-3845.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="36066" y="-3834.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="36066" y="-3823.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Input&#45;&gt;R1_Stage2_L8_Attn_Input -->
<g id="edge331" class="edge">
<title>R1_Stage2_L8_Input&#45;&gt;R1_Stage2_L8_Attn_Input</title>
<path fill="none" stroke="black" d="M36066,-3984.77C36066,-3984.77 36066,-3876.27 36066,-3876.27"/>
<polygon fill="black" stroke="black" points="36069.5,-3876.27 36066,-3866.27 36062.5,-3876.27 36069.5,-3876.27"/>
</g>
<!-- R1_Stage2_L8_Attn_TP1 -->
<g id="node223" class="node">
<title>R1_Stage2_L8_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="36022,-3689 35676,-3689 35676,-3631 36022,-3631 36022,-3689"/>
<text text-anchor="middle" x="35849" y="-3674" font-family="Times,serif" font-size="10.00">Attention TP GPU 16</text>
<text text-anchor="middle" x="35849" y="-3663" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="35849" y="-3652" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="35849" y="-3641" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage2_L8_Attn_Input&#45;&gt;R1_Stage2_L8_Attn_TP1 -->
<g id="edge332" class="edge">
<title>R1_Stage2_L8_Attn_Input&#45;&gt;R1_Stage2_L8_Attn_TP1</title>
<path fill="none" stroke="black" d="M35931.25,-3813.5C35931.25,-3813.5 35931.25,-3699.2 35931.25,-3699.2"/>
<polygon fill="black" stroke="black" points="35934.75,-3699.2 35931.25,-3689.2 35927.75,-3699.2 35934.75,-3699.2"/>
</g>
<!-- R1_Stage2_L8_Attn_TP2 -->
<g id="node224" class="node">
<title>R1_Stage2_L8_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="36404,-3689 36058,-3689 36058,-3631 36404,-3631 36404,-3689"/>
<text text-anchor="middle" x="36231" y="-3674" font-family="Times,serif" font-size="10.00">Attention TP GPU 17</text>
<text text-anchor="middle" x="36231" y="-3663" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="36231" y="-3652" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="36231" y="-3641" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage2_L8_Attn_Input&#45;&gt;R1_Stage2_L8_Attn_TP2 -->
<g id="edge333" class="edge">
<title>R1_Stage2_L8_Attn_Input&#45;&gt;R1_Stage2_L8_Attn_TP2</title>
<path fill="none" stroke="black" d="M36174.75,-3811.26C36174.75,-3811.26 36174.75,-3699.01 36174.75,-3699.01"/>
<polygon fill="black" stroke="black" points="36178.25,-3699.01 36174.75,-3689.01 36171.25,-3699.01 36178.25,-3699.01"/>
</g>
<!-- R1_Stage2_L8_Attn_Output -->
<g id="node225" class="node">
<title>R1_Stage2_L8_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="35919" cy="-3469" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="35919" y="-3483" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="35919" y="-3472" font-family="Times,serif" font-size="10.00">AllReduce GPUs 16&#45;17</text>
<text text-anchor="middle" x="35919" y="-3461" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="35919" y="-3450" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Attn_TP1&#45;&gt;R1_Stage2_L8_Attn_Output -->
<g id="edge334" class="edge">
<title>R1_Stage2_L8_Attn_TP1&#45;&gt;R1_Stage2_L8_Attn_Output</title>
<path fill="none" stroke="black" d="M35849,-3630.99C35849,-3630.99 35849,-3514.47 35849,-3514.47"/>
<polygon fill="black" stroke="black" points="35852.5,-3514.47 35849,-3504.47 35845.5,-3514.47 35852.5,-3514.47"/>
</g>
<!-- R1_Stage2_L8_Attn_TP2&#45;&gt;R1_Stage2_L8_Attn_Output -->
<g id="edge335" class="edge">
<title>R1_Stage2_L8_Attn_TP2&#45;&gt;R1_Stage2_L8_Attn_Output</title>
<path fill="none" stroke="black" d="M36110.12,-3630.99C36110.12,-3630.99 36110.12,-3501.97 36110.12,-3501.97"/>
<polygon fill="black" stroke="black" points="36113.62,-3501.97 36110.12,-3491.97 36106.62,-3501.97 36113.62,-3501.97"/>
</g>
<!-- R1_Stage2_L8_MoE_Input -->
<g id="node226" class="node">
<title>R1_Stage2_L8_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="35902" cy="-3278" rx="225.5" ry="29"/>
<text text-anchor="middle" x="35902" y="-3286.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="35902" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="35902" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Attn_Output&#45;&gt;R1_Stage2_L8_MoE_Input -->
<g id="edge336" class="edge">
<title>R1_Stage2_L8_Attn_Output&#45;&gt;R1_Stage2_L8_MoE_Input</title>
<path fill="none" stroke="black" d="M35902,-3432.17C35902,-3432.17 35902,-3317.22 35902,-3317.22"/>
<polygon fill="black" stroke="black" points="35905.5,-3317.22 35902,-3307.22 35898.5,-3317.22 35905.5,-3317.22"/>
</g>
<!-- R1_Stage2_L8_Router -->
<g id="node227" class="node">
<title>R1_Stage2_L8_Router</title>
<polygon fill="lightyellow" stroke="black" points="36320.36,-3139 35807.56,-3139 35675.64,-3035 36188.44,-3035 36320.36,-3139"/>
<text text-anchor="middle" x="35998" y="-3101" font-family="Times,serif" font-size="10.00">Router GPU 16</text>
<text text-anchor="middle" x="35998" y="-3090" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="35998" y="-3079" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="35998" y="-3068" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage2_L8_MoE_Input&#45;&gt;R1_Stage2_L8_Router -->
<g id="edge337" class="edge">
<title>R1_Stage2_L8_MoE_Input&#45;&gt;R1_Stage2_L8_Router</title>
<path fill="none" stroke="black" d="M35902,-3248.99C35902,-3248.99 35902,-3149.02 35902,-3149.02"/>
<polygon fill="black" stroke="black" points="35905.5,-3149.02 35902,-3139.02 35898.5,-3149.02 35905.5,-3149.02"/>
</g>
<!-- R1_Stage2_L8_Expert0 -->
<g id="node228" class="node">
<title>R1_Stage2_L8_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="38304,-2925 38044,-2925 38044,-2867 38304,-2867 38304,-2925"/>
<text text-anchor="middle" x="38174" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 16</text>
<text text-anchor="middle" x="38174" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38174" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert0 -->
<g id="edge338" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36203.86,-3047C36726.09,-3047 38061.33,-3047 38061.33,-3047 38061.33,-3047 38061.33,-2935.11 38061.33,-2935.11"/>
<polygon fill="black" stroke="black" points="38064.83,-2935.11 38061.33,-2925.11 38057.83,-2935.11 38064.83,-2935.11"/>
<text text-anchor="middle" x="36904.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert1 -->
<g id="node229" class="node">
<title>R1_Stage2_L8_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="38600,-2925 38340,-2925 38340,-2867 38600,-2867 38600,-2925"/>
<text text-anchor="middle" x="38470" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 17</text>
<text text-anchor="middle" x="38470" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38470" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert1 -->
<g id="edge339" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36206.34,-3049C36782.91,-3049 38357.33,-3049 38357.33,-3049 38357.33,-3049 38357.33,-2935.14 38357.33,-2935.14"/>
<polygon fill="black" stroke="black" points="38360.83,-2935.14 38357.33,-2925.14 38353.83,-2935.14 38360.83,-2935.14"/>
<text text-anchor="middle" x="36989.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert2 -->
<g id="node230" class="node">
<title>R1_Stage2_L8_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="38896,-2925 38636,-2925 38636,-2867 38896,-2867 38896,-2925"/>
<text text-anchor="middle" x="38766" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 18</text>
<text text-anchor="middle" x="38766" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="38766" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert2 -->
<g id="edge340" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36207.75,-3050C36835.01,-3050 38653.33,-3050 38653.33,-3050 38653.33,-3050 38653.33,-2935.33 38653.33,-2935.33"/>
<polygon fill="black" stroke="black" points="38656.83,-2935.33 38653.33,-2925.33 38649.83,-2935.33 38656.83,-2935.33"/>
<text text-anchor="middle" x="37074.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert3 -->
<g id="node231" class="node">
<title>R1_Stage2_L8_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="39192,-2925 38932,-2925 38932,-2867 39192,-2867 39192,-2925"/>
<text text-anchor="middle" x="39062" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 19</text>
<text text-anchor="middle" x="39062" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39062" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert3 -->
<g id="edge341" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36210.25,-3052C36886.97,-3052 38949.33,-3052 38949.33,-3052 38949.33,-3052 38949.33,-2935.34 38949.33,-2935.34"/>
<polygon fill="black" stroke="black" points="38952.83,-2935.34 38949.33,-2925.34 38945.83,-2935.34 38952.83,-2935.34"/>
<text text-anchor="middle" x="37158.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert4 -->
<g id="node232" class="node">
<title>R1_Stage2_L8_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="39488,-2925 39228,-2925 39228,-2867 39488,-2867 39488,-2925"/>
<text text-anchor="middle" x="39358" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 20</text>
<text text-anchor="middle" x="39358" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39358" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert4 -->
<g id="edge342" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36212.64,-3054C36936.85,-3054 39245.33,-3054 39245.33,-3054 39245.33,-3054 39245.33,-2935.35 39245.33,-2935.35"/>
<polygon fill="black" stroke="black" points="39248.83,-2935.35 39245.33,-2925.35 39241.83,-2935.35 39248.83,-2935.35"/>
<text text-anchor="middle" x="37242.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert5 -->
<g id="node233" class="node">
<title>R1_Stage2_L8_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="39784,-2925 39524,-2925 39524,-2867 39784,-2867 39784,-2925"/>
<text text-anchor="middle" x="39654" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 21</text>
<text text-anchor="middle" x="39654" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39654" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert5 -->
<g id="edge343" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36215.31,-3056C36985.83,-3056 39541.33,-3056 39541.33,-3056 39541.33,-3056 39541.33,-2935.35 39541.33,-2935.35"/>
<polygon fill="black" stroke="black" points="39544.83,-2935.35 39541.33,-2925.35 39537.83,-2935.35 39544.83,-2935.35"/>
<text text-anchor="middle" x="37326.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert6 -->
<g id="node234" class="node">
<title>R1_Stage2_L8_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="40080,-2925 39820,-2925 39820,-2867 40080,-2867 40080,-2925"/>
<text text-anchor="middle" x="39950" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 22</text>
<text text-anchor="middle" x="39950" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="39950" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert6 -->
<g id="edge344" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36292.53,-3117C37199.61,-3117 39890,-3117 39890,-3117 39890,-3117 39890,-2935.35 39890,-2935.35"/>
<polygon fill="black" stroke="black" points="39893.5,-2935.35 39890,-2925.35 39886.5,-2935.35 39893.5,-2935.35"/>
<text text-anchor="middle" x="37410.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert7 -->
<g id="node235" class="node">
<title>R1_Stage2_L8_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="40376,-2925 40116,-2925 40116,-2867 40376,-2867 40376,-2925"/>
<text text-anchor="middle" x="40246" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 23</text>
<text text-anchor="middle" x="40246" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="40246" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert7 -->
<g id="edge345" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36295,-3119C37250.91,-3119 40186,-3119 40186,-3119 40186,-3119 40186,-2935.15 40186,-2935.15"/>
<polygon fill="black" stroke="black" points="40189.5,-2935.15 40186,-2925.15 40182.5,-2935.15 40189.5,-2935.15"/>
<text text-anchor="middle" x="37494.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert8 -->
<g id="node236" class="node">
<title>R1_Stage2_L8_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="35936,-2925 35676,-2925 35676,-2867 35936,-2867 35936,-2925"/>
<text text-anchor="middle" x="35806" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 24</text>
<text text-anchor="middle" x="35806" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="35806" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert8 -->
<g id="edge346" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M35806,-3034.81C35806,-3034.81 35806,-2935.01 35806,-2935.01"/>
<polygon fill="black" stroke="black" points="35809.5,-2935.01 35806,-2925.01 35802.5,-2935.01 35809.5,-2935.01"/>
<text text-anchor="middle" x="35881.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert9 -->
<g id="node237" class="node">
<title>R1_Stage2_L8_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="36232,-2925 35972,-2925 35972,-2867 36232,-2867 36232,-2925"/>
<text text-anchor="middle" x="36102" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 25</text>
<text text-anchor="middle" x="36102" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="36102" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert9 -->
<g id="edge347" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36102,-3034.81C36102,-3034.81 36102,-2935.01 36102,-2935.01"/>
<polygon fill="black" stroke="black" points="36105.5,-2935.01 36102,-2925.01 36098.5,-2935.01 36105.5,-2935.01"/>
<text text-anchor="middle" x="36071.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert10 -->
<g id="node238" class="node">
<title>R1_Stage2_L8_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="36528,-2925 36268,-2925 36268,-2867 36528,-2867 36528,-2925"/>
<text text-anchor="middle" x="36398" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 26</text>
<text text-anchor="middle" x="36398" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="36398" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert10 -->
<g id="edge348" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36294.22,-3086.86C36294.22,-3086.86 36294.22,-2935.01 36294.22,-2935.01"/>
<polygon fill="black" stroke="black" points="36297.72,-2935.01 36294.22,-2925.01 36290.72,-2935.01 36297.72,-2935.01"/>
<text text-anchor="middle" x="36220.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert11 -->
<g id="node239" class="node">
<title>R1_Stage2_L8_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="36824,-2925 36564,-2925 36564,-2867 36824,-2867 36824,-2925"/>
<text text-anchor="middle" x="36694" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 27</text>
<text text-anchor="middle" x="36694" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="36694" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert11 -->
<g id="edge349" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36192.65,-3038C36362.28,-3038 36581.33,-3038 36581.33,-3038 36581.33,-3038 36581.33,-2935.08 36581.33,-2935.08"/>
<polygon fill="black" stroke="black" points="36584.83,-2935.08 36581.33,-2925.08 36577.83,-2935.08 36584.83,-2935.08"/>
<text text-anchor="middle" x="36336.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert12 -->
<g id="node240" class="node">
<title>R1_Stage2_L8_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="37120,-2925 36860,-2925 36860,-2867 37120,-2867 37120,-2925"/>
<text text-anchor="middle" x="36990" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 28</text>
<text text-anchor="middle" x="36990" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="36990" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert12 -->
<g id="edge350" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36194.79,-3040C36454,-3040 36877.33,-3040 36877.33,-3040 36877.33,-3040 36877.33,-2935.14 36877.33,-2935.14"/>
<polygon fill="black" stroke="black" points="36880.83,-2935.14 36877.33,-2925.14 36873.83,-2935.14 36880.83,-2935.14"/>
<text text-anchor="middle" x="36538.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert13 -->
<g id="node241" class="node">
<title>R1_Stage2_L8_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="37416,-2925 37156,-2925 37156,-2867 37416,-2867 37416,-2925"/>
<text text-anchor="middle" x="37286" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 29</text>
<text text-anchor="middle" x="37286" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="37286" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert13 -->
<g id="edge351" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36197.38,-3042C36532.71,-3042 37173.33,-3042 37173.33,-3042 37173.33,-3042 37173.33,-2935.19 37173.33,-2935.19"/>
<polygon fill="black" stroke="black" points="37176.83,-2935.19 37173.33,-2925.19 37169.83,-2935.19 37176.83,-2935.19"/>
<text text-anchor="middle" x="36638.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert14 -->
<g id="node242" class="node">
<title>R1_Stage2_L8_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="37712,-2925 37452,-2925 37452,-2867 37712,-2867 37712,-2925"/>
<text text-anchor="middle" x="37582" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 30</text>
<text text-anchor="middle" x="37582" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="37582" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert14 -->
<g id="edge352" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36198.73,-3043C36601.36,-3043 37469.33,-3043 37469.33,-3043 37469.33,-3043 37469.33,-2935.04 37469.33,-2935.04"/>
<polygon fill="black" stroke="black" points="37472.83,-2935.04 37469.33,-2925.04 37465.83,-2935.04 37472.83,-2935.04"/>
<text text-anchor="middle" x="36730.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_Expert15 -->
<g id="node243" class="node">
<title>R1_Stage2_L8_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="38008,-2925 37748,-2925 37748,-2867 38008,-2867 38008,-2925"/>
<text text-anchor="middle" x="37878" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 31</text>
<text text-anchor="middle" x="37878" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="37878" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert15 -->
<g id="edge353" class="edge">
<title>R1_Stage2_L8_Router&#45;&gt;R1_Stage2_L8_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M36201.17,-3045C36665.64,-3045 37765.33,-3045 37765.33,-3045 37765.33,-3045 37765.33,-2935.08 37765.33,-2935.08"/>
<polygon fill="black" stroke="black" points="37768.83,-2935.08 37765.33,-2925.08 37761.83,-2935.08 37768.83,-2935.08"/>
<text text-anchor="middle" x="36818.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage2_L8_MoE_Output -->
<g id="node244" class="node">
<title>R1_Stage2_L8_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="38504.95,-2771 37978.48,-2771 37843.05,-2667 38369.52,-2667 38504.95,-2771"/>
<text text-anchor="middle" x="38174" y="-2733" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="38174" y="-2722" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="38174" y="-2711" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="38174" y="-2700" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage2_L8_Expert0&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge354" class="edge">
<title>R1_Stage2_L8_Expert0&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M38174,-2866.77C38174,-2866.77 38174,-2781.18 38174,-2781.18"/>
<polygon fill="black" stroke="black" points="38177.5,-2781.18 38174,-2771.18 38170.5,-2781.18 38177.5,-2781.18"/>
</g>
<!-- R1_Stage2_L8_Expert1&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge355" class="edge">
<title>R1_Stage2_L8_Expert1&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M38422.36,-2866.77C38422.36,-2866.77 38422.36,-2781.18 38422.36,-2781.18"/>
<polygon fill="black" stroke="black" points="38425.86,-2781.18 38422.36,-2771.18 38418.86,-2781.18 38425.86,-2781.18"/>
</g>
<!-- R1_Stage2_L8_Expert2&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge356" class="edge">
<title>R1_Stage2_L8_Expert2&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M38766,-2866.95C38766,-2829.19 38766,-2768 38766,-2768 38766,-2768 38511.17,-2768 38511.17,-2768"/>
<polygon fill="black" stroke="black" points="38511.17,-2764.5 38501.17,-2768 38511.17,-2771.5 38511.17,-2764.5"/>
</g>
<!-- R1_Stage2_L8_Expert3&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge357" class="edge">
<title>R1_Stage2_L8_Expert3&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M39062,-2866.83C39062,-2828.5 39062,-2766 39062,-2766 39062,-2766 38508.67,-2766 38508.67,-2766"/>
<polygon fill="black" stroke="black" points="38508.67,-2762.5 38498.67,-2766 38508.67,-2769.5 38508.67,-2762.5"/>
</g>
<!-- R1_Stage2_L8_Expert4&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge358" class="edge">
<title>R1_Stage2_L8_Expert4&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M39358,-2866.7C39358,-2827.82 39358,-2764 39358,-2764 39358,-2764 38505.97,-2764 38505.97,-2764"/>
<polygon fill="black" stroke="black" points="38505.97,-2760.5 38495.97,-2764 38505.97,-2767.5 38505.97,-2760.5"/>
</g>
<!-- R1_Stage2_L8_Expert5&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge359" class="edge">
<title>R1_Stage2_L8_Expert5&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M39654,-2866.92C39654,-2827.51 39654,-2762 39654,-2762 39654,-2762 38503.32,-2762 38503.32,-2762"/>
<polygon fill="black" stroke="black" points="38503.32,-2758.5 38493.32,-2762 38503.32,-2765.5 38503.32,-2758.5"/>
</g>
<!-- R1_Stage2_L8_Expert6&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge360" class="edge">
<title>R1_Stage2_L8_Expert6&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M39950,-2866.82C39950,-2826.86 39950,-2760 39950,-2760 39950,-2760 38500.75,-2760 38500.75,-2760"/>
<polygon fill="black" stroke="black" points="38500.75,-2756.5 38490.75,-2760 38500.75,-2763.5 38500.75,-2756.5"/>
</g>
<!-- R1_Stage2_L8_Expert7&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge361" class="edge">
<title>R1_Stage2_L8_Expert7&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M40246,-2866.86C40246,-2826.1 40246,-2757 40246,-2757 40246,-2757 38496.72,-2757 38496.72,-2757"/>
<polygon fill="black" stroke="black" points="38496.72,-2753.5 38486.72,-2757 38496.72,-2760.5 38496.72,-2753.5"/>
</g>
<!-- R1_Stage2_L8_Expert8&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge362" class="edge">
<title>R1_Stage2_L8_Expert8&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M35806,-2866.99C35806,-2825.99 35806,-2756 35806,-2756 35806,-2756 37948.89,-2756 37948.89,-2756"/>
<polygon fill="black" stroke="black" points="37948.89,-2759.5 37958.89,-2756 37948.89,-2752.5 37948.89,-2759.5"/>
</g>
<!-- R1_Stage2_L8_Expert9&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge363" class="edge">
<title>R1_Stage2_L8_Expert9&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M36102,-2866.86C36102,-2826.1 36102,-2757 36102,-2757 36102,-2757 37950.06,-2757 37950.06,-2757"/>
<polygon fill="black" stroke="black" points="37950.06,-2760.5 37960.06,-2757 37950.06,-2753.5 37950.06,-2760.5"/>
</g>
<!-- R1_Stage2_L8_Expert10&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge364" class="edge">
<title>R1_Stage2_L8_Expert10&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M36398,-2866.95C36398,-2826.73 36398,-2759 36398,-2759 36398,-2759 37952.86,-2759 37952.86,-2759"/>
<polygon fill="black" stroke="black" points="37952.86,-2762.5 37962.86,-2759 37952.86,-2755.5 37952.86,-2762.5"/>
</g>
<!-- R1_Stage2_L8_Expert11&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge365" class="edge">
<title>R1_Stage2_L8_Expert11&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M36694,-2866.82C36694,-2826.86 36694,-2760 36694,-2760 36694,-2760 37953.92,-2760 37953.92,-2760"/>
<polygon fill="black" stroke="black" points="37953.92,-2763.5 37963.92,-2760 37953.92,-2756.5 37953.92,-2763.5"/>
</g>
<!-- R1_Stage2_L8_Expert12&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge366" class="edge">
<title>R1_Stage2_L8_Expert12&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M36990,-2866.71C36990,-2827 36990,-2761 36990,-2761 36990,-2761 37955.39,-2761 37955.39,-2761"/>
<polygon fill="black" stroke="black" points="37955.39,-2764.5 37965.39,-2761 37955.39,-2757.5 37955.39,-2764.5"/>
</g>
<!-- R1_Stage2_L8_Expert13&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge367" class="edge">
<title>R1_Stage2_L8_Expert13&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M37286,-2866.92C37286,-2827.51 37286,-2762 37286,-2762 37286,-2762 37956.64,-2762 37956.64,-2762"/>
<polygon fill="black" stroke="black" points="37956.64,-2765.5 37966.64,-2762 37956.64,-2758.5 37956.64,-2765.5"/>
</g>
<!-- R1_Stage2_L8_Expert14&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge368" class="edge">
<title>R1_Stage2_L8_Expert14&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M37582,-2866.81C37582,-2827.66 37582,-2763 37582,-2763 37582,-2763 37957.78,-2763 37957.78,-2763"/>
<polygon fill="black" stroke="black" points="37957.78,-2766.5 37967.78,-2763 37957.78,-2759.5 37957.78,-2766.5"/>
</g>
<!-- R1_Stage2_L8_Expert15&#45;&gt;R1_Stage2_L8_MoE_Output -->
<g id="edge369" class="edge">
<title>R1_Stage2_L8_Expert15&#45;&gt;R1_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M37925.64,-2866.77C37925.64,-2866.77 37925.64,-2740.66 37925.64,-2740.66"/>
<polygon fill="black" stroke="black" points="37929.14,-2740.66 37925.64,-2730.66 37922.14,-2740.66 37929.14,-2740.66"/>
</g>
<!-- R1_Stage2_L8_MoE_Output&#45;&gt;R1_Stage2_L8_Output -->
<g id="edge370" class="edge">
<title>R1_Stage2_L8_MoE_Output&#45;&gt;R1_Stage2_L8_Output</title>
<path fill="none" stroke="black" d="M38378.79,-2674C39010.08,-2674 40883.83,-2674 40883.83,-2674 40883.83,-2674 40883.83,-2579.35 40883.83,-2579.35"/>
<polygon fill="black" stroke="black" points="40887.33,-2579.35 40883.83,-2569.35 40880.33,-2579.35 40887.33,-2579.35"/>
</g>
<!-- R1_Stage3_L9_Input -->
<g id="node245" class="node">
<title>R1_Stage3_L9_Input</title>
<ellipse fill="lightblue" stroke="black" cx="45944" cy="-3469" rx="225.5" ry="29"/>
<text text-anchor="middle" x="45944" y="-3477.5" font-family="Times,serif" font-size="10.00">Layer 9 Input</text>
<text text-anchor="middle" x="45944" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="45944" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Attn_Input -->
<g id="node246" class="node">
<title>R1_Stage3_L9_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="45944" cy="-3278" rx="225.5" ry="29"/>
<text text-anchor="middle" x="45944" y="-3286.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="45944" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="45944" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Input&#45;&gt;R1_Stage3_L9_Attn_Input -->
<g id="edge371" class="edge">
<title>R1_Stage3_L9_Input&#45;&gt;R1_Stage3_L9_Attn_Input</title>
<path fill="none" stroke="black" d="M45944,-3439.99C45944,-3439.99 45944,-3317.28 45944,-3317.28"/>
<polygon fill="black" stroke="black" points="45947.5,-3317.28 45944,-3307.28 45940.5,-3317.28 45947.5,-3317.28"/>
</g>
<!-- R1_Stage3_L9_Attn_TP1 -->
<g id="node247" class="node">
<title>R1_Stage3_L9_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="45973,-3116 45627,-3116 45627,-3058 45973,-3058 45973,-3116"/>
<text text-anchor="middle" x="45800" y="-3101" font-family="Times,serif" font-size="10.00">Attention TP GPU 32</text>
<text text-anchor="middle" x="45800" y="-3090" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="45800" y="-3079" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="45800" y="-3068" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage3_L9_Attn_Input&#45;&gt;R1_Stage3_L9_Attn_TP1 -->
<g id="edge372" class="edge">
<title>R1_Stage3_L9_Attn_Input&#45;&gt;R1_Stage3_L9_Attn_TP1</title>
<path fill="none" stroke="black" d="M45845.75,-3251.84C45845.75,-3251.84 45845.75,-3126.28 45845.75,-3126.28"/>
<polygon fill="black" stroke="black" points="45849.25,-3126.28 45845.75,-3116.28 45842.25,-3126.28 45849.25,-3126.28"/>
</g>
<!-- R1_Stage3_L9_Attn_TP2 -->
<g id="node248" class="node">
<title>R1_Stage3_L9_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="46355,-3116 46009,-3116 46009,-3058 46355,-3058 46355,-3116"/>
<text text-anchor="middle" x="46182" y="-3101" font-family="Times,serif" font-size="10.00">Attention TP GPU 33</text>
<text text-anchor="middle" x="46182" y="-3090" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="46182" y="-3079" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="46182" y="-3068" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage3_L9_Attn_Input&#45;&gt;R1_Stage3_L9_Attn_TP2 -->
<g id="edge373" class="edge">
<title>R1_Stage3_L9_Attn_Input&#45;&gt;R1_Stage3_L9_Attn_TP2</title>
<path fill="none" stroke="black" d="M46089.25,-3255.72C46089.25,-3255.72 46089.25,-3126.31 46089.25,-3126.31"/>
<polygon fill="black" stroke="black" points="46092.75,-3126.31 46089.25,-3116.31 46085.75,-3126.31 46092.75,-3126.31"/>
</g>
<!-- R1_Stage3_L9_Attn_Output -->
<g id="node249" class="node">
<title>R1_Stage3_L9_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="45991" cy="-2896" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="45991" y="-2910" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="45991" y="-2899" font-family="Times,serif" font-size="10.00">AllReduce GPUs 32&#45;33</text>
<text text-anchor="middle" x="45991" y="-2888" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="45991" y="-2877" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Attn_TP1&#45;&gt;R1_Stage3_L9_Attn_Output -->
<g id="edge374" class="edge">
<title>R1_Stage3_L9_Attn_TP1&#45;&gt;R1_Stage3_L9_Attn_Output</title>
<path fill="none" stroke="black" d="M45860.38,-3057.99C45860.38,-3057.99 45860.38,-2937.19 45860.38,-2937.19"/>
<polygon fill="black" stroke="black" points="45863.88,-2937.19 45860.38,-2927.19 45856.88,-2937.19 45863.88,-2937.19"/>
</g>
<!-- R1_Stage3_L9_Attn_TP2&#45;&gt;R1_Stage3_L9_Attn_Output -->
<g id="edge375" class="edge">
<title>R1_Stage3_L9_Attn_TP2&#45;&gt;R1_Stage3_L9_Attn_Output</title>
<path fill="none" stroke="black" d="M46121.62,-3057.99C46121.62,-3057.99 46121.62,-2937.19 46121.62,-2937.19"/>
<polygon fill="black" stroke="black" points="46125.12,-2937.19 46121.62,-2927.19 46118.12,-2937.19 46125.12,-2937.19"/>
</g>
<!-- R1_Stage3_L9_MoE_Input -->
<g id="node250" class="node">
<title>R1_Stage3_L9_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="45991" cy="-2719" rx="225.5" ry="29"/>
<text text-anchor="middle" x="45991" y="-2727.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="45991" y="-2716.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="45991" y="-2705.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Attn_Output&#45;&gt;R1_Stage3_L9_MoE_Input -->
<g id="edge376" class="edge">
<title>R1_Stage3_L9_Attn_Output&#45;&gt;R1_Stage3_L9_MoE_Input</title>
<path fill="none" stroke="black" d="M45991,-2858.89C45991,-2858.89 45991,-2758.17 45991,-2758.17"/>
<polygon fill="black" stroke="black" points="45994.5,-2758.17 45991,-2748.17 45987.5,-2758.17 45994.5,-2758.17"/>
</g>
<!-- R1_Stage3_L9_Router -->
<g id="node251" class="node">
<title>R1_Stage3_L9_Router</title>
<polygon fill="lightyellow" stroke="black" points="46313.36,-2594 45800.56,-2594 45668.64,-2490 46181.44,-2490 46313.36,-2594"/>
<text text-anchor="middle" x="45991" y="-2556" font-family="Times,serif" font-size="10.00">Router GPU 32</text>
<text text-anchor="middle" x="45991" y="-2545" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="45991" y="-2534" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="45991" y="-2523" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage3_L9_MoE_Input&#45;&gt;R1_Stage3_L9_Router -->
<g id="edge377" class="edge">
<title>R1_Stage3_L9_MoE_Input&#45;&gt;R1_Stage3_L9_Router</title>
<path fill="none" stroke="black" d="M45991,-2689.77C45991,-2689.77 45991,-2604.18 45991,-2604.18"/>
<polygon fill="black" stroke="black" points="45994.5,-2604.18 45991,-2594.18 45987.5,-2604.18 45994.5,-2604.18"/>
</g>
<!-- R1_Stage3_L9_Expert0 -->
<g id="node252" class="node">
<title>R1_Stage3_L9_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="46887,-2380 46627,-2380 46627,-2322 46887,-2322 46887,-2380"/>
<text text-anchor="middle" x="46757" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 32</text>
<text text-anchor="middle" x="46757" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46757" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert0 -->
<g id="edge378" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M46188.26,-2495C46415.22,-2495 46757,-2495 46757,-2495 46757,-2495 46757,-2390.14 46757,-2390.14"/>
<polygon fill="black" stroke="black" points="46760.5,-2390.14 46757,-2380.14 46753.5,-2390.14 46760.5,-2390.14"/>
<text text-anchor="middle" x="46619.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert1 -->
<g id="node253" class="node">
<title>R1_Stage3_L9_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="47183,-2380 46923,-2380 46923,-2322 47183,-2322 47183,-2380"/>
<text text-anchor="middle" x="47053" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 33</text>
<text text-anchor="middle" x="47053" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47053" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert1 -->
<g id="edge379" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M46191.69,-2498C46499.51,-2498 47053,-2498 47053,-2498 47053,-2498 47053,-2390.04 47053,-2390.04"/>
<polygon fill="black" stroke="black" points="47056.5,-2390.04 47053,-2380.04 47049.5,-2390.04 47056.5,-2390.04"/>
<text text-anchor="middle" x="46888.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert2 -->
<g id="node254" class="node">
<title>R1_Stage3_L9_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="47479,-2380 47219,-2380 47219,-2322 47479,-2322 47479,-2380"/>
<text text-anchor="middle" x="47349" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 34</text>
<text text-anchor="middle" x="47349" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47349" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert2 -->
<g id="edge380" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M46195.41,-2501C46574.65,-2501 47349,-2501 47349,-2501 47349,-2501 47349,-2390.28 47349,-2390.28"/>
<polygon fill="black" stroke="black" points="47352.5,-2390.28 47349,-2380.28 47345.5,-2390.28 47352.5,-2390.28"/>
<text text-anchor="middle" x="47158.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert3 -->
<g id="node255" class="node">
<title>R1_Stage3_L9_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="47775,-2380 47515,-2380 47515,-2322 47775,-2322 47775,-2380"/>
<text text-anchor="middle" x="47645" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 35</text>
<text text-anchor="middle" x="47645" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47645" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert3 -->
<g id="edge381" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M46199.22,-2504C46643.66,-2504 47645,-2504 47645,-2504 47645,-2504 47645,-2390.14 47645,-2390.14"/>
<polygon fill="black" stroke="black" points="47648.5,-2390.14 47645,-2380.14 47641.5,-2390.14 47648.5,-2390.14"/>
<text text-anchor="middle" x="47454.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert4 -->
<g id="node256" class="node">
<title>R1_Stage3_L9_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="48071,-2380 47811,-2380 47811,-2322 48071,-2322 48071,-2380"/>
<text text-anchor="middle" x="47941" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 36</text>
<text text-anchor="middle" x="47941" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47941" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert4 -->
<g id="edge382" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M46203.4,-2507C46708.79,-2507 47941,-2507 47941,-2507 47941,-2507 47941,-2390.34 47941,-2390.34"/>
<polygon fill="black" stroke="black" points="47944.5,-2390.34 47941,-2380.34 47937.5,-2390.34 47944.5,-2390.34"/>
<text text-anchor="middle" x="47750.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert5 -->
<g id="node257" class="node">
<title>R1_Stage3_L9_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="48367,-2380 48107,-2380 48107,-2322 48367,-2322 48367,-2380"/>
<text text-anchor="middle" x="48237" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 37</text>
<text text-anchor="middle" x="48237" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="48237" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert5 -->
<g id="edge383" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M46206.87,-2510C46769.4,-2510 48237,-2510 48237,-2510 48237,-2510 48237,-2390.16 48237,-2390.16"/>
<polygon fill="black" stroke="black" points="48240.5,-2390.16 48237,-2380.16 48233.5,-2390.16 48240.5,-2390.16"/>
<text text-anchor="middle" x="48046.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert6 -->
<g id="node258" class="node">
<title>R1_Stage3_L9_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="43927,-2380 43667,-2380 43667,-2322 43927,-2322 43927,-2380"/>
<text text-anchor="middle" x="43797" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 38</text>
<text text-anchor="middle" x="43797" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="43797" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert6 -->
<g id="edge384" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M45684.99,-2503C45108.11,-2503 43917.12,-2503 43917.12,-2503 43917.12,-2503 43917.12,-2390.31 43917.12,-2390.31"/>
<polygon fill="black" stroke="black" points="43920.62,-2390.31 43917.12,-2380.31 43913.62,-2390.31 43920.62,-2390.31"/>
<text text-anchor="middle" x="44029.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert7 -->
<g id="node259" class="node">
<title>R1_Stage3_L9_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="44223,-2380 43963,-2380 43963,-2322 44223,-2322 44223,-2380"/>
<text text-anchor="middle" x="44093" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 39</text>
<text text-anchor="middle" x="44093" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44093" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert7 -->
<g id="edge385" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M45681.31,-2500C45163.35,-2500 44177.5,-2500 44177.5,-2500 44177.5,-2500 44177.5,-2390.08 44177.5,-2390.08"/>
<polygon fill="black" stroke="black" points="44181,-2390.08 44177.5,-2380.08 44174,-2390.08 44181,-2390.08"/>
<text text-anchor="middle" x="44324.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert8 -->
<g id="node260" class="node">
<title>R1_Stage3_L9_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="44519,-2380 44259,-2380 44259,-2322 44519,-2322 44519,-2380"/>
<text text-anchor="middle" x="44389" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 40</text>
<text text-anchor="middle" x="44389" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44389" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert8 -->
<g id="edge386" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M45678.32,-2498C45212.1,-2498 44389,-2498 44389,-2498 44389,-2498 44389,-2390.04 44389,-2390.04"/>
<polygon fill="black" stroke="black" points="44392.5,-2390.04 44389,-2380.04 44385.5,-2390.04 44392.5,-2390.04"/>
<text text-anchor="middle" x="44618.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert9 -->
<g id="node261" class="node">
<title>R1_Stage3_L9_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="44815,-2380 44555,-2380 44555,-2322 44815,-2322 44815,-2380"/>
<text text-anchor="middle" x="44685" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 41</text>
<text text-anchor="middle" x="44685" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44685" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert9 -->
<g id="edge387" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M45676.1,-2496C45289.64,-2496 44685,-2496 44685,-2496 44685,-2496 44685,-2390.34 44685,-2390.34"/>
<polygon fill="black" stroke="black" points="44688.5,-2390.34 44685,-2380.34 44681.5,-2390.34 44688.5,-2390.34"/>
<text text-anchor="middle" x="44911.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert10 -->
<g id="node262" class="node">
<title>R1_Stage3_L9_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="45111,-2380 44851,-2380 44851,-2322 45111,-2322 45111,-2380"/>
<text text-anchor="middle" x="44981" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 42</text>
<text text-anchor="middle" x="44981" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44981" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert10 -->
<g id="edge388" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M45673.51,-2494C45377.38,-2494 44981,-2494 44981,-2494 44981,-2494 44981,-2390.28 44981,-2390.28"/>
<polygon fill="black" stroke="black" points="44984.5,-2390.28 44981,-2380.28 44977.5,-2390.28 44984.5,-2390.28"/>
<text text-anchor="middle" x="45200.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert11 -->
<g id="node263" class="node">
<title>R1_Stage3_L9_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="45407,-2380 45147,-2380 45147,-2322 45407,-2322 45407,-2380"/>
<text text-anchor="middle" x="45277" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 43</text>
<text text-anchor="middle" x="45277" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45277" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert11 -->
<g id="edge389" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M45671.07,-2492C45481.11,-2492 45277,-2492 45277,-2492 45277,-2492 45277,-2390.22 45277,-2390.22"/>
<polygon fill="black" stroke="black" points="45280.5,-2390.22 45277,-2380.22 45273.5,-2390.22 45280.5,-2390.22"/>
<text text-anchor="middle" x="45483.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert12 -->
<g id="node264" class="node">
<title>R1_Stage3_L9_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="45703,-2380 45443,-2380 45443,-2322 45703,-2322 45703,-2380"/>
<text text-anchor="middle" x="45573" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 44</text>
<text text-anchor="middle" x="45573" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45573" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert12 -->
<g id="edge390" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M45685.78,-2541.86C45685.78,-2541.86 45685.78,-2390.01 45685.78,-2390.01"/>
<polygon fill="black" stroke="black" points="45689.28,-2390.01 45685.78,-2380.01 45682.28,-2390.01 45689.28,-2390.01"/>
<text text-anchor="middle" x="45753.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert13 -->
<g id="node265" class="node">
<title>R1_Stage3_L9_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="45999,-2380 45739,-2380 45739,-2322 45999,-2322 45999,-2380"/>
<text text-anchor="middle" x="45869" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 45</text>
<text text-anchor="middle" x="45869" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45869" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert13 -->
<g id="edge391" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M45869,-2489.81C45869,-2489.81 45869,-2390.01 45869,-2390.01"/>
<polygon fill="black" stroke="black" points="45872.5,-2390.01 45869,-2380.01 45865.5,-2390.01 45872.5,-2390.01"/>
<text text-anchor="middle" x="45943.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert14 -->
<g id="node266" class="node">
<title>R1_Stage3_L9_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="46295,-2380 46035,-2380 46035,-2322 46295,-2322 46295,-2380"/>
<text text-anchor="middle" x="46165" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 46</text>
<text text-anchor="middle" x="46165" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46165" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert14 -->
<g id="edge392" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M46165,-2489.81C46165,-2489.81 46165,-2390.01 46165,-2390.01"/>
<polygon fill="black" stroke="black" points="46168.5,-2390.01 46165,-2380.01 46161.5,-2390.01 46168.5,-2390.01"/>
<text text-anchor="middle" x="46080.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_Expert15 -->
<g id="node267" class="node">
<title>R1_Stage3_L9_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="46591,-2380 46331,-2380 46331,-2322 46591,-2322 46591,-2380"/>
<text text-anchor="middle" x="46461" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 47</text>
<text text-anchor="middle" x="46461" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46461" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert15 -->
<g id="edge393" class="edge">
<title>R1_Stage3_L9_Router&#45;&gt;R1_Stage3_L9_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M46183.99,-2492C46265.98,-2492 46343,-2492 46343,-2492 46343,-2492 46343,-2390.22 46343,-2390.22"/>
<polygon fill="black" stroke="black" points="46346.5,-2390.22 46343,-2380.22 46339.5,-2390.22 46346.5,-2390.22"/>
<text text-anchor="middle" x="46376.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L9_MoE_Output -->
<g id="node268" class="node">
<title>R1_Stage3_L9_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="44877.95,-2212 44351.48,-2212 44216.05,-2108 44742.52,-2108 44877.95,-2212"/>
<text text-anchor="middle" x="44547" y="-2174" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="44547" y="-2163" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="44547" y="-2152" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="44547" y="-2141" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L9_Expert0&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge394" class="edge">
<title>R1_Stage3_L9_Expert0&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M46636,-2321.89C46636,-2278.01 46636,-2200 46636,-2200 46636,-2200 44872.57,-2200 44872.57,-2200"/>
<polygon fill="black" stroke="black" points="44872.57,-2196.5 44862.57,-2200 44872.57,-2203.5 44872.57,-2196.5"/>
</g>
<!-- R1_Stage3_L9_Expert1&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge395" class="edge">
<title>R1_Stage3_L9_Expert1&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M46932,-2321.86C46932,-2277.47 46932,-2198 46932,-2198 46932,-2198 44870.02,-2198 44870.02,-2198"/>
<polygon fill="black" stroke="black" points="44870.02,-2194.5 44860.02,-2198 44870.02,-2201.5 44870.02,-2194.5"/>
</g>
<!-- R1_Stage3_L9_Expert2&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge396" class="edge">
<title>R1_Stage3_L9_Expert2&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M47228,-2321.85C47228,-2276.95 47228,-2196 47228,-2196 47228,-2196 44867.16,-2196 44867.16,-2196"/>
<polygon fill="black" stroke="black" points="44867.16,-2192.5 44857.16,-2196 44867.16,-2199.5 44867.16,-2192.5"/>
</g>
<!-- R1_Stage3_L9_Expert3&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge397" class="edge">
<title>R1_Stage3_L9_Expert3&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M47524,-2321.84C47524,-2276.43 47524,-2194 47524,-2194 47524,-2194 44864.73,-2194 44864.73,-2194"/>
<polygon fill="black" stroke="black" points="44864.73,-2190.5 44854.73,-2194 44864.73,-2197.5 44864.73,-2190.5"/>
</g>
<!-- R1_Stage3_L9_Expert4&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge398" class="edge">
<title>R1_Stage3_L9_Expert4&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M47820,-2321.84C47820,-2275.93 47820,-2192 47820,-2192 47820,-2192 44861.98,-2192 44861.98,-2192"/>
<polygon fill="black" stroke="black" points="44861.98,-2188.5 44851.98,-2192 44861.98,-2195.5 44861.98,-2188.5"/>
</g>
<!-- R1_Stage3_L9_Expert5&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge399" class="edge">
<title>R1_Stage3_L9_Expert5&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M48116,-2321.84C48116,-2275.45 48116,-2190 48116,-2190 48116,-2190 44859.37,-2190 44859.37,-2190"/>
<polygon fill="black" stroke="black" points="44859.37,-2186.5 44849.37,-2190 44859.37,-2193.5 44859.37,-2186.5"/>
</g>
<!-- R1_Stage3_L9_Expert6&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge400" class="edge">
<title>R1_Stage3_L9_Expert6&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M43876.28,-2321.96C43876.28,-2279.12 43876.28,-2204 43876.28,-2204 43876.28,-2204 44330.75,-2204 44330.75,-2204"/>
<polygon fill="black" stroke="black" points="44330.75,-2207.5 44340.75,-2204 44330.75,-2200.5 44330.75,-2207.5"/>
</g>
<!-- R1_Stage3_L9_Expert7&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge401" class="edge">
<title>R1_Stage3_L9_Expert7&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M44207.18,-2321.85C44207.18,-2276.95 44207.18,-2196 44207.18,-2196 44207.18,-2196 44320.35,-2196 44320.35,-2196"/>
<polygon fill="black" stroke="black" points="44320.35,-2199.5 44330.35,-2196 44320.35,-2192.5 44320.35,-2199.5"/>
</g>
<!-- R1_Stage3_L9_Expert8&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge402" class="edge">
<title>R1_Stage3_L9_Expert8&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M44389,-2321.99C44389,-2321.99 44389,-2222.02 44389,-2222.02"/>
<polygon fill="black" stroke="black" points="44392.5,-2222.02 44389,-2212.02 44385.5,-2222.02 44392.5,-2222.02"/>
</g>
<!-- R1_Stage3_L9_Expert9&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge403" class="edge">
<title>R1_Stage3_L9_Expert9&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M44685,-2321.99C44685,-2321.99 44685,-2222.02 44685,-2222.02"/>
<polygon fill="black" stroke="black" points="44688.5,-2222.02 44685,-2212.02 44681.5,-2222.02 44688.5,-2222.02"/>
</g>
<!-- R1_Stage3_L9_Expert10&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge404" class="edge">
<title>R1_Stage3_L9_Expert10&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M44864.36,-2321.99C44864.36,-2321.99 44864.36,-2170.08 44864.36,-2170.08"/>
<polygon fill="black" stroke="black" points="44867.86,-2170.08 44864.36,-2160.08 44860.86,-2170.08 44867.86,-2170.08"/>
</g>
<!-- R1_Stage3_L9_Expert11&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge405" class="edge">
<title>R1_Stage3_L9_Expert11&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M45160.5,-2321.78C45160.5,-2280.48 45160.5,-2210 45160.5,-2210 45160.5,-2210 44885.75,-2210 44885.75,-2210"/>
<polygon fill="black" stroke="black" points="44885.75,-2206.5 44875.75,-2210 44885.75,-2213.5 44885.75,-2206.5"/>
</g>
<!-- R1_Stage3_L9_Expert12&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge406" class="edge">
<title>R1_Stage3_L9_Expert12&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M45452,-2321.72C45452,-2279.88 45452,-2208 45452,-2208 45452,-2208 44882.77,-2208 44882.77,-2208"/>
<polygon fill="black" stroke="black" points="44882.77,-2204.5 44872.77,-2208 44882.77,-2211.5 44882.77,-2204.5"/>
</g>
<!-- R1_Stage3_L9_Expert13&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge407" class="edge">
<title>R1_Stage3_L9_Expert13&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M45748,-2321.66C45748,-2279.29 45748,-2206 45748,-2206 45748,-2206 44880.43,-2206 44880.43,-2206"/>
<polygon fill="black" stroke="black" points="44880.43,-2202.5 44870.43,-2206 44880.43,-2209.5 44880.43,-2202.5"/>
</g>
<!-- R1_Stage3_L9_Expert14&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge408" class="edge">
<title>R1_Stage3_L9_Expert14&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M46044,-2321.96C46044,-2279.12 46044,-2204 46044,-2204 46044,-2204 44877.68,-2204 44877.68,-2204"/>
<polygon fill="black" stroke="black" points="44877.68,-2200.5 44867.68,-2204 44877.68,-2207.5 44877.68,-2200.5"/>
</g>
<!-- R1_Stage3_L9_Expert15&#45;&gt;R1_Stage3_L9_MoE_Output -->
<g id="edge409" class="edge">
<title>R1_Stage3_L9_Expert15&#45;&gt;R1_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M46340,-2321.92C46340,-2278.56 46340,-2202 46340,-2202 46340,-2202 44874.97,-2202 44874.97,-2202"/>
<polygon fill="black" stroke="black" points="44874.97,-2198.5 44864.97,-2202 44874.97,-2205.5 44874.97,-2198.5"/>
</g>
<!-- R1_Stage3_L9_MoE_Output&#45;&gt;R1_Stage3_L9_Output -->
<g id="edge410" class="edge">
<title>R1_Stage3_L9_MoE_Output&#45;&gt;R1_Stage3_L9_Output</title>
<path fill="none" stroke="black" d="M44756.87,-2119C45520.1,-2119 48103.75,-2119 48103.75,-2119 48103.75,-2119 48103.75,-1993.66 48103.75,-1993.66"/>
<polygon fill="black" stroke="black" points="48107.25,-1993.66 48103.75,-1983.66 48100.25,-1993.66 48107.25,-1993.66"/>
</g>
<!-- R1_Stage3_L10_Input -->
<g id="node269" class="node">
<title>R1_Stage3_L10_Input</title>
<ellipse fill="lightblue" stroke="black" cx="48818" cy="-3278" rx="225.5" ry="29"/>
<text text-anchor="middle" x="48818" y="-3286.5" font-family="Times,serif" font-size="10.00">Layer 10 Input</text>
<text text-anchor="middle" x="48818" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="48818" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Attn_Input -->
<g id="node270" class="node">
<title>R1_Stage3_L10_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="48818" cy="-3087" rx="225.5" ry="29"/>
<text text-anchor="middle" x="48818" y="-3095.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="48818" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="48818" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Input&#45;&gt;R1_Stage3_L10_Attn_Input -->
<g id="edge411" class="edge">
<title>R1_Stage3_L10_Input&#45;&gt;R1_Stage3_L10_Attn_Input</title>
<path fill="none" stroke="black" d="M48818,-3248.99C48818,-3248.99 48818,-3126.28 48818,-3126.28"/>
<polygon fill="black" stroke="black" points="48821.5,-3126.28 48818,-3116.28 48814.5,-3126.28 48821.5,-3126.28"/>
</g>
<!-- R1_Stage3_L10_Attn_TP1 -->
<g id="node271" class="node">
<title>R1_Stage3_L10_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="49182,-2925 48836,-2925 48836,-2867 49182,-2867 49182,-2925"/>
<text text-anchor="middle" x="49009" y="-2910" font-family="Times,serif" font-size="10.00">Attention TP GPU 32</text>
<text text-anchor="middle" x="49009" y="-2899" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="49009" y="-2888" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="49009" y="-2877" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage3_L10_Attn_Input&#45;&gt;R1_Stage3_L10_Attn_TP1 -->
<g id="edge412" class="edge">
<title>R1_Stage3_L10_Attn_Input&#45;&gt;R1_Stage3_L10_Attn_TP1</title>
<path fill="none" stroke="black" d="M48939.75,-3062.42C48939.75,-3062.42 48939.75,-2935.17 48939.75,-2935.17"/>
<polygon fill="black" stroke="black" points="48943.25,-2935.17 48939.75,-2925.17 48936.25,-2935.17 48943.25,-2935.17"/>
</g>
<!-- R1_Stage3_L10_Attn_TP2 -->
<g id="node272" class="node">
<title>R1_Stage3_L10_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="48800,-2925 48454,-2925 48454,-2867 48800,-2867 48800,-2925"/>
<text text-anchor="middle" x="48627" y="-2910" font-family="Times,serif" font-size="10.00">Attention TP GPU 33</text>
<text text-anchor="middle" x="48627" y="-2899" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="48627" y="-2888" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="48627" y="-2877" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage3_L10_Attn_Input&#45;&gt;R1_Stage3_L10_Attn_TP2 -->
<g id="edge413" class="edge">
<title>R1_Stage3_L10_Attn_Input&#45;&gt;R1_Stage3_L10_Attn_TP2</title>
<path fill="none" stroke="black" d="M48696.25,-3062.42C48696.25,-3062.42 48696.25,-2935.17 48696.25,-2935.17"/>
<polygon fill="black" stroke="black" points="48699.75,-2935.17 48696.25,-2925.17 48692.75,-2935.17 48699.75,-2935.17"/>
</g>
<!-- R1_Stage3_L10_Attn_Output -->
<g id="node273" class="node">
<title>R1_Stage3_L10_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="48725" cy="-2719" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="48725" y="-2733" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="48725" y="-2722" font-family="Times,serif" font-size="10.00">AllReduce GPUs 32&#45;33</text>
<text text-anchor="middle" x="48725" y="-2711" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="48725" y="-2700" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Attn_TP1&#45;&gt;R1_Stage3_L10_Attn_Output -->
<g id="edge414" class="edge">
<title>R1_Stage3_L10_Attn_TP1&#45;&gt;R1_Stage3_L10_Attn_Output</title>
<path fill="none" stroke="black" d="M48902.12,-2866.77C48902.12,-2866.77 48902.12,-2754.25 48902.12,-2754.25"/>
<polygon fill="black" stroke="black" points="48905.62,-2754.25 48902.12,-2744.25 48898.62,-2754.25 48905.62,-2754.25"/>
</g>
<!-- R1_Stage3_L10_Attn_TP2&#45;&gt;R1_Stage3_L10_Attn_Output -->
<g id="edge415" class="edge">
<title>R1_Stage3_L10_Attn_TP2&#45;&gt;R1_Stage3_L10_Attn_Output</title>
<path fill="none" stroke="black" d="M48640.88,-2866.77C48640.88,-2866.77 48640.88,-2763.75 48640.88,-2763.75"/>
<polygon fill="black" stroke="black" points="48644.38,-2763.75 48640.88,-2753.75 48637.38,-2763.75 48644.38,-2763.75"/>
</g>
<!-- R1_Stage3_L10_MoE_Input -->
<g id="node274" class="node">
<title>R1_Stage3_L10_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="48725" cy="-2542" rx="225.5" ry="29"/>
<text text-anchor="middle" x="48725" y="-2550.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="48725" y="-2539.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="48725" y="-2528.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Attn_Output&#45;&gt;R1_Stage3_L10_MoE_Input -->
<g id="edge416" class="edge">
<title>R1_Stage3_L10_Attn_Output&#45;&gt;R1_Stage3_L10_MoE_Input</title>
<path fill="none" stroke="black" d="M48725,-2681.89C48725,-2681.89 48725,-2581.17 48725,-2581.17"/>
<polygon fill="black" stroke="black" points="48728.5,-2581.17 48725,-2571.17 48721.5,-2581.17 48728.5,-2581.17"/>
</g>
<!-- R1_Stage3_L10_Router -->
<g id="node275" class="node">
<title>R1_Stage3_L10_Router</title>
<polygon fill="lightyellow" stroke="black" points="49047.36,-2403 48534.56,-2403 48402.64,-2299 48915.44,-2299 49047.36,-2403"/>
<text text-anchor="middle" x="48725" y="-2365" font-family="Times,serif" font-size="10.00">Router GPU 32</text>
<text text-anchor="middle" x="48725" y="-2354" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="48725" y="-2343" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="48725" y="-2332" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage3_L10_MoE_Input&#45;&gt;R1_Stage3_L10_Router -->
<g id="edge417" class="edge">
<title>R1_Stage3_L10_MoE_Input&#45;&gt;R1_Stage3_L10_Router</title>
<path fill="none" stroke="black" d="M48725,-2512.99C48725,-2512.99 48725,-2413.02 48725,-2413.02"/>
<polygon fill="black" stroke="black" points="48728.5,-2413.02 48725,-2403.02 48721.5,-2413.02 48728.5,-2413.02"/>
</g>
<!-- R1_Stage3_L10_Expert0 -->
<g id="node276" class="node">
<title>R1_Stage3_L10_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="47838,-2189 47578,-2189 47578,-2131 47838,-2131 47838,-2189"/>
<text text-anchor="middle" x="47708" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 32</text>
<text text-anchor="middle" x="47708" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47708" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert0 -->
<g id="edge418" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48408.79,-2304C48150.88,-2304 47829,-2304 47829,-2304 47829,-2304 47829,-2199.14 47829,-2199.14"/>
<polygon fill="black" stroke="black" points="47832.5,-2199.14 47829,-2189.14 47825.5,-2199.14 47832.5,-2199.14"/>
<text text-anchor="middle" x="47917.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert1 -->
<g id="node277" class="node">
<title>R1_Stage3_L10_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="48134,-2189 47874,-2189 47874,-2131 48134,-2131 48134,-2189"/>
<text text-anchor="middle" x="48004" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 33</text>
<text text-anchor="middle" x="48004" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="48004" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert1 -->
<g id="edge419" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48403.48,-2300C48260.99,-2300 48125,-2300 48125,-2300 48125,-2300 48125,-2199.01 48125,-2199.01"/>
<polygon fill="black" stroke="black" points="48128.5,-2199.01 48125,-2189.01 48121.5,-2199.01 48128.5,-2199.01"/>
<text text-anchor="middle" x="48189.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert2 -->
<g id="node278" class="node">
<title>R1_Stage3_L10_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="48430,-2189 48170,-2189 48170,-2131 48430,-2131 48430,-2189"/>
<text text-anchor="middle" x="48300" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 34</text>
<text text-anchor="middle" x="48300" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="48300" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert2 -->
<g id="edge420" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48416.28,-2350.86C48416.28,-2350.86 48416.28,-2199.01 48416.28,-2199.01"/>
<polygon fill="black" stroke="black" points="48419.78,-2199.01 48416.28,-2189.01 48412.78,-2199.01 48419.78,-2199.01"/>
<text text-anchor="middle" x="48438.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert3 -->
<g id="node279" class="node">
<title>R1_Stage3_L10_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="48726,-2189 48466,-2189 48466,-2131 48726,-2131 48726,-2189"/>
<text text-anchor="middle" x="48596" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 35</text>
<text text-anchor="middle" x="48596" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="48596" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert3 -->
<g id="edge421" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48596,-2298.81C48596,-2298.81 48596,-2199.01 48596,-2199.01"/>
<polygon fill="black" stroke="black" points="48599.5,-2199.01 48596,-2189.01 48592.5,-2199.01 48599.5,-2199.01"/>
<text text-anchor="middle" x="48693.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert4 -->
<g id="node280" class="node">
<title>R1_Stage3_L10_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="49022,-2189 48762,-2189 48762,-2131 49022,-2131 49022,-2189"/>
<text text-anchor="middle" x="48892" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 36</text>
<text text-anchor="middle" x="48892" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="48892" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert4 -->
<g id="edge422" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48892,-2298.81C48892,-2298.81 48892,-2199.01 48892,-2199.01"/>
<polygon fill="black" stroke="black" points="48895.5,-2199.01 48892,-2189.01 48888.5,-2199.01 48895.5,-2199.01"/>
<text text-anchor="middle" x="48799.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert5 -->
<g id="node281" class="node">
<title>R1_Stage3_L10_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="49318,-2189 49058,-2189 49058,-2131 49318,-2131 49318,-2189"/>
<text text-anchor="middle" x="49188" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 37</text>
<text text-anchor="middle" x="49188" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="49188" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert5 -->
<g id="edge423" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M49034.72,-2350.86C49034.72,-2345.08 49034.72,-2160 49034.72,-2160 49034.72,-2160 49048,-2160 49048,-2160"/>
<polygon fill="black" stroke="black" points="49048,-2163.5 49058,-2160 49048,-2156.5 49048,-2163.5"/>
<text text-anchor="middle" x="49072.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert6 -->
<g id="node282" class="node">
<title>R1_Stage3_L10_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="49614,-2189 49354,-2189 49354,-2131 49614,-2131 49614,-2189"/>
<text text-anchor="middle" x="49484" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 38</text>
<text text-anchor="middle" x="49484" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="49484" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert6 -->
<g id="edge424" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48929.4,-2310C49154.2,-2310 49484,-2310 49484,-2310 49484,-2310 49484,-2199.28 49484,-2199.28"/>
<polygon fill="black" stroke="black" points="49487.5,-2199.28 49484,-2189.28 49480.5,-2199.28 49487.5,-2199.28"/>
<text text-anchor="middle" x="49357.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert7 -->
<g id="node283" class="node">
<title>R1_Stage3_L10_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="45174,-2189 44914,-2189 44914,-2131 45174,-2131 45174,-2189"/>
<text text-anchor="middle" x="45044" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 39</text>
<text text-anchor="middle" x="45044" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45044" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert7 -->
<g id="edge425" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48509.16,-2383C47732.93,-2383 45129,-2383 45129,-2383 45129,-2383 45129,-2199.15 45129,-2199.15"/>
<polygon fill="black" stroke="black" points="45132.5,-2199.15 45129,-2189.15 45125.5,-2199.15 45132.5,-2199.15"/>
<text text-anchor="middle" x="45276.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert8 -->
<g id="node284" class="node">
<title>R1_Stage3_L10_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="45470,-2189 45210,-2189 45210,-2131 45470,-2131 45470,-2189"/>
<text text-anchor="middle" x="45340" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 40</text>
<text text-anchor="middle" x="45340" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45340" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert8 -->
<g id="edge426" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48429.22,-2320C47625.47,-2320 45461,-2320 45461,-2320 45461,-2320 45461,-2199.35 45461,-2199.35"/>
<polygon fill="black" stroke="black" points="45464.5,-2199.35 45461,-2189.35 45457.5,-2199.35 45464.5,-2199.35"/>
<text text-anchor="middle" x="45572.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert9 -->
<g id="node285" class="node">
<title>R1_Stage3_L10_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="45766,-2189 45506,-2189 45506,-2131 45766,-2131 45766,-2189"/>
<text text-anchor="middle" x="45636" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 41</text>
<text text-anchor="middle" x="45636" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45636" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert9 -->
<g id="edge427" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48426.48,-2318C47673.6,-2318 45757,-2318 45757,-2318 45757,-2318 45757,-2199.35 45757,-2199.35"/>
<polygon fill="black" stroke="black" points="45760.5,-2199.35 45757,-2189.35 45753.5,-2199.35 45760.5,-2199.35"/>
<text text-anchor="middle" x="45867.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert10 -->
<g id="node286" class="node">
<title>R1_Stage3_L10_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="46062,-2189 45802,-2189 45802,-2131 46062,-2131 46062,-2189"/>
<text text-anchor="middle" x="45932" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 42</text>
<text text-anchor="middle" x="45932" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45932" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert10 -->
<g id="edge428" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48424.01,-2316C47725.4,-2316 46053,-2316 46053,-2316 46053,-2316 46053,-2199.34 46053,-2199.34"/>
<polygon fill="black" stroke="black" points="46056.5,-2199.34 46053,-2189.34 46049.5,-2199.34 46056.5,-2199.34"/>
<text text-anchor="middle" x="46161.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert11 -->
<g id="node287" class="node">
<title>R1_Stage3_L10_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="46358,-2189 46098,-2189 46098,-2131 46358,-2131 46358,-2189"/>
<text text-anchor="middle" x="46228" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 43</text>
<text text-anchor="middle" x="46228" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46228" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert11 -->
<g id="edge429" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48418.94,-2312C47777.07,-2312 46349,-2312 46349,-2312 46349,-2312 46349,-2199.31 46349,-2199.31"/>
<polygon fill="black" stroke="black" points="46352.5,-2199.31 46349,-2189.31 46345.5,-2199.31 46352.5,-2199.31"/>
<text text-anchor="middle" x="46454.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert12 -->
<g id="node288" class="node">
<title>R1_Stage3_L10_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="46654,-2189 46394,-2189 46394,-2131 46654,-2131 46654,-2189"/>
<text text-anchor="middle" x="46524" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 44</text>
<text text-anchor="middle" x="46524" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46524" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert12 -->
<g id="edge430" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48416.41,-2310C47837.19,-2310 46645,-2310 46645,-2310 46645,-2310 46645,-2199.28 46645,-2199.28"/>
<polygon fill="black" stroke="black" points="46648.5,-2199.28 46645,-2189.28 46641.5,-2199.28 46648.5,-2199.28"/>
<text text-anchor="middle" x="46743.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert13 -->
<g id="node289" class="node">
<title>R1_Stage3_L10_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="46950,-2189 46690,-2189 46690,-2131 46950,-2131 46950,-2189"/>
<text text-anchor="middle" x="46820" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 45</text>
<text text-anchor="middle" x="46820" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46820" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert13 -->
<g id="edge431" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48415.27,-2309C47904.4,-2309 46941,-2309 46941,-2309 46941,-2309 46941,-2199.08 46941,-2199.08"/>
<polygon fill="black" stroke="black" points="46944.5,-2199.08 46941,-2189.08 46937.5,-2199.08 46944.5,-2199.08"/>
<text text-anchor="middle" x="47026.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert14 -->
<g id="node290" class="node">
<title>R1_Stage3_L10_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="47246,-2189 46986,-2189 46986,-2131 47246,-2131 47246,-2189"/>
<text text-anchor="middle" x="47116" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 46</text>
<text text-anchor="middle" x="47116" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47116" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert14 -->
<g id="edge432" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48412.61,-2307C47976.22,-2307 47237,-2307 47237,-2307 47237,-2307 47237,-2199.04 47237,-2199.04"/>
<polygon fill="black" stroke="black" points="47240.5,-2199.04 47237,-2189.04 47233.5,-2199.04 47240.5,-2199.04"/>
<text text-anchor="middle" x="47296.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_Expert15 -->
<g id="node291" class="node">
<title>R1_Stage3_L10_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="47542,-2189 47282,-2189 47282,-2131 47542,-2131 47542,-2189"/>
<text text-anchor="middle" x="47412" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 47</text>
<text text-anchor="middle" x="47412" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47412" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert15 -->
<g id="edge433" class="edge">
<title>R1_Stage3_L10_Router&#45;&gt;R1_Stage3_L10_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M48409.87,-2305C48056.72,-2305 47533,-2305 47533,-2305 47533,-2305 47533,-2199.34 47533,-2199.34"/>
<polygon fill="black" stroke="black" points="47536.5,-2199.34 47533,-2189.34 47529.5,-2199.34 47536.5,-2199.34"/>
<text text-anchor="middle" x="47539.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L10_MoE_Output -->
<g id="node292" class="node">
<title>R1_Stage3_L10_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="49221.95,-2021 48695.48,-2021 48560.05,-1917 49086.52,-1917 49221.95,-2021"/>
<text text-anchor="middle" x="48891" y="-1983" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="48891" y="-1972" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="48891" y="-1961" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="48891" y="-1950" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L10_Expert0&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge434" class="edge">
<title>R1_Stage3_L10_Expert0&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M47817.67,-2130.86C47817.67,-2088.78 47817.67,-2016 47817.67,-2016 47817.67,-2016 48678.8,-2016 48678.8,-2016"/>
<polygon fill="black" stroke="black" points="48678.8,-2019.5 48688.8,-2016 48678.8,-2012.5 48678.8,-2019.5"/>
</g>
<!-- R1_Stage3_L10_Expert1&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge435" class="edge">
<title>R1_Stage3_L10_Expert1&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M48118.87,-2130.72C48118.87,-2088.88 48118.87,-2017 48118.87,-2017 48118.87,-2017 48680.15,-2017 48680.15,-2017"/>
<polygon fill="black" stroke="black" points="48680.15,-2020.5 48690.15,-2017 48680.15,-2013.5 48680.15,-2020.5"/>
</g>
<!-- R1_Stage3_L10_Expert2&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge436" class="edge">
<title>R1_Stage3_L10_Expert2&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M48300,-2130.78C48300,-2089.48 48300,-2019 48300,-2019 48300,-2019 48682.56,-2019 48682.56,-2019"/>
<polygon fill="black" stroke="black" points="48682.56,-2022.5 48692.56,-2019 48682.56,-2015.5 48682.56,-2022.5"/>
</g>
<!-- R1_Stage3_L10_Expert3&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge437" class="edge">
<title>R1_Stage3_L10_Expert3&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M48643.14,-2130.99C48643.14,-2130.99 48643.14,-1991.07 48643.14,-1991.07"/>
<polygon fill="black" stroke="black" points="48646.64,-1991.07 48643.14,-1981.07 48639.64,-1991.07 48646.64,-1991.07"/>
</g>
<!-- R1_Stage3_L10_Expert4&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge438" class="edge">
<title>R1_Stage3_L10_Expert4&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M48892,-2130.99C48892,-2130.99 48892,-2031.02 48892,-2031.02"/>
<polygon fill="black" stroke="black" points="48895.5,-2031.02 48892,-2021.02 48888.5,-2031.02 48895.5,-2031.02"/>
</g>
<!-- R1_Stage3_L10_Expert5&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge439" class="edge">
<title>R1_Stage3_L10_Expert5&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M49139.86,-2130.99C49139.86,-2130.99 49139.86,-2031.02 49139.86,-2031.02"/>
<polygon fill="black" stroke="black" points="49143.36,-2031.02 49139.86,-2021.02 49136.36,-2031.02 49143.36,-2031.02"/>
</g>
<!-- R1_Stage3_L10_Expert6&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge440" class="edge">
<title>R1_Stage3_L10_Expert6&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M49484,-2130.89C49484,-2087.01 49484,-2009 49484,-2009 49484,-2009 49216.6,-2009 49216.6,-2009"/>
<polygon fill="black" stroke="black" points="49216.6,-2005.5 49206.6,-2009 49216.6,-2012.5 49216.6,-2005.5"/>
</g>
<!-- R1_Stage3_L10_Expert7&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge441" class="edge">
<title>R1_Stage3_L10_Expert7&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M45153.67,-2130.65C45153.67,-2084.96 45153.67,-2002 45153.67,-2002 45153.67,-2002 48660.48,-2002 48660.48,-2002"/>
<polygon fill="black" stroke="black" points="48660.48,-2005.5 48670.48,-2002 48660.48,-1998.5 48660.48,-2005.5"/>
</g>
<!-- R1_Stage3_L10_Expert8&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge442" class="edge">
<title>R1_Stage3_L10_Expert8&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M45449.67,-2130.66C45449.67,-2085.47 45449.67,-2004 45449.67,-2004 45449.67,-2004 48663.12,-2004 48663.12,-2004"/>
<polygon fill="black" stroke="black" points="48663.12,-2007.5 48673.12,-2004 48663.12,-2000.5 48663.12,-2007.5"/>
</g>
<!-- R1_Stage3_L10_Expert9&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge443" class="edge">
<title>R1_Stage3_L10_Expert9&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M45745.67,-2130.85C45745.67,-2085.95 45745.67,-2005 45745.67,-2005 45745.67,-2005 48664.5,-2005 48664.5,-2005"/>
<polygon fill="black" stroke="black" points="48664.5,-2008.5 48674.5,-2005 48664.5,-2001.5 48664.5,-2008.5"/>
</g>
<!-- R1_Stage3_L10_Expert10&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge444" class="edge">
<title>R1_Stage3_L10_Expert10&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M46041.67,-2130.86C46041.67,-2086.47 46041.67,-2007 46041.67,-2007 46041.67,-2007 48667.13,-2007 48667.13,-2007"/>
<polygon fill="black" stroke="black" points="48667.13,-2010.5 48677.13,-2007 48667.13,-2003.5 48667.13,-2010.5"/>
</g>
<!-- R1_Stage3_L10_Expert11&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge445" class="edge">
<title>R1_Stage3_L10_Expert11&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M46337.67,-2130.69C46337.67,-2086.52 46337.67,-2008 46337.67,-2008 46337.67,-2008 48668.52,-2008 48668.52,-2008"/>
<polygon fill="black" stroke="black" points="48668.52,-2011.5 48678.52,-2008 48668.52,-2004.5 48668.52,-2011.5"/>
</g>
<!-- R1_Stage3_L10_Expert12&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge446" class="edge">
<title>R1_Stage3_L10_Expert12&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M46633.67,-2130.72C46633.67,-2087.07 46633.67,-2010 46633.67,-2010 46633.67,-2010 48670.92,-2010 48670.92,-2010"/>
<polygon fill="black" stroke="black" points="48670.92,-2013.5 48680.92,-2010 48670.92,-2006.5 48670.92,-2013.5"/>
</g>
<!-- R1_Stage3_L10_Expert13&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge447" class="edge">
<title>R1_Stage3_L10_Expert13&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M46929.67,-2130.92C46929.67,-2087.56 46929.67,-2011 46929.67,-2011 46929.67,-2011 48672.03,-2011 48672.03,-2011"/>
<polygon fill="black" stroke="black" points="48672.03,-2014.5 48682.03,-2011 48672.03,-2007.5 48672.03,-2014.5"/>
</g>
<!-- R1_Stage3_L10_Expert14&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge448" class="edge">
<title>R1_Stage3_L10_Expert14&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M47225.67,-2130.96C47225.67,-2088.12 47225.67,-2013 47225.67,-2013 47225.67,-2013 48674.71,-2013 48674.71,-2013"/>
<polygon fill="black" stroke="black" points="48674.71,-2016.5 48684.71,-2013 48674.71,-2009.5 48674.71,-2016.5"/>
</g>
<!-- R1_Stage3_L10_Expert15&#45;&gt;R1_Stage3_L10_MoE_Output -->
<g id="edge449" class="edge">
<title>R1_Stage3_L10_Expert15&#45;&gt;R1_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M47521.67,-2130.81C47521.67,-2088.2 47521.67,-2014 47521.67,-2014 47521.67,-2014 48676.37,-2014 48676.37,-2014"/>
<polygon fill="black" stroke="black" points="48676.37,-2017.5 48686.37,-2014 48676.37,-2010.5 48676.37,-2017.5"/>
</g>
<!-- R1_Stage3_L10_MoE_Output&#45;&gt;R1_Stage3_L10_Output -->
<g id="edge450" class="edge">
<title>R1_Stage3_L10_MoE_Output&#45;&gt;R1_Stage3_L10_Output</title>
<path fill="none" stroke="black" d="M48561.09,-1918C48543.58,-1918 48533,-1918 48533,-1918 48533,-1918 48533,-1795.93 48533,-1795.93"/>
<polygon fill="black" stroke="black" points="48536.5,-1795.93 48533,-1785.93 48529.5,-1795.93 48536.5,-1795.93"/>
</g>
<!-- R1_Stage3_L11_Input -->
<g id="node293" class="node">
<title>R1_Stage3_L11_Input</title>
<ellipse fill="lightblue" stroke="black" cx="43700" cy="-3087" rx="225.5" ry="29"/>
<text text-anchor="middle" x="43700" y="-3095.5" font-family="Times,serif" font-size="10.00">Layer 11 Input</text>
<text text-anchor="middle" x="43700" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="43700" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Attn_Input -->
<g id="node294" class="node">
<title>R1_Stage3_L11_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="43700" cy="-2896" rx="225.5" ry="29"/>
<text text-anchor="middle" x="43700" y="-2904.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="43700" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="43700" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Input&#45;&gt;R1_Stage3_L11_Attn_Input -->
<g id="edge451" class="edge">
<title>R1_Stage3_L11_Input&#45;&gt;R1_Stage3_L11_Attn_Input</title>
<path fill="none" stroke="black" d="M43700,-3057.99C43700,-3057.99 43700,-2935.28 43700,-2935.28"/>
<polygon fill="black" stroke="black" points="43703.5,-2935.28 43700,-2925.28 43696.5,-2935.28 43703.5,-2935.28"/>
</g>
<!-- R1_Stage3_L11_Attn_TP1 -->
<g id="node295" class="node">
<title>R1_Stage3_L11_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="43750,-2748 43404,-2748 43404,-2690 43750,-2690 43750,-2748"/>
<text text-anchor="middle" x="43577" y="-2733" font-family="Times,serif" font-size="10.00">Attention TP GPU 32</text>
<text text-anchor="middle" x="43577" y="-2722" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="43577" y="-2711" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="43577" y="-2700" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage3_L11_Attn_Input&#45;&gt;R1_Stage3_L11_Attn_TP1 -->
<g id="edge452" class="edge">
<title>R1_Stage3_L11_Attn_Input&#45;&gt;R1_Stage3_L11_Attn_TP1</title>
<path fill="none" stroke="black" d="M43612.25,-2869.12C43612.25,-2869.12 43612.25,-2758.2 43612.25,-2758.2"/>
<polygon fill="black" stroke="black" points="43615.75,-2758.2 43612.25,-2748.2 43608.75,-2758.2 43615.75,-2758.2"/>
</g>
<!-- R1_Stage3_L11_Attn_TP2 -->
<g id="node296" class="node">
<title>R1_Stage3_L11_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="44132,-2748 43786,-2748 43786,-2690 44132,-2690 44132,-2748"/>
<text text-anchor="middle" x="43959" y="-2733" font-family="Times,serif" font-size="10.00">Attention TP GPU 33</text>
<text text-anchor="middle" x="43959" y="-2722" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="43959" y="-2711" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="43959" y="-2700" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage3_L11_Attn_Input&#45;&gt;R1_Stage3_L11_Attn_TP2 -->
<g id="edge453" class="edge">
<title>R1_Stage3_L11_Attn_Input&#45;&gt;R1_Stage3_L11_Attn_TP2</title>
<path fill="none" stroke="black" d="M43855.75,-2875C43855.75,-2875 43855.75,-2758.19 43855.75,-2758.19"/>
<polygon fill="black" stroke="black" points="43859.25,-2758.19 43855.75,-2748.19 43852.25,-2758.19 43859.25,-2758.19"/>
</g>
<!-- R1_Stage3_L11_Attn_Output -->
<g id="node297" class="node">
<title>R1_Stage3_L11_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="43664" cy="-2542" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="43664" y="-2556" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="43664" y="-2545" font-family="Times,serif" font-size="10.00">AllReduce GPUs 32&#45;33</text>
<text text-anchor="middle" x="43664" y="-2534" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="43664" y="-2523" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Attn_TP1&#45;&gt;R1_Stage3_L11_Attn_Output -->
<g id="edge454" class="edge">
<title>R1_Stage3_L11_Attn_TP1&#45;&gt;R1_Stage3_L11_Attn_Output</title>
<path fill="none" stroke="black" d="M43585.38,-2689.77C43585.38,-2689.77 43585.38,-2587.06 43585.38,-2587.06"/>
<polygon fill="black" stroke="black" points="43588.88,-2587.06 43585.38,-2577.06 43581.88,-2587.06 43588.88,-2587.06"/>
</g>
<!-- R1_Stage3_L11_Attn_TP2&#45;&gt;R1_Stage3_L11_Attn_Output -->
<g id="edge455" class="edge">
<title>R1_Stage3_L11_Attn_TP2&#45;&gt;R1_Stage3_L11_Attn_Output</title>
<path fill="none" stroke="black" d="M43846.62,-2689.77C43846.62,-2689.77 43846.62,-2576.42 43846.62,-2576.42"/>
<polygon fill="black" stroke="black" points="43850.12,-2576.42 43846.62,-2566.42 43843.12,-2576.42 43850.12,-2576.42"/>
</g>
<!-- R1_Stage3_L11_MoE_Input -->
<g id="node298" class="node">
<title>R1_Stage3_L11_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="43405" cy="-2351" rx="225.5" ry="29"/>
<text text-anchor="middle" x="43405" y="-2359.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="43405" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="43405" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Attn_Output&#45;&gt;R1_Stage3_L11_MoE_Input -->
<g id="edge456" class="edge">
<title>R1_Stage3_L11_Attn_Output&#45;&gt;R1_Stage3_L11_MoE_Input</title>
<path fill="none" stroke="black" d="M43525.63,-2511.74C43525.63,-2511.74 43525.63,-2385.66 43525.63,-2385.66"/>
<polygon fill="black" stroke="black" points="43529.13,-2385.66 43525.63,-2375.66 43522.13,-2385.66 43529.13,-2385.66"/>
</g>
<!-- R1_Stage3_L11_Router -->
<g id="node299" class="node">
<title>R1_Stage3_L11_Router</title>
<polygon fill="lightyellow" stroke="black" points="43789.36,-2212 43276.56,-2212 43144.64,-2108 43657.44,-2108 43789.36,-2212"/>
<text text-anchor="middle" x="43467" y="-2174" font-family="Times,serif" font-size="10.00">Router GPU 32</text>
<text text-anchor="middle" x="43467" y="-2163" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="43467" y="-2152" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="43467" y="-2141" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage3_L11_MoE_Input&#45;&gt;R1_Stage3_L11_Router -->
<g id="edge457" class="edge">
<title>R1_Stage3_L11_MoE_Input&#45;&gt;R1_Stage3_L11_Router</title>
<path fill="none" stroke="black" d="M43405,-2321.99C43405,-2321.99 43405,-2222.02 43405,-2222.02"/>
<polygon fill="black" stroke="black" points="43408.5,-2222.02 43405,-2212.02 43401.5,-2222.02 43408.5,-2222.02"/>
</g>
<!-- R1_Stage3_L11_Expert0 -->
<g id="node300" class="node">
<title>R1_Stage3_L11_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="47741,-1998 47481,-1998 47481,-1940 47741,-1940 47741,-1998"/>
<text text-anchor="middle" x="47611" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 32</text>
<text text-anchor="middle" x="47611" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47611" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert0 -->
<g id="edge458" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43755.91,-2159.95C43755.91,-2157.77 43755.91,-2088 43755.91,-2088 43755.91,-2088 47501.33,-2088 47501.33,-2088 47501.33,-2088 47501.33,-2008.11 47501.33,-2008.11"/>
<polygon fill="black" stroke="black" points="47504.83,-2008.11 47501.33,-1998.11 47497.83,-2008.11 47504.83,-2008.11"/>
<text text-anchor="middle" x="45061.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert1 -->
<g id="node301" class="node">
<title>R1_Stage3_L11_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="48037,-1998 47777,-1998 47777,-1940 48037,-1940 48037,-1998"/>
<text text-anchor="middle" x="47907" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 33</text>
<text text-anchor="middle" x="47907" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47907" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert1 -->
<g id="edge459" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43767.08,-2159.95C43767.08,-2157.98 43767.08,-2095 43767.08,-2095 43767.08,-2095 47797.33,-2095 47797.33,-2095 47797.33,-2095 47797.33,-2008.22 47797.33,-2008.22"/>
<polygon fill="black" stroke="black" points="47800.83,-2008.22 47797.33,-1998.22 47793.83,-2008.22 47800.83,-2008.22"/>
<text text-anchor="middle" x="45145.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert2 -->
<g id="node302" class="node">
<title>R1_Stage3_L11_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="43597,-1998 43337,-1998 43337,-1940 43597,-1940 43597,-1998"/>
<text text-anchor="middle" x="43467" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 34</text>
<text text-anchor="middle" x="43467" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="43467" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert2 -->
<g id="edge460" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43467,-2107.81C43467,-2107.81 43467,-2008.01 43467,-2008.01"/>
<polygon fill="black" stroke="black" points="43470.5,-2008.01 43467,-1998.01 43463.5,-2008.01 43470.5,-2008.01"/>
<text text-anchor="middle" x="43488.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert3 -->
<g id="node303" class="node">
<title>R1_Stage3_L11_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="44189,-1998 43929,-1998 43929,-1940 44189,-1940 44189,-1998"/>
<text text-anchor="middle" x="44059" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 35</text>
<text text-anchor="middle" x="44059" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44059" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert3 -->
<g id="edge461" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43666.37,-2115C43822.29,-2115 44012.81,-2115 44012.81,-2115 44012.81,-2115 44012.81,-2008.19 44012.81,-2008.19"/>
<polygon fill="black" stroke="black" points="44016.31,-2008.19 44012.81,-1998.19 44009.31,-2008.19 44016.31,-2008.19"/>
<text text-anchor="middle" x="43836.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert4 -->
<g id="node304" class="node">
<title>R1_Stage3_L11_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="44485,-1998 44225,-1998 44225,-1940 44485,-1940 44485,-1998"/>
<text text-anchor="middle" x="44355" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 36</text>
<text text-anchor="middle" x="44355" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44355" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert4 -->
<g id="edge462" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43676.5,-2123C43892.54,-2123 44198.09,-2123 44198.09,-2123 44198.09,-2123 44198.09,-1969 44198.09,-1969 44198.09,-1969 44214.71,-1969 44214.71,-1969"/>
<polygon fill="black" stroke="black" points="44214.71,-1972.5 44224.71,-1969 44214.71,-1965.5 44214.71,-1972.5"/>
<text text-anchor="middle" x="43957.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert5 -->
<g id="node305" class="node">
<title>R1_Stage3_L11_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="44781,-1998 44521,-1998 44521,-1940 44781,-1940 44781,-1998"/>
<text text-anchor="middle" x="44651" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 37</text>
<text text-anchor="middle" x="44651" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44651" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert5 -->
<g id="edge463" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43644.17,-2107.81C43644.17,-2069.46 43644.17,-2024 43644.17,-2024 43644.17,-2024 44651,-2024 44651,-2024 44651,-2024 44651,-2008.11 44651,-2008.11"/>
<polygon fill="black" stroke="black" points="44654.5,-2008.11 44651,-1998.11 44647.5,-2008.11 44654.5,-2008.11"/>
<text text-anchor="middle" x="44059.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert6 -->
<g id="node306" class="node">
<title>R1_Stage3_L11_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="45077,-1998 44817,-1998 44817,-1940 45077,-1940 45077,-1998"/>
<text text-anchor="middle" x="44947" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 38</text>
<text text-anchor="middle" x="44947" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44947" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert6 -->
<g id="edge464" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43655.35,-2107.87C43655.35,-2071.71 43655.35,-2030 43655.35,-2030 43655.35,-2030 44847.36,-2030 44847.36,-2030 44847.36,-2030 44847.36,-2008.07 44847.36,-2008.07"/>
<polygon fill="black" stroke="black" points="44850.86,-2008.07 44847.36,-1998.07 44843.86,-2008.07 44850.86,-2008.07"/>
<text text-anchor="middle" x="44152.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert7 -->
<g id="node307" class="node">
<title>R1_Stage3_L11_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="45373,-1998 45113,-1998 45113,-1940 45373,-1940 45373,-1998"/>
<text text-anchor="middle" x="45243" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 39</text>
<text text-anchor="middle" x="45243" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45243" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert7 -->
<g id="edge465" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43666.52,-2114.9C43666.52,-2079.79 43666.52,-2037 43666.52,-2037 43666.52,-2037 45133.33,-2037 45133.33,-2037 45133.33,-2037 45133.33,-2008.23 45133.33,-2008.23"/>
<polygon fill="black" stroke="black" points="45136.83,-2008.23 45133.33,-1998.23 45129.83,-2008.23 45136.83,-2008.23"/>
<text text-anchor="middle" x="44241.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert8 -->
<g id="node308" class="node">
<title>R1_Stage3_L11_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="47149,-1998 46889,-1998 46889,-1940 47149,-1940 47149,-1998"/>
<text text-anchor="middle" x="47019" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 40</text>
<text text-anchor="middle" x="47019" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47019" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert8 -->
<g id="edge466" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43733.56,-2159.94C43733.56,-2157.36 43733.56,-2075 43733.56,-2075 43733.56,-2075 46909.33,-2075 46909.33,-2075 46909.33,-2075 46909.33,-2008.25 46909.33,-2008.25"/>
<polygon fill="black" stroke="black" points="46912.83,-2008.25 46909.33,-1998.25 46905.83,-2008.25 46912.83,-2008.25"/>
<text text-anchor="middle" x="44893.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert9 -->
<g id="node309" class="node">
<title>R1_Stage3_L11_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="45669,-1998 45409,-1998 45409,-1940 45669,-1940 45669,-1998"/>
<text text-anchor="middle" x="45539" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 41</text>
<text text-anchor="middle" x="45539" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45539" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert9 -->
<g id="edge467" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43677.69,-2123.94C43677.69,-2089.56 43677.69,-2043 43677.69,-2043 43677.69,-2043 45429.33,-2043 45429.33,-2043 45429.33,-2043 45429.33,-2008.25 45429.33,-2008.25"/>
<polygon fill="black" stroke="black" points="45432.83,-2008.25 45429.33,-1998.25 45425.83,-2008.25 45432.83,-2008.25"/>
<text text-anchor="middle" x="44327.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert10 -->
<g id="node310" class="node">
<title>R1_Stage3_L11_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="45965,-1998 45705,-1998 45705,-1940 45965,-1940 45965,-1998"/>
<text text-anchor="middle" x="45835" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 42</text>
<text text-anchor="middle" x="45835" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45835" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert10 -->
<g id="edge468" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43688.87,-2132.53C43688.87,-2099.94 43688.87,-2050 43688.87,-2050 43688.87,-2050 45725.33,-2050 45725.33,-2050 45725.33,-2050 45725.33,-2008.24 45725.33,-2008.24"/>
<polygon fill="black" stroke="black" points="45728.83,-2008.24 45725.33,-1998.24 45721.83,-2008.24 45728.83,-2008.24"/>
<text text-anchor="middle" x="44412.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert11 -->
<g id="node311" class="node">
<title>R1_Stage3_L11_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="46261,-1998 46001,-1998 46001,-1940 46261,-1940 46261,-1998"/>
<text text-anchor="middle" x="46131" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 43</text>
<text text-anchor="middle" x="46131" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46131" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert11 -->
<g id="edge469" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43700.04,-2141.41C43700.04,-2111.49 43700.04,-2056 43700.04,-2056 43700.04,-2056 46021.33,-2056 46021.33,-2056 46021.33,-2056 46021.33,-2008.45 46021.33,-2008.45"/>
<polygon fill="black" stroke="black" points="46024.83,-2008.45 46021.33,-1998.45 46017.83,-2008.45 46024.83,-2008.45"/>
<text text-anchor="middle" x="44497.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert12 -->
<g id="node312" class="node">
<title>R1_Stage3_L11_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="46557,-1998 46297,-1998 46297,-1940 46557,-1940 46557,-1998"/>
<text text-anchor="middle" x="46427" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 44</text>
<text text-anchor="middle" x="46427" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46427" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert12 -->
<g id="edge470" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43711.22,-2150.25C43711.22,-2125.46 43711.22,-2062 43711.22,-2062 43711.22,-2062 46317.33,-2062 46317.33,-2062 46317.33,-2062 46317.33,-2008.17 46317.33,-2008.17"/>
<polygon fill="black" stroke="black" points="46320.83,-2008.17 46317.33,-1998.17 46313.83,-2008.17 46320.83,-2008.17"/>
<text text-anchor="middle" x="44725.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert13 -->
<g id="node313" class="node">
<title>R1_Stage3_L11_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="43893,-1998 43633,-1998 43633,-1940 43893,-1940 43893,-1998"/>
<text text-anchor="middle" x="43763" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 45</text>
<text text-anchor="middle" x="43763" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="43763" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert13 -->
<g id="edge471" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43778.26,-2159.86C43778.26,-2159.86 43778.26,-2008.01 43778.26,-2008.01"/>
<polygon fill="black" stroke="black" points="43781.76,-2008.01 43778.26,-1998.01 43774.76,-2008.01 43781.76,-2008.01"/>
<text text-anchor="middle" x="43678.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert14 -->
<g id="node314" class="node">
<title>R1_Stage3_L11_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="46853,-1998 46593,-1998 46593,-1940 46853,-1940 46853,-1998"/>
<text text-anchor="middle" x="46723" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 46</text>
<text text-anchor="middle" x="46723" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46723" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert14 -->
<g id="edge472" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43722.39,-2158.98C43722.39,-2148.98 43722.39,-2069 43722.39,-2069 43722.39,-2069 46613.33,-2069 46613.33,-2069 46613.33,-2069 46613.33,-2008.19 46613.33,-2008.19"/>
<polygon fill="black" stroke="black" points="46616.83,-2008.19 46613.33,-1998.19 46609.83,-2008.19 46616.83,-2008.19"/>
<text text-anchor="middle" x="44809.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_Expert15 -->
<g id="node315" class="node">
<title>R1_Stage3_L11_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="47445,-1998 47185,-1998 47185,-1940 47445,-1940 47445,-1998"/>
<text text-anchor="middle" x="47315" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 47</text>
<text text-anchor="middle" x="47315" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47315" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert15 -->
<g id="edge473" class="edge">
<title>R1_Stage3_L11_Router&#45;&gt;R1_Stage3_L11_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43744.74,-2159.94C43744.74,-2157.58 43744.74,-2082 43744.74,-2082 43744.74,-2082 47205.33,-2082 47205.33,-2082 47205.33,-2082 47205.33,-2008.1 47205.33,-2008.1"/>
<polygon fill="black" stroke="black" points="47208.83,-2008.1 47205.33,-1998.1 47201.83,-2008.1 47208.83,-2008.1"/>
<text text-anchor="middle" x="44977.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L11_MoE_Output -->
<g id="node316" class="node">
<title>R1_Stage3_L11_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="48054.95,-1830 47528.48,-1830 47393.05,-1726 47919.52,-1726 48054.95,-1830"/>
<text text-anchor="middle" x="47724" y="-1792" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="47724" y="-1781" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="47724" y="-1770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="47724" y="-1759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L11_Expert0&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge474" class="edge">
<title>R1_Stage3_L11_Expert0&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M47611,-1939.99C47611,-1939.99 47611,-1840.02 47611,-1840.02"/>
<polygon fill="black" stroke="black" points="47614.5,-1840.02 47611,-1830.02 47607.5,-1840.02 47614.5,-1840.02"/>
</g>
<!-- R1_Stage3_L11_Expert1&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge475" class="edge">
<title>R1_Stage3_L11_Expert1&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M47907,-1939.99C47907,-1939.99 47907,-1840.02 47907,-1840.02"/>
<polygon fill="black" stroke="black" points="47910.5,-1840.02 47907,-1830.02 47903.5,-1840.02 47910.5,-1840.02"/>
</g>
<!-- R1_Stage3_L11_Expert2&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge476" class="edge">
<title>R1_Stage3_L11_Expert2&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M43579.67,-1939.67C43579.67,-1894.99 43579.67,-1815 43579.67,-1815 43579.67,-1815 47498.83,-1815 47498.83,-1815"/>
<polygon fill="black" stroke="black" points="47498.83,-1818.5 47508.83,-1815 47498.83,-1811.5 47498.83,-1818.5"/>
</g>
<!-- R1_Stage3_L11_Expert3&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge477" class="edge">
<title>R1_Stage3_L11_Expert3&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M44171.67,-1939.89C44171.67,-1896.01 44171.67,-1818 44171.67,-1818 44171.67,-1818 47502.75,-1818 47502.75,-1818"/>
<polygon fill="black" stroke="black" points="47502.75,-1821.5 47512.75,-1818 47502.75,-1814.5 47502.75,-1821.5"/>
</g>
<!-- R1_Stage3_L11_Expert4&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge478" class="edge">
<title>R1_Stage3_L11_Expert4&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M44467.67,-1939.72C44467.67,-1896.07 44467.67,-1819 44467.67,-1819 44467.67,-1819 47504.1,-1819 47504.1,-1819"/>
<polygon fill="black" stroke="black" points="47504.1,-1822.5 47514.1,-1819 47504.1,-1815.5 47504.1,-1822.5"/>
</g>
<!-- R1_Stage3_L11_Expert5&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge479" class="edge">
<title>R1_Stage3_L11_Expert5&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M44763.67,-1939.92C44763.67,-1896.56 44763.67,-1820 44763.67,-1820 44763.67,-1820 47505.25,-1820 47505.25,-1820"/>
<polygon fill="black" stroke="black" points="47505.25,-1823.5 47515.25,-1820 47505.25,-1816.5 47505.25,-1823.5"/>
</g>
<!-- R1_Stage3_L11_Expert6&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge480" class="edge">
<title>R1_Stage3_L11_Expert6&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M45059.67,-1939.76C45059.67,-1896.63 45059.67,-1821 45059.67,-1821 45059.67,-1821 47506.6,-1821 47506.6,-1821"/>
<polygon fill="black" stroke="black" points="47506.6,-1824.5 47516.6,-1821 47506.6,-1817.5 47506.6,-1824.5"/>
</g>
<!-- R1_Stage3_L11_Expert7&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge481" class="edge">
<title>R1_Stage3_L11_Expert7&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M45355.67,-1939.96C45355.67,-1897.12 45355.67,-1822 45355.67,-1822 45355.67,-1822 47507.97,-1822 47507.97,-1822"/>
<polygon fill="black" stroke="black" points="47507.97,-1825.5 47517.97,-1822 47507.97,-1818.5 47507.97,-1825.5"/>
</g>
<!-- R1_Stage3_L11_Expert8&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge482" class="edge">
<title>R1_Stage3_L11_Expert8&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M47123,-1939.78C47123,-1898.48 47123,-1828 47123,-1828 47123,-1828 47515.54,-1828 47515.54,-1828"/>
<polygon fill="black" stroke="black" points="47515.54,-1831.5 47525.54,-1828 47515.54,-1824.5 47515.54,-1831.5"/>
</g>
<!-- R1_Stage3_L11_Expert9&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge483" class="edge">
<title>R1_Stage3_L11_Expert9&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M45651.67,-1939.81C45651.67,-1897.2 45651.67,-1823 45651.67,-1823 45651.67,-1823 47509.15,-1823 47509.15,-1823"/>
<polygon fill="black" stroke="black" points="47509.15,-1826.5 47519.15,-1823 47509.15,-1819.5 47509.15,-1826.5"/>
</g>
<!-- R1_Stage3_L11_Expert10&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge484" class="edge">
<title>R1_Stage3_L11_Expert10&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M45947.67,-1939.66C45947.67,-1897.29 45947.67,-1824 45947.67,-1824 45947.67,-1824 47510.66,-1824 47510.66,-1824"/>
<polygon fill="black" stroke="black" points="47510.66,-1827.5 47520.66,-1824 47510.66,-1820.5 47510.66,-1827.5"/>
</g>
<!-- R1_Stage3_L11_Expert11&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge485" class="edge">
<title>R1_Stage3_L11_Expert11&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M46243.67,-1939.86C46243.67,-1897.78 46243.67,-1825 46243.67,-1825 46243.67,-1825 47511.66,-1825 47511.66,-1825"/>
<polygon fill="black" stroke="black" points="47511.66,-1828.5 47521.66,-1825 47511.66,-1821.5 47511.66,-1828.5"/>
</g>
<!-- R1_Stage3_L11_Expert12&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge486" class="edge">
<title>R1_Stage3_L11_Expert12&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M46539.67,-1939.72C46539.67,-1897.88 46539.67,-1826 46539.67,-1826 46539.67,-1826 47513.09,-1826 47513.09,-1826"/>
<polygon fill="black" stroke="black" points="47513.09,-1829.5 47523.09,-1826 47513.09,-1822.5 47513.09,-1829.5"/>
</g>
<!-- R1_Stage3_L11_Expert13&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge487" class="edge">
<title>R1_Stage3_L11_Expert13&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M43875.67,-1939.86C43875.67,-1895.47 43875.67,-1816 43875.67,-1816 43875.67,-1816 47500.23,-1816 47500.23,-1816"/>
<polygon fill="black" stroke="black" points="47500.24,-1819.5 47510.23,-1816 47500.23,-1812.5 47500.24,-1819.5"/>
</g>
<!-- R1_Stage3_L11_Expert14&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge488" class="edge">
<title>R1_Stage3_L11_Expert14&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M46827,-1939.92C46827,-1898.38 46827,-1827 46827,-1827 46827,-1827 47514.37,-1827 47514.37,-1827"/>
<polygon fill="black" stroke="black" points="47514.37,-1830.5 47524.37,-1827 47514.37,-1823.5 47514.37,-1830.5"/>
</g>
<!-- R1_Stage3_L11_Expert15&#45;&gt;R1_Stage3_L11_MoE_Output -->
<g id="edge489" class="edge">
<title>R1_Stage3_L11_Expert15&#45;&gt;R1_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M47419.14,-1939.99C47419.14,-1939.99 47419.14,-1788.08 47419.14,-1788.08"/>
<polygon fill="black" stroke="black" points="47422.64,-1788.08 47419.14,-1778.08 47415.64,-1788.08 47422.64,-1788.08"/>
</g>
<!-- R1_Stage3_L11_MoE_Output&#45;&gt;R1_Stage3_L11_Output -->
<g id="edge490" class="edge">
<title>R1_Stage3_L11_MoE_Output&#45;&gt;R1_Stage3_L11_Output</title>
<path fill="none" stroke="black" d="M47884.61,-1725.85C47884.61,-1725.85 47884.61,-1639.21 47884.61,-1639.21"/>
<polygon fill="black" stroke="black" points="47888.11,-1639.21 47884.61,-1629.21 47881.11,-1639.21 47888.11,-1639.21"/>
</g>
<!-- R1_Stage3_L12_Input -->
<g id="node317" class="node">
<title>R1_Stage3_L12_Input</title>
<ellipse fill="lightblue" stroke="black" cx="43040" cy="-2896" rx="225.5" ry="29"/>
<text text-anchor="middle" x="43040" y="-2904.5" font-family="Times,serif" font-size="10.00">Layer 12 Input</text>
<text text-anchor="middle" x="43040" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="43040" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Attn_Input -->
<g id="node318" class="node">
<title>R1_Stage3_L12_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="43040" cy="-2719" rx="225.5" ry="29"/>
<text text-anchor="middle" x="43040" y="-2727.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="43040" y="-2716.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="43040" y="-2705.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Input&#45;&gt;R1_Stage3_L12_Attn_Input -->
<g id="edge491" class="edge">
<title>R1_Stage3_L12_Input&#45;&gt;R1_Stage3_L12_Attn_Input</title>
<path fill="none" stroke="black" d="M43040,-2866.77C43040,-2866.77 43040,-2758.27 43040,-2758.27"/>
<polygon fill="black" stroke="black" points="43043.5,-2758.27 43040,-2748.27 43036.5,-2758.27 43043.5,-2758.27"/>
</g>
<!-- R1_Stage3_L12_Attn_TP1 -->
<g id="node319" class="node">
<title>R1_Stage3_L12_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="43003,-2571 42657,-2571 42657,-2513 43003,-2513 43003,-2571"/>
<text text-anchor="middle" x="42830" y="-2556" font-family="Times,serif" font-size="10.00">Attention TP GPU 32</text>
<text text-anchor="middle" x="42830" y="-2545" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="42830" y="-2534" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="42830" y="-2523" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage3_L12_Attn_Input&#45;&gt;R1_Stage3_L12_Attn_TP1 -->
<g id="edge492" class="edge">
<title>R1_Stage3_L12_Attn_Input&#45;&gt;R1_Stage3_L12_Attn_TP1</title>
<path fill="none" stroke="black" d="M42908.75,-2695.13C42908.75,-2695.13 42908.75,-2581.07 42908.75,-2581.07"/>
<polygon fill="black" stroke="black" points="42912.25,-2581.07 42908.75,-2571.07 42905.25,-2581.07 42912.25,-2581.07"/>
</g>
<!-- R1_Stage3_L12_Attn_TP2 -->
<g id="node320" class="node">
<title>R1_Stage3_L12_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="43385,-2571 43039,-2571 43039,-2513 43385,-2513 43385,-2571"/>
<text text-anchor="middle" x="43212" y="-2556" font-family="Times,serif" font-size="10.00">Attention TP GPU 33</text>
<text text-anchor="middle" x="43212" y="-2545" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="43212" y="-2534" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="43212" y="-2523" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage3_L12_Attn_Input&#45;&gt;R1_Stage3_L12_Attn_TP2 -->
<g id="edge493" class="edge">
<title>R1_Stage3_L12_Attn_Input&#45;&gt;R1_Stage3_L12_Attn_TP2</title>
<path fill="none" stroke="black" d="M43152.25,-2693.64C43152.25,-2693.64 43152.25,-2581.14 43152.25,-2581.14"/>
<polygon fill="black" stroke="black" points="43155.75,-2581.14 43152.25,-2571.14 43148.75,-2581.14 43155.75,-2581.14"/>
</g>
<!-- R1_Stage3_L12_Attn_Output -->
<g id="node321" class="node">
<title>R1_Stage3_L12_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="42900" cy="-2351" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="42900" y="-2365" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="42900" y="-2354" font-family="Times,serif" font-size="10.00">AllReduce GPUs 32&#45;33</text>
<text text-anchor="middle" x="42900" y="-2343" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="42900" y="-2332" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Attn_TP1&#45;&gt;R1_Stage3_L12_Attn_Output -->
<g id="edge494" class="edge">
<title>R1_Stage3_L12_Attn_TP1&#45;&gt;R1_Stage3_L12_Attn_Output</title>
<path fill="none" stroke="black" d="M42830,-2512.99C42830,-2512.99 42830,-2396.47 42830,-2396.47"/>
<polygon fill="black" stroke="black" points="42833.5,-2396.47 42830,-2386.47 42826.5,-2396.47 42833.5,-2396.47"/>
</g>
<!-- R1_Stage3_L12_Attn_TP2&#45;&gt;R1_Stage3_L12_Attn_Output -->
<g id="edge495" class="edge">
<title>R1_Stage3_L12_Attn_TP2&#45;&gt;R1_Stage3_L12_Attn_Output</title>
<path fill="none" stroke="black" d="M43091.12,-2512.99C43091.12,-2512.99 43091.12,-2383.97 43091.12,-2383.97"/>
<polygon fill="black" stroke="black" points="43094.62,-2383.97 43091.12,-2373.97 43087.62,-2383.97 43094.62,-2383.97"/>
</g>
<!-- R1_Stage3_L12_MoE_Input -->
<g id="node322" class="node">
<title>R1_Stage3_L12_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="42883" cy="-2160" rx="225.5" ry="29"/>
<text text-anchor="middle" x="42883" y="-2168.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="42883" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="42883" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Attn_Output&#45;&gt;R1_Stage3_L12_MoE_Input -->
<g id="edge496" class="edge">
<title>R1_Stage3_L12_Attn_Output&#45;&gt;R1_Stage3_L12_MoE_Input</title>
<path fill="none" stroke="black" d="M42883,-2314.17C42883,-2314.17 42883,-2199.22 42883,-2199.22"/>
<polygon fill="black" stroke="black" points="42886.5,-2199.22 42883,-2189.22 42879.5,-2199.22 42886.5,-2199.22"/>
</g>
<!-- R1_Stage3_L12_Router -->
<g id="node323" class="node">
<title>R1_Stage3_L12_Router</title>
<polygon fill="lightyellow" stroke="black" points="43301.36,-2021 42788.56,-2021 42656.64,-1917 43169.44,-1917 43301.36,-2021"/>
<text text-anchor="middle" x="42979" y="-1983" font-family="Times,serif" font-size="10.00">Router GPU 32</text>
<text text-anchor="middle" x="42979" y="-1972" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="42979" y="-1961" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="42979" y="-1950" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage3_L12_MoE_Input&#45;&gt;R1_Stage3_L12_Router -->
<g id="edge497" class="edge">
<title>R1_Stage3_L12_MoE_Input&#45;&gt;R1_Stage3_L12_Router</title>
<path fill="none" stroke="black" d="M42883,-2130.99C42883,-2130.99 42883,-2031.02 42883,-2031.02"/>
<polygon fill="black" stroke="black" points="42886.5,-2031.02 42883,-2021.02 42879.5,-2031.02 42886.5,-2031.02"/>
</g>
<!-- R1_Stage3_L12_Expert0 -->
<g id="node324" class="node">
<title>R1_Stage3_L12_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="45285,-1807 45025,-1807 45025,-1749 45285,-1749 45285,-1807"/>
<text text-anchor="middle" x="45155" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 32</text>
<text text-anchor="middle" x="45155" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45155" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert0 -->
<g id="edge498" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43184.86,-1929C43707.09,-1929 45042.33,-1929 45042.33,-1929 45042.33,-1929 45042.33,-1817.11 45042.33,-1817.11"/>
<polygon fill="black" stroke="black" points="45045.83,-1817.11 45042.33,-1807.11 45038.83,-1817.11 45045.83,-1817.11"/>
<text text-anchor="middle" x="43885.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert1 -->
<g id="node325" class="node">
<title>R1_Stage3_L12_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="45581,-1807 45321,-1807 45321,-1749 45581,-1749 45581,-1807"/>
<text text-anchor="middle" x="45451" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 33</text>
<text text-anchor="middle" x="45451" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45451" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert1 -->
<g id="edge499" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43187.34,-1931C43763.91,-1931 45338.33,-1931 45338.33,-1931 45338.33,-1931 45338.33,-1817.14 45338.33,-1817.14"/>
<polygon fill="black" stroke="black" points="45341.83,-1817.14 45338.33,-1807.14 45334.83,-1817.14 45341.83,-1817.14"/>
<text text-anchor="middle" x="43970.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert2 -->
<g id="node326" class="node">
<title>R1_Stage3_L12_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="45877,-1807 45617,-1807 45617,-1749 45877,-1749 45877,-1807"/>
<text text-anchor="middle" x="45747" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 34</text>
<text text-anchor="middle" x="45747" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="45747" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert2 -->
<g id="edge500" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43188.75,-1932C43816.01,-1932 45634.33,-1932 45634.33,-1932 45634.33,-1932 45634.33,-1817.33 45634.33,-1817.33"/>
<polygon fill="black" stroke="black" points="45637.83,-1817.33 45634.33,-1807.33 45630.83,-1817.33 45637.83,-1817.33"/>
<text text-anchor="middle" x="44055.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert3 -->
<g id="node327" class="node">
<title>R1_Stage3_L12_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="46173,-1807 45913,-1807 45913,-1749 46173,-1749 46173,-1807"/>
<text text-anchor="middle" x="46043" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 35</text>
<text text-anchor="middle" x="46043" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46043" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert3 -->
<g id="edge501" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43191.25,-1934C43867.97,-1934 45930.33,-1934 45930.33,-1934 45930.33,-1934 45930.33,-1817.34 45930.33,-1817.34"/>
<polygon fill="black" stroke="black" points="45933.83,-1817.34 45930.33,-1807.34 45926.83,-1817.34 45933.83,-1817.34"/>
<text text-anchor="middle" x="44139.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert4 -->
<g id="node328" class="node">
<title>R1_Stage3_L12_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="46469,-1807 46209,-1807 46209,-1749 46469,-1749 46469,-1807"/>
<text text-anchor="middle" x="46339" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 36</text>
<text text-anchor="middle" x="46339" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46339" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert4 -->
<g id="edge502" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43193.64,-1936C43917.85,-1936 46226.33,-1936 46226.33,-1936 46226.33,-1936 46226.33,-1817.35 46226.33,-1817.35"/>
<polygon fill="black" stroke="black" points="46229.83,-1817.35 46226.33,-1807.35 46222.83,-1817.35 46229.83,-1817.35"/>
<text text-anchor="middle" x="44223.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert5 -->
<g id="node329" class="node">
<title>R1_Stage3_L12_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="46765,-1807 46505,-1807 46505,-1749 46765,-1749 46765,-1807"/>
<text text-anchor="middle" x="46635" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 37</text>
<text text-anchor="middle" x="46635" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46635" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert5 -->
<g id="edge503" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43196.31,-1938C43966.83,-1938 46522.33,-1938 46522.33,-1938 46522.33,-1938 46522.33,-1817.35 46522.33,-1817.35"/>
<polygon fill="black" stroke="black" points="46525.83,-1817.35 46522.33,-1807.35 46518.83,-1817.35 46525.83,-1817.35"/>
<text text-anchor="middle" x="44307.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert6 -->
<g id="node330" class="node">
<title>R1_Stage3_L12_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="47061,-1807 46801,-1807 46801,-1749 47061,-1749 47061,-1807"/>
<text text-anchor="middle" x="46931" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 38</text>
<text text-anchor="middle" x="46931" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="46931" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert6 -->
<g id="edge504" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43273.53,-1999C44180.61,-1999 46871,-1999 46871,-1999 46871,-1999 46871,-1817.35 46871,-1817.35"/>
<polygon fill="black" stroke="black" points="46874.5,-1817.35 46871,-1807.35 46867.5,-1817.35 46874.5,-1817.35"/>
<text text-anchor="middle" x="44391.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert7 -->
<g id="node331" class="node">
<title>R1_Stage3_L12_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="47357,-1807 47097,-1807 47097,-1749 47357,-1749 47357,-1807"/>
<text text-anchor="middle" x="47227" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 39</text>
<text text-anchor="middle" x="47227" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="47227" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert7 -->
<g id="edge505" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43276,-2001C44231.91,-2001 47167,-2001 47167,-2001 47167,-2001 47167,-1817.15 47167,-1817.15"/>
<polygon fill="black" stroke="black" points="47170.5,-1817.15 47167,-1807.15 47163.5,-1817.15 47170.5,-1817.15"/>
<text text-anchor="middle" x="44475.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert8 -->
<g id="node332" class="node">
<title>R1_Stage3_L12_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="42917,-1807 42657,-1807 42657,-1749 42917,-1749 42917,-1807"/>
<text text-anchor="middle" x="42787" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 40</text>
<text text-anchor="middle" x="42787" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="42787" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert8 -->
<g id="edge506" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M42787,-1916.81C42787,-1916.81 42787,-1817.01 42787,-1817.01"/>
<polygon fill="black" stroke="black" points="42790.5,-1817.01 42787,-1807.01 42783.5,-1817.01 42790.5,-1817.01"/>
<text text-anchor="middle" x="42862.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert9 -->
<g id="node333" class="node">
<title>R1_Stage3_L12_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="43213,-1807 42953,-1807 42953,-1749 43213,-1749 43213,-1807"/>
<text text-anchor="middle" x="43083" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 41</text>
<text text-anchor="middle" x="43083" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="43083" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert9 -->
<g id="edge507" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43083,-1916.81C43083,-1916.81 43083,-1817.01 43083,-1817.01"/>
<polygon fill="black" stroke="black" points="43086.5,-1817.01 43083,-1807.01 43079.5,-1817.01 43086.5,-1817.01"/>
<text text-anchor="middle" x="43052.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert10 -->
<g id="node334" class="node">
<title>R1_Stage3_L12_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="43509,-1807 43249,-1807 43249,-1749 43509,-1749 43509,-1807"/>
<text text-anchor="middle" x="43379" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 42</text>
<text text-anchor="middle" x="43379" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="43379" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert10 -->
<g id="edge508" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43275.22,-1968.86C43275.22,-1968.86 43275.22,-1817.01 43275.22,-1817.01"/>
<polygon fill="black" stroke="black" points="43278.72,-1817.01 43275.22,-1807.01 43271.72,-1817.01 43278.72,-1817.01"/>
<text text-anchor="middle" x="43201.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert11 -->
<g id="node335" class="node">
<title>R1_Stage3_L12_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="43805,-1807 43545,-1807 43545,-1749 43805,-1749 43805,-1807"/>
<text text-anchor="middle" x="43675" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 43</text>
<text text-anchor="middle" x="43675" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="43675" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert11 -->
<g id="edge509" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43173.65,-1920C43343.28,-1920 43562.33,-1920 43562.33,-1920 43562.33,-1920 43562.33,-1817.08 43562.33,-1817.08"/>
<polygon fill="black" stroke="black" points="43565.83,-1817.08 43562.33,-1807.08 43558.83,-1817.08 43565.83,-1817.08"/>
<text text-anchor="middle" x="43317.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert12 -->
<g id="node336" class="node">
<title>R1_Stage3_L12_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="44101,-1807 43841,-1807 43841,-1749 44101,-1749 44101,-1807"/>
<text text-anchor="middle" x="43971" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 44</text>
<text text-anchor="middle" x="43971" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="43971" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert12 -->
<g id="edge510" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43175.79,-1922C43435,-1922 43858.33,-1922 43858.33,-1922 43858.33,-1922 43858.33,-1817.14 43858.33,-1817.14"/>
<polygon fill="black" stroke="black" points="43861.83,-1817.14 43858.33,-1807.14 43854.83,-1817.14 43861.83,-1817.14"/>
<text text-anchor="middle" x="43519.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert13 -->
<g id="node337" class="node">
<title>R1_Stage3_L12_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="44397,-1807 44137,-1807 44137,-1749 44397,-1749 44397,-1807"/>
<text text-anchor="middle" x="44267" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 45</text>
<text text-anchor="middle" x="44267" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44267" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert13 -->
<g id="edge511" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43178.38,-1924C43513.71,-1924 44154.33,-1924 44154.33,-1924 44154.33,-1924 44154.33,-1817.19 44154.33,-1817.19"/>
<polygon fill="black" stroke="black" points="44157.83,-1817.19 44154.33,-1807.19 44150.83,-1817.19 44157.83,-1817.19"/>
<text text-anchor="middle" x="43619.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert14 -->
<g id="node338" class="node">
<title>R1_Stage3_L12_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="44693,-1807 44433,-1807 44433,-1749 44693,-1749 44693,-1807"/>
<text text-anchor="middle" x="44563" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 46</text>
<text text-anchor="middle" x="44563" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44563" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert14 -->
<g id="edge512" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43179.73,-1925C43582.36,-1925 44450.33,-1925 44450.33,-1925 44450.33,-1925 44450.33,-1817.04 44450.33,-1817.04"/>
<polygon fill="black" stroke="black" points="44453.83,-1817.04 44450.33,-1807.04 44446.83,-1817.04 44453.83,-1817.04"/>
<text text-anchor="middle" x="43711.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_Expert15 -->
<g id="node339" class="node">
<title>R1_Stage3_L12_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="44989,-1807 44729,-1807 44729,-1749 44989,-1749 44989,-1807"/>
<text text-anchor="middle" x="44859" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 47</text>
<text text-anchor="middle" x="44859" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="44859" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert15 -->
<g id="edge513" class="edge">
<title>R1_Stage3_L12_Router&#45;&gt;R1_Stage3_L12_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M43182.17,-1927C43646.64,-1927 44746.33,-1927 44746.33,-1927 44746.33,-1927 44746.33,-1817.08 44746.33,-1817.08"/>
<polygon fill="black" stroke="black" points="44749.83,-1817.08 44746.33,-1807.08 44742.83,-1817.08 44749.83,-1817.08"/>
<text text-anchor="middle" x="43799.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage3_L12_MoE_Output -->
<g id="node340" class="node">
<title>R1_Stage3_L12_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="45485.95,-1653 44959.48,-1653 44824.05,-1549 45350.52,-1549 45485.95,-1653"/>
<text text-anchor="middle" x="45155" y="-1615" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="45155" y="-1604" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="45155" y="-1593" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="45155" y="-1582" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage3_L12_Expert0&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge514" class="edge">
<title>R1_Stage3_L12_Expert0&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M45155,-1748.77C45155,-1748.77 45155,-1663.18 45155,-1663.18"/>
<polygon fill="black" stroke="black" points="45158.5,-1663.18 45155,-1653.18 45151.5,-1663.18 45158.5,-1663.18"/>
</g>
<!-- R1_Stage3_L12_Expert1&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge515" class="edge">
<title>R1_Stage3_L12_Expert1&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M45403.36,-1748.77C45403.36,-1748.77 45403.36,-1663.18 45403.36,-1663.18"/>
<polygon fill="black" stroke="black" points="45406.86,-1663.18 45403.36,-1653.18 45399.86,-1663.18 45406.86,-1663.18"/>
</g>
<!-- R1_Stage3_L12_Expert2&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge516" class="edge">
<title>R1_Stage3_L12_Expert2&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M45747,-1748.95C45747,-1711.19 45747,-1650 45747,-1650 45747,-1650 45492.17,-1650 45492.17,-1650"/>
<polygon fill="black" stroke="black" points="45492.17,-1646.5 45482.17,-1650 45492.17,-1653.5 45492.17,-1646.5"/>
</g>
<!-- R1_Stage3_L12_Expert3&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge517" class="edge">
<title>R1_Stage3_L12_Expert3&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M46043,-1748.83C46043,-1710.5 46043,-1648 46043,-1648 46043,-1648 45489.67,-1648 45489.67,-1648"/>
<polygon fill="black" stroke="black" points="45489.67,-1644.5 45479.67,-1648 45489.67,-1651.5 45489.67,-1644.5"/>
</g>
<!-- R1_Stage3_L12_Expert4&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge518" class="edge">
<title>R1_Stage3_L12_Expert4&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M46339,-1748.7C46339,-1709.82 46339,-1646 46339,-1646 46339,-1646 45486.97,-1646 45486.97,-1646"/>
<polygon fill="black" stroke="black" points="45486.97,-1642.5 45476.97,-1646 45486.97,-1649.5 45486.97,-1642.5"/>
</g>
<!-- R1_Stage3_L12_Expert5&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge519" class="edge">
<title>R1_Stage3_L12_Expert5&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M46635,-1748.92C46635,-1709.51 46635,-1644 46635,-1644 46635,-1644 45484.32,-1644 45484.32,-1644"/>
<polygon fill="black" stroke="black" points="45484.32,-1640.5 45474.32,-1644 45484.32,-1647.5 45484.32,-1640.5"/>
</g>
<!-- R1_Stage3_L12_Expert6&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge520" class="edge">
<title>R1_Stage3_L12_Expert6&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M46931,-1748.82C46931,-1708.86 46931,-1642 46931,-1642 46931,-1642 45481.75,-1642 45481.75,-1642"/>
<polygon fill="black" stroke="black" points="45481.75,-1638.5 45471.75,-1642 45481.75,-1645.5 45481.75,-1638.5"/>
</g>
<!-- R1_Stage3_L12_Expert7&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge521" class="edge">
<title>R1_Stage3_L12_Expert7&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M47227,-1748.86C47227,-1708.1 47227,-1639 47227,-1639 47227,-1639 45477.72,-1639 45477.72,-1639"/>
<polygon fill="black" stroke="black" points="45477.72,-1635.5 45467.72,-1639 45477.72,-1642.5 45477.72,-1635.5"/>
</g>
<!-- R1_Stage3_L12_Expert8&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge522" class="edge">
<title>R1_Stage3_L12_Expert8&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M42787,-1748.99C42787,-1707.99 42787,-1638 42787,-1638 42787,-1638 44929.89,-1638 44929.89,-1638"/>
<polygon fill="black" stroke="black" points="44929.89,-1641.5 44939.89,-1638 44929.89,-1634.5 44929.89,-1641.5"/>
</g>
<!-- R1_Stage3_L12_Expert9&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge523" class="edge">
<title>R1_Stage3_L12_Expert9&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M43083,-1748.86C43083,-1708.1 43083,-1639 43083,-1639 43083,-1639 44931.06,-1639 44931.06,-1639"/>
<polygon fill="black" stroke="black" points="44931.06,-1642.5 44941.06,-1639 44931.06,-1635.5 44931.06,-1642.5"/>
</g>
<!-- R1_Stage3_L12_Expert10&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge524" class="edge">
<title>R1_Stage3_L12_Expert10&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M43379,-1748.95C43379,-1708.73 43379,-1641 43379,-1641 43379,-1641 44933.86,-1641 44933.86,-1641"/>
<polygon fill="black" stroke="black" points="44933.86,-1644.5 44943.86,-1641 44933.86,-1637.5 44933.86,-1644.5"/>
</g>
<!-- R1_Stage3_L12_Expert11&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge525" class="edge">
<title>R1_Stage3_L12_Expert11&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M43675,-1748.82C43675,-1708.86 43675,-1642 43675,-1642 43675,-1642 44934.92,-1642 44934.92,-1642"/>
<polygon fill="black" stroke="black" points="44934.92,-1645.5 44944.92,-1642 44934.92,-1638.5 44934.92,-1645.5"/>
</g>
<!-- R1_Stage3_L12_Expert12&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge526" class="edge">
<title>R1_Stage3_L12_Expert12&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M43971,-1748.71C43971,-1709 43971,-1643 43971,-1643 43971,-1643 44936.39,-1643 44936.39,-1643"/>
<polygon fill="black" stroke="black" points="44936.39,-1646.5 44946.39,-1643 44936.39,-1639.5 44936.39,-1646.5"/>
</g>
<!-- R1_Stage3_L12_Expert13&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge527" class="edge">
<title>R1_Stage3_L12_Expert13&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M44267,-1748.92C44267,-1709.51 44267,-1644 44267,-1644 44267,-1644 44937.64,-1644 44937.64,-1644"/>
<polygon fill="black" stroke="black" points="44937.64,-1647.5 44947.64,-1644 44937.64,-1640.5 44937.64,-1647.5"/>
</g>
<!-- R1_Stage3_L12_Expert14&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge528" class="edge">
<title>R1_Stage3_L12_Expert14&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M44563,-1748.81C44563,-1709.66 44563,-1645 44563,-1645 44563,-1645 44938.78,-1645 44938.78,-1645"/>
<polygon fill="black" stroke="black" points="44938.78,-1648.5 44948.78,-1645 44938.78,-1641.5 44938.78,-1648.5"/>
</g>
<!-- R1_Stage3_L12_Expert15&#45;&gt;R1_Stage3_L12_MoE_Output -->
<g id="edge529" class="edge">
<title>R1_Stage3_L12_Expert15&#45;&gt;R1_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M44906.64,-1748.77C44906.64,-1748.77 44906.64,-1622.66 44906.64,-1622.66"/>
<polygon fill="black" stroke="black" points="44910.14,-1622.66 44906.64,-1612.66 44903.14,-1622.66 44910.14,-1622.66"/>
</g>
<!-- R1_Stage3_L12_MoE_Output&#45;&gt;R1_Stage3_L12_Output -->
<g id="edge530" class="edge">
<title>R1_Stage3_L12_MoE_Output&#45;&gt;R1_Stage3_L12_Output</title>
<path fill="none" stroke="black" d="M45359.79,-1556C45991.08,-1556 47864.83,-1556 47864.83,-1556 47864.83,-1556 47864.83,-1461.35 47864.83,-1461.35"/>
<polygon fill="black" stroke="black" points="47868.33,-1461.35 47864.83,-1451.35 47861.33,-1461.35 47868.33,-1461.35"/>
</g>
<!-- R1_Stage4_L13_Input -->
<g id="node341" class="node">
<title>R1_Stage4_L13_Input</title>
<ellipse fill="lightblue" stroke="black" cx="52970" cy="-2351" rx="225.5" ry="29"/>
<text text-anchor="middle" x="52970" y="-2359.5" font-family="Times,serif" font-size="10.00">Layer 13 Input</text>
<text text-anchor="middle" x="52970" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="52970" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Attn_Input -->
<g id="node342" class="node">
<title>R1_Stage4_L13_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="52970" cy="-2160" rx="225.5" ry="29"/>
<text text-anchor="middle" x="52970" y="-2168.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="52970" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="52970" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Input&#45;&gt;R1_Stage4_L13_Attn_Input -->
<g id="edge531" class="edge">
<title>R1_Stage4_L13_Input&#45;&gt;R1_Stage4_L13_Attn_Input</title>
<path fill="none" stroke="black" d="M52970,-2321.99C52970,-2321.99 52970,-2199.28 52970,-2199.28"/>
<polygon fill="black" stroke="black" points="52973.5,-2199.28 52970,-2189.28 52966.5,-2199.28 52973.5,-2199.28"/>
</g>
<!-- R1_Stage4_L13_Attn_TP1 -->
<g id="node343" class="node">
<title>R1_Stage4_L13_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="52999,-1998 52653,-1998 52653,-1940 52999,-1940 52999,-1998"/>
<text text-anchor="middle" x="52826" y="-1983" font-family="Times,serif" font-size="10.00">Attention TP GPU 48</text>
<text text-anchor="middle" x="52826" y="-1972" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="52826" y="-1961" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="52826" y="-1950" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage4_L13_Attn_Input&#45;&gt;R1_Stage4_L13_Attn_TP1 -->
<g id="edge532" class="edge">
<title>R1_Stage4_L13_Attn_Input&#45;&gt;R1_Stage4_L13_Attn_TP1</title>
<path fill="none" stroke="black" d="M52871.75,-2133.84C52871.75,-2133.84 52871.75,-2008.28 52871.75,-2008.28"/>
<polygon fill="black" stroke="black" points="52875.25,-2008.28 52871.75,-1998.28 52868.25,-2008.28 52875.25,-2008.28"/>
</g>
<!-- R1_Stage4_L13_Attn_TP2 -->
<g id="node344" class="node">
<title>R1_Stage4_L13_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="53381,-1998 53035,-1998 53035,-1940 53381,-1940 53381,-1998"/>
<text text-anchor="middle" x="53208" y="-1983" font-family="Times,serif" font-size="10.00">Attention TP GPU 49</text>
<text text-anchor="middle" x="53208" y="-1972" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="53208" y="-1961" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="53208" y="-1950" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage4_L13_Attn_Input&#45;&gt;R1_Stage4_L13_Attn_TP2 -->
<g id="edge533" class="edge">
<title>R1_Stage4_L13_Attn_Input&#45;&gt;R1_Stage4_L13_Attn_TP2</title>
<path fill="none" stroke="black" d="M53115.25,-2137.72C53115.25,-2137.72 53115.25,-2008.31 53115.25,-2008.31"/>
<polygon fill="black" stroke="black" points="53118.75,-2008.31 53115.25,-1998.31 53111.75,-2008.31 53118.75,-2008.31"/>
</g>
<!-- R1_Stage4_L13_Attn_Output -->
<g id="node345" class="node">
<title>R1_Stage4_L13_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="52972" cy="-1778" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="52972" y="-1792" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="52972" y="-1781" font-family="Times,serif" font-size="10.00">AllReduce GPUs 48&#45;49</text>
<text text-anchor="middle" x="52972" y="-1770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="52972" y="-1759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Attn_TP1&#45;&gt;R1_Stage4_L13_Attn_Output -->
<g id="edge534" class="edge">
<title>R1_Stage4_L13_Attn_TP1&#45;&gt;R1_Stage4_L13_Attn_Output</title>
<path fill="none" stroke="black" d="M52863.88,-1939.99C52863.88,-1939.99 52863.88,-1821.14 52863.88,-1821.14"/>
<polygon fill="black" stroke="black" points="52867.38,-1821.14 52863.88,-1811.14 52860.38,-1821.14 52867.38,-1821.14"/>
</g>
<!-- R1_Stage4_L13_Attn_TP2&#45;&gt;R1_Stage4_L13_Attn_Output -->
<g id="edge535" class="edge">
<title>R1_Stage4_L13_Attn_TP2&#45;&gt;R1_Stage4_L13_Attn_Output</title>
<path fill="none" stroke="black" d="M53125.12,-1939.99C53125.12,-1939.99 53125.12,-1816.66 53125.12,-1816.66"/>
<polygon fill="black" stroke="black" points="53128.62,-1816.66 53125.12,-1806.66 53121.62,-1816.66 53128.62,-1816.66"/>
</g>
<!-- R1_Stage4_L13_MoE_Input -->
<g id="node346" class="node">
<title>R1_Stage4_L13_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="52972" cy="-1601" rx="225.5" ry="29"/>
<text text-anchor="middle" x="52972" y="-1609.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="52972" y="-1598.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="52972" y="-1587.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Attn_Output&#45;&gt;R1_Stage4_L13_MoE_Input -->
<g id="edge536" class="edge">
<title>R1_Stage4_L13_Attn_Output&#45;&gt;R1_Stage4_L13_MoE_Input</title>
<path fill="none" stroke="black" d="M52972,-1740.89C52972,-1740.89 52972,-1640.17 52972,-1640.17"/>
<polygon fill="black" stroke="black" points="52975.5,-1640.17 52972,-1630.17 52968.5,-1640.17 52975.5,-1640.17"/>
</g>
<!-- R1_Stage4_L13_Router -->
<g id="node347" class="node">
<title>R1_Stage4_L13_Router</title>
<polygon fill="lightyellow" stroke="black" points="53294.36,-1476 52781.56,-1476 52649.64,-1372 53162.44,-1372 53294.36,-1476"/>
<text text-anchor="middle" x="52972" y="-1438" font-family="Times,serif" font-size="10.00">Router GPU 48</text>
<text text-anchor="middle" x="52972" y="-1427" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="52972" y="-1416" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="52972" y="-1405" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage4_L13_MoE_Input&#45;&gt;R1_Stage4_L13_Router -->
<g id="edge537" class="edge">
<title>R1_Stage4_L13_MoE_Input&#45;&gt;R1_Stage4_L13_Router</title>
<path fill="none" stroke="black" d="M52972,-1571.77C52972,-1571.77 52972,-1486.18 52972,-1486.18"/>
<polygon fill="black" stroke="black" points="52975.5,-1486.18 52972,-1476.18 52968.5,-1486.18 52975.5,-1486.18"/>
</g>
<!-- R1_Stage4_L13_Expert0 -->
<g id="node348" class="node">
<title>R1_Stage4_L13_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="55052,-1262 54792,-1262 54792,-1204 55052,-1204 55052,-1262"/>
<text text-anchor="middle" x="54922" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 48</text>
<text text-anchor="middle" x="54922" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54922" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert0 -->
<g id="edge538" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M53183,-1388C53687.52,-1388 54922,-1388 54922,-1388 54922,-1388 54922,-1272.15 54922,-1272.15"/>
<polygon fill="black" stroke="black" points="54925.5,-1272.15 54922,-1262.15 54918.5,-1272.15 54925.5,-1272.15"/>
<text text-anchor="middle" x="54731.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert1 -->
<g id="node349" class="node">
<title>R1_Stage4_L13_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="55348,-1262 55088,-1262 55088,-1204 55348,-1204 55348,-1262"/>
<text text-anchor="middle" x="55218" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 49</text>
<text text-anchor="middle" x="55218" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="55218" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert1 -->
<g id="edge539" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M53186.59,-1391C53748.18,-1391 55218,-1391 55218,-1391 55218,-1391 55218,-1272.35 55218,-1272.35"/>
<polygon fill="black" stroke="black" points="55221.5,-1272.35 55218,-1262.35 55214.5,-1272.35 55221.5,-1272.35"/>
<text text-anchor="middle" x="55027.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert2 -->
<g id="node350" class="node">
<title>R1_Stage4_L13_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="50908,-1262 50648,-1262 50648,-1204 50908,-1204 50908,-1262"/>
<text text-anchor="middle" x="50778" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 50</text>
<text text-anchor="middle" x="50778" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="50778" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert2 -->
<g id="edge540" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M52664.6,-1384C52087.19,-1384 50898.12,-1384 50898.12,-1384 50898.12,-1384 50898.12,-1272.11 50898.12,-1272.11"/>
<polygon fill="black" stroke="black" points="50901.62,-1272.11 50898.12,-1262.11 50894.62,-1272.11 50901.62,-1272.11"/>
<text text-anchor="middle" x="51010.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert3 -->
<g id="node351" class="node">
<title>R1_Stage4_L13_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="51204,-1262 50944,-1262 50944,-1204 51204,-1204 51204,-1262"/>
<text text-anchor="middle" x="51074" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 51</text>
<text text-anchor="middle" x="51074" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51074" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert3 -->
<g id="edge541" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M52662.14,-1382C52143.18,-1382 51154.5,-1382 51154.5,-1382 51154.5,-1382 51154.5,-1272.08 51154.5,-1272.08"/>
<polygon fill="black" stroke="black" points="51158,-1272.08 51154.5,-1262.08 51151,-1272.08 51158,-1272.08"/>
<text text-anchor="middle" x="51305.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert4 -->
<g id="node352" class="node">
<title>R1_Stage4_L13_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="51500,-1262 51240,-1262 51240,-1204 51500,-1204 51500,-1262"/>
<text text-anchor="middle" x="51370" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 52</text>
<text text-anchor="middle" x="51370" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51370" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert4 -->
<g id="edge542" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M52659.32,-1380C52193.1,-1380 51370,-1380 51370,-1380 51370,-1380 51370,-1272.04 51370,-1272.04"/>
<polygon fill="black" stroke="black" points="51373.5,-1272.04 51370,-1262.04 51366.5,-1272.04 51373.5,-1272.04"/>
<text text-anchor="middle" x="51599.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert5 -->
<g id="node353" class="node">
<title>R1_Stage4_L13_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="51796,-1262 51536,-1262 51536,-1204 51796,-1204 51796,-1262"/>
<text text-anchor="middle" x="51666" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 53</text>
<text text-anchor="middle" x="51666" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51666" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert5 -->
<g id="edge543" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M52655.85,-1377C52269.34,-1377 51666,-1377 51666,-1377 51666,-1377 51666,-1272.14 51666,-1272.14"/>
<polygon fill="black" stroke="black" points="51669.5,-1272.14 51666,-1262.14 51662.5,-1272.14 51669.5,-1272.14"/>
<text text-anchor="middle" x="51892.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert6 -->
<g id="node354" class="node">
<title>R1_Stage4_L13_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="52092,-1262 51832,-1262 51832,-1204 52092,-1204 52092,-1262"/>
<text text-anchor="middle" x="51962" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 54</text>
<text text-anchor="middle" x="51962" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51962" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert6 -->
<g id="edge544" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M52653.12,-1375C52357.15,-1375 51962,-1375 51962,-1375 51962,-1375 51962,-1272.08 51962,-1272.08"/>
<polygon fill="black" stroke="black" points="51965.5,-1272.08 51962,-1262.08 51958.5,-1272.08 51965.5,-1272.08"/>
<text text-anchor="middle" x="52181.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert7 -->
<g id="node355" class="node">
<title>R1_Stage4_L13_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="52388,-1262 52128,-1262 52128,-1204 52388,-1204 52388,-1262"/>
<text text-anchor="middle" x="52258" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 55</text>
<text text-anchor="middle" x="52258" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52258" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert7 -->
<g id="edge545" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M52650.77,-1373C52461.18,-1373 52258,-1373 52258,-1373 52258,-1373 52258,-1272.01 52258,-1272.01"/>
<polygon fill="black" stroke="black" points="52261.5,-1272.01 52258,-1262.01 52254.5,-1272.01 52261.5,-1272.01"/>
<text text-anchor="middle" x="52464.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert8 -->
<g id="node356" class="node">
<title>R1_Stage4_L13_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="52684,-1262 52424,-1262 52424,-1204 52684,-1204 52684,-1262"/>
<text text-anchor="middle" x="52554" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 56</text>
<text text-anchor="middle" x="52554" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52554" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert8 -->
<g id="edge546" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M52666.78,-1423.86C52666.78,-1423.86 52666.78,-1272.01 52666.78,-1272.01"/>
<polygon fill="black" stroke="black" points="52670.28,-1272.01 52666.78,-1262.01 52663.28,-1272.01 52670.28,-1272.01"/>
<text text-anchor="middle" x="52734.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert9 -->
<g id="node357" class="node">
<title>R1_Stage4_L13_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="52980,-1262 52720,-1262 52720,-1204 52980,-1204 52980,-1262"/>
<text text-anchor="middle" x="52850" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 57</text>
<text text-anchor="middle" x="52850" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52850" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert9 -->
<g id="edge547" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M52850,-1371.81C52850,-1371.81 52850,-1272.01 52850,-1272.01"/>
<polygon fill="black" stroke="black" points="52853.5,-1272.01 52850,-1262.01 52846.5,-1272.01 52853.5,-1272.01"/>
<text text-anchor="middle" x="52924.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert10 -->
<g id="node358" class="node">
<title>R1_Stage4_L13_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="53276,-1262 53016,-1262 53016,-1204 53276,-1204 53276,-1262"/>
<text text-anchor="middle" x="53146" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 58</text>
<text text-anchor="middle" x="53146" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53146" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert10 -->
<g id="edge548" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M53146,-1371.81C53146,-1371.81 53146,-1272.01 53146,-1272.01"/>
<polygon fill="black" stroke="black" points="53149.5,-1272.01 53146,-1262.01 53142.5,-1272.01 53149.5,-1272.01"/>
<text text-anchor="middle" x="53061.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert11 -->
<g id="node359" class="node">
<title>R1_Stage4_L13_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="53572,-1262 53312,-1262 53312,-1204 53572,-1204 53572,-1262"/>
<text text-anchor="middle" x="53442" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 59</text>
<text text-anchor="middle" x="53442" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53442" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert11 -->
<g id="edge549" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M53285.22,-1423.86C53285.22,-1418.08 53285.22,-1233 53285.22,-1233 53285.22,-1233 53301.81,-1233 53301.81,-1233"/>
<polygon fill="black" stroke="black" points="53301.81,-1236.5 53311.81,-1233 53301.81,-1229.5 53301.81,-1236.5"/>
<text text-anchor="middle" x="53357.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert12 -->
<g id="node360" class="node">
<title>R1_Stage4_L13_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="53868,-1262 53608,-1262 53608,-1204 53868,-1204 53868,-1262"/>
<text text-anchor="middle" x="53738" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 60</text>
<text text-anchor="middle" x="53738" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53738" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert12 -->
<g id="edge550" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M53166.28,-1375C53393.22,-1375 53738,-1375 53738,-1375 53738,-1375 53738,-1272.08 53738,-1272.08"/>
<polygon fill="black" stroke="black" points="53741.5,-1272.08 53738,-1262.08 53734.5,-1272.08 53741.5,-1272.08"/>
<text text-anchor="middle" x="53600.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert13 -->
<g id="node361" class="node">
<title>R1_Stage4_L13_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="54164,-1262 53904,-1262 53904,-1204 54164,-1204 54164,-1262"/>
<text text-anchor="middle" x="54034" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 61</text>
<text text-anchor="middle" x="54034" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54034" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert13 -->
<g id="edge551" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M53170.2,-1378C53477.51,-1378 54034,-1378 54034,-1378 54034,-1378 54034,-1272.34 54034,-1272.34"/>
<polygon fill="black" stroke="black" points="54037.5,-1272.34 54034,-1262.34 54030.5,-1272.34 54037.5,-1272.34"/>
<text text-anchor="middle" x="53843.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert14 -->
<g id="node362" class="node">
<title>R1_Stage4_L13_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="54460,-1262 54200,-1262 54200,-1204 54460,-1204 54460,-1262"/>
<text text-anchor="middle" x="54330" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 62</text>
<text text-anchor="middle" x="54330" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54330" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert14 -->
<g id="edge552" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M53174.21,-1381C53552.64,-1381 54330,-1381 54330,-1381 54330,-1381 54330,-1272.24 54330,-1272.24"/>
<polygon fill="black" stroke="black" points="54333.5,-1272.24 54330,-1262.24 54326.5,-1272.24 54333.5,-1272.24"/>
<text text-anchor="middle" x="54139.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_Expert15 -->
<g id="node363" class="node">
<title>R1_Stage4_L13_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="54756,-1262 54496,-1262 54496,-1204 54756,-1204 54756,-1262"/>
<text text-anchor="middle" x="54626" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 63</text>
<text text-anchor="middle" x="54626" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54626" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert15 -->
<g id="edge553" class="edge">
<title>R1_Stage4_L13_Router&#45;&gt;R1_Stage4_L13_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M53178.97,-1385C53622.78,-1385 54626,-1385 54626,-1385 54626,-1385 54626,-1272.31 54626,-1272.31"/>
<polygon fill="black" stroke="black" points="54629.5,-1272.31 54626,-1262.31 54622.5,-1272.31 54629.5,-1272.31"/>
<text text-anchor="middle" x="54435.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L13_MoE_Output -->
<g id="node364" class="node">
<title>R1_Stage4_L13_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="51858.95,-1094 51332.48,-1094 51197.05,-990 51723.52,-990 51858.95,-1094"/>
<text text-anchor="middle" x="51528" y="-1056" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="51528" y="-1045" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="51528" y="-1034" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="51528" y="-1023" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L13_Expert0&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge554" class="edge">
<title>R1_Stage4_L13_Expert0&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M54801,-1203.84C54801,-1157.93 54801,-1074 54801,-1074 54801,-1074 51842.98,-1074 51842.98,-1074"/>
<polygon fill="black" stroke="black" points="51842.98,-1070.5 51832.98,-1074 51842.98,-1077.5 51842.98,-1070.5"/>
</g>
<!-- R1_Stage4_L13_Expert1&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge555" class="edge">
<title>R1_Stage4_L13_Expert1&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M55097,-1203.84C55097,-1157.45 55097,-1072 55097,-1072 55097,-1072 51840.37,-1072 51840.37,-1072"/>
<polygon fill="black" stroke="black" points="51840.37,-1068.5 51830.37,-1072 51840.37,-1075.5 51840.37,-1068.5"/>
</g>
<!-- R1_Stage4_L13_Expert2&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge556" class="edge">
<title>R1_Stage4_L13_Expert2&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M50857.28,-1203.96C50857.28,-1161.12 50857.28,-1086 50857.28,-1086 50857.28,-1086 51311.75,-1086 51311.75,-1086"/>
<polygon fill="black" stroke="black" points="51311.75,-1089.5 51321.75,-1086 51311.75,-1082.5 51311.75,-1089.5"/>
</g>
<!-- R1_Stage4_L13_Expert3&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge557" class="edge">
<title>R1_Stage4_L13_Expert3&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M51188.18,-1203.85C51188.18,-1158.95 51188.18,-1078 51188.18,-1078 51188.18,-1078 51301.35,-1078 51301.35,-1078"/>
<polygon fill="black" stroke="black" points="51301.35,-1081.5 51311.35,-1078 51301.35,-1074.5 51301.35,-1081.5"/>
</g>
<!-- R1_Stage4_L13_Expert4&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge558" class="edge">
<title>R1_Stage4_L13_Expert4&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M51370,-1203.99C51370,-1203.99 51370,-1104.02 51370,-1104.02"/>
<polygon fill="black" stroke="black" points="51373.5,-1104.02 51370,-1094.02 51366.5,-1104.02 51373.5,-1104.02"/>
</g>
<!-- R1_Stage4_L13_Expert5&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge559" class="edge">
<title>R1_Stage4_L13_Expert5&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M51666,-1203.99C51666,-1203.99 51666,-1104.02 51666,-1104.02"/>
<polygon fill="black" stroke="black" points="51669.5,-1104.02 51666,-1094.02 51662.5,-1104.02 51669.5,-1104.02"/>
</g>
<!-- R1_Stage4_L13_Expert6&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge560" class="edge">
<title>R1_Stage4_L13_Expert6&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M51845.36,-1203.99C51845.36,-1203.99 51845.36,-1052.08 51845.36,-1052.08"/>
<polygon fill="black" stroke="black" points="51848.86,-1052.08 51845.36,-1042.08 51841.86,-1052.08 51848.86,-1052.08"/>
</g>
<!-- R1_Stage4_L13_Expert7&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge561" class="edge">
<title>R1_Stage4_L13_Expert7&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M52141.5,-1203.78C52141.5,-1162.48 52141.5,-1092 52141.5,-1092 52141.5,-1092 51866.75,-1092 51866.75,-1092"/>
<polygon fill="black" stroke="black" points="51866.75,-1088.5 51856.75,-1092 51866.75,-1095.5 51866.75,-1088.5"/>
</g>
<!-- R1_Stage4_L13_Expert8&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge562" class="edge">
<title>R1_Stage4_L13_Expert8&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M52433,-1203.72C52433,-1161.88 52433,-1090 52433,-1090 52433,-1090 51863.77,-1090 51863.77,-1090"/>
<polygon fill="black" stroke="black" points="51863.77,-1086.5 51853.77,-1090 51863.77,-1093.5 51863.77,-1086.5"/>
</g>
<!-- R1_Stage4_L13_Expert9&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge563" class="edge">
<title>R1_Stage4_L13_Expert9&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M52729,-1203.66C52729,-1161.29 52729,-1088 52729,-1088 52729,-1088 51861.43,-1088 51861.43,-1088"/>
<polygon fill="black" stroke="black" points="51861.43,-1084.5 51851.43,-1088 51861.43,-1091.5 51861.43,-1084.5"/>
</g>
<!-- R1_Stage4_L13_Expert10&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge564" class="edge">
<title>R1_Stage4_L13_Expert10&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M53025,-1203.96C53025,-1161.12 53025,-1086 53025,-1086 53025,-1086 51858.68,-1086 51858.68,-1086"/>
<polygon fill="black" stroke="black" points="51858.68,-1082.5 51848.68,-1086 51858.68,-1089.5 51858.68,-1082.5"/>
</g>
<!-- R1_Stage4_L13_Expert11&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge565" class="edge">
<title>R1_Stage4_L13_Expert11&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M53321,-1203.92C53321,-1160.56 53321,-1084 53321,-1084 53321,-1084 51855.97,-1084 51855.97,-1084"/>
<polygon fill="black" stroke="black" points="51855.97,-1080.5 51845.97,-1084 51855.97,-1087.5 51855.97,-1080.5"/>
</g>
<!-- R1_Stage4_L13_Expert12&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge566" class="edge">
<title>R1_Stage4_L13_Expert12&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M53617,-1203.89C53617,-1160.01 53617,-1082 53617,-1082 53617,-1082 51853.57,-1082 51853.57,-1082"/>
<polygon fill="black" stroke="black" points="51853.57,-1078.5 51843.57,-1082 51853.57,-1085.5 51853.57,-1078.5"/>
</g>
<!-- R1_Stage4_L13_Expert13&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge567" class="edge">
<title>R1_Stage4_L13_Expert13&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M53913,-1203.86C53913,-1159.47 53913,-1080 53913,-1080 53913,-1080 51851.02,-1080 51851.02,-1080"/>
<polygon fill="black" stroke="black" points="51851.02,-1076.5 51841.02,-1080 51851.02,-1083.5 51851.02,-1076.5"/>
</g>
<!-- R1_Stage4_L13_Expert14&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge568" class="edge">
<title>R1_Stage4_L13_Expert14&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M54209,-1203.85C54209,-1158.95 54209,-1078 54209,-1078 54209,-1078 51848.16,-1078 51848.16,-1078"/>
<polygon fill="black" stroke="black" points="51848.16,-1074.5 51838.16,-1078 51848.16,-1081.5 51848.16,-1074.5"/>
</g>
<!-- R1_Stage4_L13_Expert15&#45;&gt;R1_Stage4_L13_MoE_Output -->
<g id="edge569" class="edge">
<title>R1_Stage4_L13_Expert15&#45;&gt;R1_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M54505,-1203.84C54505,-1158.43 54505,-1076 54505,-1076 54505,-1076 51845.73,-1076 51845.73,-1076"/>
<polygon fill="black" stroke="black" points="51845.73,-1072.5 51835.73,-1076 51845.73,-1079.5 51845.73,-1072.5"/>
</g>
<!-- R1_Stage4_L13_MoE_Output&#45;&gt;R1_Stage4_L13_Output -->
<g id="edge570" class="edge">
<title>R1_Stage4_L13_MoE_Output&#45;&gt;R1_Stage4_L13_Output</title>
<path fill="none" stroke="black" d="M51737.87,-1001C52501.1,-1001 55084.75,-1001 55084.75,-1001 55084.75,-1001 55084.75,-875.66 55084.75,-875.66"/>
<polygon fill="black" stroke="black" points="55088.25,-875.66 55084.75,-865.66 55081.25,-875.66 55088.25,-875.66"/>
</g>
<!-- R1_Stage4_L14_Input -->
<g id="node365" class="node">
<title>R1_Stage4_L14_Input</title>
<ellipse fill="lightblue" stroke="black" cx="55799" cy="-2160" rx="225.5" ry="29"/>
<text text-anchor="middle" x="55799" y="-2168.5" font-family="Times,serif" font-size="10.00">Layer 14 Input</text>
<text text-anchor="middle" x="55799" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="55799" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Attn_Input -->
<g id="node366" class="node">
<title>R1_Stage4_L14_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="55799" cy="-1969" rx="225.5" ry="29"/>
<text text-anchor="middle" x="55799" y="-1977.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="55799" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="55799" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Input&#45;&gt;R1_Stage4_L14_Attn_Input -->
<g id="edge571" class="edge">
<title>R1_Stage4_L14_Input&#45;&gt;R1_Stage4_L14_Attn_Input</title>
<path fill="none" stroke="black" d="M55799,-2130.99C55799,-2130.99 55799,-2008.28 55799,-2008.28"/>
<polygon fill="black" stroke="black" points="55802.5,-2008.28 55799,-1998.28 55795.5,-2008.28 55802.5,-2008.28"/>
</g>
<!-- R1_Stage4_L14_Attn_TP1 -->
<g id="node367" class="node">
<title>R1_Stage4_L14_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="56163,-1807 55817,-1807 55817,-1749 56163,-1749 56163,-1807"/>
<text text-anchor="middle" x="55990" y="-1792" font-family="Times,serif" font-size="10.00">Attention TP GPU 48</text>
<text text-anchor="middle" x="55990" y="-1781" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="55990" y="-1770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="55990" y="-1759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage4_L14_Attn_Input&#45;&gt;R1_Stage4_L14_Attn_TP1 -->
<g id="edge572" class="edge">
<title>R1_Stage4_L14_Attn_Input&#45;&gt;R1_Stage4_L14_Attn_TP1</title>
<path fill="none" stroke="black" d="M55920.75,-1944.42C55920.75,-1944.42 55920.75,-1817.17 55920.75,-1817.17"/>
<polygon fill="black" stroke="black" points="55924.25,-1817.17 55920.75,-1807.17 55917.25,-1817.17 55924.25,-1817.17"/>
</g>
<!-- R1_Stage4_L14_Attn_TP2 -->
<g id="node368" class="node">
<title>R1_Stage4_L14_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="55781,-1807 55435,-1807 55435,-1749 55781,-1749 55781,-1807"/>
<text text-anchor="middle" x="55608" y="-1792" font-family="Times,serif" font-size="10.00">Attention TP GPU 49</text>
<text text-anchor="middle" x="55608" y="-1781" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="55608" y="-1770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="55608" y="-1759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage4_L14_Attn_Input&#45;&gt;R1_Stage4_L14_Attn_TP2 -->
<g id="edge573" class="edge">
<title>R1_Stage4_L14_Attn_Input&#45;&gt;R1_Stage4_L14_Attn_TP2</title>
<path fill="none" stroke="black" d="M55677.25,-1944.42C55677.25,-1944.42 55677.25,-1817.17 55677.25,-1817.17"/>
<polygon fill="black" stroke="black" points="55680.75,-1817.17 55677.25,-1807.17 55673.75,-1817.17 55680.75,-1817.17"/>
</g>
<!-- R1_Stage4_L14_Attn_Output -->
<g id="node369" class="node">
<title>R1_Stage4_L14_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="55706" cy="-1601" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="55706" y="-1615" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="55706" y="-1604" font-family="Times,serif" font-size="10.00">AllReduce GPUs 48&#45;49</text>
<text text-anchor="middle" x="55706" y="-1593" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="55706" y="-1582" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Attn_TP1&#45;&gt;R1_Stage4_L14_Attn_Output -->
<g id="edge574" class="edge">
<title>R1_Stage4_L14_Attn_TP1&#45;&gt;R1_Stage4_L14_Attn_Output</title>
<path fill="none" stroke="black" d="M55883.12,-1748.77C55883.12,-1748.77 55883.12,-1636.25 55883.12,-1636.25"/>
<polygon fill="black" stroke="black" points="55886.62,-1636.25 55883.12,-1626.25 55879.62,-1636.25 55886.62,-1636.25"/>
</g>
<!-- R1_Stage4_L14_Attn_TP2&#45;&gt;R1_Stage4_L14_Attn_Output -->
<g id="edge575" class="edge">
<title>R1_Stage4_L14_Attn_TP2&#45;&gt;R1_Stage4_L14_Attn_Output</title>
<path fill="none" stroke="black" d="M55621.88,-1748.77C55621.88,-1748.77 55621.88,-1645.75 55621.88,-1645.75"/>
<polygon fill="black" stroke="black" points="55625.38,-1645.75 55621.88,-1635.75 55618.38,-1645.75 55625.38,-1645.75"/>
</g>
<!-- R1_Stage4_L14_MoE_Input -->
<g id="node370" class="node">
<title>R1_Stage4_L14_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="55706" cy="-1424" rx="225.5" ry="29"/>
<text text-anchor="middle" x="55706" y="-1432.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="55706" y="-1421.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="55706" y="-1410.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Attn_Output&#45;&gt;R1_Stage4_L14_MoE_Input -->
<g id="edge576" class="edge">
<title>R1_Stage4_L14_Attn_Output&#45;&gt;R1_Stage4_L14_MoE_Input</title>
<path fill="none" stroke="black" d="M55706,-1563.89C55706,-1563.89 55706,-1463.17 55706,-1463.17"/>
<polygon fill="black" stroke="black" points="55709.5,-1463.17 55706,-1453.17 55702.5,-1463.17 55709.5,-1463.17"/>
</g>
<!-- R1_Stage4_L14_Router -->
<g id="node371" class="node">
<title>R1_Stage4_L14_Router</title>
<polygon fill="lightyellow" stroke="black" points="56028.36,-1285 55515.56,-1285 55383.64,-1181 55896.44,-1181 56028.36,-1285"/>
<text text-anchor="middle" x="55706" y="-1247" font-family="Times,serif" font-size="10.00">Router GPU 48</text>
<text text-anchor="middle" x="55706" y="-1236" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="55706" y="-1225" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="55706" y="-1214" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage4_L14_MoE_Input&#45;&gt;R1_Stage4_L14_Router -->
<g id="edge577" class="edge">
<title>R1_Stage4_L14_MoE_Input&#45;&gt;R1_Stage4_L14_Router</title>
<path fill="none" stroke="black" d="M55706,-1394.99C55706,-1394.99 55706,-1295.02 55706,-1295.02"/>
<polygon fill="black" stroke="black" points="55709.5,-1295.02 55706,-1285.02 55702.5,-1295.02 55709.5,-1295.02"/>
</g>
<!-- R1_Stage4_L14_Expert0 -->
<g id="node372" class="node">
<title>R1_Stage4_L14_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="54819,-1071 54559,-1071 54559,-1013 54819,-1013 54819,-1071"/>
<text text-anchor="middle" x="54689" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 48</text>
<text text-anchor="middle" x="54689" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54689" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert0 -->
<g id="edge578" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55389.79,-1186C55131.88,-1186 54810,-1186 54810,-1186 54810,-1186 54810,-1081.14 54810,-1081.14"/>
<polygon fill="black" stroke="black" points="54813.5,-1081.14 54810,-1071.14 54806.5,-1081.14 54813.5,-1081.14"/>
<text text-anchor="middle" x="54898.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert1 -->
<g id="node373" class="node">
<title>R1_Stage4_L14_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="55115,-1071 54855,-1071 54855,-1013 55115,-1013 55115,-1071"/>
<text text-anchor="middle" x="54985" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 49</text>
<text text-anchor="middle" x="54985" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54985" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert1 -->
<g id="edge579" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55384.48,-1182C55241.99,-1182 55106,-1182 55106,-1182 55106,-1182 55106,-1081.01 55106,-1081.01"/>
<polygon fill="black" stroke="black" points="55109.5,-1081.01 55106,-1071.01 55102.5,-1081.01 55109.5,-1081.01"/>
<text text-anchor="middle" x="55170.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert2 -->
<g id="node374" class="node">
<title>R1_Stage4_L14_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="55411,-1071 55151,-1071 55151,-1013 55411,-1013 55411,-1071"/>
<text text-anchor="middle" x="55281" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 50</text>
<text text-anchor="middle" x="55281" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="55281" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert2 -->
<g id="edge580" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55397.28,-1232.86C55397.28,-1232.86 55397.28,-1081.01 55397.28,-1081.01"/>
<polygon fill="black" stroke="black" points="55400.78,-1081.01 55397.28,-1071.01 55393.78,-1081.01 55400.78,-1081.01"/>
<text text-anchor="middle" x="55419.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert3 -->
<g id="node375" class="node">
<title>R1_Stage4_L14_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="55707,-1071 55447,-1071 55447,-1013 55707,-1013 55707,-1071"/>
<text text-anchor="middle" x="55577" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 51</text>
<text text-anchor="middle" x="55577" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="55577" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert3 -->
<g id="edge581" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55577,-1180.81C55577,-1180.81 55577,-1081.01 55577,-1081.01"/>
<polygon fill="black" stroke="black" points="55580.5,-1081.01 55577,-1071.01 55573.5,-1081.01 55580.5,-1081.01"/>
<text text-anchor="middle" x="55620.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert4 -->
<g id="node376" class="node">
<title>R1_Stage4_L14_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="56003,-1071 55743,-1071 55743,-1013 56003,-1013 56003,-1071"/>
<text text-anchor="middle" x="55873" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 52</text>
<text text-anchor="middle" x="55873" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="55873" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert4 -->
<g id="edge582" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55873,-1180.81C55873,-1180.81 55873,-1081.01 55873,-1081.01"/>
<polygon fill="black" stroke="black" points="55876.5,-1081.01 55873,-1071.01 55869.5,-1081.01 55876.5,-1081.01"/>
<text text-anchor="middle" x="55810.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert5 -->
<g id="node377" class="node">
<title>R1_Stage4_L14_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="56299,-1071 56039,-1071 56039,-1013 56299,-1013 56299,-1071"/>
<text text-anchor="middle" x="56169" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 53</text>
<text text-anchor="middle" x="56169" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="56169" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert5 -->
<g id="edge583" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M56015.72,-1232.86C56015.72,-1227.08 56015.72,-1042 56015.72,-1042 56015.72,-1042 56029,-1042 56029,-1042"/>
<polygon fill="black" stroke="black" points="56029,-1045.5 56039,-1042 56029,-1038.5 56029,-1045.5"/>
<text text-anchor="middle" x="56083.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert6 -->
<g id="node378" class="node">
<title>R1_Stage4_L14_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="56595,-1071 56335,-1071 56335,-1013 56595,-1013 56595,-1071"/>
<text text-anchor="middle" x="56465" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 54</text>
<text text-anchor="middle" x="56465" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="56465" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert6 -->
<g id="edge584" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55962.43,-1233C56182.7,-1233 56465,-1233 56465,-1233 56465,-1233 56465,-1081.01 56465,-1081.01"/>
<polygon fill="black" stroke="black" points="56468.5,-1081.01 56465,-1071.01 56461.5,-1081.01 56468.5,-1081.01"/>
<text text-anchor="middle" x="56368.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert7 -->
<g id="node379" class="node">
<title>R1_Stage4_L14_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="52155,-1071 51895,-1071 51895,-1013 52155,-1013 52155,-1071"/>
<text text-anchor="middle" x="52025" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 55</text>
<text text-anchor="middle" x="52025" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52025" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert7 -->
<g id="edge585" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55490.16,-1265C54713.93,-1265 52110,-1265 52110,-1265 52110,-1265 52110,-1081.15 52110,-1081.15"/>
<polygon fill="black" stroke="black" points="52113.5,-1081.15 52110,-1071.15 52106.5,-1081.15 52113.5,-1081.15"/>
<text text-anchor="middle" x="52257.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert8 -->
<g id="node380" class="node">
<title>R1_Stage4_L14_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="52451,-1071 52191,-1071 52191,-1013 52451,-1013 52451,-1071"/>
<text text-anchor="middle" x="52321" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 56</text>
<text text-anchor="middle" x="52321" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52321" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert8 -->
<g id="edge586" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55410.22,-1202C54606.47,-1202 52442,-1202 52442,-1202 52442,-1202 52442,-1081.35 52442,-1081.35"/>
<polygon fill="black" stroke="black" points="52445.5,-1081.35 52442,-1071.35 52438.5,-1081.35 52445.5,-1081.35"/>
<text text-anchor="middle" x="52553.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert9 -->
<g id="node381" class="node">
<title>R1_Stage4_L14_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="52747,-1071 52487,-1071 52487,-1013 52747,-1013 52747,-1071"/>
<text text-anchor="middle" x="52617" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 57</text>
<text text-anchor="middle" x="52617" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52617" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert9 -->
<g id="edge587" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55407.48,-1200C54654.6,-1200 52738,-1200 52738,-1200 52738,-1200 52738,-1081.35 52738,-1081.35"/>
<polygon fill="black" stroke="black" points="52741.5,-1081.35 52738,-1071.35 52734.5,-1081.35 52741.5,-1081.35"/>
<text text-anchor="middle" x="52848.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert10 -->
<g id="node382" class="node">
<title>R1_Stage4_L14_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="53043,-1071 52783,-1071 52783,-1013 53043,-1013 53043,-1071"/>
<text text-anchor="middle" x="52913" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 58</text>
<text text-anchor="middle" x="52913" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52913" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert10 -->
<g id="edge588" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55405.01,-1198C54706.4,-1198 53034,-1198 53034,-1198 53034,-1198 53034,-1081.34 53034,-1081.34"/>
<polygon fill="black" stroke="black" points="53037.5,-1081.34 53034,-1071.34 53030.5,-1081.34 53037.5,-1081.34"/>
<text text-anchor="middle" x="53142.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert11 -->
<g id="node383" class="node">
<title>R1_Stage4_L14_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="53339,-1071 53079,-1071 53079,-1013 53339,-1013 53339,-1071"/>
<text text-anchor="middle" x="53209" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 59</text>
<text text-anchor="middle" x="53209" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53209" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert11 -->
<g id="edge589" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55399.94,-1194C54758.07,-1194 53330,-1194 53330,-1194 53330,-1194 53330,-1081.31 53330,-1081.31"/>
<polygon fill="black" stroke="black" points="53333.5,-1081.31 53330,-1071.31 53326.5,-1081.31 53333.5,-1081.31"/>
<text text-anchor="middle" x="53435.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert12 -->
<g id="node384" class="node">
<title>R1_Stage4_L14_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="53635,-1071 53375,-1071 53375,-1013 53635,-1013 53635,-1071"/>
<text text-anchor="middle" x="53505" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 60</text>
<text text-anchor="middle" x="53505" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53505" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert12 -->
<g id="edge590" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55397.41,-1192C54818.19,-1192 53626,-1192 53626,-1192 53626,-1192 53626,-1081.28 53626,-1081.28"/>
<polygon fill="black" stroke="black" points="53629.5,-1081.28 53626,-1071.28 53622.5,-1081.28 53629.5,-1081.28"/>
<text text-anchor="middle" x="53724.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert13 -->
<g id="node385" class="node">
<title>R1_Stage4_L14_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="53931,-1071 53671,-1071 53671,-1013 53931,-1013 53931,-1071"/>
<text text-anchor="middle" x="53801" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 61</text>
<text text-anchor="middle" x="53801" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53801" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert13 -->
<g id="edge591" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55396.27,-1191C54885.4,-1191 53922,-1191 53922,-1191 53922,-1191 53922,-1081.08 53922,-1081.08"/>
<polygon fill="black" stroke="black" points="53925.5,-1081.08 53922,-1071.08 53918.5,-1081.08 53925.5,-1081.08"/>
<text text-anchor="middle" x="54007.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert14 -->
<g id="node386" class="node">
<title>R1_Stage4_L14_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="54227,-1071 53967,-1071 53967,-1013 54227,-1013 54227,-1071"/>
<text text-anchor="middle" x="54097" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 62</text>
<text text-anchor="middle" x="54097" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54097" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert14 -->
<g id="edge592" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55393.61,-1189C54957.22,-1189 54218,-1189 54218,-1189 54218,-1189 54218,-1081.04 54218,-1081.04"/>
<polygon fill="black" stroke="black" points="54221.5,-1081.04 54218,-1071.04 54214.5,-1081.04 54221.5,-1081.04"/>
<text text-anchor="middle" x="54277.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_Expert15 -->
<g id="node387" class="node">
<title>R1_Stage4_L14_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="54523,-1071 54263,-1071 54263,-1013 54523,-1013 54523,-1071"/>
<text text-anchor="middle" x="54393" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 63</text>
<text text-anchor="middle" x="54393" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54393" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert15 -->
<g id="edge593" class="edge">
<title>R1_Stage4_L14_Router&#45;&gt;R1_Stage4_L14_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M55390.87,-1187C55037.72,-1187 54514,-1187 54514,-1187 54514,-1187 54514,-1081.34 54514,-1081.34"/>
<polygon fill="black" stroke="black" points="54517.5,-1081.34 54514,-1071.34 54510.5,-1081.34 54517.5,-1081.34"/>
<text text-anchor="middle" x="54520.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L14_MoE_Output -->
<g id="node388" class="node">
<title>R1_Stage4_L14_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="56202.95,-903 55676.48,-903 55541.05,-799 56067.52,-799 56202.95,-903"/>
<text text-anchor="middle" x="55872" y="-865" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="55872" y="-854" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="55872" y="-843" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="55872" y="-832" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L14_Expert0&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge594" class="edge">
<title>R1_Stage4_L14_Expert0&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M54798.67,-1012.86C54798.67,-970.78 54798.67,-898 54798.67,-898 54798.67,-898 55659.8,-898 55659.8,-898"/>
<polygon fill="black" stroke="black" points="55659.8,-901.5 55669.8,-898 55659.8,-894.5 55659.8,-901.5"/>
</g>
<!-- R1_Stage4_L14_Expert1&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge595" class="edge">
<title>R1_Stage4_L14_Expert1&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M55099.87,-1012.72C55099.87,-970.88 55099.87,-899 55099.87,-899 55099.87,-899 55661.15,-899 55661.15,-899"/>
<polygon fill="black" stroke="black" points="55661.15,-902.5 55671.15,-899 55661.15,-895.5 55661.15,-902.5"/>
</g>
<!-- R1_Stage4_L14_Expert2&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge596" class="edge">
<title>R1_Stage4_L14_Expert2&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M55281,-1012.78C55281,-971.48 55281,-901 55281,-901 55281,-901 55663.56,-901 55663.56,-901"/>
<polygon fill="black" stroke="black" points="55663.56,-904.5 55673.56,-901 55663.56,-897.5 55663.56,-904.5"/>
</g>
<!-- R1_Stage4_L14_Expert3&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge597" class="edge">
<title>R1_Stage4_L14_Expert3&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M55624.14,-1012.99C55624.14,-1012.99 55624.14,-873.07 55624.14,-873.07"/>
<polygon fill="black" stroke="black" points="55627.64,-873.07 55624.14,-863.07 55620.64,-873.07 55627.64,-873.07"/>
</g>
<!-- R1_Stage4_L14_Expert4&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge598" class="edge">
<title>R1_Stage4_L14_Expert4&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M55873,-1012.99C55873,-1012.99 55873,-913.02 55873,-913.02"/>
<polygon fill="black" stroke="black" points="55876.5,-913.02 55873,-903.02 55869.5,-913.02 55876.5,-913.02"/>
</g>
<!-- R1_Stage4_L14_Expert5&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge599" class="edge">
<title>R1_Stage4_L14_Expert5&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M56120.86,-1012.99C56120.86,-1012.99 56120.86,-913.02 56120.86,-913.02"/>
<polygon fill="black" stroke="black" points="56124.36,-913.02 56120.86,-903.02 56117.36,-913.02 56124.36,-913.02"/>
</g>
<!-- R1_Stage4_L14_Expert6&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge600" class="edge">
<title>R1_Stage4_L14_Expert6&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M56465,-1012.99C56465,-959.56 56465,-851 56465,-851 56465,-851 56145.55,-851 56145.55,-851"/>
<polygon fill="black" stroke="black" points="56145.55,-847.5 56135.55,-851 56145.55,-854.5 56145.55,-847.5"/>
</g>
<!-- R1_Stage4_L14_Expert7&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge601" class="edge">
<title>R1_Stage4_L14_Expert7&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M52134.67,-1012.65C52134.67,-966.96 52134.67,-884 52134.67,-884 52134.67,-884 55641.48,-884 55641.48,-884"/>
<polygon fill="black" stroke="black" points="55641.48,-887.5 55651.48,-884 55641.48,-880.5 55641.48,-887.5"/>
</g>
<!-- R1_Stage4_L14_Expert8&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge602" class="edge">
<title>R1_Stage4_L14_Expert8&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M52430.67,-1012.66C52430.67,-967.47 52430.67,-886 52430.67,-886 52430.67,-886 55644.12,-886 55644.12,-886"/>
<polygon fill="black" stroke="black" points="55644.12,-889.5 55654.12,-886 55644.12,-882.5 55644.12,-889.5"/>
</g>
<!-- R1_Stage4_L14_Expert9&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge603" class="edge">
<title>R1_Stage4_L14_Expert9&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M52726.67,-1012.85C52726.67,-967.95 52726.67,-887 52726.67,-887 52726.67,-887 55645.5,-887 55645.5,-887"/>
<polygon fill="black" stroke="black" points="55645.5,-890.5 55655.5,-887 55645.5,-883.5 55645.5,-890.5"/>
</g>
<!-- R1_Stage4_L14_Expert10&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge604" class="edge">
<title>R1_Stage4_L14_Expert10&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M53022.67,-1012.86C53022.67,-968.47 53022.67,-889 53022.67,-889 53022.67,-889 55648.13,-889 55648.13,-889"/>
<polygon fill="black" stroke="black" points="55648.13,-892.5 55658.13,-889 55648.13,-885.5 55648.13,-892.5"/>
</g>
<!-- R1_Stage4_L14_Expert11&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge605" class="edge">
<title>R1_Stage4_L14_Expert11&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M53318.67,-1012.69C53318.67,-968.52 53318.67,-890 53318.67,-890 53318.67,-890 55649.52,-890 55649.52,-890"/>
<polygon fill="black" stroke="black" points="55649.52,-893.5 55659.52,-890 55649.52,-886.5 55649.52,-893.5"/>
</g>
<!-- R1_Stage4_L14_Expert12&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge606" class="edge">
<title>R1_Stage4_L14_Expert12&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M53614.67,-1012.72C53614.67,-969.07 53614.67,-892 53614.67,-892 53614.67,-892 55651.92,-892 55651.92,-892"/>
<polygon fill="black" stroke="black" points="55651.92,-895.5 55661.92,-892 55651.92,-888.5 55651.92,-895.5"/>
</g>
<!-- R1_Stage4_L14_Expert13&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge607" class="edge">
<title>R1_Stage4_L14_Expert13&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M53910.67,-1012.92C53910.67,-969.56 53910.67,-893 53910.67,-893 53910.67,-893 55653.03,-893 55653.03,-893"/>
<polygon fill="black" stroke="black" points="55653.03,-896.5 55663.03,-893 55653.03,-889.5 55653.03,-896.5"/>
</g>
<!-- R1_Stage4_L14_Expert14&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge608" class="edge">
<title>R1_Stage4_L14_Expert14&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M54206.67,-1012.96C54206.67,-970.12 54206.67,-895 54206.67,-895 54206.67,-895 55655.71,-895 55655.71,-895"/>
<polygon fill="black" stroke="black" points="55655.71,-898.5 55665.71,-895 55655.71,-891.5 55655.71,-898.5"/>
</g>
<!-- R1_Stage4_L14_Expert15&#45;&gt;R1_Stage4_L14_MoE_Output -->
<g id="edge609" class="edge">
<title>R1_Stage4_L14_Expert15&#45;&gt;R1_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M54502.67,-1012.81C54502.67,-970.2 54502.67,-896 54502.67,-896 54502.67,-896 55657.37,-896 55657.37,-896"/>
<polygon fill="black" stroke="black" points="55657.37,-899.5 55667.37,-896 55657.37,-892.5 55657.37,-899.5"/>
</g>
<!-- R1_Stage4_L14_MoE_Output&#45;&gt;R1_Stage4_L14_Output -->
<g id="edge610" class="edge">
<title>R1_Stage4_L14_MoE_Output&#45;&gt;R1_Stage4_L14_Output</title>
<path fill="none" stroke="black" d="M55542.09,-800C55524.58,-800 55514,-800 55514,-800 55514,-800 55514,-677.93 55514,-677.93"/>
<polygon fill="black" stroke="black" points="55517.5,-677.93 55514,-667.93 55510.5,-677.93 55517.5,-677.93"/>
</g>
<!-- R1_Stage4_L15_Input -->
<g id="node389" class="node">
<title>R1_Stage4_L15_Input</title>
<ellipse fill="lightblue" stroke="black" cx="50680" cy="-1969" rx="225.5" ry="29"/>
<text text-anchor="middle" x="50680" y="-1977.5" font-family="Times,serif" font-size="10.00">Layer 15 Input</text>
<text text-anchor="middle" x="50680" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="50680" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Attn_Input -->
<g id="node390" class="node">
<title>R1_Stage4_L15_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="50680" cy="-1778" rx="225.5" ry="29"/>
<text text-anchor="middle" x="50680" y="-1786.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="50680" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="50680" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Input&#45;&gt;R1_Stage4_L15_Attn_Input -->
<g id="edge611" class="edge">
<title>R1_Stage4_L15_Input&#45;&gt;R1_Stage4_L15_Attn_Input</title>
<path fill="none" stroke="black" d="M50680,-1939.99C50680,-1939.99 50680,-1817.28 50680,-1817.28"/>
<polygon fill="black" stroke="black" points="50683.5,-1817.28 50680,-1807.28 50676.5,-1817.28 50683.5,-1817.28"/>
</g>
<!-- R1_Stage4_L15_Attn_TP1 -->
<g id="node391" class="node">
<title>R1_Stage4_L15_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="50723,-1630 50377,-1630 50377,-1572 50723,-1572 50723,-1630"/>
<text text-anchor="middle" x="50550" y="-1615" font-family="Times,serif" font-size="10.00">Attention TP GPU 48</text>
<text text-anchor="middle" x="50550" y="-1604" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="50550" y="-1593" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="50550" y="-1582" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage4_L15_Attn_Input&#45;&gt;R1_Stage4_L15_Attn_TP1 -->
<g id="edge612" class="edge">
<title>R1_Stage4_L15_Attn_Input&#45;&gt;R1_Stage4_L15_Attn_TP1</title>
<path fill="none" stroke="black" d="M50588.75,-1751.12C50588.75,-1751.12 50588.75,-1640.2 50588.75,-1640.2"/>
<polygon fill="black" stroke="black" points="50592.25,-1640.2 50588.75,-1630.2 50585.25,-1640.2 50592.25,-1640.2"/>
</g>
<!-- R1_Stage4_L15_Attn_TP2 -->
<g id="node392" class="node">
<title>R1_Stage4_L15_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="51105,-1630 50759,-1630 50759,-1572 51105,-1572 51105,-1630"/>
<text text-anchor="middle" x="50932" y="-1615" font-family="Times,serif" font-size="10.00">Attention TP GPU 49</text>
<text text-anchor="middle" x="50932" y="-1604" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="50932" y="-1593" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="50932" y="-1582" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage4_L15_Attn_Input&#45;&gt;R1_Stage4_L15_Attn_TP2 -->
<g id="edge613" class="edge">
<title>R1_Stage4_L15_Attn_Input&#45;&gt;R1_Stage4_L15_Attn_TP2</title>
<path fill="none" stroke="black" d="M50832.25,-1756.3C50832.25,-1756.3 50832.25,-1640.24 50832.25,-1640.24"/>
<polygon fill="black" stroke="black" points="50835.75,-1640.24 50832.25,-1630.24 50828.75,-1640.24 50835.75,-1640.24"/>
</g>
<!-- R1_Stage4_L15_Attn_Output -->
<g id="node393" class="node">
<title>R1_Stage4_L15_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="50645" cy="-1424" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="50645" y="-1438" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="50645" y="-1427" font-family="Times,serif" font-size="10.00">AllReduce GPUs 48&#45;49</text>
<text text-anchor="middle" x="50645" y="-1416" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="50645" y="-1405" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Attn_TP1&#45;&gt;R1_Stage4_L15_Attn_Output -->
<g id="edge614" class="edge">
<title>R1_Stage4_L15_Attn_TP1&#45;&gt;R1_Stage4_L15_Attn_Output</title>
<path fill="none" stroke="black" d="M50562.38,-1571.77C50562.38,-1571.77 50562.38,-1468.75 50562.38,-1468.75"/>
<polygon fill="black" stroke="black" points="50565.88,-1468.75 50562.38,-1458.75 50558.88,-1468.75 50565.88,-1468.75"/>
</g>
<!-- R1_Stage4_L15_Attn_TP2&#45;&gt;R1_Stage4_L15_Attn_Output -->
<g id="edge615" class="edge">
<title>R1_Stage4_L15_Attn_TP2&#45;&gt;R1_Stage4_L15_Attn_Output</title>
<path fill="none" stroke="black" d="M50823.62,-1571.77C50823.62,-1571.77 50823.62,-1458.98 50823.62,-1458.98"/>
<polygon fill="black" stroke="black" points="50827.12,-1458.98 50823.62,-1448.98 50820.12,-1458.98 50827.12,-1458.98"/>
</g>
<!-- R1_Stage4_L15_MoE_Input -->
<g id="node394" class="node">
<title>R1_Stage4_L15_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="50386" cy="-1233" rx="225.5" ry="29"/>
<text text-anchor="middle" x="50386" y="-1241.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="50386" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="50386" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Attn_Output&#45;&gt;R1_Stage4_L15_MoE_Input -->
<g id="edge616" class="edge">
<title>R1_Stage4_L15_Attn_Output&#45;&gt;R1_Stage4_L15_MoE_Input</title>
<path fill="none" stroke="black" d="M50506.63,-1393.74C50506.63,-1393.74 50506.63,-1267.66 50506.63,-1267.66"/>
<polygon fill="black" stroke="black" points="50510.13,-1267.66 50506.63,-1257.66 50503.13,-1267.66 50510.13,-1267.66"/>
</g>
<!-- R1_Stage4_L15_Router -->
<g id="node395" class="node">
<title>R1_Stage4_L15_Router</title>
<polygon fill="lightyellow" stroke="black" points="50770.36,-1094 50257.56,-1094 50125.64,-990 50638.44,-990 50770.36,-1094"/>
<text text-anchor="middle" x="50448" y="-1056" font-family="Times,serif" font-size="10.00">Router GPU 48</text>
<text text-anchor="middle" x="50448" y="-1045" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="50448" y="-1034" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="50448" y="-1023" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage4_L15_MoE_Input&#45;&gt;R1_Stage4_L15_Router -->
<g id="edge617" class="edge">
<title>R1_Stage4_L15_MoE_Input&#45;&gt;R1_Stage4_L15_Router</title>
<path fill="none" stroke="black" d="M50386,-1203.99C50386,-1203.99 50386,-1104.02 50386,-1104.02"/>
<polygon fill="black" stroke="black" points="50389.5,-1104.02 50386,-1094.02 50382.5,-1104.02 50389.5,-1104.02"/>
</g>
<!-- R1_Stage4_L15_Expert0 -->
<g id="node396" class="node">
<title>R1_Stage4_L15_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="55018,-880 54758,-880 54758,-822 55018,-822 55018,-880"/>
<text text-anchor="middle" x="54888" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 48</text>
<text text-anchor="middle" x="54888" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54888" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert0 -->
<g id="edge618" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50748.08,-1041.95C50748.08,-1039.98 50748.08,-977 50748.08,-977 50748.08,-977 54778.33,-977 54778.33,-977 54778.33,-977 54778.33,-890.22 54778.33,-890.22"/>
<polygon fill="black" stroke="black" points="54781.83,-890.22 54778.33,-880.22 54774.83,-890.22 54781.83,-890.22"/>
<text text-anchor="middle" x="52126.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert1 -->
<g id="node397" class="node">
<title>R1_Stage4_L15_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="50578,-880 50318,-880 50318,-822 50578,-822 50578,-880"/>
<text text-anchor="middle" x="50448" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 49</text>
<text text-anchor="middle" x="50448" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="50448" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert1 -->
<g id="edge619" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50448,-989.81C50448,-989.81 50448,-890.01 50448,-890.01"/>
<polygon fill="black" stroke="black" points="50451.5,-890.01 50448,-880.01 50444.5,-890.01 50451.5,-890.01"/>
<text text-anchor="middle" x="50469.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert2 -->
<g id="node398" class="node">
<title>R1_Stage4_L15_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="50874,-880 50614,-880 50614,-822 50874,-822 50874,-880"/>
<text text-anchor="middle" x="50744" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 50</text>
<text text-anchor="middle" x="50744" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="50744" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert2 -->
<g id="edge620" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50759.26,-1041.86C50759.26,-1041.86 50759.26,-890.01 50759.26,-890.01"/>
<polygon fill="black" stroke="black" points="50762.76,-890.01 50759.26,-880.01 50755.76,-890.01 50762.76,-890.01"/>
<text text-anchor="middle" x="50659.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert3 -->
<g id="node399" class="node">
<title>R1_Stage4_L15_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="53834,-880 53574,-880 53574,-822 53834,-822 53834,-880"/>
<text text-anchor="middle" x="53704" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 51</text>
<text text-anchor="middle" x="53704" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53704" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert3 -->
<g id="edge621" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50703.39,-1040.98C50703.39,-1030.98 50703.39,-951 50703.39,-951 50703.39,-951 53594.33,-951 53594.33,-951 53594.33,-951 53594.33,-890.19 53594.33,-890.19"/>
<polygon fill="black" stroke="black" points="53597.83,-890.19 53594.33,-880.19 53590.83,-890.19 53597.83,-890.19"/>
<text text-anchor="middle" x="51790.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert4 -->
<g id="node400" class="node">
<title>R1_Stage4_L15_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="51466,-880 51206,-880 51206,-822 51466,-822 51466,-880"/>
<text text-anchor="middle" x="51336" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 52</text>
<text text-anchor="middle" x="51336" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51336" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert4 -->
<g id="edge622" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50657.5,-1005C50873.54,-1005 51179.09,-1005 51179.09,-1005 51179.09,-1005 51179.09,-851 51179.09,-851 51179.09,-851 51195.71,-851 51195.71,-851"/>
<polygon fill="black" stroke="black" points="51195.71,-854.5 51205.71,-851 51195.71,-847.5 51195.71,-854.5"/>
<text text-anchor="middle" x="50938.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert5 -->
<g id="node401" class="node">
<title>R1_Stage4_L15_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="52058,-880 51798,-880 51798,-822 52058,-822 52058,-880"/>
<text text-anchor="middle" x="51928" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 53</text>
<text text-anchor="middle" x="51928" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51928" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert5 -->
<g id="edge623" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50636.35,-989.87C50636.35,-953.71 50636.35,-912 50636.35,-912 50636.35,-912 51828.36,-912 51828.36,-912 51828.36,-912 51828.36,-890.07 51828.36,-890.07"/>
<polygon fill="black" stroke="black" points="51831.86,-890.07 51828.36,-880.07 51824.86,-890.07 51831.86,-890.07"/>
<text text-anchor="middle" x="51133.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert6 -->
<g id="node402" class="node">
<title>R1_Stage4_L15_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="52354,-880 52094,-880 52094,-822 52354,-822 52354,-880"/>
<text text-anchor="middle" x="52224" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 54</text>
<text text-anchor="middle" x="52224" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52224" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert6 -->
<g id="edge624" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50647.52,-996.9C50647.52,-961.79 50647.52,-919 50647.52,-919 50647.52,-919 52114.33,-919 52114.33,-919 52114.33,-919 52114.33,-890.23 52114.33,-890.23"/>
<polygon fill="black" stroke="black" points="52117.83,-890.23 52114.33,-880.23 52110.83,-890.23 52117.83,-890.23"/>
<text text-anchor="middle" x="51222.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert7 -->
<g id="node403" class="node">
<title>R1_Stage4_L15_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="52650,-880 52390,-880 52390,-822 52650,-822 52650,-880"/>
<text text-anchor="middle" x="52520" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 55</text>
<text text-anchor="middle" x="52520" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52520" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert7 -->
<g id="edge625" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50658.69,-1005.94C50658.69,-971.56 50658.69,-925 50658.69,-925 50658.69,-925 52410.33,-925 52410.33,-925 52410.33,-925 52410.33,-890.25 52410.33,-890.25"/>
<polygon fill="black" stroke="black" points="52413.83,-890.25 52410.33,-880.25 52406.83,-890.25 52413.83,-890.25"/>
<text text-anchor="middle" x="51308.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert8 -->
<g id="node404" class="node">
<title>R1_Stage4_L15_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="54426,-880 54166,-880 54166,-822 54426,-822 54426,-880"/>
<text text-anchor="middle" x="54296" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 56</text>
<text text-anchor="middle" x="54296" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54296" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert8 -->
<g id="edge626" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50725.74,-1041.94C50725.74,-1039.58 50725.74,-964 50725.74,-964 50725.74,-964 54186.33,-964 54186.33,-964 54186.33,-964 54186.33,-890.1 54186.33,-890.1"/>
<polygon fill="black" stroke="black" points="54189.83,-890.1 54186.33,-880.1 54182.83,-890.1 54189.83,-890.1"/>
<text text-anchor="middle" x="51958.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert9 -->
<g id="node405" class="node">
<title>R1_Stage4_L15_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="52946,-880 52686,-880 52686,-822 52946,-822 52946,-880"/>
<text text-anchor="middle" x="52816" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 57</text>
<text text-anchor="middle" x="52816" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52816" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert9 -->
<g id="edge627" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50669.87,-1014.53C50669.87,-981.94 50669.87,-932 50669.87,-932 50669.87,-932 52706.33,-932 52706.33,-932 52706.33,-932 52706.33,-890.24 52706.33,-890.24"/>
<polygon fill="black" stroke="black" points="52709.83,-890.24 52706.33,-880.24 52702.83,-890.24 52709.83,-890.24"/>
<text text-anchor="middle" x="51393.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert10 -->
<g id="node406" class="node">
<title>R1_Stage4_L15_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="53242,-880 52982,-880 52982,-822 53242,-822 53242,-880"/>
<text text-anchor="middle" x="53112" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 58</text>
<text text-anchor="middle" x="53112" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53112" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert10 -->
<g id="edge628" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50681.04,-1023.41C50681.04,-993.49 50681.04,-938 50681.04,-938 50681.04,-938 53002.33,-938 53002.33,-938 53002.33,-938 53002.33,-890.45 53002.33,-890.45"/>
<polygon fill="black" stroke="black" points="53005.83,-890.45 53002.33,-880.45 52998.83,-890.45 53005.83,-890.45"/>
<text text-anchor="middle" x="51478.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert11 -->
<g id="node407" class="node">
<title>R1_Stage4_L15_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="53538,-880 53278,-880 53278,-822 53538,-822 53538,-880"/>
<text text-anchor="middle" x="53408" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 59</text>
<text text-anchor="middle" x="53408" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53408" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert11 -->
<g id="edge629" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50692.22,-1032.25C50692.22,-1007.46 50692.22,-944 50692.22,-944 50692.22,-944 53298.33,-944 53298.33,-944 53298.33,-944 53298.33,-890.17 53298.33,-890.17"/>
<polygon fill="black" stroke="black" points="53301.83,-890.17 53298.33,-880.17 53294.83,-890.17 53301.83,-890.17"/>
<text text-anchor="middle" x="51706.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert12 -->
<g id="node408" class="node">
<title>R1_Stage4_L15_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="54130,-880 53870,-880 53870,-822 54130,-822 54130,-880"/>
<text text-anchor="middle" x="54000" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 60</text>
<text text-anchor="middle" x="54000" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54000" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert12 -->
<g id="edge630" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50714.56,-1041.94C50714.56,-1039.36 50714.56,-957 50714.56,-957 50714.56,-957 53890.33,-957 53890.33,-957 53890.33,-957 53890.33,-890.25 53890.33,-890.25"/>
<polygon fill="black" stroke="black" points="53893.83,-890.25 53890.33,-880.25 53886.83,-890.25 53893.83,-890.25"/>
<text text-anchor="middle" x="51874.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert13 -->
<g id="node409" class="node">
<title>R1_Stage4_L15_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="51170,-880 50910,-880 50910,-822 51170,-822 51170,-880"/>
<text text-anchor="middle" x="51040" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 61</text>
<text text-anchor="middle" x="51040" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51040" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert13 -->
<g id="edge631" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50647.37,-997C50803.29,-997 50993.81,-997 50993.81,-997 50993.81,-997 50993.81,-890.19 50993.81,-890.19"/>
<polygon fill="black" stroke="black" points="50997.31,-890.19 50993.81,-880.19 50990.31,-890.19 50997.31,-890.19"/>
<text text-anchor="middle" x="50817.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert14 -->
<g id="node410" class="node">
<title>R1_Stage4_L15_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="51762,-880 51502,-880 51502,-822 51762,-822 51762,-880"/>
<text text-anchor="middle" x="51632" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 62</text>
<text text-anchor="middle" x="51632" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51632" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert14 -->
<g id="edge632" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50625.17,-989.81C50625.17,-951.46 50625.17,-906 50625.17,-906 50625.17,-906 51632,-906 51632,-906 51632,-906 51632,-890.11 51632,-890.11"/>
<polygon fill="black" stroke="black" points="51635.5,-890.11 51632,-880.11 51628.5,-890.11 51635.5,-890.11"/>
<text text-anchor="middle" x="51040.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_Expert15 -->
<g id="node411" class="node">
<title>R1_Stage4_L15_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="54722,-880 54462,-880 54462,-822 54722,-822 54722,-880"/>
<text text-anchor="middle" x="54592" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 63</text>
<text text-anchor="middle" x="54592" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54592" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert15 -->
<g id="edge633" class="edge">
<title>R1_Stage4_L15_Router&#45;&gt;R1_Stage4_L15_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50736.91,-1041.95C50736.91,-1039.77 50736.91,-970 50736.91,-970 50736.91,-970 54482.33,-970 54482.33,-970 54482.33,-970 54482.33,-890.11 54482.33,-890.11"/>
<polygon fill="black" stroke="black" points="54485.83,-890.11 54482.33,-880.11 54478.83,-890.11 54485.83,-890.11"/>
<text text-anchor="middle" x="52042.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L15_MoE_Output -->
<g id="node412" class="node">
<title>R1_Stage4_L15_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="55035.95,-712 54509.48,-712 54374.05,-608 54900.52,-608 55035.95,-712"/>
<text text-anchor="middle" x="54705" y="-674" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="54705" y="-663" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="54705" y="-652" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="54705" y="-641" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L15_Expert0&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge634" class="edge">
<title>R1_Stage4_L15_Expert0&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M54888,-821.99C54888,-821.99 54888,-722.02 54888,-722.02"/>
<polygon fill="black" stroke="black" points="54891.5,-722.02 54888,-712.02 54884.5,-722.02 54891.5,-722.02"/>
</g>
<!-- R1_Stage4_L15_Expert1&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge635" class="edge">
<title>R1_Stage4_L15_Expert1&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M50560.67,-821.84C50560.67,-775.45 50560.67,-690 50560.67,-690 50560.67,-690 54470.71,-690 54470.71,-690"/>
<polygon fill="black" stroke="black" points="54470.71,-693.5 54480.71,-690 54470.71,-686.5 54470.71,-693.5"/>
</g>
<!-- R1_Stage4_L15_Expert2&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge636" class="edge">
<title>R1_Stage4_L15_Expert2&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M50856.67,-821.84C50856.67,-775.93 50856.67,-692 50856.67,-692 50856.67,-692 54473.22,-692 54473.22,-692"/>
<polygon fill="black" stroke="black" points="54473.22,-695.5 54483.22,-692 54473.22,-688.5 54473.22,-695.5"/>
</g>
<!-- R1_Stage4_L15_Expert3&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge637" class="edge">
<title>R1_Stage4_L15_Expert3&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M53808,-821.72C53808,-779.88 53808,-708 53808,-708 53808,-708 54494.25,-708 54494.25,-708"/>
<polygon fill="black" stroke="black" points="54494.25,-711.5 54504.25,-708 54494.25,-704.5 54494.25,-711.5"/>
</g>
<!-- R1_Stage4_L15_Expert4&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge638" class="edge">
<title>R1_Stage4_L15_Expert4&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M51448.67,-821.66C51448.67,-776.47 51448.67,-695 51448.67,-695 51448.67,-695 54477.24,-695 54477.24,-695"/>
<polygon fill="black" stroke="black" points="54477.24,-698.5 54487.24,-695 54477.24,-691.5 54477.24,-698.5"/>
</g>
<!-- R1_Stage4_L15_Expert5&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge639" class="edge">
<title>R1_Stage4_L15_Expert5&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M52040.67,-821.86C52040.67,-777.47 52040.67,-698 52040.67,-698 52040.67,-698 54481.19,-698 54481.19,-698"/>
<polygon fill="black" stroke="black" points="54481.19,-701.5 54491.19,-698 54481.19,-694.5 54481.19,-701.5"/>
</g>
<!-- R1_Stage4_L15_Expert6&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge640" class="edge">
<title>R1_Stage4_L15_Expert6&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M52336.67,-821.89C52336.67,-778.01 52336.67,-700 52336.67,-700 52336.67,-700 54483.79,-700 54483.79,-700"/>
<polygon fill="black" stroke="black" points="54483.79,-703.5 54493.79,-700 54483.79,-696.5 54483.79,-703.5"/>
</g>
<!-- R1_Stage4_L15_Expert7&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge641" class="edge">
<title>R1_Stage4_L15_Expert7&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M52632.67,-821.92C52632.67,-778.56 52632.67,-702 52632.67,-702 52632.67,-702 54486.33,-702 54486.33,-702"/>
<polygon fill="black" stroke="black" points="54486.33,-705.5 54496.33,-702 54486.33,-698.5 54486.33,-705.5"/>
</g>
<!-- R1_Stage4_L15_Expert8&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge642" class="edge">
<title>R1_Stage4_L15_Expert8&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M54400.14,-821.99C54400.14,-821.99 54400.14,-670.08 54400.14,-670.08"/>
<polygon fill="black" stroke="black" points="54403.64,-670.08 54400.14,-660.08 54396.64,-670.08 54403.64,-670.08"/>
</g>
<!-- R1_Stage4_L15_Expert9&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge643" class="edge">
<title>R1_Stage4_L15_Expert9&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M52928.67,-821.76C52928.67,-778.63 52928.67,-703 52928.67,-703 52928.67,-703 54487.76,-703 54487.76,-703"/>
<polygon fill="black" stroke="black" points="54487.76,-706.5 54497.76,-703 54487.76,-699.5 54487.76,-706.5"/>
</g>
<!-- R1_Stage4_L15_Expert10&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge644" class="edge">
<title>R1_Stage4_L15_Expert10&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M53224.67,-821.81C53224.67,-779.2 53224.67,-705 53224.67,-705 53224.67,-705 54490.33,-705 54490.33,-705"/>
<polygon fill="black" stroke="black" points="54490.33,-708.5 54500.33,-705 54490.33,-701.5 54490.33,-708.5"/>
</g>
<!-- R1_Stage4_L15_Expert11&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge645" class="edge">
<title>R1_Stage4_L15_Expert11&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M53520.67,-821.86C53520.67,-779.78 53520.67,-707 53520.67,-707 53520.67,-707 54492.75,-707 54492.75,-707"/>
<polygon fill="black" stroke="black" points="54492.75,-710.5 54502.75,-707 54492.75,-703.5 54492.75,-710.5"/>
</g>
<!-- R1_Stage4_L15_Expert12&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge646" class="edge">
<title>R1_Stage4_L15_Expert12&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M54104,-821.78C54104,-780.48 54104,-710 54104,-710 54104,-710 54496.54,-710 54496.54,-710"/>
<polygon fill="black" stroke="black" points="54496.54,-713.5 54506.54,-710 54496.54,-706.5 54496.54,-713.5"/>
</g>
<!-- R1_Stage4_L15_Expert13&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge647" class="edge">
<title>R1_Stage4_L15_Expert13&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M51152.67,-821.65C51152.67,-775.96 51152.67,-693 51152.67,-693 51152.67,-693 54474.46,-693 54474.46,-693"/>
<polygon fill="black" stroke="black" points="54474.46,-696.5 54484.46,-693 54474.46,-689.5 54474.46,-696.5"/>
</g>
<!-- R1_Stage4_L15_Expert14&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge648" class="edge">
<title>R1_Stage4_L15_Expert14&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M51744.67,-821.67C51744.67,-776.99 51744.67,-697 51744.67,-697 51744.67,-697 54479.72,-697 54479.72,-697"/>
<polygon fill="black" stroke="black" points="54479.72,-700.5 54489.72,-697 54479.72,-693.5 54479.72,-700.5"/>
</g>
<!-- R1_Stage4_L15_Expert15&#45;&gt;R1_Stage4_L15_MoE_Output -->
<g id="edge649" class="edge">
<title>R1_Stage4_L15_Expert15&#45;&gt;R1_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M54592,-821.99C54592,-821.99 54592,-722.02 54592,-722.02"/>
<polygon fill="black" stroke="black" points="54595.5,-722.02 54592,-712.02 54588.5,-722.02 54595.5,-722.02"/>
</g>
<!-- R1_Stage4_L15_MoE_Output&#45;&gt;R1_Stage4_L15_Output -->
<g id="edge650" class="edge">
<title>R1_Stage4_L15_MoE_Output&#45;&gt;R1_Stage4_L15_Output</title>
<path fill="none" stroke="black" d="M54705,-607.85C54705,-607.85 54705,-522.22 54705,-522.22"/>
<polygon fill="black" stroke="black" points="54708.5,-522.22 54705,-512.22 54701.5,-522.22 54708.5,-522.22"/>
</g>
<!-- R1_Stage4_L16_Input -->
<g id="node413" class="node">
<title>R1_Stage4_L16_Input</title>
<ellipse fill="lightblue" stroke="black" cx="50028" cy="-1778" rx="225.5" ry="29"/>
<text text-anchor="middle" x="50028" y="-1786.5" font-family="Times,serif" font-size="10.00">Layer 16 Input</text>
<text text-anchor="middle" x="50028" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="50028" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Attn_Input -->
<g id="node414" class="node">
<title>R1_Stage4_L16_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="50028" cy="-1601" rx="225.5" ry="29"/>
<text text-anchor="middle" x="50028" y="-1609.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="50028" y="-1598.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="50028" y="-1587.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Input&#45;&gt;R1_Stage4_L16_Attn_Input -->
<g id="edge651" class="edge">
<title>R1_Stage4_L16_Input&#45;&gt;R1_Stage4_L16_Attn_Input</title>
<path fill="none" stroke="black" d="M50028,-1748.77C50028,-1748.77 50028,-1640.27 50028,-1640.27"/>
<polygon fill="black" stroke="black" points="50031.5,-1640.27 50028,-1630.27 50024.5,-1640.27 50031.5,-1640.27"/>
</g>
<!-- R1_Stage4_L16_Attn_TP1 -->
<g id="node415" class="node">
<title>R1_Stage4_L16_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="49984,-1453 49638,-1453 49638,-1395 49984,-1395 49984,-1453"/>
<text text-anchor="middle" x="49811" y="-1438" font-family="Times,serif" font-size="10.00">Attention TP GPU 48</text>
<text text-anchor="middle" x="49811" y="-1427" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="49811" y="-1416" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="49811" y="-1405" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage4_L16_Attn_Input&#45;&gt;R1_Stage4_L16_Attn_TP1 -->
<g id="edge652" class="edge">
<title>R1_Stage4_L16_Attn_Input&#45;&gt;R1_Stage4_L16_Attn_TP1</title>
<path fill="none" stroke="black" d="M49893.25,-1577.5C49893.25,-1577.5 49893.25,-1463.2 49893.25,-1463.2"/>
<polygon fill="black" stroke="black" points="49896.75,-1463.2 49893.25,-1453.2 49889.75,-1463.2 49896.75,-1463.2"/>
</g>
<!-- R1_Stage4_L16_Attn_TP2 -->
<g id="node416" class="node">
<title>R1_Stage4_L16_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="50366,-1453 50020,-1453 50020,-1395 50366,-1395 50366,-1453"/>
<text text-anchor="middle" x="50193" y="-1438" font-family="Times,serif" font-size="10.00">Attention TP GPU 49</text>
<text text-anchor="middle" x="50193" y="-1427" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="50193" y="-1416" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="50193" y="-1405" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R1_Stage4_L16_Attn_Input&#45;&gt;R1_Stage4_L16_Attn_TP2 -->
<g id="edge653" class="edge">
<title>R1_Stage4_L16_Attn_Input&#45;&gt;R1_Stage4_L16_Attn_TP2</title>
<path fill="none" stroke="black" d="M50136.75,-1575.26C50136.75,-1575.26 50136.75,-1463.01 50136.75,-1463.01"/>
<polygon fill="black" stroke="black" points="50140.25,-1463.01 50136.75,-1453.01 50133.25,-1463.01 50140.25,-1463.01"/>
</g>
<!-- R1_Stage4_L16_Attn_Output -->
<g id="node417" class="node">
<title>R1_Stage4_L16_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="49881" cy="-1233" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="49881" y="-1247" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="49881" y="-1236" font-family="Times,serif" font-size="10.00">AllReduce GPUs 48&#45;49</text>
<text text-anchor="middle" x="49881" y="-1225" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="49881" y="-1214" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Attn_TP1&#45;&gt;R1_Stage4_L16_Attn_Output -->
<g id="edge654" class="edge">
<title>R1_Stage4_L16_Attn_TP1&#45;&gt;R1_Stage4_L16_Attn_Output</title>
<path fill="none" stroke="black" d="M49811,-1394.99C49811,-1394.99 49811,-1278.47 49811,-1278.47"/>
<polygon fill="black" stroke="black" points="49814.5,-1278.47 49811,-1268.47 49807.5,-1278.47 49814.5,-1278.47"/>
</g>
<!-- R1_Stage4_L16_Attn_TP2&#45;&gt;R1_Stage4_L16_Attn_Output -->
<g id="edge655" class="edge">
<title>R1_Stage4_L16_Attn_TP2&#45;&gt;R1_Stage4_L16_Attn_Output</title>
<path fill="none" stroke="black" d="M50072.12,-1394.99C50072.12,-1394.99 50072.12,-1265.97 50072.12,-1265.97"/>
<polygon fill="black" stroke="black" points="50075.62,-1265.97 50072.12,-1255.97 50068.62,-1265.97 50075.62,-1265.97"/>
</g>
<!-- R1_Stage4_L16_MoE_Input -->
<g id="node418" class="node">
<title>R1_Stage4_L16_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="49864" cy="-1042" rx="225.5" ry="29"/>
<text text-anchor="middle" x="49864" y="-1050.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="49864" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="49864" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Attn_Output&#45;&gt;R1_Stage4_L16_MoE_Input -->
<g id="edge656" class="edge">
<title>R1_Stage4_L16_Attn_Output&#45;&gt;R1_Stage4_L16_MoE_Input</title>
<path fill="none" stroke="black" d="M49864,-1196.17C49864,-1196.17 49864,-1081.22 49864,-1081.22"/>
<polygon fill="black" stroke="black" points="49867.5,-1081.22 49864,-1071.22 49860.5,-1081.22 49867.5,-1081.22"/>
</g>
<!-- R1_Stage4_L16_Router -->
<g id="node419" class="node">
<title>R1_Stage4_L16_Router</title>
<polygon fill="lightyellow" stroke="black" points="50282.36,-903 49769.56,-903 49637.64,-799 50150.44,-799 50282.36,-903"/>
<text text-anchor="middle" x="49960" y="-865" font-family="Times,serif" font-size="10.00">Router GPU 48</text>
<text text-anchor="middle" x="49960" y="-854" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="49960" y="-843" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="49960" y="-832" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R1_Stage4_L16_MoE_Input&#45;&gt;R1_Stage4_L16_Router -->
<g id="edge657" class="edge">
<title>R1_Stage4_L16_MoE_Input&#45;&gt;R1_Stage4_L16_Router</title>
<path fill="none" stroke="black" d="M49864,-1012.99C49864,-1012.99 49864,-913.02 49864,-913.02"/>
<polygon fill="black" stroke="black" points="49867.5,-913.02 49864,-903.02 49860.5,-913.02 49867.5,-913.02"/>
</g>
<!-- R1_Stage4_L16_Expert0 -->
<g id="node420" class="node">
<title>R1_Stage4_L16_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="51082,-689 50822,-689 50822,-631 51082,-631 51082,-689"/>
<text text-anchor="middle" x="50952" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 48</text>
<text text-anchor="middle" x="50952" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="50952" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert0 -->
<g id="edge658" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50156.79,-804C50416,-804 50839.33,-804 50839.33,-804 50839.33,-804 50839.33,-699.14 50839.33,-699.14"/>
<polygon fill="black" stroke="black" points="50842.83,-699.14 50839.33,-689.14 50835.83,-699.14 50842.83,-699.14"/>
<text text-anchor="middle" x="50398.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert1 -->
<g id="node421" class="node">
<title>R1_Stage4_L16_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="51378,-689 51118,-689 51118,-631 51378,-631 51378,-689"/>
<text text-anchor="middle" x="51248" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 49</text>
<text text-anchor="middle" x="51248" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51248" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert1 -->
<g id="edge659" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50159.38,-806C50494.71,-806 51135.33,-806 51135.33,-806 51135.33,-806 51135.33,-699.19 51135.33,-699.19"/>
<polygon fill="black" stroke="black" points="51138.83,-699.19 51135.33,-689.19 51131.83,-699.19 51138.83,-699.19"/>
<text text-anchor="middle" x="50490.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert2 -->
<g id="node422" class="node">
<title>R1_Stage4_L16_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="51674,-689 51414,-689 51414,-631 51674,-631 51674,-689"/>
<text text-anchor="middle" x="51544" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 50</text>
<text text-anchor="middle" x="51544" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51544" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert2 -->
<g id="edge660" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50160.73,-807C50563.36,-807 51431.33,-807 51431.33,-807 51431.33,-807 51431.33,-699.04 51431.33,-699.04"/>
<polygon fill="black" stroke="black" points="51434.83,-699.04 51431.33,-689.04 51427.83,-699.04 51434.83,-699.04"/>
<text text-anchor="middle" x="50578.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert3 -->
<g id="node423" class="node">
<title>R1_Stage4_L16_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="51970,-689 51710,-689 51710,-631 51970,-631 51970,-689"/>
<text text-anchor="middle" x="51840" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 51</text>
<text text-anchor="middle" x="51840" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="51840" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert3 -->
<g id="edge661" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50163.17,-809C50627.64,-809 51727.33,-809 51727.33,-809 51727.33,-809 51727.33,-699.08 51727.33,-699.08"/>
<polygon fill="black" stroke="black" points="51730.83,-699.08 51727.33,-689.08 51723.83,-699.08 51730.83,-699.08"/>
<text text-anchor="middle" x="50664.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert4 -->
<g id="node424" class="node">
<title>R1_Stage4_L16_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="52266,-689 52006,-689 52006,-631 52266,-631 52266,-689"/>
<text text-anchor="middle" x="52136" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 52</text>
<text text-anchor="middle" x="52136" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52136" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert4 -->
<g id="edge662" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50165.86,-811C50688.09,-811 52023.33,-811 52023.33,-811 52023.33,-811 52023.33,-699.11 52023.33,-699.11"/>
<polygon fill="black" stroke="black" points="52026.83,-699.11 52023.33,-689.11 52019.83,-699.11 52026.83,-699.11"/>
<text text-anchor="middle" x="50749.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert5 -->
<g id="node425" class="node">
<title>R1_Stage4_L16_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="52562,-689 52302,-689 52302,-631 52562,-631 52562,-689"/>
<text text-anchor="middle" x="52432" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 53</text>
<text text-anchor="middle" x="52432" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52432" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert5 -->
<g id="edge663" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50168.34,-813C50744.91,-813 52319.33,-813 52319.33,-813 52319.33,-813 52319.33,-699.14 52319.33,-699.14"/>
<polygon fill="black" stroke="black" points="52322.83,-699.14 52319.33,-689.14 52315.83,-699.14 52322.83,-699.14"/>
<text text-anchor="middle" x="50834.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert6 -->
<g id="node426" class="node">
<title>R1_Stage4_L16_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="52858,-689 52598,-689 52598,-631 52858,-631 52858,-689"/>
<text text-anchor="middle" x="52728" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 54</text>
<text text-anchor="middle" x="52728" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="52728" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert6 -->
<g id="edge664" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50169.75,-814C50797.01,-814 52615.33,-814 52615.33,-814 52615.33,-814 52615.33,-699.33 52615.33,-699.33"/>
<polygon fill="black" stroke="black" points="52618.83,-699.33 52615.33,-689.33 52611.83,-699.33 52618.83,-699.33"/>
<text text-anchor="middle" x="50918.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert7 -->
<g id="node427" class="node">
<title>R1_Stage4_L16_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="53154,-689 52894,-689 52894,-631 53154,-631 53154,-689"/>
<text text-anchor="middle" x="53024" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 55</text>
<text text-anchor="middle" x="53024" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53024" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert7 -->
<g id="edge665" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50172.25,-816C50848.97,-816 52911.33,-816 52911.33,-816 52911.33,-816 52911.33,-699.34 52911.33,-699.34"/>
<polygon fill="black" stroke="black" points="52914.83,-699.34 52911.33,-689.34 52907.83,-699.34 52914.83,-699.34"/>
<text text-anchor="middle" x="51002.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert8 -->
<g id="node428" class="node">
<title>R1_Stage4_L16_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="53450,-689 53190,-689 53190,-631 53450,-631 53450,-689"/>
<text text-anchor="middle" x="53320" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 56</text>
<text text-anchor="middle" x="53320" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53320" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert8 -->
<g id="edge666" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50174.64,-818C50898.85,-818 53207.33,-818 53207.33,-818 53207.33,-818 53207.33,-699.35 53207.33,-699.35"/>
<polygon fill="black" stroke="black" points="53210.83,-699.35 53207.33,-689.35 53203.83,-699.35 53210.83,-699.35"/>
<text text-anchor="middle" x="51086.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert9 -->
<g id="node429" class="node">
<title>R1_Stage4_L16_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="53746,-689 53486,-689 53486,-631 53746,-631 53746,-689"/>
<text text-anchor="middle" x="53616" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 57</text>
<text text-anchor="middle" x="53616" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53616" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert9 -->
<g id="edge667" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50177.31,-820C50947.83,-820 53503.33,-820 53503.33,-820 53503.33,-820 53503.33,-699.35 53503.33,-699.35"/>
<polygon fill="black" stroke="black" points="53506.83,-699.35 53503.33,-689.35 53499.83,-699.35 53506.83,-699.35"/>
<text text-anchor="middle" x="51170.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert10 -->
<g id="node430" class="node">
<title>R1_Stage4_L16_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="54042,-689 53782,-689 53782,-631 54042,-631 54042,-689"/>
<text text-anchor="middle" x="53912" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 58</text>
<text text-anchor="middle" x="53912" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="53912" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert10 -->
<g id="edge668" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50254.53,-881C51161.61,-881 53852,-881 53852,-881 53852,-881 53852,-699.35 53852,-699.35"/>
<polygon fill="black" stroke="black" points="53855.5,-699.35 53852,-689.35 53848.5,-699.35 53855.5,-699.35"/>
<text text-anchor="middle" x="51254.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert11 -->
<g id="node431" class="node">
<title>R1_Stage4_L16_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="54338,-689 54078,-689 54078,-631 54338,-631 54338,-689"/>
<text text-anchor="middle" x="54208" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 59</text>
<text text-anchor="middle" x="54208" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="54208" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert11 -->
<g id="edge669" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50257,-883C51212.91,-883 54148,-883 54148,-883 54148,-883 54148,-699.15 54148,-699.15"/>
<polygon fill="black" stroke="black" points="54151.5,-699.15 54148,-689.15 54144.5,-699.15 54151.5,-699.15"/>
<text text-anchor="middle" x="51338.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert12 -->
<g id="node432" class="node">
<title>R1_Stage4_L16_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="49898,-689 49638,-689 49638,-631 49898,-631 49898,-689"/>
<text text-anchor="middle" x="49768" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 60</text>
<text text-anchor="middle" x="49768" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="49768" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert12 -->
<g id="edge670" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M49768,-798.81C49768,-798.81 49768,-699.01 49768,-699.01"/>
<polygon fill="black" stroke="black" points="49771.5,-699.01 49768,-689.01 49764.5,-699.01 49771.5,-699.01"/>
<text text-anchor="middle" x="49843.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert13 -->
<g id="node433" class="node">
<title>R1_Stage4_L16_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="50194,-689 49934,-689 49934,-631 50194,-631 50194,-689"/>
<text text-anchor="middle" x="50064" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 61</text>
<text text-anchor="middle" x="50064" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="50064" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert13 -->
<g id="edge671" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50064,-798.81C50064,-798.81 50064,-699.01 50064,-699.01"/>
<polygon fill="black" stroke="black" points="50067.5,-699.01 50064,-689.01 50060.5,-699.01 50067.5,-699.01"/>
<text text-anchor="middle" x="50033.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert14 -->
<g id="node434" class="node">
<title>R1_Stage4_L16_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="50490,-689 50230,-689 50230,-631 50490,-631 50490,-689"/>
<text text-anchor="middle" x="50360" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 62</text>
<text text-anchor="middle" x="50360" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="50360" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert14 -->
<g id="edge672" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50256.22,-850.86C50256.22,-850.86 50256.22,-699.01 50256.22,-699.01"/>
<polygon fill="black" stroke="black" points="50259.72,-699.01 50256.22,-689.01 50252.72,-699.01 50259.72,-699.01"/>
<text text-anchor="middle" x="50182.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_Expert15 -->
<g id="node435" class="node">
<title>R1_Stage4_L16_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="50786,-689 50526,-689 50526,-631 50786,-631 50786,-689"/>
<text text-anchor="middle" x="50656" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 63</text>
<text text-anchor="middle" x="50656" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="50656" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert15 -->
<g id="edge673" class="edge">
<title>R1_Stage4_L16_Router&#45;&gt;R1_Stage4_L16_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M50154.65,-802C50324.28,-802 50543.33,-802 50543.33,-802 50543.33,-802 50543.33,-699.08 50543.33,-699.08"/>
<polygon fill="black" stroke="black" points="50546.83,-699.08 50543.33,-689.08 50539.83,-699.08 50546.83,-699.08"/>
<text text-anchor="middle" x="50298.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R1_Stage4_L16_MoE_Output -->
<g id="node436" class="node">
<title>R1_Stage4_L16_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="52466.95,-535 51940.48,-535 51805.05,-431 52331.52,-431 52466.95,-535"/>
<text text-anchor="middle" x="52136" y="-497" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="52136" y="-486" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="52136" y="-475" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="52136" y="-464" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R1_Stage4_L16_Expert0&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge674" class="edge">
<title>R1_Stage4_L16_Expert0&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M50952,-630.99C50952,-589.99 50952,-520 50952,-520 50952,-520 51910.9,-520 51910.9,-520"/>
<polygon fill="black" stroke="black" points="51910.9,-523.5 51920.9,-520 51910.9,-516.5 51910.9,-523.5"/>
</g>
<!-- R1_Stage4_L16_Expert1&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge675" class="edge">
<title>R1_Stage4_L16_Expert1&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M51248,-630.86C51248,-590.1 51248,-521 51248,-521 51248,-521 51912.17,-521 51912.17,-521"/>
<polygon fill="black" stroke="black" points="51912.17,-524.5 51922.17,-521 51912.17,-517.5 51912.17,-524.5"/>
</g>
<!-- R1_Stage4_L16_Expert2&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge676" class="edge">
<title>R1_Stage4_L16_Expert2&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M51544,-630.95C51544,-590.73 51544,-523 51544,-523 51544,-523 51914.78,-523 51914.78,-523"/>
<polygon fill="black" stroke="black" points="51914.78,-526.5 51924.78,-523 51914.78,-519.5 51914.78,-526.5"/>
</g>
<!-- R1_Stage4_L16_Expert3&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge677" class="edge">
<title>R1_Stage4_L16_Expert3&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M51887.64,-630.77C51887.64,-630.77 51887.64,-504.66 51887.64,-504.66"/>
<polygon fill="black" stroke="black" points="51891.14,-504.66 51887.64,-494.66 51884.14,-504.66 51891.14,-504.66"/>
</g>
<!-- R1_Stage4_L16_Expert4&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge678" class="edge">
<title>R1_Stage4_L16_Expert4&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M52136,-630.77C52136,-630.77 52136,-545.18 52136,-545.18"/>
<polygon fill="black" stroke="black" points="52139.5,-545.18 52136,-535.18 52132.5,-545.18 52139.5,-545.18"/>
</g>
<!-- R1_Stage4_L16_Expert5&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge679" class="edge">
<title>R1_Stage4_L16_Expert5&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M52384.36,-630.77C52384.36,-630.77 52384.36,-545.18 52384.36,-545.18"/>
<polygon fill="black" stroke="black" points="52387.86,-545.18 52384.36,-535.18 52380.86,-545.18 52387.86,-545.18"/>
</g>
<!-- R1_Stage4_L16_Expert6&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge680" class="edge">
<title>R1_Stage4_L16_Expert6&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M52728,-630.73C52728,-592.67 52728,-531 52728,-531 52728,-531 52471.87,-531 52471.87,-531"/>
<polygon fill="black" stroke="black" points="52471.87,-527.5 52461.87,-531 52471.87,-534.5 52471.87,-527.5"/>
</g>
<!-- R1_Stage4_L16_Expert7&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge681" class="edge">
<title>R1_Stage4_L16_Expert7&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M53024,-630.7C53024,-591.82 53024,-528 53024,-528 53024,-528 52467.84,-528 52467.84,-528"/>
<polygon fill="black" stroke="black" points="52467.84,-524.5 52457.84,-528 52467.84,-531.5 52467.84,-524.5"/>
</g>
<!-- R1_Stage4_L16_Expert8&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge682" class="edge">
<title>R1_Stage4_L16_Expert8&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M53364.83,-630.71C53364.83,-591 53364.83,-525 53364.83,-525 53364.83,-525 52464.05,-525 52464.05,-525"/>
<polygon fill="black" stroke="black" points="52464.05,-521.5 52454.05,-525 52464.05,-528.5 52464.05,-521.5"/>
</g>
<!-- R1_Stage4_L16_Expert9&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge683" class="edge">
<title>R1_Stage4_L16_Expert9&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M53539.17,-630.86C53539.17,-590.1 53539.17,-521 53539.17,-521 53539.17,-521 52459.15,-521 52459.15,-521"/>
<polygon fill="black" stroke="black" points="52459.15,-517.5 52449.15,-521 52459.15,-524.5 52459.15,-517.5"/>
</g>
<!-- R1_Stage4_L16_Expert10&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge684" class="edge">
<title>R1_Stage4_L16_Expert10&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M53912,-630.92C53912,-589.38 53912,-518 53912,-518 53912,-518 52454.85,-518 52454.85,-518"/>
<polygon fill="black" stroke="black" points="52454.85,-514.5 52444.85,-518 52454.85,-521.5 52454.85,-514.5"/>
</g>
<!-- R1_Stage4_L16_Expert11&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge685" class="edge">
<title>R1_Stage4_L16_Expert11&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M54208,-630.66C54208,-588.29 54208,-515 54208,-515 54208,-515 52451.17,-515 52451.17,-515"/>
<polygon fill="black" stroke="black" points="52451.17,-511.5 52441.17,-515 52451.17,-518.5 52451.17,-511.5"/>
</g>
<!-- R1_Stage4_L16_Expert12&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge686" class="edge">
<title>R1_Stage4_L16_Expert12&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M49768,-630.96C49768,-588.12 49768,-513 49768,-513 49768,-513 51901.62,-513 51901.62,-513"/>
<polygon fill="black" stroke="black" points="51901.62,-516.5 51911.62,-513 51901.62,-509.5 51901.62,-516.5"/>
</g>
<!-- R1_Stage4_L16_Expert13&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge687" class="edge">
<title>R1_Stage4_L16_Expert13&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M50064,-630.66C50064,-588.29 50064,-515 50064,-515 50064,-515 51904.26,-515 51904.26,-515"/>
<polygon fill="black" stroke="black" points="51904.26,-518.5 51914.26,-515 51904.26,-511.5 51904.26,-518.5"/>
</g>
<!-- R1_Stage4_L16_Expert14&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge688" class="edge">
<title>R1_Stage4_L16_Expert14&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M50360,-630.86C50360,-588.78 50360,-516 50360,-516 50360,-516 51905.55,-516 51905.55,-516"/>
<polygon fill="black" stroke="black" points="51905.55,-519.5 51915.55,-516 51905.55,-512.5 51905.55,-519.5"/>
</g>
<!-- R1_Stage4_L16_Expert15&#45;&gt;R1_Stage4_L16_MoE_Output -->
<g id="edge689" class="edge">
<title>R1_Stage4_L16_Expert15&#45;&gt;R1_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M50656,-630.92C50656,-589.38 50656,-518 50656,-518 50656,-518 51908.02,-518 51908.02,-518"/>
<polygon fill="black" stroke="black" points="51908.02,-521.5 51918.02,-518 51908.02,-514.5 51908.02,-521.5"/>
</g>
<!-- R1_Stage4_L16_MoE_Output&#45;&gt;R1_Stage4_L16_Output -->
<g id="edge690" class="edge">
<title>R1_Stage4_L16_MoE_Output&#45;&gt;R1_Stage4_L16_Output</title>
<path fill="none" stroke="black" d="M52346.1,-442C52676.34,-442 53279.67,-442 53279.67,-442 53279.67,-442 53279.67,-361.87 53279.67,-361.87"/>
<polygon fill="black" stroke="black" points="53283.17,-361.87 53279.67,-351.87 53276.17,-361.87 53283.17,-361.87"/>
</g>
<!-- R2_Stage1_L1_Input -->
<g id="node437" class="node">
<title>R2_Stage1_L1_Input</title>
<ellipse fill="lightblue" stroke="black" cx="10709" cy="-5487.08" rx="225.5" ry="29"/>
<text text-anchor="middle" x="10709" y="-5495.58" font-family="Times,serif" font-size="10.00">Layer 1 Input</text>
<text text-anchor="middle" x="10709" y="-5484.58" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="10709" y="-5473.58" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Attn_Input -->
<g id="node438" class="node">
<title>R2_Stage1_L1_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="10709" cy="-5356.08" rx="225.5" ry="29"/>
<text text-anchor="middle" x="10709" y="-5364.58" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="10709" y="-5353.58" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="10709" y="-5342.58" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Input&#45;&gt;R2_Stage1_L1_Attn_Input -->
<g id="edge691" class="edge">
<title>R2_Stage1_L1_Input&#45;&gt;R2_Stage1_L1_Attn_Input</title>
<path fill="none" stroke="black" d="M10709,-5458.01C10709,-5458.01 10709,-5395.52 10709,-5395.52"/>
<polygon fill="black" stroke="black" points="10712.5,-5395.52 10709,-5385.52 10705.5,-5395.52 10712.5,-5395.52"/>
</g>
<!-- R2_Stage1_L1_Attn_TP1 -->
<g id="node439" class="node">
<title>R2_Stage1_L1_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="10737,-5254.08 10391,-5254.08 10391,-5196.08 10737,-5196.08 10737,-5254.08"/>
<text text-anchor="middle" x="10564" y="-5239.08" font-family="Times,serif" font-size="10.00">Attention TP GPU 64</text>
<text text-anchor="middle" x="10564" y="-5228.08" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="10564" y="-5217.08" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="10564" y="-5206.08" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage1_L1_Attn_Input&#45;&gt;R2_Stage1_L1_Attn_TP1 -->
<g id="edge692" class="edge">
<title>R2_Stage1_L1_Attn_Input&#45;&gt;R2_Stage1_L1_Attn_TP1</title>
<path fill="none" stroke="black" d="M10610.25,-5329.88C10610.25,-5329.88 10610.25,-5264.42 10610.25,-5264.42"/>
<polygon fill="black" stroke="black" points="10613.75,-5264.42 10610.25,-5254.42 10606.75,-5264.42 10613.75,-5264.42"/>
</g>
<!-- R2_Stage1_L1_Attn_TP2 -->
<g id="node440" class="node">
<title>R2_Stage1_L1_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="11119,-5254.08 10773,-5254.08 10773,-5196.08 11119,-5196.08 11119,-5254.08"/>
<text text-anchor="middle" x="10946" y="-5239.08" font-family="Times,serif" font-size="10.00">Attention TP GPU 65</text>
<text text-anchor="middle" x="10946" y="-5228.08" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="10946" y="-5217.08" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="10946" y="-5206.08" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage1_L1_Attn_Input&#45;&gt;R2_Stage1_L1_Attn_TP2 -->
<g id="edge693" class="edge">
<title>R2_Stage1_L1_Attn_Input&#45;&gt;R2_Stage1_L1_Attn_TP2</title>
<path fill="none" stroke="black" d="M10853.75,-5333.56C10853.75,-5333.56 10853.75,-5264.18 10853.75,-5264.18"/>
<polygon fill="black" stroke="black" points="10857.25,-5264.18 10853.75,-5254.18 10850.25,-5264.18 10857.25,-5264.18"/>
</g>
<!-- R2_Stage1_L1_Attn_Output -->
<g id="node441" class="node">
<title>R2_Stage1_L1_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="10755" cy="-5086.31" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="10755" y="-5100.31" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="10755" y="-5089.31" font-family="Times,serif" font-size="10.00">AllReduce GPUs 64&#45;65</text>
<text text-anchor="middle" x="10755" y="-5078.31" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="10755" y="-5067.31" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Attn_TP1&#45;&gt;R2_Stage1_L1_Attn_Output -->
<g id="edge694" class="edge">
<title>R2_Stage1_L1_Attn_TP1&#45;&gt;R2_Stage1_L1_Attn_Output</title>
<path fill="none" stroke="black" d="M10624.38,-5195.99C10624.38,-5195.99 10624.38,-5127.78 10624.38,-5127.78"/>
<polygon fill="black" stroke="black" points="10627.88,-5127.78 10624.38,-5117.78 10620.88,-5127.78 10627.88,-5127.78"/>
</g>
<!-- R2_Stage1_L1_Attn_TP2&#45;&gt;R2_Stage1_L1_Attn_Output -->
<g id="edge695" class="edge">
<title>R2_Stage1_L1_Attn_TP2&#45;&gt;R2_Stage1_L1_Attn_Output</title>
<path fill="none" stroke="black" d="M10885.62,-5195.99C10885.62,-5195.99 10885.62,-5127.78 10885.62,-5127.78"/>
<polygon fill="black" stroke="black" points="10889.12,-5127.78 10885.62,-5117.78 10882.12,-5127.78 10889.12,-5127.78"/>
</g>
<!-- R2_Stage1_L1_MoE_Input -->
<g id="node442" class="node">
<title>R2_Stage1_L1_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="10755" cy="-4939.77" rx="225.5" ry="29"/>
<text text-anchor="middle" x="10755" y="-4948.27" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="10755" y="-4937.27" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="10755" y="-4926.27" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Attn_Output&#45;&gt;R2_Stage1_L1_MoE_Input -->
<g id="edge696" class="edge">
<title>R2_Stage1_L1_Attn_Output&#45;&gt;R2_Stage1_L1_MoE_Input</title>
<path fill="none" stroke="black" d="M10755,-5049.33C10755,-5049.33 10755,-4978.89 10755,-4978.89"/>
<polygon fill="black" stroke="black" points="10758.5,-4978.89 10755,-4968.89 10751.5,-4978.89 10758.5,-4978.89"/>
</g>
<!-- R2_Stage1_L1_Router -->
<g id="node443" class="node">
<title>R2_Stage1_L1_Router</title>
<polygon fill="lightyellow" stroke="black" points="11077.36,-4830 10564.56,-4830 10432.64,-4726 10945.44,-4726 11077.36,-4830"/>
<text text-anchor="middle" x="10755" y="-4792" font-family="Times,serif" font-size="10.00">Router GPU 64</text>
<text text-anchor="middle" x="10755" y="-4781" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="10755" y="-4770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="10755" y="-4759" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage1_L1_MoE_Input&#45;&gt;R2_Stage1_L1_Router -->
<g id="edge697" class="edge">
<title>R2_Stage1_L1_MoE_Input&#45;&gt;R2_Stage1_L1_Router</title>
<path fill="none" stroke="black" d="M10755,-4910.47C10755,-4910.47 10755,-4840.3 10755,-4840.3"/>
<polygon fill="black" stroke="black" points="10758.5,-4840.3 10755,-4830.3 10751.5,-4840.3 10758.5,-4840.3"/>
</g>
<!-- R2_Stage1_L1_Expert0 -->
<g id="node444" class="node">
<title>R2_Stage1_L1_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="12809,-4616 12549,-4616 12549,-4558 12809,-4558 12809,-4616"/>
<text text-anchor="middle" x="12679" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 64</text>
<text text-anchor="middle" x="12679" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="12679" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert0 -->
<g id="edge698" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10959.53,-4737C11454.99,-4737 12679,-4737 12679,-4737 12679,-4737 12679,-4626.28 12679,-4626.28"/>
<polygon fill="black" stroke="black" points="12682.5,-4626.28 12679,-4616.28 12675.5,-4626.28 12682.5,-4626.28"/>
<text text-anchor="middle" x="12409.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert1 -->
<g id="node445" class="node">
<title>R2_Stage1_L1_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="13105,-4616 12845,-4616 12845,-4558 13105,-4558 13105,-4616"/>
<text text-anchor="middle" x="12975" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 65</text>
<text text-anchor="middle" x="12975" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="12975" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert1 -->
<g id="edge699" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10963.35,-4740C11515.61,-4740 12975,-4740 12975,-4740 12975,-4740 12975,-4626.14 12975,-4626.14"/>
<polygon fill="black" stroke="black" points="12978.5,-4626.14 12975,-4616.14 12971.5,-4626.14 12978.5,-4626.14"/>
<text text-anchor="middle" x="12745.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert2 -->
<g id="node446" class="node">
<title>R2_Stage1_L1_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="8665,-4616 8405,-4616 8405,-4558 8665,-4558 8665,-4616"/>
<text text-anchor="middle" x="8535" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 66</text>
<text text-anchor="middle" x="8535" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="8535" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert2 -->
<g id="edge700" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10448.98,-4739C9864,-4739 8644.62,-4739 8644.62,-4739 8644.62,-4739 8644.62,-4626.31 8644.62,-4626.31"/>
<polygon fill="black" stroke="black" points="8648.12,-4626.31 8644.62,-4616.31 8641.12,-4626.31 8648.12,-4626.31"/>
<text text-anchor="middle" x="8766.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert3 -->
<g id="node447" class="node">
<title>R2_Stage1_L1_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="8961,-4616 8701,-4616 8701,-4558 8961,-4558 8961,-4616"/>
<text text-anchor="middle" x="8831" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 67</text>
<text text-anchor="middle" x="8831" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="8831" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert3 -->
<g id="edge701" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10445.17,-4736C9911.49,-4736 8875.5,-4736 8875.5,-4736 8875.5,-4736 8875.5,-4626.08 8875.5,-4626.08"/>
<polygon fill="black" stroke="black" points="8879,-4626.08 8875.5,-4616.08 8872,-4626.08 8879,-4626.08"/>
<text text-anchor="middle" x="9061.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert4 -->
<g id="node448" class="node">
<title>R2_Stage1_L1_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="9257,-4616 8997,-4616 8997,-4558 9257,-4558 9257,-4616"/>
<text text-anchor="middle" x="9127" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 68</text>
<text text-anchor="middle" x="9127" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9127" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert4 -->
<g id="edge702" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10442.55,-4734C9969.74,-4734 9127,-4734 9127,-4734 9127,-4734 9127,-4626.04 9127,-4626.04"/>
<polygon fill="black" stroke="black" points="9130.5,-4626.04 9127,-4616.04 9123.5,-4626.04 9130.5,-4626.04"/>
<text text-anchor="middle" x="9355.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert5 -->
<g id="node449" class="node">
<title>R2_Stage1_L1_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="9553,-4616 9293,-4616 9293,-4558 9553,-4558 9553,-4616"/>
<text text-anchor="middle" x="9423" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 69</text>
<text text-anchor="middle" x="9423" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9423" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert5 -->
<g id="edge703" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10440.18,-4732C10046.33,-4732 9423,-4732 9423,-4732 9423,-4732 9423,-4626.34 9423,-4626.34"/>
<polygon fill="black" stroke="black" points="9426.5,-4626.34 9423,-4616.34 9419.5,-4626.34 9426.5,-4626.34"/>
<text text-anchor="middle" x="9646.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert6 -->
<g id="node450" class="node">
<title>R2_Stage1_L1_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="9849,-4616 9589,-4616 9589,-4558 9849,-4558 9849,-4616"/>
<text text-anchor="middle" x="9719" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 70</text>
<text text-anchor="middle" x="9719" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9719" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert6 -->
<g id="edge704" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10437.48,-4730C10132.91,-4730 9719,-4730 9719,-4730 9719,-4730 9719,-4626.28 9719,-4626.28"/>
<polygon fill="black" stroke="black" points="9722.5,-4626.28 9719,-4616.28 9715.5,-4626.28 9722.5,-4626.28"/>
<text text-anchor="middle" x="9932.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert7 -->
<g id="node451" class="node">
<title>R2_Stage1_L1_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="10145,-4616 9885,-4616 9885,-4558 10145,-4558 10145,-4616"/>
<text text-anchor="middle" x="10015" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 71</text>
<text text-anchor="middle" x="10015" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10015" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert7 -->
<g id="edge705" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10435,-4728C10234.93,-4728 10015,-4728 10015,-4728 10015,-4728 10015,-4626.22 10015,-4626.22"/>
<polygon fill="black" stroke="black" points="10018.5,-4626.22 10015,-4616.22 10011.5,-4626.22 10018.5,-4626.22"/>
<text text-anchor="middle" x="10208.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert8 -->
<g id="node452" class="node">
<title>R2_Stage1_L1_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="10441,-4616 10181,-4616 10181,-4558 10441,-4558 10441,-4616"/>
<text text-anchor="middle" x="10311" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 72</text>
<text text-anchor="middle" x="10311" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10311" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert8 -->
<g id="edge706" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10436.78,-4777.86C10436.78,-4777.86 10436.78,-4626.01 10436.78,-4626.01"/>
<polygon fill="black" stroke="black" points="10440.28,-4626.01 10436.78,-4616.01 10433.28,-4626.01 10440.28,-4626.01"/>
<text text-anchor="middle" x="10464.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert9 -->
<g id="node453" class="node">
<title>R2_Stage1_L1_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="10737,-4616 10477,-4616 10477,-4558 10737,-4558 10737,-4616"/>
<text text-anchor="middle" x="10607" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 73</text>
<text text-anchor="middle" x="10607" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10607" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert9 -->
<g id="edge707" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10607,-4725.81C10607,-4725.81 10607,-4626.01 10607,-4626.01"/>
<polygon fill="black" stroke="black" points="10610.5,-4626.01 10607,-4616.01 10603.5,-4626.01 10610.5,-4626.01"/>
<text text-anchor="middle" x="10681.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert10 -->
<g id="node454" class="node">
<title>R2_Stage1_L1_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="11033,-4616 10773,-4616 10773,-4558 11033,-4558 11033,-4616"/>
<text text-anchor="middle" x="10903" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 74</text>
<text text-anchor="middle" x="10903" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10903" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert10 -->
<g id="edge708" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10903,-4725.81C10903,-4725.81 10903,-4626.01 10903,-4626.01"/>
<polygon fill="black" stroke="black" points="10906.5,-4626.01 10903,-4616.01 10899.5,-4626.01 10906.5,-4626.01"/>
<text text-anchor="middle" x="10871.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert11 -->
<g id="node455" class="node">
<title>R2_Stage1_L1_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="11329,-4616 11069,-4616 11069,-4558 11329,-4558 11329,-4616"/>
<text text-anchor="middle" x="11199" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 75</text>
<text text-anchor="middle" x="11199" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11199" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert11 -->
<g id="edge709" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M11073.22,-4777.86C11073.22,-4777.86 11073.22,-4626.01 11073.22,-4626.01"/>
<polygon fill="black" stroke="black" points="11076.72,-4626.01 11073.22,-4616.01 11069.72,-4626.01 11076.72,-4626.01"/>
<text text-anchor="middle" x="11114.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert12 -->
<g id="node456" class="node">
<title>R2_Stage1_L1_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="11625,-4616 11365,-4616 11365,-4558 11625,-4558 11625,-4616"/>
<text text-anchor="middle" x="11495" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 76</text>
<text text-anchor="middle" x="11495" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11495" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert12 -->
<g id="edge710" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10948.46,-4728C11167.72,-4728 11495,-4728 11495,-4728 11495,-4728 11495,-4626.22 11495,-4626.22"/>
<polygon fill="black" stroke="black" points="11498.5,-4626.22 11495,-4616.22 11491.5,-4626.22 11498.5,-4626.22"/>
<text text-anchor="middle" x="11238.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert13 -->
<g id="node457" class="node">
<title>R2_Stage1_L1_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="11921,-4616 11661,-4616 11661,-4558 11921,-4558 11921,-4616"/>
<text text-anchor="middle" x="11791" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 77</text>
<text text-anchor="middle" x="11791" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11791" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert13 -->
<g id="edge711" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10950.78,-4730C11251.06,-4730 11791,-4730 11791,-4730 11791,-4730 11791,-4626.28 11791,-4626.28"/>
<polygon fill="black" stroke="black" points="11794.5,-4626.28 11791,-4616.28 11787.5,-4626.28 11794.5,-4626.28"/>
<text text-anchor="middle" x="11454.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert14 -->
<g id="node458" class="node">
<title>R2_Stage1_L1_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="12217,-4616 11957,-4616 11957,-4558 12217,-4558 12217,-4616"/>
<text text-anchor="middle" x="12087" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 78</text>
<text text-anchor="middle" x="12087" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="12087" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert14 -->
<g id="edge712" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10954.41,-4733C11326,-4733 12087,-4733 12087,-4733 12087,-4733 12087,-4626.19 12087,-4626.19"/>
<polygon fill="black" stroke="black" points="12090.5,-4626.19 12087,-4616.19 12083.5,-4626.19 12090.5,-4626.19"/>
<text text-anchor="middle" x="11578.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_Expert15 -->
<g id="node459" class="node">
<title>R2_Stage1_L1_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="12513,-4616 12253,-4616 12253,-4558 12513,-4558 12513,-4616"/>
<text text-anchor="middle" x="12383" y="-4595.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 79</text>
<text text-anchor="middle" x="12383" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="12383" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert15 -->
<g id="edge713" class="edge">
<title>R2_Stage1_L1_Router&#45;&gt;R2_Stage1_L1_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M10957.08,-4735C11393.07,-4735 12383,-4735 12383,-4735 12383,-4735 12383,-4626.24 12383,-4626.24"/>
<polygon fill="black" stroke="black" points="12386.5,-4626.24 12383,-4616.24 12379.5,-4626.24 12386.5,-4626.24"/>
<text text-anchor="middle" x="12033.5" y="-4678.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L1_MoE_Output -->
<g id="node460" class="node">
<title>R2_Stage1_L1_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="9594.95,-4448 9068.48,-4448 8933.05,-4344 9459.52,-4344 9594.95,-4448"/>
<text text-anchor="middle" x="9264" y="-4410" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="9264" y="-4399" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="9264" y="-4388" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="9264" y="-4377" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L1_Expert0&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge714" class="edge">
<title>R2_Stage1_L1_Expert0&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M12573,-4557.84C12573,-4511.93 12573,-4428 12573,-4428 12573,-4428 9579,-4428 9579,-4428"/>
<polygon fill="black" stroke="black" points="9579,-4424.5 9569,-4428 9579,-4431.5 9579,-4424.5"/>
</g>
<!-- R2_Stage1_L1_Expert1&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge715" class="edge">
<title>R2_Stage1_L1_Expert1&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M12869,-4557.84C12869,-4511.45 12869,-4426 12869,-4426 12869,-4426 9576.32,-4426 9576.32,-4426"/>
<polygon fill="black" stroke="black" points="9576.32,-4422.5 9566.32,-4426 9576.32,-4429.5 9576.32,-4422.5"/>
</g>
<!-- R2_Stage1_L1_Expert2&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge716" class="edge">
<title>R2_Stage1_L1_Expert2&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M8624.19,-4557.89C8624.19,-4514.01 8624.19,-4436 8624.19,-4436 8624.19,-4436 9042.73,-4436 9042.73,-4436"/>
<polygon fill="black" stroke="black" points="9042.73,-4439.5 9052.73,-4436 9042.73,-4432.5 9042.73,-4439.5"/>
</g>
<!-- R2_Stage1_L1_Expert3&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge717" class="edge">
<title>R2_Stage1_L1_Expert3&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M8947.14,-4557.99C8947.14,-4557.99 8947.14,-4406.08 8947.14,-4406.08"/>
<polygon fill="black" stroke="black" points="8950.64,-4406.08 8947.14,-4396.08 8943.64,-4406.08 8950.64,-4406.08"/>
</g>
<!-- R2_Stage1_L1_Expert4&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge718" class="edge">
<title>R2_Stage1_L1_Expert4&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M9127,-4557.99C9127,-4557.99 9127,-4458.02 9127,-4458.02"/>
<polygon fill="black" stroke="black" points="9130.5,-4458.02 9127,-4448.02 9123.5,-4458.02 9130.5,-4458.02"/>
</g>
<!-- R2_Stage1_L1_Expert5&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge719" class="edge">
<title>R2_Stage1_L1_Expert5&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M9423,-4557.99C9423,-4557.99 9423,-4458.02 9423,-4458.02"/>
<polygon fill="black" stroke="black" points="9426.5,-4458.02 9423,-4448.02 9419.5,-4458.02 9426.5,-4458.02"/>
</g>
<!-- R2_Stage1_L1_Expert6&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge720" class="edge">
<title>R2_Stage1_L1_Expert6&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M9612.86,-4557.78C9612.86,-4516.48 9612.86,-4446 9612.86,-4446 9612.86,-4446 9602.6,-4446 9602.6,-4446"/>
<polygon fill="black" stroke="black" points="9602.6,-4442.5 9592.6,-4446 9602.6,-4449.5 9602.6,-4442.5"/>
</g>
<!-- R2_Stage1_L1_Expert7&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge721" class="edge">
<title>R2_Stage1_L1_Expert7&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M9909,-4557.72C9909,-4515.88 9909,-4444 9909,-4444 9909,-4444 9599.81,-4444 9599.81,-4444"/>
<polygon fill="black" stroke="black" points="9599.81,-4440.5 9589.81,-4444 9599.81,-4447.5 9599.81,-4440.5"/>
</g>
<!-- R2_Stage1_L1_Expert8&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge722" class="edge">
<title>R2_Stage1_L1_Expert8&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M10205,-4557.66C10205,-4515.29 10205,-4442 10205,-4442 10205,-4442 9597.18,-4442 9597.18,-4442"/>
<polygon fill="black" stroke="black" points="9597.18,-4438.5 9587.18,-4442 9597.18,-4445.5 9597.18,-4438.5"/>
</g>
<!-- R2_Stage1_L1_Expert9&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge723" class="edge">
<title>R2_Stage1_L1_Expert9&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M10501,-4557.96C10501,-4515.12 10501,-4440 10501,-4440 10501,-4440 9594.57,-4440 9594.57,-4440"/>
<polygon fill="black" stroke="black" points="9594.57,-4436.5 9584.57,-4440 9594.57,-4443.5 9594.57,-4436.5"/>
</g>
<!-- R2_Stage1_L1_Expert10&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge724" class="edge">
<title>R2_Stage1_L1_Expert10&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M10797,-4557.76C10797,-4514.63 10797,-4439 10797,-4439 10797,-4439 9593.5,-4439 9593.5,-4439"/>
<polygon fill="black" stroke="black" points="9593.5,-4435.5 9583.5,-4439 9593.5,-4442.5 9593.5,-4435.5"/>
</g>
<!-- R2_Stage1_L1_Expert11&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge725" class="edge">
<title>R2_Stage1_L1_Expert11&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M11093,-4557.72C11093,-4514.07 11093,-4437 11093,-4437 11093,-4437 9590.76,-4437 9590.76,-4437"/>
<polygon fill="black" stroke="black" points="9590.76,-4433.5 9580.76,-4437 9590.76,-4440.5 9590.76,-4433.5"/>
</g>
<!-- R2_Stage1_L1_Expert12&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge726" class="edge">
<title>R2_Stage1_L1_Expert12&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M11389,-4557.69C11389,-4513.52 11389,-4435 11389,-4435 11389,-4435 9588.12,-4435 9588.12,-4435"/>
<polygon fill="black" stroke="black" points="9588.12,-4431.5 9578.12,-4435 9588.12,-4438.5 9588.12,-4431.5"/>
</g>
<!-- R2_Stage1_L1_Expert13&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge727" class="edge">
<title>R2_Stage1_L1_Expert13&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M11685,-4557.67C11685,-4512.99 11685,-4433 11685,-4433 11685,-4433 9585.55,-4433 9585.55,-4433"/>
<polygon fill="black" stroke="black" points="9585.55,-4429.5 9575.55,-4433 9585.55,-4436.5 9585.55,-4429.5"/>
</g>
<!-- R2_Stage1_L1_Expert14&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge728" class="edge">
<title>R2_Stage1_L1_Expert14&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M11981,-4557.85C11981,-4512.95 11981,-4432 11981,-4432 11981,-4432 9584.35,-4432 9584.35,-4432"/>
<polygon fill="black" stroke="black" points="9584.35,-4428.5 9574.35,-4432 9584.35,-4435.5 9584.35,-4428.5"/>
</g>
<!-- R2_Stage1_L1_Expert15&#45;&gt;R2_Stage1_L1_MoE_Output -->
<g id="edge729" class="edge">
<title>R2_Stage1_L1_Expert15&#45;&gt;R2_Stage1_L1_MoE_Output</title>
<path fill="none" stroke="black" d="M12277,-4557.84C12277,-4512.43 12277,-4430 12277,-4430 12277,-4430 9581.58,-4430 9581.58,-4430"/>
<polygon fill="black" stroke="black" points="9581.58,-4426.5 9571.58,-4430 9581.58,-4433.5 9581.58,-4426.5"/>
</g>
<!-- R2_Stage1_L1_MoE_Output&#45;&gt;R2_Stage1_L1_Output -->
<g id="edge730" class="edge">
<title>R2_Stage1_L1_MoE_Output&#45;&gt;R2_Stage1_L1_Output</title>
<path fill="none" stroke="black" d="M9473.87,-4355C10237.1,-4355 12820.75,-4355 12820.75,-4355 12820.75,-4355 12820.75,-4229.66 12820.75,-4229.66"/>
<polygon fill="black" stroke="black" points="12824.25,-4229.66 12820.75,-4219.66 12817.25,-4229.66 12824.25,-4229.66"/>
</g>
<!-- R2_Stage1_L2_Input -->
<g id="node461" class="node">
<title>R2_Stage1_L2_Input</title>
<ellipse fill="lightblue" stroke="black" cx="13556" cy="-5356.08" rx="225.5" ry="29"/>
<text text-anchor="middle" x="13556" y="-5364.58" font-family="Times,serif" font-size="10.00">Layer 2 Input</text>
<text text-anchor="middle" x="13556" y="-5353.58" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="13556" y="-5342.58" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Attn_Input -->
<g id="node462" class="node">
<title>R2_Stage1_L2_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="13556" cy="-5225.08" rx="225.5" ry="29"/>
<text text-anchor="middle" x="13556" y="-5233.58" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="13556" y="-5222.58" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="13556" y="-5211.58" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Input&#45;&gt;R2_Stage1_L2_Attn_Input -->
<g id="edge731" class="edge">
<title>R2_Stage1_L2_Input&#45;&gt;R2_Stage1_L2_Attn_Input</title>
<path fill="none" stroke="black" d="M13556,-5327.01C13556,-5327.01 13556,-5264.52 13556,-5264.52"/>
<polygon fill="black" stroke="black" points="13559.5,-5264.52 13556,-5254.52 13552.5,-5264.52 13559.5,-5264.52"/>
</g>
<!-- R2_Stage1_L2_Attn_TP1 -->
<g id="node463" class="node">
<title>R2_Stage1_L2_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="13920,-5115.31 13574,-5115.31 13574,-5057.31 13920,-5057.31 13920,-5115.31"/>
<text text-anchor="middle" x="13747" y="-5100.31" font-family="Times,serif" font-size="10.00">Attention TP GPU 64</text>
<text text-anchor="middle" x="13747" y="-5089.31" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="13747" y="-5078.31" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="13747" y="-5067.31" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage1_L2_Attn_Input&#45;&gt;R2_Stage1_L2_Attn_TP1 -->
<g id="edge732" class="edge">
<title>R2_Stage1_L2_Attn_Input&#45;&gt;R2_Stage1_L2_Attn_TP1</title>
<path fill="none" stroke="black" d="M13677.75,-5200.59C13677.75,-5200.59 13677.75,-5125.36 13677.75,-5125.36"/>
<polygon fill="black" stroke="black" points="13681.25,-5125.36 13677.75,-5115.36 13674.25,-5125.36 13681.25,-5125.36"/>
</g>
<!-- R2_Stage1_L2_Attn_TP2 -->
<g id="node464" class="node">
<title>R2_Stage1_L2_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="13538,-5115.31 13192,-5115.31 13192,-5057.31 13538,-5057.31 13538,-5115.31"/>
<text text-anchor="middle" x="13365" y="-5100.31" font-family="Times,serif" font-size="10.00">Attention TP GPU 65</text>
<text text-anchor="middle" x="13365" y="-5089.31" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="13365" y="-5078.31" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="13365" y="-5067.31" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage1_L2_Attn_Input&#45;&gt;R2_Stage1_L2_Attn_TP2 -->
<g id="edge733" class="edge">
<title>R2_Stage1_L2_Attn_Input&#45;&gt;R2_Stage1_L2_Attn_TP2</title>
<path fill="none" stroke="black" d="M13434.25,-5200.59C13434.25,-5200.59 13434.25,-5125.36 13434.25,-5125.36"/>
<polygon fill="black" stroke="black" points="13437.75,-5125.36 13434.25,-5115.36 13430.75,-5125.36 13437.75,-5125.36"/>
</g>
<!-- R2_Stage1_L2_Attn_Output -->
<g id="node465" class="node">
<title>R2_Stage1_L2_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="13463" cy="-4939.77" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="13463" y="-4953.77" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="13463" y="-4942.77" font-family="Times,serif" font-size="10.00">AllReduce GPUs 64&#45;65</text>
<text text-anchor="middle" x="13463" y="-4931.77" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="13463" y="-4920.77" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Attn_TP1&#45;&gt;R2_Stage1_L2_Attn_Output -->
<g id="edge734" class="edge">
<title>R2_Stage1_L2_Attn_TP1&#45;&gt;R2_Stage1_L2_Attn_Output</title>
<path fill="none" stroke="black" d="M13640.12,-5057.01C13640.12,-5057.01 13640.12,-4975.11 13640.12,-4975.11"/>
<polygon fill="black" stroke="black" points="13643.62,-4975.11 13640.12,-4965.11 13636.62,-4975.11 13643.62,-4975.11"/>
</g>
<!-- R2_Stage1_L2_Attn_TP2&#45;&gt;R2_Stage1_L2_Attn_Output -->
<g id="edge735" class="edge">
<title>R2_Stage1_L2_Attn_TP2&#45;&gt;R2_Stage1_L2_Attn_Output</title>
<path fill="none" stroke="black" d="M13378.88,-5057.01C13378.88,-5057.01 13378.88,-4984.43 13378.88,-4984.43"/>
<polygon fill="black" stroke="black" points="13382.38,-4984.43 13378.88,-4974.43 13375.38,-4984.43 13382.38,-4984.43"/>
</g>
<!-- R2_Stage1_L2_MoE_Input -->
<g id="node466" class="node">
<title>R2_Stage1_L2_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="13463" cy="-4778" rx="225.5" ry="29"/>
<text text-anchor="middle" x="13463" y="-4786.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="13463" y="-4775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="13463" y="-4764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Attn_Output&#45;&gt;R2_Stage1_L2_MoE_Input -->
<g id="edge736" class="edge">
<title>R2_Stage1_L2_Attn_Output&#45;&gt;R2_Stage1_L2_MoE_Input</title>
<path fill="none" stroke="black" d="M13463,-4902.66C13463,-4902.66 13463,-4817.14 13463,-4817.14"/>
<polygon fill="black" stroke="black" points="13466.5,-4817.14 13463,-4807.14 13459.5,-4817.14 13466.5,-4817.14"/>
</g>
<!-- R2_Stage1_L2_Router -->
<g id="node467" class="node">
<title>R2_Stage1_L2_Router</title>
<polygon fill="lightyellow" stroke="black" points="13785.36,-4639 13272.56,-4639 13140.64,-4535 13653.44,-4535 13785.36,-4639"/>
<text text-anchor="middle" x="13463" y="-4601" font-family="Times,serif" font-size="10.00">Router GPU 64</text>
<text text-anchor="middle" x="13463" y="-4590" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="13463" y="-4579" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="13463" y="-4568" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage1_L2_MoE_Input&#45;&gt;R2_Stage1_L2_Router -->
<g id="edge737" class="edge">
<title>R2_Stage1_L2_MoE_Input&#45;&gt;R2_Stage1_L2_Router</title>
<path fill="none" stroke="black" d="M13463,-4748.99C13463,-4748.99 13463,-4649.02 13463,-4649.02"/>
<polygon fill="black" stroke="black" points="13466.5,-4649.02 13463,-4639.02 13459.5,-4649.02 13466.5,-4649.02"/>
</g>
<!-- R2_Stage1_L2_Expert0 -->
<g id="node468" class="node">
<title>R2_Stage1_L2_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="12555,-4425 12295,-4425 12295,-4367 12555,-4367 12555,-4425"/>
<text text-anchor="middle" x="12425" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 64</text>
<text text-anchor="middle" x="12425" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="12425" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert0 -->
<g id="edge738" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13146.82,-4540C12876.53,-4540 12531,-4540 12531,-4540 12531,-4540 12531,-4435.14 12531,-4435.14"/>
<polygon fill="black" stroke="black" points="12534.5,-4435.14 12531,-4425.14 12527.5,-4435.14 12534.5,-4435.14"/>
<text text-anchor="middle" x="12635.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert1 -->
<g id="node469" class="node">
<title>R2_Stage1_L2_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="12851,-4425 12591,-4425 12591,-4367 12851,-4367 12851,-4425"/>
<text text-anchor="middle" x="12721" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 65</text>
<text text-anchor="middle" x="12721" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="12721" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert1 -->
<g id="edge739" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13144.07,-4538C12985.38,-4538 12827,-4538 12827,-4538 12827,-4538 12827,-4435.08 12827,-4435.08"/>
<polygon fill="black" stroke="black" points="12830.5,-4435.08 12827,-4425.08 12823.5,-4435.08 12830.5,-4435.08"/>
<text text-anchor="middle" x="12909.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert2 -->
<g id="node470" class="node">
<title>R2_Stage1_L2_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="13147,-4425 12887,-4425 12887,-4367 13147,-4367 13147,-4425"/>
<text text-anchor="middle" x="13017" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 66</text>
<text text-anchor="middle" x="13017" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="13017" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert2 -->
<g id="edge740" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13141.56,-4536C13129.7,-4536 13122.78,-4536 13122.78,-4536 13122.78,-4536 13122.78,-4435.01 13122.78,-4435.01"/>
<polygon fill="black" stroke="black" points="13126.28,-4435.01 13122.78,-4425.01 13119.28,-4435.01 13126.28,-4435.01"/>
<text text-anchor="middle" x="13160.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert3 -->
<g id="node471" class="node">
<title>R2_Stage1_L2_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="13443,-4425 13183,-4425 13183,-4367 13443,-4367 13443,-4425"/>
<text text-anchor="middle" x="13313" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 67</text>
<text text-anchor="middle" x="13313" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="13313" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert3 -->
<g id="edge741" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13313,-4534.81C13313,-4534.81 13313,-4435.01 13313,-4435.01"/>
<polygon fill="black" stroke="black" points="13316.5,-4435.01 13313,-4425.01 13309.5,-4435.01 13316.5,-4435.01"/>
<text text-anchor="middle" x="13367.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert4 -->
<g id="node472" class="node">
<title>R2_Stage1_L2_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="13739,-4425 13479,-4425 13479,-4367 13739,-4367 13739,-4425"/>
<text text-anchor="middle" x="13609" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 68</text>
<text text-anchor="middle" x="13609" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="13609" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert4 -->
<g id="edge742" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13609,-4534.81C13609,-4534.81 13609,-4435.01 13609,-4435.01"/>
<polygon fill="black" stroke="black" points="13612.5,-4435.01 13609,-4425.01 13605.5,-4435.01 13612.5,-4435.01"/>
<text text-anchor="middle" x="13557.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert5 -->
<g id="node473" class="node">
<title>R2_Stage1_L2_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="14035,-4425 13775,-4425 13775,-4367 14035,-4367 14035,-4425"/>
<text text-anchor="middle" x="13905" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 69</text>
<text text-anchor="middle" x="13905" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="13905" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert5 -->
<g id="edge743" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13780.22,-4586.86C13780.22,-4586.86 13780.22,-4435.01 13780.22,-4435.01"/>
<polygon fill="black" stroke="black" points="13783.72,-4435.01 13780.22,-4425.01 13776.72,-4435.01 13783.72,-4435.01"/>
<text text-anchor="middle" x="13820.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert6 -->
<g id="node474" class="node">
<title>R2_Stage1_L2_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="14331,-4425 14071,-4425 14071,-4367 14331,-4367 14331,-4425"/>
<text text-anchor="middle" x="14201" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 70</text>
<text text-anchor="middle" x="14201" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="14201" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert6 -->
<g id="edge744" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13657.38,-4538C13876.04,-4538 14201,-4538 14201,-4538 14201,-4538 14201,-4435.08 14201,-4435.08"/>
<polygon fill="black" stroke="black" points="14204.5,-4435.08 14201,-4425.08 14197.5,-4435.08 14204.5,-4435.08"/>
<text text-anchor="middle" x="14099.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert7 -->
<g id="node475" class="node">
<title>R2_Stage1_L2_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="9891,-4425 9631,-4425 9631,-4367 9891,-4367 9891,-4425"/>
<text text-anchor="middle" x="9761" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 71</text>
<text text-anchor="middle" x="9761" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9761" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert7 -->
<g id="edge745" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13249.49,-4621C12476.17,-4621 9867,-4621 9867,-4621 9867,-4621 9867,-4435.41 9867,-4435.41"/>
<polygon fill="black" stroke="black" points="9870.5,-4435.41 9867,-4425.41 9863.5,-4435.41 9870.5,-4435.41"/>
<text text-anchor="middle" x="9993.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert8 -->
<g id="node476" class="node">
<title>R2_Stage1_L2_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="10187,-4425 9927,-4425 9927,-4367 10187,-4367 10187,-4425"/>
<text text-anchor="middle" x="10057" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 72</text>
<text text-anchor="middle" x="10057" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10057" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert8 -->
<g id="edge746" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13245.84,-4618C12510.96,-4618 10163,-4618 10163,-4618 10163,-4618 10163,-4435.02 10163,-4435.02"/>
<polygon fill="black" stroke="black" points="10166.5,-4435.02 10163,-4425.02 10159.5,-4435.02 10166.5,-4435.02"/>
<text text-anchor="middle" x="10289.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert9 -->
<g id="node477" class="node">
<title>R2_Stage1_L2_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="10483,-4425 10223,-4425 10223,-4367 10483,-4367 10483,-4425"/>
<text text-anchor="middle" x="10353" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 73</text>
<text text-anchor="middle" x="10353" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10353" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert9 -->
<g id="edge747" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13167.09,-4556C12409.47,-4556 10459,-4556 10459,-4556 10459,-4556 10459,-4435.35 10459,-4435.35"/>
<polygon fill="black" stroke="black" points="10462.5,-4435.35 10459,-4425.35 10455.5,-4435.35 10462.5,-4435.35"/>
<text text-anchor="middle" x="10584.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert10 -->
<g id="node478" class="node">
<title>R2_Stage1_L2_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="10779,-4425 10519,-4425 10519,-4367 10779,-4367 10779,-4425"/>
<text text-anchor="middle" x="10649" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 74</text>
<text text-anchor="middle" x="10649" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10649" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert10 -->
<g id="edge748" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13164.48,-4554C12460.41,-4554 10755,-4554 10755,-4554 10755,-4554 10755,-4435.35 10755,-4435.35"/>
<polygon fill="black" stroke="black" points="10758.5,-4435.35 10755,-4425.35 10751.5,-4435.35 10758.5,-4435.35"/>
<text text-anchor="middle" x="10878.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert11 -->
<g id="node479" class="node">
<title>R2_Stage1_L2_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="11075,-4425 10815,-4425 10815,-4367 11075,-4367 11075,-4425"/>
<text text-anchor="middle" x="10945" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 75</text>
<text text-anchor="middle" x="10945" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10945" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert11 -->
<g id="edge749" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13162.09,-4552C12515.36,-4552 11051,-4552 11051,-4552 11051,-4552 11051,-4435.34 11051,-4435.34"/>
<polygon fill="black" stroke="black" points="11054.5,-4435.34 11051,-4425.34 11047.5,-4435.34 11054.5,-4435.34"/>
<text text-anchor="middle" x="11171.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert12 -->
<g id="node480" class="node">
<title>R2_Stage1_L2_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="11371,-4425 11111,-4425 11111,-4367 11371,-4367 11371,-4425"/>
<text text-anchor="middle" x="11241" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 76</text>
<text text-anchor="middle" x="11241" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11241" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert12 -->
<g id="edge750" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13157.01,-4548C12570.8,-4548 11347,-4548 11347,-4548 11347,-4548 11347,-4435.31 11347,-4435.31"/>
<polygon fill="black" stroke="black" points="11350.5,-4435.31 11347,-4425.31 11343.5,-4435.31 11350.5,-4435.31"/>
<text text-anchor="middle" x="11460.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert13 -->
<g id="node481" class="node">
<title>R2_Stage1_L2_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="11667,-4425 11407,-4425 11407,-4367 11667,-4367 11667,-4425"/>
<text text-anchor="middle" x="11537" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 77</text>
<text text-anchor="middle" x="11537" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11537" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert13 -->
<g id="edge751" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13154.52,-4546C12635.34,-4546 11643,-4546 11643,-4546 11643,-4546 11643,-4435.28 11643,-4435.28"/>
<polygon fill="black" stroke="black" points="11646.5,-4435.28 11643,-4425.28 11639.5,-4435.28 11646.5,-4435.28"/>
<text text-anchor="middle" x="11743.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert14 -->
<g id="node482" class="node">
<title>R2_Stage1_L2_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="11963,-4425 11703,-4425 11703,-4367 11963,-4367 11963,-4425"/>
<text text-anchor="middle" x="11833" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 78</text>
<text text-anchor="middle" x="11833" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11833" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert14 -->
<g id="edge752" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13151.84,-4544C12706.11,-4544 11939,-4544 11939,-4544 11939,-4544 11939,-4435.24 11939,-4435.24"/>
<polygon fill="black" stroke="black" points="11942.5,-4435.24 11939,-4425.24 11935.5,-4435.24 11942.5,-4435.24"/>
<text text-anchor="middle" x="12013.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_Expert15 -->
<g id="node483" class="node">
<title>R2_Stage1_L2_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="12259,-4425 11999,-4425 11999,-4367 12259,-4367 12259,-4425"/>
<text text-anchor="middle" x="12129" y="-4404.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 79</text>
<text text-anchor="middle" x="12129" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="12129" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert15 -->
<g id="edge753" class="edge">
<title>R2_Stage1_L2_Router&#45;&gt;R2_Stage1_L2_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M13149.15,-4542C12785.32,-4542 12235,-4542 12235,-4542 12235,-4542 12235,-4435.19 12235,-4435.19"/>
<polygon fill="black" stroke="black" points="12238.5,-4435.19 12235,-4425.19 12231.5,-4435.19 12238.5,-4435.19"/>
<text text-anchor="middle" x="12256.5" y="-4487.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L2_MoE_Output -->
<g id="node484" class="node">
<title>R2_Stage1_L2_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="13938.95,-4257 13412.48,-4257 13277.05,-4153 13803.52,-4153 13938.95,-4257"/>
<text text-anchor="middle" x="13608" y="-4219" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="13608" y="-4208" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="13608" y="-4197" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="13608" y="-4186" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L2_Expert0&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge754" class="edge">
<title>R2_Stage1_L2_Expert0&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M12534.67,-4366.86C12534.67,-4324.78 12534.67,-4252 12534.67,-4252 12534.67,-4252 13395.8,-4252 13395.8,-4252"/>
<polygon fill="black" stroke="black" points="13395.8,-4255.5 13405.8,-4252 13395.8,-4248.5 13395.8,-4255.5"/>
</g>
<!-- R2_Stage1_L2_Expert1&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge755" class="edge">
<title>R2_Stage1_L2_Expert1&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M12835.87,-4366.72C12835.87,-4324.88 12835.87,-4253 12835.87,-4253 12835.87,-4253 13397.15,-4253 13397.15,-4253"/>
<polygon fill="black" stroke="black" points="13397.15,-4256.5 13407.15,-4253 13397.15,-4249.5 13397.15,-4256.5"/>
</g>
<!-- R2_Stage1_L2_Expert2&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge756" class="edge">
<title>R2_Stage1_L2_Expert2&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M13017,-4366.78C13017,-4325.48 13017,-4255 13017,-4255 13017,-4255 13399.56,-4255 13399.56,-4255"/>
<polygon fill="black" stroke="black" points="13399.56,-4258.5 13409.56,-4255 13399.56,-4251.5 13399.56,-4258.5"/>
</g>
<!-- R2_Stage1_L2_Expert3&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge757" class="edge">
<title>R2_Stage1_L2_Expert3&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M13360.14,-4366.99C13360.14,-4366.99 13360.14,-4227.07 13360.14,-4227.07"/>
<polygon fill="black" stroke="black" points="13363.64,-4227.07 13360.14,-4217.07 13356.64,-4227.07 13363.64,-4227.07"/>
</g>
<!-- R2_Stage1_L2_Expert4&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge758" class="edge">
<title>R2_Stage1_L2_Expert4&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M13609,-4366.99C13609,-4366.99 13609,-4267.02 13609,-4267.02"/>
<polygon fill="black" stroke="black" points="13612.5,-4267.02 13609,-4257.02 13605.5,-4267.02 13612.5,-4267.02"/>
</g>
<!-- R2_Stage1_L2_Expert5&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge759" class="edge">
<title>R2_Stage1_L2_Expert5&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M13856.86,-4366.99C13856.86,-4366.99 13856.86,-4267.02 13856.86,-4267.02"/>
<polygon fill="black" stroke="black" points="13860.36,-4267.02 13856.86,-4257.02 13853.36,-4267.02 13860.36,-4267.02"/>
</g>
<!-- R2_Stage1_L2_Expert6&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge760" class="edge">
<title>R2_Stage1_L2_Expert6&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M14201,-4366.99C14201,-4313.56 14201,-4205 14201,-4205 14201,-4205 13881.55,-4205 13881.55,-4205"/>
<polygon fill="black" stroke="black" points="13881.55,-4201.5 13871.55,-4205 13881.55,-4208.5 13881.55,-4201.5"/>
</g>
<!-- R2_Stage1_L2_Expert7&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge761" class="edge">
<title>R2_Stage1_L2_Expert7&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M9870.67,-4366.65C9870.67,-4320.96 9870.67,-4238 9870.67,-4238 9870.67,-4238 13377.48,-4238 13377.48,-4238"/>
<polygon fill="black" stroke="black" points="13377.48,-4241.5 13387.48,-4238 13377.48,-4234.5 13377.48,-4241.5"/>
</g>
<!-- R2_Stage1_L2_Expert8&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge762" class="edge">
<title>R2_Stage1_L2_Expert8&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M10166.67,-4366.66C10166.67,-4321.47 10166.67,-4240 10166.67,-4240 10166.67,-4240 13380.12,-4240 13380.12,-4240"/>
<polygon fill="black" stroke="black" points="13380.12,-4243.5 13390.12,-4240 13380.12,-4236.5 13380.12,-4243.5"/>
</g>
<!-- R2_Stage1_L2_Expert9&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge763" class="edge">
<title>R2_Stage1_L2_Expert9&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M10462.67,-4366.85C10462.67,-4321.95 10462.67,-4241 10462.67,-4241 10462.67,-4241 13381.5,-4241 13381.5,-4241"/>
<polygon fill="black" stroke="black" points="13381.5,-4244.5 13391.5,-4241 13381.5,-4237.5 13381.5,-4244.5"/>
</g>
<!-- R2_Stage1_L2_Expert10&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge764" class="edge">
<title>R2_Stage1_L2_Expert10&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M10758.67,-4366.86C10758.67,-4322.47 10758.67,-4243 10758.67,-4243 10758.67,-4243 13384.13,-4243 13384.13,-4243"/>
<polygon fill="black" stroke="black" points="13384.13,-4246.5 13394.13,-4243 13384.13,-4239.5 13384.13,-4246.5"/>
</g>
<!-- R2_Stage1_L2_Expert11&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge765" class="edge">
<title>R2_Stage1_L2_Expert11&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M11054.67,-4366.69C11054.67,-4322.52 11054.67,-4244 11054.67,-4244 11054.67,-4244 13385.52,-4244 13385.52,-4244"/>
<polygon fill="black" stroke="black" points="13385.52,-4247.5 13395.52,-4244 13385.52,-4240.5 13385.52,-4247.5"/>
</g>
<!-- R2_Stage1_L2_Expert12&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge766" class="edge">
<title>R2_Stage1_L2_Expert12&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M11350.67,-4366.72C11350.67,-4323.07 11350.67,-4246 11350.67,-4246 11350.67,-4246 13387.92,-4246 13387.92,-4246"/>
<polygon fill="black" stroke="black" points="13387.92,-4249.5 13397.92,-4246 13387.92,-4242.5 13387.92,-4249.5"/>
</g>
<!-- R2_Stage1_L2_Expert13&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge767" class="edge">
<title>R2_Stage1_L2_Expert13&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M11646.67,-4366.92C11646.67,-4323.56 11646.67,-4247 11646.67,-4247 11646.67,-4247 13389.03,-4247 13389.03,-4247"/>
<polygon fill="black" stroke="black" points="13389.03,-4250.5 13399.03,-4247 13389.03,-4243.5 13389.03,-4250.5"/>
</g>
<!-- R2_Stage1_L2_Expert14&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge768" class="edge">
<title>R2_Stage1_L2_Expert14&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M11942.67,-4366.96C11942.67,-4324.12 11942.67,-4249 11942.67,-4249 11942.67,-4249 13391.71,-4249 13391.71,-4249"/>
<polygon fill="black" stroke="black" points="13391.71,-4252.5 13401.71,-4249 13391.71,-4245.5 13391.71,-4252.5"/>
</g>
<!-- R2_Stage1_L2_Expert15&#45;&gt;R2_Stage1_L2_MoE_Output -->
<g id="edge769" class="edge">
<title>R2_Stage1_L2_Expert15&#45;&gt;R2_Stage1_L2_MoE_Output</title>
<path fill="none" stroke="black" d="M12238.67,-4366.81C12238.67,-4324.2 12238.67,-4250 12238.67,-4250 12238.67,-4250 13393.37,-4250 13393.37,-4250"/>
<polygon fill="black" stroke="black" points="13393.37,-4253.5 13403.37,-4250 13393.37,-4246.5 13393.37,-4253.5"/>
</g>
<!-- R2_Stage1_L2_MoE_Output&#45;&gt;R2_Stage1_L2_Output -->
<g id="edge770" class="edge">
<title>R2_Stage1_L2_MoE_Output&#45;&gt;R2_Stage1_L2_Output</title>
<path fill="none" stroke="black" d="M13278.09,-4154C13260.58,-4154 13250,-4154 13250,-4154 13250,-4154 13250,-4031.93 13250,-4031.93"/>
<polygon fill="black" stroke="black" points="13253.5,-4031.93 13250,-4021.93 13246.5,-4031.93 13253.5,-4031.93"/>
</g>
<!-- R2_Stage1_L3_Input -->
<g id="node485" class="node">
<title>R2_Stage1_L3_Input</title>
<ellipse fill="lightblue" stroke="black" cx="8426" cy="-5225.08" rx="225.5" ry="29"/>
<text text-anchor="middle" x="8426" y="-5233.58" font-family="Times,serif" font-size="10.00">Layer 3 Input</text>
<text text-anchor="middle" x="8426" y="-5222.58" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="8426" y="-5211.58" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Attn_Input -->
<g id="node486" class="node">
<title>R2_Stage1_L3_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="8426" cy="-5086.31" rx="225.5" ry="29"/>
<text text-anchor="middle" x="8426" y="-5094.81" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="8426" y="-5083.81" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="8426" y="-5072.81" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Input&#45;&gt;R2_Stage1_L3_Attn_Input -->
<g id="edge771" class="edge">
<title>R2_Stage1_L3_Input&#45;&gt;R2_Stage1_L3_Attn_Input</title>
<path fill="none" stroke="black" d="M8426,-5195.99C8426,-5195.99 8426,-5125.36 8426,-5125.36"/>
<polygon fill="black" stroke="black" points="8429.5,-5125.36 8426,-5115.36 8422.5,-5125.36 8429.5,-5125.36"/>
</g>
<!-- R2_Stage1_L3_Attn_TP1 -->
<g id="node487" class="node">
<title>R2_Stage1_L3_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="8408,-4968.77 8062,-4968.77 8062,-4910.77 8408,-4910.77 8408,-4968.77"/>
<text text-anchor="middle" x="8235" y="-4953.77" font-family="Times,serif" font-size="10.00">Attention TP GPU 64</text>
<text text-anchor="middle" x="8235" y="-4942.77" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="8235" y="-4931.77" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="8235" y="-4920.77" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage1_L3_Attn_Input&#45;&gt;R2_Stage1_L3_Attn_TP1 -->
<g id="edge772" class="edge">
<title>R2_Stage1_L3_Attn_Input&#45;&gt;R2_Stage1_L3_Attn_TP1</title>
<path fill="none" stroke="black" d="M8304.25,-5061.78C8304.25,-5061.78 8304.25,-4978.92 8304.25,-4978.92"/>
<polygon fill="black" stroke="black" points="8307.75,-4978.92 8304.25,-4968.92 8300.75,-4978.92 8307.75,-4978.92"/>
</g>
<!-- R2_Stage1_L3_Attn_TP2 -->
<g id="node488" class="node">
<title>R2_Stage1_L3_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="8790,-4968.77 8444,-4968.77 8444,-4910.77 8790,-4910.77 8790,-4968.77"/>
<text text-anchor="middle" x="8617" y="-4953.77" font-family="Times,serif" font-size="10.00">Attention TP GPU 65</text>
<text text-anchor="middle" x="8617" y="-4942.77" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="8617" y="-4931.77" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="8617" y="-4920.77" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage1_L3_Attn_Input&#45;&gt;R2_Stage1_L3_Attn_TP2 -->
<g id="edge773" class="edge">
<title>R2_Stage1_L3_Attn_Input&#45;&gt;R2_Stage1_L3_Attn_TP2</title>
<path fill="none" stroke="black" d="M8547.75,-5061.78C8547.75,-5061.78 8547.75,-4978.92 8547.75,-4978.92"/>
<polygon fill="black" stroke="black" points="8551.25,-4978.92 8547.75,-4968.92 8544.25,-4978.92 8551.25,-4978.92"/>
</g>
<!-- R2_Stage1_L3_Attn_Output -->
<g id="node489" class="node">
<title>R2_Stage1_L3_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="8381" cy="-4778" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="8381" y="-4792" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="8381" y="-4781" font-family="Times,serif" font-size="10.00">AllReduce GPUs 64&#45;65</text>
<text text-anchor="middle" x="8381" y="-4770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="8381" y="-4759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Attn_TP1&#45;&gt;R2_Stage1_L3_Attn_Output -->
<g id="edge774" class="edge">
<title>R2_Stage1_L3_Attn_TP1&#45;&gt;R2_Stage1_L3_Attn_Output</title>
<path fill="none" stroke="black" d="M8272.88,-4910.47C8272.88,-4910.47 8272.88,-4820.98 8272.88,-4820.98"/>
<polygon fill="black" stroke="black" points="8276.38,-4820.98 8272.88,-4810.98 8269.38,-4820.98 8276.38,-4820.98"/>
</g>
<!-- R2_Stage1_L3_Attn_TP2&#45;&gt;R2_Stage1_L3_Attn_Output -->
<g id="edge775" class="edge">
<title>R2_Stage1_L3_Attn_TP2&#45;&gt;R2_Stage1_L3_Attn_Output</title>
<path fill="none" stroke="black" d="M8534.12,-4910.47C8534.12,-4910.47 8534.12,-4816.81 8534.12,-4816.81"/>
<polygon fill="black" stroke="black" points="8537.62,-4816.81 8534.12,-4806.81 8530.62,-4816.81 8537.62,-4816.81"/>
</g>
<!-- R2_Stage1_L3_MoE_Input -->
<g id="node490" class="node">
<title>R2_Stage1_L3_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="8143" cy="-4587" rx="225.5" ry="29"/>
<text text-anchor="middle" x="8143" y="-4595.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="8143" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="8143" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Attn_Output&#45;&gt;R2_Stage1_L3_MoE_Input -->
<g id="edge776" class="edge">
<title>R2_Stage1_L3_Attn_Output&#45;&gt;R2_Stage1_L3_MoE_Input</title>
<path fill="none" stroke="black" d="M8253.13,-4746.46C8253.13,-4746.46 8253.13,-4622.47 8253.13,-4622.47"/>
<polygon fill="black" stroke="black" points="8256.63,-4622.47 8253.13,-4612.47 8249.63,-4622.47 8256.63,-4622.47"/>
</g>
<!-- R2_Stage1_L3_Router -->
<g id="node491" class="node">
<title>R2_Stage1_L3_Router</title>
<polygon fill="lightyellow" stroke="black" points="8506.36,-4448 7993.56,-4448 7861.64,-4344 8374.44,-4344 8506.36,-4448"/>
<text text-anchor="middle" x="8184" y="-4410" font-family="Times,serif" font-size="10.00">Router GPU 64</text>
<text text-anchor="middle" x="8184" y="-4399" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="8184" y="-4388" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="8184" y="-4377" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage1_L3_MoE_Input&#45;&gt;R2_Stage1_L3_Router -->
<g id="edge777" class="edge">
<title>R2_Stage1_L3_MoE_Input&#45;&gt;R2_Stage1_L3_Router</title>
<path fill="none" stroke="black" d="M8143,-4557.99C8143,-4557.99 8143,-4458.02 8143,-4458.02"/>
<polygon fill="black" stroke="black" points="8146.5,-4458.02 8143,-4448.02 8139.5,-4458.02 8146.5,-4458.02"/>
</g>
<!-- R2_Stage1_L3_Expert0 -->
<g id="node492" class="node">
<title>R2_Stage1_L3_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="12754,-4234 12494,-4234 12494,-4176 12754,-4176 12754,-4234"/>
<text text-anchor="middle" x="12624" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 64</text>
<text text-anchor="middle" x="12624" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="12624" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert0 -->
<g id="edge778" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8484.08,-4395.83C8484.08,-4392.37 8484.08,-4337 8484.08,-4337 8484.08,-4337 12514.33,-4337 12514.33,-4337 12514.33,-4337 12514.33,-4244.3 12514.33,-4244.3"/>
<polygon fill="black" stroke="black" points="12517.83,-4244.3 12514.33,-4234.3 12510.83,-4244.3 12517.83,-4244.3"/>
<text text-anchor="middle" x="9718.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert1 -->
<g id="node493" class="node">
<title>R2_Stage1_L3_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="8314,-4234 8054,-4234 8054,-4176 8314,-4176 8314,-4234"/>
<text text-anchor="middle" x="8184" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 65</text>
<text text-anchor="middle" x="8184" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="8184" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert1 -->
<g id="edge779" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8184,-4343.81C8184,-4343.81 8184,-4244.01 8184,-4244.01"/>
<polygon fill="black" stroke="black" points="8187.5,-4244.01 8184,-4234.01 8180.5,-4244.01 8187.5,-4244.01"/>
<text text-anchor="middle" x="8205.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert2 -->
<g id="node494" class="node">
<title>R2_Stage1_L3_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="8906,-4234 8646,-4234 8646,-4176 8906,-4176 8906,-4234"/>
<text text-anchor="middle" x="8776" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 66</text>
<text text-anchor="middle" x="8776" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="8776" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert2 -->
<g id="edge780" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8383.37,-4351C8539.29,-4351 8729.81,-4351 8729.81,-4351 8729.81,-4351 8729.81,-4244.19 8729.81,-4244.19"/>
<polygon fill="black" stroke="black" points="8733.31,-4244.19 8729.81,-4234.19 8726.31,-4244.19 8733.31,-4244.19"/>
<text text-anchor="middle" x="8553.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert3 -->
<g id="node495" class="node">
<title>R2_Stage1_L3_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="9202,-4234 8942,-4234 8942,-4176 9202,-4176 9202,-4234"/>
<text text-anchor="middle" x="9072" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 67</text>
<text text-anchor="middle" x="9072" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9072" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert3 -->
<g id="edge781" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8393.82,-4359C8611.25,-4359 8919.64,-4359 8919.64,-4359 8919.64,-4359 8919.64,-4205 8919.64,-4205 8919.64,-4205 8931.79,-4205 8931.79,-4205"/>
<polygon fill="black" stroke="black" points="8931.79,-4208.5 8941.79,-4205 8931.79,-4201.5 8931.79,-4208.5"/>
<text text-anchor="middle" x="8674.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert4 -->
<g id="node496" class="node">
<title>R2_Stage1_L3_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="9498,-4234 9238,-4234 9238,-4176 9498,-4176 9498,-4234"/>
<text text-anchor="middle" x="9368" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 68</text>
<text text-anchor="middle" x="9368" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9368" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert4 -->
<g id="edge782" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8361.17,-4343.82C8361.17,-4306.56 8361.17,-4263 8361.17,-4263 8361.17,-4263 9368,-4263 9368,-4263 9368,-4263 9368,-4244 9368,-4244"/>
<polygon fill="black" stroke="black" points="9371.5,-4244 9368,-4234 9364.5,-4244 9371.5,-4244"/>
<text text-anchor="middle" x="8776.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert5 -->
<g id="node497" class="node">
<title>R2_Stage1_L3_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="9794,-4234 9534,-4234 9534,-4176 9794,-4176 9794,-4234"/>
<text text-anchor="middle" x="9664" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 69</text>
<text text-anchor="middle" x="9664" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9664" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert5 -->
<g id="edge783" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8372.35,-4343.98C8372.35,-4308.91 8372.35,-4269 8372.35,-4269 8372.35,-4269 9564.36,-4269 9564.36,-4269 9564.36,-4269 9564.36,-4244 9564.36,-4244"/>
<polygon fill="black" stroke="black" points="9567.86,-4244 9564.36,-4234 9560.86,-4244 9567.86,-4244"/>
<text text-anchor="middle" x="8869.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert6 -->
<g id="node498" class="node">
<title>R2_Stage1_L3_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="10090,-4234 9830,-4234 9830,-4176 10090,-4176 10090,-4234"/>
<text text-anchor="middle" x="9960" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 70</text>
<text text-anchor="middle" x="9960" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9960" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert6 -->
<g id="edge784" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8383.52,-4350.98C8383.52,-4316.92 8383.52,-4276 8383.52,-4276 8383.52,-4276 9850.33,-4276 9850.33,-4276 9850.33,-4276 9850.33,-4244.29 9850.33,-4244.29"/>
<polygon fill="black" stroke="black" points="9853.83,-4244.29 9850.33,-4234.29 9846.83,-4244.29 9853.83,-4244.29"/>
<text text-anchor="middle" x="8958.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert7 -->
<g id="node499" class="node">
<title>R2_Stage1_L3_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="10386,-4234 10126,-4234 10126,-4176 10386,-4176 10386,-4234"/>
<text text-anchor="middle" x="10256" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 71</text>
<text text-anchor="middle" x="10256" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10256" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert7 -->
<g id="edge785" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8394.69,-4359.93C8394.69,-4326.53 8394.69,-4282 8394.69,-4282 8394.69,-4282 10146.33,-4282 10146.33,-4282 10146.33,-4282 10146.33,-4244.11 10146.33,-4244.11"/>
<polygon fill="black" stroke="black" points="10149.83,-4244.11 10146.33,-4234.11 10142.83,-4244.11 10149.83,-4244.11"/>
<text text-anchor="middle" x="9044.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert8 -->
<g id="node500" class="node">
<title>R2_Stage1_L3_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="12162,-4234 11902,-4234 11902,-4176 12162,-4176 12162,-4234"/>
<text text-anchor="middle" x="12032" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 72</text>
<text text-anchor="middle" x="12032" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="12032" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert8 -->
<g id="edge786" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8461.74,-4395.95C8461.74,-4393.67 8461.74,-4321 8461.74,-4321 8461.74,-4321 11922.33,-4321 11922.33,-4321 11922.33,-4321 11922.33,-4244.27 11922.33,-4244.27"/>
<polygon fill="black" stroke="black" points="11925.83,-4244.27 11922.33,-4234.27 11918.83,-4244.27 11925.83,-4244.27"/>
<text text-anchor="middle" x="9550.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert9 -->
<g id="node501" class="node">
<title>R2_Stage1_L3_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="10682,-4234 10422,-4234 10422,-4176 10682,-4176 10682,-4234"/>
<text text-anchor="middle" x="10552" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 73</text>
<text text-anchor="middle" x="10552" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10552" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert9 -->
<g id="edge787" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8405.87,-4368.72C8405.87,-4337.02 8405.87,-4289 8405.87,-4289 8405.87,-4289 10442.33,-4289 10442.33,-4289 10442.33,-4289 10442.33,-4244.38 10442.33,-4244.38"/>
<polygon fill="black" stroke="black" points="10445.83,-4244.38 10442.33,-4234.38 10438.83,-4244.38 10445.83,-4244.38"/>
<text text-anchor="middle" x="9129.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert10 -->
<g id="node502" class="node">
<title>R2_Stage1_L3_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="8610,-4234 8350,-4234 8350,-4176 8610,-4176 8610,-4234"/>
<text text-anchor="middle" x="8480" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 74</text>
<text text-anchor="middle" x="8480" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="8480" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert10 -->
<g id="edge788" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8495.26,-4395.86C8495.26,-4395.86 8495.26,-4244.01 8495.26,-4244.01"/>
<polygon fill="black" stroke="black" points="8498.76,-4244.01 8495.26,-4234.01 8491.76,-4244.01 8498.76,-4244.01"/>
<text text-anchor="middle" x="8395.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert11 -->
<g id="node503" class="node">
<title>R2_Stage1_L3_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="10978,-4234 10718,-4234 10718,-4176 10978,-4176 10978,-4234"/>
<text text-anchor="middle" x="10848" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 75</text>
<text text-anchor="middle" x="10848" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10848" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert11 -->
<g id="edge789" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8417.04,-4377.48C8417.04,-4348.32 8417.04,-4295 8417.04,-4295 8417.04,-4295 10738.33,-4295 10738.33,-4295 10738.33,-4295 10738.33,-4244.47 10738.33,-4244.47"/>
<polygon fill="black" stroke="black" points="10741.83,-4244.47 10738.33,-4234.47 10734.83,-4244.47 10741.83,-4244.47"/>
<text text-anchor="middle" x="9214.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert12 -->
<g id="node504" class="node">
<title>R2_Stage1_L3_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="11570,-4234 11310,-4234 11310,-4176 11570,-4176 11570,-4234"/>
<text text-anchor="middle" x="11440" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 76</text>
<text text-anchor="middle" x="11440" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11440" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert12 -->
<g id="edge790" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8439.39,-4395.01C8439.39,-4385.34 8439.39,-4308 8439.39,-4308 8439.39,-4308 11330.33,-4308 11330.33,-4308 11330.33,-4308 11330.33,-4244.24 11330.33,-4244.24"/>
<polygon fill="black" stroke="black" points="11333.83,-4244.24 11330.33,-4234.24 11326.83,-4244.24 11333.83,-4244.24"/>
<text text-anchor="middle" x="9382.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert13 -->
<g id="node505" class="node">
<title>R2_Stage1_L3_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="11274,-4234 11014,-4234 11014,-4176 11274,-4176 11274,-4234"/>
<text text-anchor="middle" x="11144" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 77</text>
<text text-anchor="middle" x="11144" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11144" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert13 -->
<g id="edge791" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8428.22,-4386.29C8428.22,-4362.28 8428.22,-4302 8428.22,-4302 8428.22,-4302 11034.33,-4302 11034.33,-4302 11034.33,-4302 11034.33,-4244.1 11034.33,-4244.1"/>
<polygon fill="black" stroke="black" points="11037.83,-4244.1 11034.33,-4234.1 11030.83,-4244.1 11037.83,-4244.1"/>
<text text-anchor="middle" x="9298.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert14 -->
<g id="node506" class="node">
<title>R2_Stage1_L3_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="11866,-4234 11606,-4234 11606,-4176 11866,-4176 11866,-4234"/>
<text text-anchor="middle" x="11736" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 78</text>
<text text-anchor="middle" x="11736" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11736" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert14 -->
<g id="edge792" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8450.56,-4395.94C8450.56,-4393.49 8450.56,-4315 8450.56,-4315 8450.56,-4315 11626.33,-4315 11626.33,-4315 11626.33,-4315 11626.33,-4244.19 11626.33,-4244.19"/>
<polygon fill="black" stroke="black" points="11629.83,-4244.19 11626.33,-4234.19 11622.83,-4244.19 11629.83,-4244.19"/>
<text text-anchor="middle" x="9466.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_Expert15 -->
<g id="node507" class="node">
<title>R2_Stage1_L3_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="12458,-4234 12198,-4234 12198,-4176 12458,-4176 12458,-4234"/>
<text text-anchor="middle" x="12328" y="-4213.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 79</text>
<text text-anchor="middle" x="12328" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="12328" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert15 -->
<g id="edge793" class="edge">
<title>R2_Stage1_L3_Router&#45;&gt;R2_Stage1_L3_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8472.91,-4395.95C8472.91,-4393.86 8472.91,-4327 8472.91,-4327 8472.91,-4327 12218.33,-4327 12218.33,-4327 12218.33,-4327 12218.33,-4244.22 12218.33,-4244.22"/>
<polygon fill="black" stroke="black" points="12221.83,-4244.22 12218.33,-4234.22 12214.83,-4244.22 12221.83,-4244.22"/>
<text text-anchor="middle" x="9634.5" y="-4296.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L3_MoE_Output -->
<g id="node508" class="node">
<title>R2_Stage1_L3_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="12771.95,-4066 12245.48,-4066 12110.05,-3962 12636.52,-3962 12771.95,-4066"/>
<text text-anchor="middle" x="12441" y="-4028" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="12441" y="-4017" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="12441" y="-4006" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="12441" y="-3995" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L3_Expert0&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge794" class="edge">
<title>R2_Stage1_L3_Expert0&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M12624,-4175.99C12624,-4175.99 12624,-4076.02 12624,-4076.02"/>
<polygon fill="black" stroke="black" points="12627.5,-4076.02 12624,-4066.02 12620.5,-4076.02 12627.5,-4076.02"/>
</g>
<!-- R2_Stage1_L3_Expert1&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge795" class="edge">
<title>R2_Stage1_L3_Expert1&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M8296.67,-4175.67C8296.67,-4130.99 8296.67,-4051 8296.67,-4051 8296.67,-4051 12215.83,-4051 12215.83,-4051"/>
<polygon fill="black" stroke="black" points="12215.83,-4054.5 12225.83,-4051 12215.83,-4047.5 12215.83,-4054.5"/>
</g>
<!-- R2_Stage1_L3_Expert2&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge796" class="edge">
<title>R2_Stage1_L3_Expert2&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M8888.67,-4175.89C8888.67,-4132.01 8888.67,-4054 8888.67,-4054 8888.67,-4054 12219.75,-4054 12219.75,-4054"/>
<polygon fill="black" stroke="black" points="12219.75,-4057.5 12229.75,-4054 12219.75,-4050.5 12219.75,-4057.5"/>
</g>
<!-- R2_Stage1_L3_Expert3&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge797" class="edge">
<title>R2_Stage1_L3_Expert3&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M9184.67,-4175.72C9184.67,-4132.07 9184.67,-4055 9184.67,-4055 9184.67,-4055 12221.1,-4055 12221.1,-4055"/>
<polygon fill="black" stroke="black" points="12221.1,-4058.5 12231.1,-4055 12221.1,-4051.5 12221.1,-4058.5"/>
</g>
<!-- R2_Stage1_L3_Expert4&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge798" class="edge">
<title>R2_Stage1_L3_Expert4&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M9480.67,-4175.92C9480.67,-4132.56 9480.67,-4056 9480.67,-4056 9480.67,-4056 12222.25,-4056 12222.25,-4056"/>
<polygon fill="black" stroke="black" points="12222.25,-4059.5 12232.25,-4056 12222.25,-4052.5 12222.25,-4059.5"/>
</g>
<!-- R2_Stage1_L3_Expert5&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge799" class="edge">
<title>R2_Stage1_L3_Expert5&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M9776.67,-4175.76C9776.67,-4132.63 9776.67,-4057 9776.67,-4057 9776.67,-4057 12223.6,-4057 12223.6,-4057"/>
<polygon fill="black" stroke="black" points="12223.6,-4060.5 12233.6,-4057 12223.6,-4053.5 12223.6,-4060.5"/>
</g>
<!-- R2_Stage1_L3_Expert6&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge800" class="edge">
<title>R2_Stage1_L3_Expert6&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M10072.67,-4175.96C10072.67,-4133.12 10072.67,-4058 10072.67,-4058 10072.67,-4058 12224.97,-4058 12224.97,-4058"/>
<polygon fill="black" stroke="black" points="12224.97,-4061.5 12234.97,-4058 12224.97,-4054.5 12224.97,-4061.5"/>
</g>
<!-- R2_Stage1_L3_Expert7&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge801" class="edge">
<title>R2_Stage1_L3_Expert7&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M10368.67,-4175.81C10368.67,-4133.2 10368.67,-4059 10368.67,-4059 10368.67,-4059 12226.15,-4059 12226.15,-4059"/>
<polygon fill="black" stroke="black" points="12226.15,-4062.5 12236.15,-4059 12226.15,-4055.5 12226.15,-4062.5"/>
</g>
<!-- R2_Stage1_L3_Expert8&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge802" class="edge">
<title>R2_Stage1_L3_Expert8&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M12136.14,-4175.99C12136.14,-4175.99 12136.14,-4024.08 12136.14,-4024.08"/>
<polygon fill="black" stroke="black" points="12139.64,-4024.08 12136.14,-4014.08 12132.64,-4024.08 12139.64,-4024.08"/>
</g>
<!-- R2_Stage1_L3_Expert9&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge803" class="edge">
<title>R2_Stage1_L3_Expert9&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M10664.67,-4175.66C10664.67,-4133.29 10664.67,-4060 10664.67,-4060 10664.67,-4060 12227.66,-4060 12227.66,-4060"/>
<polygon fill="black" stroke="black" points="12227.66,-4063.5 12237.66,-4060 12227.66,-4056.5 12227.66,-4063.5"/>
</g>
<!-- R2_Stage1_L3_Expert10&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge804" class="edge">
<title>R2_Stage1_L3_Expert10&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M8592.67,-4175.86C8592.67,-4131.47 8592.67,-4052 8592.67,-4052 8592.67,-4052 12217.23,-4052 12217.23,-4052"/>
<polygon fill="black" stroke="black" points="12217.24,-4055.5 12227.23,-4052 12217.23,-4048.5 12217.24,-4055.5"/>
</g>
<!-- R2_Stage1_L3_Expert11&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge805" class="edge">
<title>R2_Stage1_L3_Expert11&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M10960.67,-4175.86C10960.67,-4133.78 10960.67,-4061 10960.67,-4061 10960.67,-4061 12228.66,-4061 12228.66,-4061"/>
<polygon fill="black" stroke="black" points="12228.66,-4064.5 12238.66,-4061 12228.66,-4057.5 12228.66,-4064.5"/>
</g>
<!-- R2_Stage1_L3_Expert12&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge806" class="edge">
<title>R2_Stage1_L3_Expert12&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M11544,-4175.92C11544,-4134.38 11544,-4063 11544,-4063 11544,-4063 12231.37,-4063 12231.37,-4063"/>
<polygon fill="black" stroke="black" points="12231.37,-4066.5 12241.37,-4063 12231.37,-4059.5 12231.37,-4066.5"/>
</g>
<!-- R2_Stage1_L3_Expert13&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge807" class="edge">
<title>R2_Stage1_L3_Expert13&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M11256.67,-4175.72C11256.67,-4133.88 11256.67,-4062 11256.67,-4062 11256.67,-4062 12230.09,-4062 12230.09,-4062"/>
<polygon fill="black" stroke="black" points="12230.09,-4065.5 12240.09,-4062 12230.09,-4058.5 12230.09,-4065.5"/>
</g>
<!-- R2_Stage1_L3_Expert14&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge808" class="edge">
<title>R2_Stage1_L3_Expert14&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M11840,-4175.78C11840,-4134.48 11840,-4064 11840,-4064 11840,-4064 12232.54,-4064 12232.54,-4064"/>
<polygon fill="black" stroke="black" points="12232.54,-4067.5 12242.54,-4064 12232.54,-4060.5 12232.54,-4067.5"/>
</g>
<!-- R2_Stage1_L3_Expert15&#45;&gt;R2_Stage1_L3_MoE_Output -->
<g id="edge809" class="edge">
<title>R2_Stage1_L3_Expert15&#45;&gt;R2_Stage1_L3_MoE_Output</title>
<path fill="none" stroke="black" d="M12328,-4175.99C12328,-4175.99 12328,-4076.02 12328,-4076.02"/>
<polygon fill="black" stroke="black" points="12331.5,-4076.02 12328,-4066.02 12324.5,-4076.02 12331.5,-4076.02"/>
</g>
<!-- R2_Stage1_L3_MoE_Output&#45;&gt;R2_Stage1_L3_Output -->
<g id="edge810" class="edge">
<title>R2_Stage1_L3_MoE_Output&#45;&gt;R2_Stage1_L3_Output</title>
<path fill="none" stroke="black" d="M12441,-3961.85C12441,-3961.85 12441,-3876.22 12441,-3876.22"/>
<polygon fill="black" stroke="black" points="12444.5,-3876.22 12441,-3866.22 12437.5,-3876.22 12444.5,-3876.22"/>
</g>
<!-- R2_Stage1_L4_Input -->
<g id="node509" class="node">
<title>R2_Stage1_L4_Input</title>
<ellipse fill="lightblue" stroke="black" cx="7750" cy="-5086.31" rx="225.5" ry="29"/>
<text text-anchor="middle" x="7750" y="-5094.81" font-family="Times,serif" font-size="10.00">Layer 4 Input</text>
<text text-anchor="middle" x="7750" y="-5083.81" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="7750" y="-5072.81" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Attn_Input -->
<g id="node510" class="node">
<title>R2_Stage1_L4_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="7750" cy="-4939.77" rx="225.5" ry="29"/>
<text text-anchor="middle" x="7750" y="-4948.27" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="7750" y="-4937.27" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="7750" y="-4926.27" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Input&#45;&gt;R2_Stage1_L4_Attn_Input -->
<g id="edge811" class="edge">
<title>R2_Stage1_L4_Input&#45;&gt;R2_Stage1_L4_Attn_Input</title>
<path fill="none" stroke="black" d="M7750,-5057.01C7750,-5057.01 7750,-4979.02 7750,-4979.02"/>
<polygon fill="black" stroke="black" points="7753.5,-4979.02 7750,-4969.02 7746.5,-4979.02 7753.5,-4979.02"/>
</g>
<!-- R2_Stage1_L4_Attn_TP1 -->
<g id="node511" class="node">
<title>R2_Stage1_L4_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="7720,-4807 7374,-4807 7374,-4749 7720,-4749 7720,-4807"/>
<text text-anchor="middle" x="7547" y="-4792" font-family="Times,serif" font-size="10.00">Attention TP GPU 64</text>
<text text-anchor="middle" x="7547" y="-4781" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="7547" y="-4770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="7547" y="-4759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage1_L4_Attn_Input&#45;&gt;R2_Stage1_L4_Attn_TP1 -->
<g id="edge812" class="edge">
<title>R2_Stage1_L4_Attn_Input&#45;&gt;R2_Stage1_L4_Attn_TP1</title>
<path fill="none" stroke="black" d="M7622.25,-4915.55C7622.25,-4915.55 7622.25,-4817.04 7622.25,-4817.04"/>
<polygon fill="black" stroke="black" points="7625.75,-4817.04 7622.25,-4807.04 7618.75,-4817.04 7625.75,-4817.04"/>
</g>
<!-- R2_Stage1_L4_Attn_TP2 -->
<g id="node512" class="node">
<title>R2_Stage1_L4_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="8102,-4807 7756,-4807 7756,-4749 8102,-4749 8102,-4807"/>
<text text-anchor="middle" x="7929" y="-4792" font-family="Times,serif" font-size="10.00">Attention TP GPU 65</text>
<text text-anchor="middle" x="7929" y="-4781" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="7929" y="-4770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="7929" y="-4759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage1_L4_Attn_Input&#45;&gt;R2_Stage1_L4_Attn_TP2 -->
<g id="edge813" class="edge">
<title>R2_Stage1_L4_Attn_Input&#45;&gt;R2_Stage1_L4_Attn_TP2</title>
<path fill="none" stroke="black" d="M7865.75,-4914.85C7865.75,-4914.85 7865.75,-4817.06 7865.75,-4817.06"/>
<polygon fill="black" stroke="black" points="7869.25,-4817.06 7865.75,-4807.06 7862.25,-4817.06 7869.25,-4817.06"/>
</g>
<!-- R2_Stage1_L4_Attn_Output -->
<g id="node513" class="node">
<title>R2_Stage1_L4_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="7638" cy="-4587" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="7638" y="-4601" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="7638" y="-4590" font-family="Times,serif" font-size="10.00">AllReduce GPUs 64&#45;65</text>
<text text-anchor="middle" x="7638" y="-4579" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="7638" y="-4568" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Attn_TP1&#45;&gt;R2_Stage1_L4_Attn_Output -->
<g id="edge814" class="edge">
<title>R2_Stage1_L4_Attn_TP1&#45;&gt;R2_Stage1_L4_Attn_Output</title>
<path fill="none" stroke="black" d="M7557.38,-4748.99C7557.38,-4748.99 7557.38,-4631.8 7557.38,-4631.8"/>
<polygon fill="black" stroke="black" points="7560.88,-4631.8 7557.38,-4621.8 7553.88,-4631.8 7560.88,-4631.8"/>
</g>
<!-- R2_Stage1_L4_Attn_TP2&#45;&gt;R2_Stage1_L4_Attn_Output -->
<g id="edge815" class="edge">
<title>R2_Stage1_L4_Attn_TP2&#45;&gt;R2_Stage1_L4_Attn_Output</title>
<path fill="none" stroke="black" d="M7818.62,-4748.99C7818.62,-4748.99 7818.62,-4621.71 7818.62,-4621.71"/>
<polygon fill="black" stroke="black" points="7822.12,-4621.71 7818.62,-4611.71 7815.12,-4621.71 7822.12,-4621.71"/>
</g>
<!-- R2_Stage1_L4_MoE_Input -->
<g id="node514" class="node">
<title>R2_Stage1_L4_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="7600" cy="-4396" rx="225.5" ry="29"/>
<text text-anchor="middle" x="7600" y="-4404.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="7600" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="7600" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Attn_Output&#45;&gt;R2_Stage1_L4_MoE_Input -->
<g id="edge816" class="edge">
<title>R2_Stage1_L4_Attn_Output&#45;&gt;R2_Stage1_L4_MoE_Input</title>
<path fill="none" stroke="black" d="M7610.13,-4550.17C7610.13,-4550.17 7610.13,-4435.22 7610.13,-4435.22"/>
<polygon fill="black" stroke="black" points="7613.63,-4435.22 7610.13,-4425.22 7606.63,-4435.22 7613.63,-4435.22"/>
</g>
<!-- R2_Stage1_L4_Router -->
<g id="node515" class="node">
<title>R2_Stage1_L4_Router</title>
<polygon fill="lightyellow" stroke="black" points="8018.36,-4257 7505.56,-4257 7373.64,-4153 7886.44,-4153 8018.36,-4257"/>
<text text-anchor="middle" x="7696" y="-4219" font-family="Times,serif" font-size="10.00">Router GPU 64</text>
<text text-anchor="middle" x="7696" y="-4208" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="7696" y="-4197" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="7696" y="-4186" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage1_L4_MoE_Input&#45;&gt;R2_Stage1_L4_Router -->
<g id="edge817" class="edge">
<title>R2_Stage1_L4_MoE_Input&#45;&gt;R2_Stage1_L4_Router</title>
<path fill="none" stroke="black" d="M7600,-4366.99C7600,-4366.99 7600,-4267.02 7600,-4267.02"/>
<polygon fill="black" stroke="black" points="7603.5,-4267.02 7600,-4257.02 7596.5,-4267.02 7603.5,-4267.02"/>
</g>
<!-- R2_Stage1_L4_Expert0 -->
<g id="node516" class="node">
<title>R2_Stage1_L4_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="10002,-4043 9742,-4043 9742,-3985 10002,-3985 10002,-4043"/>
<text text-anchor="middle" x="9872" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 64</text>
<text text-anchor="middle" x="9872" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9872" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert0 -->
<g id="edge818" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7901.86,-4165C8424.09,-4165 9759.33,-4165 9759.33,-4165 9759.33,-4165 9759.33,-4053.11 9759.33,-4053.11"/>
<polygon fill="black" stroke="black" points="9762.83,-4053.11 9759.33,-4043.11 9755.83,-4053.11 9762.83,-4053.11"/>
<text text-anchor="middle" x="8485.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert1 -->
<g id="node517" class="node">
<title>R2_Stage1_L4_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="10298,-4043 10038,-4043 10038,-3985 10298,-3985 10298,-4043"/>
<text text-anchor="middle" x="10168" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 65</text>
<text text-anchor="middle" x="10168" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10168" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert1 -->
<g id="edge819" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7904.34,-4167C8480.91,-4167 10055.33,-4167 10055.33,-4167 10055.33,-4167 10055.33,-4053.14 10055.33,-4053.14"/>
<polygon fill="black" stroke="black" points="10058.83,-4053.14 10055.33,-4043.14 10051.83,-4053.14 10058.83,-4053.14"/>
<text text-anchor="middle" x="8570.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert2 -->
<g id="node518" class="node">
<title>R2_Stage1_L4_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="10594,-4043 10334,-4043 10334,-3985 10594,-3985 10594,-4043"/>
<text text-anchor="middle" x="10464" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 66</text>
<text text-anchor="middle" x="10464" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10464" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert2 -->
<g id="edge820" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7905.75,-4168C8533.01,-4168 10351.33,-4168 10351.33,-4168 10351.33,-4168 10351.33,-4053.33 10351.33,-4053.33"/>
<polygon fill="black" stroke="black" points="10354.83,-4053.33 10351.33,-4043.33 10347.83,-4053.33 10354.83,-4053.33"/>
<text text-anchor="middle" x="8654.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert3 -->
<g id="node519" class="node">
<title>R2_Stage1_L4_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="10890,-4043 10630,-4043 10630,-3985 10890,-3985 10890,-4043"/>
<text text-anchor="middle" x="10760" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 67</text>
<text text-anchor="middle" x="10760" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="10760" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert3 -->
<g id="edge821" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7908.25,-4170C8584.97,-4170 10647.33,-4170 10647.33,-4170 10647.33,-4170 10647.33,-4053.34 10647.33,-4053.34"/>
<polygon fill="black" stroke="black" points="10650.83,-4053.34 10647.33,-4043.34 10643.83,-4053.34 10650.83,-4053.34"/>
<text text-anchor="middle" x="8738.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert4 -->
<g id="node520" class="node">
<title>R2_Stage1_L4_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="11186,-4043 10926,-4043 10926,-3985 11186,-3985 11186,-4043"/>
<text text-anchor="middle" x="11056" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 68</text>
<text text-anchor="middle" x="11056" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11056" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert4 -->
<g id="edge822" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7910.64,-4172C8634.85,-4172 10943.33,-4172 10943.33,-4172 10943.33,-4172 10943.33,-4053.35 10943.33,-4053.35"/>
<polygon fill="black" stroke="black" points="10946.83,-4053.35 10943.33,-4043.35 10939.83,-4053.35 10946.83,-4053.35"/>
<text text-anchor="middle" x="8822.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert5 -->
<g id="node521" class="node">
<title>R2_Stage1_L4_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="11482,-4043 11222,-4043 11222,-3985 11482,-3985 11482,-4043"/>
<text text-anchor="middle" x="11352" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 69</text>
<text text-anchor="middle" x="11352" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11352" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert5 -->
<g id="edge823" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7913.31,-4174C8683.83,-4174 11239.33,-4174 11239.33,-4174 11239.33,-4174 11239.33,-4053.35 11239.33,-4053.35"/>
<polygon fill="black" stroke="black" points="11242.83,-4053.35 11239.33,-4043.35 11235.83,-4053.35 11242.83,-4053.35"/>
<text text-anchor="middle" x="8906.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert6 -->
<g id="node522" class="node">
<title>R2_Stage1_L4_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="11778,-4043 11518,-4043 11518,-3985 11778,-3985 11778,-4043"/>
<text text-anchor="middle" x="11648" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 70</text>
<text text-anchor="middle" x="11648" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11648" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert6 -->
<g id="edge824" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7990.53,-4235C8897.61,-4235 11588,-4235 11588,-4235 11588,-4235 11588,-4053.35 11588,-4053.35"/>
<polygon fill="black" stroke="black" points="11591.5,-4053.35 11588,-4043.35 11584.5,-4053.35 11591.5,-4053.35"/>
<text text-anchor="middle" x="8990.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert7 -->
<g id="node523" class="node">
<title>R2_Stage1_L4_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="12074,-4043 11814,-4043 11814,-3985 12074,-3985 12074,-4043"/>
<text text-anchor="middle" x="11944" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 71</text>
<text text-anchor="middle" x="11944" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="11944" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert7 -->
<g id="edge825" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7993,-4237C8948.91,-4237 11884,-4237 11884,-4237 11884,-4237 11884,-4053.15 11884,-4053.15"/>
<polygon fill="black" stroke="black" points="11887.5,-4053.15 11884,-4043.15 11880.5,-4053.15 11887.5,-4053.15"/>
<text text-anchor="middle" x="9074.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert8 -->
<g id="node524" class="node">
<title>R2_Stage1_L4_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="7634,-4043 7374,-4043 7374,-3985 7634,-3985 7634,-4043"/>
<text text-anchor="middle" x="7504" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 72</text>
<text text-anchor="middle" x="7504" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="7504" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert8 -->
<g id="edge826" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7504,-4152.81C7504,-4152.81 7504,-4053.01 7504,-4053.01"/>
<polygon fill="black" stroke="black" points="7507.5,-4053.01 7504,-4043.01 7500.5,-4053.01 7507.5,-4053.01"/>
<text text-anchor="middle" x="7579.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert9 -->
<g id="node525" class="node">
<title>R2_Stage1_L4_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="7930,-4043 7670,-4043 7670,-3985 7930,-3985 7930,-4043"/>
<text text-anchor="middle" x="7800" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 73</text>
<text text-anchor="middle" x="7800" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="7800" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert9 -->
<g id="edge827" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7800,-4152.81C7800,-4152.81 7800,-4053.01 7800,-4053.01"/>
<polygon fill="black" stroke="black" points="7803.5,-4053.01 7800,-4043.01 7796.5,-4053.01 7803.5,-4053.01"/>
<text text-anchor="middle" x="7769.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert10 -->
<g id="node526" class="node">
<title>R2_Stage1_L4_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="8226,-4043 7966,-4043 7966,-3985 8226,-3985 8226,-4043"/>
<text text-anchor="middle" x="8096" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 74</text>
<text text-anchor="middle" x="8096" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="8096" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert10 -->
<g id="edge828" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7992.22,-4204.86C7992.22,-4204.86 7992.22,-4053.01 7992.22,-4053.01"/>
<polygon fill="black" stroke="black" points="7995.72,-4053.01 7992.22,-4043.01 7988.72,-4053.01 7995.72,-4053.01"/>
<text text-anchor="middle" x="7918.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert11 -->
<g id="node527" class="node">
<title>R2_Stage1_L4_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="8522,-4043 8262,-4043 8262,-3985 8522,-3985 8522,-4043"/>
<text text-anchor="middle" x="8392" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 75</text>
<text text-anchor="middle" x="8392" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="8392" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert11 -->
<g id="edge829" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7890.65,-4156C8060.28,-4156 8279.33,-4156 8279.33,-4156 8279.33,-4156 8279.33,-4053.08 8279.33,-4053.08"/>
<polygon fill="black" stroke="black" points="8282.83,-4053.08 8279.33,-4043.08 8275.83,-4053.08 8282.83,-4053.08"/>
<text text-anchor="middle" x="8034.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert12 -->
<g id="node528" class="node">
<title>R2_Stage1_L4_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="8818,-4043 8558,-4043 8558,-3985 8818,-3985 8818,-4043"/>
<text text-anchor="middle" x="8688" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 76</text>
<text text-anchor="middle" x="8688" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="8688" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert12 -->
<g id="edge830" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7892.79,-4158C8152,-4158 8575.33,-4158 8575.33,-4158 8575.33,-4158 8575.33,-4053.14 8575.33,-4053.14"/>
<polygon fill="black" stroke="black" points="8578.83,-4053.14 8575.33,-4043.14 8571.83,-4053.14 8578.83,-4053.14"/>
<text text-anchor="middle" x="8134.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert13 -->
<g id="node529" class="node">
<title>R2_Stage1_L4_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="9114,-4043 8854,-4043 8854,-3985 9114,-3985 9114,-4043"/>
<text text-anchor="middle" x="8984" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 77</text>
<text text-anchor="middle" x="8984" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="8984" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert13 -->
<g id="edge831" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7895.38,-4160C8230.71,-4160 8871.33,-4160 8871.33,-4160 8871.33,-4160 8871.33,-4053.19 8871.33,-4053.19"/>
<polygon fill="black" stroke="black" points="8874.83,-4053.19 8871.33,-4043.19 8867.83,-4053.19 8874.83,-4053.19"/>
<text text-anchor="middle" x="8226.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert14 -->
<g id="node530" class="node">
<title>R2_Stage1_L4_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="9410,-4043 9150,-4043 9150,-3985 9410,-3985 9410,-4043"/>
<text text-anchor="middle" x="9280" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 78</text>
<text text-anchor="middle" x="9280" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9280" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert14 -->
<g id="edge832" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7896.73,-4161C8299.36,-4161 9167.33,-4161 9167.33,-4161 9167.33,-4161 9167.33,-4053.04 9167.33,-4053.04"/>
<polygon fill="black" stroke="black" points="9170.83,-4053.04 9167.33,-4043.04 9163.83,-4053.04 9170.83,-4053.04"/>
<text text-anchor="middle" x="8314.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_Expert15 -->
<g id="node531" class="node">
<title>R2_Stage1_L4_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="9706,-4043 9446,-4043 9446,-3985 9706,-3985 9706,-4043"/>
<text text-anchor="middle" x="9576" y="-4022.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 79</text>
<text text-anchor="middle" x="9576" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="9576" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert15 -->
<g id="edge833" class="edge">
<title>R2_Stage1_L4_Router&#45;&gt;R2_Stage1_L4_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7899.17,-4163C8363.64,-4163 9463.33,-4163 9463.33,-4163 9463.33,-4163 9463.33,-4053.08 9463.33,-4053.08"/>
<polygon fill="black" stroke="black" points="9466.83,-4053.08 9463.33,-4043.08 9459.83,-4053.08 9466.83,-4053.08"/>
<text text-anchor="middle" x="8400.5" y="-4105.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage1_L4_MoE_Output -->
<g id="node532" class="node">
<title>R2_Stage1_L4_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="10055.95,-3889 9529.48,-3889 9394.05,-3785 9920.52,-3785 10055.95,-3889"/>
<text text-anchor="middle" x="9725" y="-3851" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="9725" y="-3840" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="9725" y="-3829" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="9725" y="-3818" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage1_L4_Expert0&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge834" class="edge">
<title>R2_Stage1_L4_Expert0&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M9872,-3984.77C9872,-3984.77 9872,-3899.18 9872,-3899.18"/>
<polygon fill="black" stroke="black" points="9875.5,-3899.18 9872,-3889.18 9868.5,-3899.18 9875.5,-3899.18"/>
</g>
<!-- R2_Stage1_L4_Expert1&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge835" class="edge">
<title>R2_Stage1_L4_Expert1&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M10046.86,-3984.77C10046.86,-3984.77 10046.86,-3847.07 10046.86,-3847.07"/>
<polygon fill="black" stroke="black" points="10050.36,-3847.07 10046.86,-3837.07 10043.36,-3847.07 10050.36,-3847.07"/>
</g>
<!-- R2_Stage1_L4_Expert2&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge836" class="edge">
<title>R2_Stage1_L4_Expert2&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M10464,-3984.86C10464,-3947.37 10464,-3887 10464,-3887 10464,-3887 10063.44,-3887 10063.44,-3887"/>
<polygon fill="black" stroke="black" points="10063.44,-3883.5 10053.44,-3887 10063.44,-3890.5 10063.44,-3883.5"/>
</g>
<!-- R2_Stage1_L4_Expert3&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge837" class="edge">
<title>R2_Stage1_L4_Expert3&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M10760,-3984.73C10760,-3946.67 10760,-3885 10760,-3885 10760,-3885 10061.06,-3885 10061.06,-3885"/>
<polygon fill="black" stroke="black" points="10061.06,-3881.5 10051.06,-3885 10061.06,-3888.5 10061.06,-3881.5"/>
</g>
<!-- R2_Stage1_L4_Expert4&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge838" class="edge">
<title>R2_Stage1_L4_Expert4&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M11056,-3984.83C11056,-3946.5 11056,-3884 11056,-3884 11056,-3884 10059.75,-3884 10059.75,-3884"/>
<polygon fill="black" stroke="black" points="10059.75,-3880.5 10049.75,-3884 10059.75,-3887.5 10059.75,-3880.5"/>
</g>
<!-- R2_Stage1_L4_Expert5&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge839" class="edge">
<title>R2_Stage1_L4_Expert5&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M11352,-3984.7C11352,-3945.82 11352,-3882 11352,-3882 11352,-3882 10056.93,-3882 10056.93,-3882"/>
<polygon fill="black" stroke="black" points="10056.93,-3878.5 10046.93,-3882 10056.93,-3885.5 10056.93,-3878.5"/>
</g>
<!-- R2_Stage1_L4_Expert6&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge840" class="edge">
<title>R2_Stage1_L4_Expert6&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M11648,-3984.92C11648,-3945.51 11648,-3880 11648,-3880 11648,-3880 10054.43,-3880 10054.43,-3880"/>
<polygon fill="black" stroke="black" points="10054.43,-3876.5 10044.43,-3880 10054.43,-3883.5 10054.43,-3876.5"/>
</g>
<!-- R2_Stage1_L4_Expert7&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge841" class="edge">
<title>R2_Stage1_L4_Expert7&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M11944,-3984.71C11944,-3945 11944,-3879 11944,-3879 11944,-3879 10052.93,-3879 10052.93,-3879"/>
<polygon fill="black" stroke="black" points="10052.93,-3875.5 10042.93,-3879 10052.93,-3882.5 10052.93,-3875.5"/>
</g>
<!-- R2_Stage1_L4_Expert8&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge842" class="edge">
<title>R2_Stage1_L4_Expert8&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M7504,-3984.86C7504,-3944.1 7504,-3875 7504,-3875 7504,-3875 9501.03,-3875 9501.03,-3875"/>
<polygon fill="black" stroke="black" points="9501.03,-3878.5 9511.03,-3875 9501.03,-3871.5 9501.03,-3878.5"/>
</g>
<!-- R2_Stage1_L4_Expert9&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge843" class="edge">
<title>R2_Stage1_L4_Expert9&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M7800,-3984.82C7800,-3944.86 7800,-3878 7800,-3878 7800,-3878 9504.87,-3878 9504.87,-3878"/>
<polygon fill="black" stroke="black" points="9504.87,-3881.5 9514.87,-3878 9504.87,-3874.5 9504.87,-3881.5"/>
</g>
<!-- R2_Stage1_L4_Expert10&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge844" class="edge">
<title>R2_Stage1_L4_Expert10&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M8096,-3984.92C8096,-3945.51 8096,-3880 8096,-3880 8096,-3880 9507.45,-3880 9507.45,-3880"/>
<polygon fill="black" stroke="black" points="9507.45,-3883.5 9517.45,-3880 9507.45,-3876.5 9507.45,-3883.5"/>
</g>
<!-- R2_Stage1_L4_Expert11&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge845" class="edge">
<title>R2_Stage1_L4_Expert11&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M8392,-3984.7C8392,-3945.82 8392,-3882 8392,-3882 8392,-3882 9510,-3882 9510,-3882"/>
<polygon fill="black" stroke="black" points="9510,-3885.5 9520,-3882 9510,-3878.5 9510,-3885.5"/>
</g>
<!-- R2_Stage1_L4_Expert12&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge846" class="edge">
<title>R2_Stage1_L4_Expert12&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M8688,-3984.83C8688,-3946.5 8688,-3884 8688,-3884 8688,-3884 9512.9,-3884 9512.9,-3884"/>
<polygon fill="black" stroke="black" points="9512.9,-3887.5 9522.9,-3884 9512.9,-3880.5 9512.9,-3887.5"/>
</g>
<!-- R2_Stage1_L4_Expert13&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge847" class="edge">
<title>R2_Stage1_L4_Expert13&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M9001.22,-3984.95C9001.22,-3947.19 9001.22,-3886 9001.22,-3886 9001.22,-3886 9515.31,-3886 9515.31,-3886"/>
<polygon fill="black" stroke="black" points="9515.31,-3889.5 9525.31,-3886 9515.31,-3882.5 9515.31,-3889.5"/>
</g>
<!-- R2_Stage1_L4_Expert14&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge848" class="edge">
<title>R2_Stage1_L4_Expert14&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M9402.14,-3984.77C9402.14,-3984.77 9402.14,-3847.07 9402.14,-3847.07"/>
<polygon fill="black" stroke="black" points="9405.64,-3847.07 9402.14,-3837.07 9398.64,-3847.07 9405.64,-3847.07"/>
</g>
<!-- R2_Stage1_L4_Expert15&#45;&gt;R2_Stage1_L4_MoE_Output -->
<g id="edge849" class="edge">
<title>R2_Stage1_L4_Expert15&#45;&gt;R2_Stage1_L4_MoE_Output</title>
<path fill="none" stroke="black" d="M9576,-3984.77C9576,-3984.77 9576,-3899.18 9576,-3899.18"/>
<polygon fill="black" stroke="black" points="9579.5,-3899.18 9576,-3889.18 9572.5,-3899.18 9579.5,-3899.18"/>
</g>
<!-- R2_Stage1_L4_MoE_Output&#45;&gt;R2_Stage1_L4_Output -->
<g id="edge850" class="edge">
<title>R2_Stage1_L4_MoE_Output&#45;&gt;R2_Stage1_L4_Output</title>
<path fill="none" stroke="black" d="M9725,-3784.85C9725,-3784.85 9725,-3699.22 9725,-3699.22"/>
<polygon fill="black" stroke="black" points="9728.5,-3699.22 9725,-3689.22 9721.5,-3699.22 9728.5,-3699.22"/>
</g>
<!-- R2_Stage2_L5_Input -->
<g id="node533" class="node">
<title>R2_Stage2_L5_Input</title>
<ellipse fill="lightblue" stroke="black" cx="4638" cy="-4587" rx="225.5" ry="29"/>
<text text-anchor="middle" x="4638" y="-4595.5" font-family="Times,serif" font-size="10.00">Layer 5 Input</text>
<text text-anchor="middle" x="4638" y="-4584.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="4638" y="-4573.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Attn_Input -->
<g id="node534" class="node">
<title>R2_Stage2_L5_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="4638" cy="-4396" rx="225.5" ry="29"/>
<text text-anchor="middle" x="4638" y="-4404.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="4638" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="4638" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Input&#45;&gt;R2_Stage2_L5_Attn_Input -->
<g id="edge851" class="edge">
<title>R2_Stage2_L5_Input&#45;&gt;R2_Stage2_L5_Attn_Input</title>
<path fill="none" stroke="black" d="M4638,-4557.99C4638,-4557.99 4638,-4435.28 4638,-4435.28"/>
<polygon fill="black" stroke="black" points="4641.5,-4435.28 4638,-4425.28 4634.5,-4435.28 4641.5,-4435.28"/>
</g>
<!-- R2_Stage2_L5_Attn_TP1 -->
<g id="node535" class="node">
<title>R2_Stage2_L5_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="4620,-4234 4274,-4234 4274,-4176 4620,-4176 4620,-4234"/>
<text text-anchor="middle" x="4447" y="-4219" font-family="Times,serif" font-size="10.00">Attention TP GPU 80</text>
<text text-anchor="middle" x="4447" y="-4208" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="4447" y="-4197" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="4447" y="-4186" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage2_L5_Attn_Input&#45;&gt;R2_Stage2_L5_Attn_TP1 -->
<g id="edge852" class="edge">
<title>R2_Stage2_L5_Attn_Input&#45;&gt;R2_Stage2_L5_Attn_TP1</title>
<path fill="none" stroke="black" d="M4516.25,-4371.42C4516.25,-4371.42 4516.25,-4244.17 4516.25,-4244.17"/>
<polygon fill="black" stroke="black" points="4519.75,-4244.17 4516.25,-4234.17 4512.75,-4244.17 4519.75,-4244.17"/>
</g>
<!-- R2_Stage2_L5_Attn_TP2 -->
<g id="node536" class="node">
<title>R2_Stage2_L5_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="5002,-4234 4656,-4234 4656,-4176 5002,-4176 5002,-4234"/>
<text text-anchor="middle" x="4829" y="-4219" font-family="Times,serif" font-size="10.00">Attention TP GPU 81</text>
<text text-anchor="middle" x="4829" y="-4208" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="4829" y="-4197" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="4829" y="-4186" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage2_L5_Attn_Input&#45;&gt;R2_Stage2_L5_Attn_TP2 -->
<g id="edge853" class="edge">
<title>R2_Stage2_L5_Attn_Input&#45;&gt;R2_Stage2_L5_Attn_TP2</title>
<path fill="none" stroke="black" d="M4759.75,-4371.42C4759.75,-4371.42 4759.75,-4244.17 4759.75,-4244.17"/>
<polygon fill="black" stroke="black" points="4763.25,-4244.17 4759.75,-4234.17 4756.25,-4244.17 4763.25,-4244.17"/>
</g>
<!-- R2_Stage2_L5_Attn_Output -->
<g id="node537" class="node">
<title>R2_Stage2_L5_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="4638" cy="-4014" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="4638" y="-4028" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="4638" y="-4017" font-family="Times,serif" font-size="10.00">AllReduce GPUs 80&#45;81</text>
<text text-anchor="middle" x="4638" y="-4006" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="4638" y="-3995" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Attn_TP1&#45;&gt;R2_Stage2_L5_Attn_Output -->
<g id="edge854" class="edge">
<title>R2_Stage2_L5_Attn_TP1&#45;&gt;R2_Stage2_L5_Attn_Output</title>
<path fill="none" stroke="black" d="M4507.38,-4175.99C4507.38,-4175.99 4507.38,-4055.19 4507.38,-4055.19"/>
<polygon fill="black" stroke="black" points="4510.88,-4055.19 4507.38,-4045.19 4503.88,-4055.19 4510.88,-4055.19"/>
</g>
<!-- R2_Stage2_L5_Attn_TP2&#45;&gt;R2_Stage2_L5_Attn_Output -->
<g id="edge855" class="edge">
<title>R2_Stage2_L5_Attn_TP2&#45;&gt;R2_Stage2_L5_Attn_Output</title>
<path fill="none" stroke="black" d="M4768.62,-4175.99C4768.62,-4175.99 4768.62,-4055.19 4768.62,-4055.19"/>
<polygon fill="black" stroke="black" points="4772.12,-4055.19 4768.62,-4045.19 4765.12,-4055.19 4772.12,-4055.19"/>
</g>
<!-- R2_Stage2_L5_MoE_Input -->
<g id="node538" class="node">
<title>R2_Stage2_L5_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="4638" cy="-3837" rx="225.5" ry="29"/>
<text text-anchor="middle" x="4638" y="-3845.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="4638" y="-3834.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="4638" y="-3823.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Attn_Output&#45;&gt;R2_Stage2_L5_MoE_Input -->
<g id="edge856" class="edge">
<title>R2_Stage2_L5_Attn_Output&#45;&gt;R2_Stage2_L5_MoE_Input</title>
<path fill="none" stroke="black" d="M4638,-3976.89C4638,-3976.89 4638,-3876.17 4638,-3876.17"/>
<polygon fill="black" stroke="black" points="4641.5,-3876.17 4638,-3866.17 4634.5,-3876.17 4641.5,-3876.17"/>
</g>
<!-- R2_Stage2_L5_Router -->
<g id="node539" class="node">
<title>R2_Stage2_L5_Router</title>
<polygon fill="lightyellow" stroke="black" points="4960.36,-3712 4447.56,-3712 4315.64,-3608 4828.44,-3608 4960.36,-3712"/>
<text text-anchor="middle" x="4638" y="-3674" font-family="Times,serif" font-size="10.00">Router GPU 80</text>
<text text-anchor="middle" x="4638" y="-3663" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="4638" y="-3652" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="4638" y="-3641" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage2_L5_MoE_Input&#45;&gt;R2_Stage2_L5_Router -->
<g id="edge857" class="edge">
<title>R2_Stage2_L5_MoE_Input&#45;&gt;R2_Stage2_L5_Router</title>
<path fill="none" stroke="black" d="M4638,-3807.77C4638,-3807.77 4638,-3722.18 4638,-3722.18"/>
<polygon fill="black" stroke="black" points="4641.5,-3722.18 4638,-3712.18 4634.5,-3722.18 4641.5,-3722.18"/>
</g>
<!-- R2_Stage2_L5_Expert0 -->
<g id="node540" class="node">
<title>R2_Stage2_L5_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="2548,-3498 2288,-3498 2288,-3440 2548,-3440 2548,-3498"/>
<text text-anchor="middle" x="2418" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 80</text>
<text text-anchor="middle" x="2418" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2418" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert0 -->
<g id="edge858" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4331.94,-3621C3723.06,-3621 2418,-3621 2418,-3621 2418,-3621 2418,-3508.31 2418,-3508.31"/>
<polygon fill="black" stroke="black" points="2421.5,-3508.31 2418,-3498.31 2414.5,-3508.31 2421.5,-3508.31"/>
<text text-anchor="middle" x="2649.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert1 -->
<g id="node541" class="node">
<title>R2_Stage2_L5_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="2844,-3498 2584,-3498 2584,-3440 2844,-3440 2844,-3498"/>
<text text-anchor="middle" x="2714" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 81</text>
<text text-anchor="middle" x="2714" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2714" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert1 -->
<g id="edge859" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4328.07,-3618C3783.95,-3618 2714,-3618 2714,-3618 2714,-3618 2714,-3508.08 2714,-3508.08"/>
<polygon fill="black" stroke="black" points="2717.5,-3508.08 2714,-3498.08 2710.5,-3508.08 2717.5,-3508.08"/>
<text text-anchor="middle" x="2944.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert2 -->
<g id="node542" class="node">
<title>R2_Stage2_L5_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="3140,-3498 2880,-3498 2880,-3440 3140,-3440 3140,-3498"/>
<text text-anchor="middle" x="3010" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 82</text>
<text text-anchor="middle" x="3010" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3010" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert2 -->
<g id="edge860" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4325.55,-3616C3852.74,-3616 3010,-3616 3010,-3616 3010,-3616 3010,-3508.04 3010,-3508.04"/>
<polygon fill="black" stroke="black" points="3013.5,-3508.04 3010,-3498.04 3006.5,-3508.04 3013.5,-3508.04"/>
<text text-anchor="middle" x="3238.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert3 -->
<g id="node543" class="node">
<title>R2_Stage2_L5_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="3436,-3498 3176,-3498 3176,-3440 3436,-3440 3436,-3498"/>
<text text-anchor="middle" x="3306" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 83</text>
<text text-anchor="middle" x="3306" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3306" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert3 -->
<g id="edge861" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4323.18,-3614C3929.33,-3614 3306,-3614 3306,-3614 3306,-3614 3306,-3508.34 3306,-3508.34"/>
<polygon fill="black" stroke="black" points="3309.5,-3508.34 3306,-3498.34 3302.5,-3508.34 3309.5,-3508.34"/>
<text text-anchor="middle" x="3529.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert4 -->
<g id="node544" class="node">
<title>R2_Stage2_L5_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="3732,-3498 3472,-3498 3472,-3440 3732,-3440 3732,-3498"/>
<text text-anchor="middle" x="3602" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 84</text>
<text text-anchor="middle" x="3602" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3602" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert4 -->
<g id="edge862" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4320.48,-3612C4015.91,-3612 3602,-3612 3602,-3612 3602,-3612 3602,-3508.28 3602,-3508.28"/>
<polygon fill="black" stroke="black" points="3605.5,-3508.28 3602,-3498.28 3598.5,-3508.28 3605.5,-3508.28"/>
<text text-anchor="middle" x="3815.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert5 -->
<g id="node545" class="node">
<title>R2_Stage2_L5_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="4028,-3498 3768,-3498 3768,-3440 4028,-3440 4028,-3498"/>
<text text-anchor="middle" x="3898" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 85</text>
<text text-anchor="middle" x="3898" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3898" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert5 -->
<g id="edge863" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4318,-3610C4117.93,-3610 3898,-3610 3898,-3610 3898,-3610 3898,-3508.22 3898,-3508.22"/>
<polygon fill="black" stroke="black" points="3901.5,-3508.22 3898,-3498.22 3894.5,-3508.22 3901.5,-3508.22"/>
<text text-anchor="middle" x="4091.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert6 -->
<g id="node546" class="node">
<title>R2_Stage2_L5_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="4324,-3498 4064,-3498 4064,-3440 4324,-3440 4324,-3498"/>
<text text-anchor="middle" x="4194" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 86</text>
<text text-anchor="middle" x="4194" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4194" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert6 -->
<g id="edge864" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4319.78,-3659.86C4319.78,-3659.86 4319.78,-3508.01 4319.78,-3508.01"/>
<polygon fill="black" stroke="black" points="4323.28,-3508.01 4319.78,-3498.01 4316.28,-3508.01 4323.28,-3508.01"/>
<text text-anchor="middle" x="4347.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert7 -->
<g id="node547" class="node">
<title>R2_Stage2_L5_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="4620,-3498 4360,-3498 4360,-3440 4620,-3440 4620,-3498"/>
<text text-anchor="middle" x="4490" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 87</text>
<text text-anchor="middle" x="4490" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4490" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert7 -->
<g id="edge865" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4490,-3607.81C4490,-3607.81 4490,-3508.01 4490,-3508.01"/>
<polygon fill="black" stroke="black" points="4493.5,-3508.01 4490,-3498.01 4486.5,-3508.01 4493.5,-3508.01"/>
<text text-anchor="middle" x="4564.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert8 -->
<g id="node548" class="node">
<title>R2_Stage2_L5_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="4916,-3498 4656,-3498 4656,-3440 4916,-3440 4916,-3498"/>
<text text-anchor="middle" x="4786" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 88</text>
<text text-anchor="middle" x="4786" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4786" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert8 -->
<g id="edge866" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4786,-3607.81C4786,-3607.81 4786,-3508.01 4786,-3508.01"/>
<polygon fill="black" stroke="black" points="4789.5,-3508.01 4786,-3498.01 4782.5,-3508.01 4789.5,-3508.01"/>
<text text-anchor="middle" x="4754.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert9 -->
<g id="node549" class="node">
<title>R2_Stage2_L5_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="5212,-3498 4952,-3498 4952,-3440 5212,-3440 5212,-3498"/>
<text text-anchor="middle" x="5082" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 89</text>
<text text-anchor="middle" x="5082" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="5082" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert9 -->
<g id="edge867" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4956.22,-3659.86C4956.22,-3659.86 4956.22,-3508.01 4956.22,-3508.01"/>
<polygon fill="black" stroke="black" points="4959.72,-3508.01 4956.22,-3498.01 4952.72,-3508.01 4959.72,-3508.01"/>
<text text-anchor="middle" x="4997.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert10 -->
<g id="node550" class="node">
<title>R2_Stage2_L5_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="5508,-3498 5248,-3498 5248,-3440 5508,-3440 5508,-3498"/>
<text text-anchor="middle" x="5378" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 90</text>
<text text-anchor="middle" x="5378" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="5378" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert10 -->
<g id="edge868" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4831.46,-3610C5050.72,-3610 5378,-3610 5378,-3610 5378,-3610 5378,-3508.22 5378,-3508.22"/>
<polygon fill="black" stroke="black" points="5381.5,-3508.22 5378,-3498.22 5374.5,-3508.22 5381.5,-3508.22"/>
<text text-anchor="middle" x="5266.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert11 -->
<g id="node551" class="node">
<title>R2_Stage2_L5_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="5804,-3498 5544,-3498 5544,-3440 5804,-3440 5804,-3498"/>
<text text-anchor="middle" x="5674" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 91</text>
<text text-anchor="middle" x="5674" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="5674" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert11 -->
<g id="edge869" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4833.78,-3612C5134.06,-3612 5674,-3612 5674,-3612 5674,-3612 5674,-3508.28 5674,-3508.28"/>
<polygon fill="black" stroke="black" points="5677.5,-3508.28 5674,-3498.28 5670.5,-3508.28 5677.5,-3508.28"/>
<text text-anchor="middle" x="5549.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert12 -->
<g id="node552" class="node">
<title>R2_Stage2_L5_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="6100,-3498 5840,-3498 5840,-3440 6100,-3440 6100,-3498"/>
<text text-anchor="middle" x="5970" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 92</text>
<text text-anchor="middle" x="5970" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="5970" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert12 -->
<g id="edge870" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4837.41,-3615C5209,-3615 5970,-3615 5970,-3615 5970,-3615 5970,-3508.19 5970,-3508.19"/>
<polygon fill="black" stroke="black" points="5973.5,-3508.19 5970,-3498.19 5966.5,-3508.19 5973.5,-3508.19"/>
<text text-anchor="middle" x="5838.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert13 -->
<g id="node553" class="node">
<title>R2_Stage2_L5_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="6396,-3498 6136,-3498 6136,-3440 6396,-3440 6396,-3498"/>
<text text-anchor="middle" x="6266" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 93</text>
<text text-anchor="middle" x="6266" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="6266" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert13 -->
<g id="edge871" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4840.08,-3617C5276.07,-3617 6266,-3617 6266,-3617 6266,-3617 6266,-3508.24 6266,-3508.24"/>
<polygon fill="black" stroke="black" points="6269.5,-3508.24 6266,-3498.24 6262.5,-3508.24 6269.5,-3508.24"/>
<text text-anchor="middle" x="6131.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert14 -->
<g id="node554" class="node">
<title>R2_Stage2_L5_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="6692,-3498 6432,-3498 6432,-3440 6692,-3440 6692,-3498"/>
<text text-anchor="middle" x="6562" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 94</text>
<text text-anchor="middle" x="6562" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="6562" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert14 -->
<g id="edge872" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4842.53,-3619C5337.99,-3619 6562,-3619 6562,-3619 6562,-3619 6562,-3508.28 6562,-3508.28"/>
<polygon fill="black" stroke="black" points="6565.5,-3508.28 6562,-3498.28 6558.5,-3508.28 6565.5,-3508.28"/>
<text text-anchor="middle" x="6425.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_Expert15 -->
<g id="node555" class="node">
<title>R2_Stage2_L5_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="6988,-3498 6728,-3498 6728,-3440 6988,-3440 6988,-3498"/>
<text text-anchor="middle" x="6858" y="-3477.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 95</text>
<text text-anchor="middle" x="6858" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="6858" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert15 -->
<g id="edge873" class="edge">
<title>R2_Stage2_L5_Router&#45;&gt;R2_Stage2_L5_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M4846.35,-3622C5398.61,-3622 6858,-3622 6858,-3622 6858,-3622 6858,-3508.14 6858,-3508.14"/>
<polygon fill="black" stroke="black" points="6861.5,-3508.14 6858,-3498.14 6854.5,-3508.14 6861.5,-3508.14"/>
<text text-anchor="middle" x="6720.5" y="-3560.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L5_MoE_Output -->
<g id="node556" class="node">
<title>R2_Stage2_L5_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="6597.95,-3330 6071.48,-3330 5936.05,-3226 6462.52,-3226 6597.95,-3330"/>
<text text-anchor="middle" x="6267" y="-3292" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="6267" y="-3281" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="6267" y="-3270" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="6267" y="-3259" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L5_Expert0&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge874" class="edge">
<title>R2_Stage2_L5_Expert0&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M2493.33,-3439.84C2493.33,-3394.43 2493.33,-3312 2493.33,-3312 2493.33,-3312 6037.8,-3312 6037.8,-3312"/>
<polygon fill="black" stroke="black" points="6037.8,-3315.5 6047.8,-3312 6037.8,-3308.5 6037.8,-3315.5"/>
</g>
<!-- R2_Stage2_L5_Expert1&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge875" class="edge">
<title>R2_Stage2_L5_Expert1&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M2789.33,-3439.85C2789.33,-3394.95 2789.33,-3314 2789.33,-3314 2789.33,-3314 6040.44,-3314 6040.44,-3314"/>
<polygon fill="black" stroke="black" points="6040.44,-3317.5 6050.44,-3314 6040.44,-3310.5 6040.44,-3317.5"/>
</g>
<!-- R2_Stage2_L5_Expert2&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge876" class="edge">
<title>R2_Stage2_L5_Expert2&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M3085.33,-3439.67C3085.33,-3394.99 3085.33,-3315 3085.33,-3315 3085.33,-3315 6041.75,-3315 6041.75,-3315"/>
<polygon fill="black" stroke="black" points="6041.75,-3318.5 6051.75,-3315 6041.75,-3311.5 6041.75,-3318.5"/>
</g>
<!-- R2_Stage2_L5_Expert3&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge877" class="edge">
<title>R2_Stage2_L5_Expert3&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M3381.33,-3439.69C3381.33,-3395.52 3381.33,-3317 3381.33,-3317 3381.33,-3317 6044.52,-3317 6044.52,-3317"/>
<polygon fill="black" stroke="black" points="6044.52,-3320.5 6054.52,-3317 6044.52,-3313.5 6044.52,-3320.5"/>
</g>
<!-- R2_Stage2_L5_Expert4&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge878" class="edge">
<title>R2_Stage2_L5_Expert4&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M3677.33,-3439.89C3677.33,-3396.01 3677.33,-3318 3677.33,-3318 3677.33,-3318 6045.63,-3318 6045.63,-3318"/>
<polygon fill="black" stroke="black" points="6045.63,-3321.5 6055.63,-3318 6045.63,-3314.5 6045.63,-3321.5"/>
</g>
<!-- R2_Stage2_L5_Expert5&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge879" class="edge">
<title>R2_Stage2_L5_Expert5&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M3973.33,-3439.72C3973.33,-3396.07 3973.33,-3319 3973.33,-3319 3973.33,-3319 6047.12,-3319 6047.12,-3319"/>
<polygon fill="black" stroke="black" points="6047.12,-3322.5 6057.12,-3319 6047.12,-3315.5 6047.12,-3322.5"/>
</g>
<!-- R2_Stage2_L5_Expert6&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge880" class="edge">
<title>R2_Stage2_L5_Expert6&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M4269.33,-3439.76C4269.33,-3396.63 4269.33,-3321 4269.33,-3321 4269.33,-3321 6049.34,-3321 6049.34,-3321"/>
<polygon fill="black" stroke="black" points="6049.34,-3324.5 6059.34,-3321 6049.34,-3317.5 6049.34,-3324.5"/>
</g>
<!-- R2_Stage2_L5_Expert7&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge881" class="edge">
<title>R2_Stage2_L5_Expert7&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M4565.33,-3439.96C4565.33,-3397.12 4565.33,-3322 4565.33,-3322 4565.33,-3322 6050.89,-3322 6050.89,-3322"/>
<polygon fill="black" stroke="black" points="6050.89,-3325.5 6060.89,-3322 6050.89,-3318.5 6050.89,-3325.5"/>
</g>
<!-- R2_Stage2_L5_Expert8&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge882" class="edge">
<title>R2_Stage2_L5_Expert8&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M4861.33,-3439.66C4861.33,-3397.29 4861.33,-3324 4861.33,-3324 4861.33,-3324 6053.36,-3324 6053.36,-3324"/>
<polygon fill="black" stroke="black" points="6053.36,-3327.5 6063.36,-3324 6053.36,-3320.5 6053.36,-3327.5"/>
</g>
<!-- R2_Stage2_L5_Expert9&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge883" class="edge">
<title>R2_Stage2_L5_Expert9&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M5157.33,-3439.86C5157.33,-3397.78 5157.33,-3325 5157.33,-3325 5157.33,-3325 6054.76,-3325 6054.76,-3325"/>
<polygon fill="black" stroke="black" points="6054.76,-3328.5 6064.76,-3325 6054.76,-3321.5 6054.76,-3328.5"/>
</g>
<!-- R2_Stage2_L5_Expert10&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge884" class="edge">
<title>R2_Stage2_L5_Expert10&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M5426,-3439.92C5426,-3398.38 5426,-3327 5426,-3327 5426,-3327 6057.43,-3327 6057.43,-3327"/>
<polygon fill="black" stroke="black" points="6057.43,-3330.5 6067.43,-3327 6057.43,-3323.5 6057.43,-3330.5"/>
</g>
<!-- R2_Stage2_L5_Expert11&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge885" class="edge">
<title>R2_Stage2_L5_Expert11&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M5722,-3439.78C5722,-3398.48 5722,-3328 5722,-3328 5722,-3328 6058.7,-3328 6058.7,-3328"/>
<polygon fill="black" stroke="black" points="6058.7,-3331.5 6068.7,-3328 6058.7,-3324.5 6058.7,-3331.5"/>
</g>
<!-- R2_Stage2_L5_Expert12&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge886" class="edge">
<title>R2_Stage2_L5_Expert12&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M6018.14,-3439.99C6018.14,-3439.99 6018.14,-3299.2 6018.14,-3299.2"/>
<polygon fill="black" stroke="black" points="6021.64,-3299.2 6018.14,-3289.2 6014.64,-3299.2 6021.64,-3299.2"/>
</g>
<!-- R2_Stage2_L5_Expert13&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge887" class="edge">
<title>R2_Stage2_L5_Expert13&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M6266,-3439.99C6266,-3439.99 6266,-3340.02 6266,-3340.02"/>
<polygon fill="black" stroke="black" points="6269.5,-3340.02 6266,-3330.02 6262.5,-3340.02 6269.5,-3340.02"/>
</g>
<!-- R2_Stage2_L5_Expert14&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge888" class="edge">
<title>R2_Stage2_L5_Expert14&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M6514.86,-3439.99C6514.86,-3439.99 6514.86,-3340.02 6514.86,-3340.02"/>
<polygon fill="black" stroke="black" points="6518.36,-3340.02 6514.86,-3330.02 6511.36,-3340.02 6518.36,-3340.02"/>
</g>
<!-- R2_Stage2_L5_Expert15&#45;&gt;R2_Stage2_L5_MoE_Output -->
<g id="edge889" class="edge">
<title>R2_Stage2_L5_Expert15&#45;&gt;R2_Stage2_L5_MoE_Output</title>
<path fill="none" stroke="black" d="M6858,-3439.89C6858,-3396.01 6858,-3318 6858,-3318 6858,-3318 6592.4,-3318 6592.4,-3318"/>
<polygon fill="black" stroke="black" points="6592.4,-3314.5 6582.4,-3318 6592.4,-3321.5 6592.4,-3314.5"/>
</g>
<!-- R2_Stage2_L5_MoE_Output&#45;&gt;R2_Stage2_L5_Output -->
<g id="edge890" class="edge">
<title>R2_Stage2_L5_MoE_Output&#45;&gt;R2_Stage2_L5_Output</title>
<path fill="none" stroke="black" d="M6371,-3225.81C6371,-3225.81 6371,-3126.01 6371,-3126.01"/>
<polygon fill="black" stroke="black" points="6374.5,-3126.01 6371,-3116.01 6367.5,-3126.01 6374.5,-3126.01"/>
</g>
<!-- R2_Stage2_L6_Input -->
<g id="node557" class="node">
<title>R2_Stage2_L6_Input</title>
<ellipse fill="lightblue" stroke="black" cx="1651" cy="-4396" rx="225.5" ry="29"/>
<text text-anchor="middle" x="1651" y="-4404.5" font-family="Times,serif" font-size="10.00">Layer 6 Input</text>
<text text-anchor="middle" x="1651" y="-4393.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="1651" y="-4382.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Attn_Input -->
<g id="node558" class="node">
<title>R2_Stage2_L6_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="1651" cy="-4205" rx="225.5" ry="29"/>
<text text-anchor="middle" x="1651" y="-4213.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="1651" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="1651" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Input&#45;&gt;R2_Stage2_L6_Attn_Input -->
<g id="edge891" class="edge">
<title>R2_Stage2_L6_Input&#45;&gt;R2_Stage2_L6_Attn_Input</title>
<path fill="none" stroke="black" d="M1651,-4366.99C1651,-4366.99 1651,-4244.28 1651,-4244.28"/>
<polygon fill="black" stroke="black" points="1654.5,-4244.28 1651,-4234.28 1647.5,-4244.28 1654.5,-4244.28"/>
</g>
<!-- R2_Stage2_L6_Attn_TP1 -->
<g id="node559" class="node">
<title>R2_Stage2_L6_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="1798,-4043 1452,-4043 1452,-3985 1798,-3985 1798,-4043"/>
<text text-anchor="middle" x="1625" y="-4028" font-family="Times,serif" font-size="10.00">Attention TP GPU 80</text>
<text text-anchor="middle" x="1625" y="-4017" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="1625" y="-4006" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="1625" y="-3995" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage2_L6_Attn_Input&#45;&gt;R2_Stage2_L6_Attn_TP1 -->
<g id="edge892" class="edge">
<title>R2_Stage2_L6_Attn_Input&#45;&gt;R2_Stage2_L6_Attn_TP1</title>
<path fill="none" stroke="black" d="M1625,-4175.99C1625,-4175.99 1625,-4053.28 1625,-4053.28"/>
<polygon fill="black" stroke="black" points="1628.5,-4053.28 1625,-4043.28 1621.5,-4053.28 1628.5,-4053.28"/>
</g>
<!-- R2_Stage2_L6_Attn_TP2 -->
<g id="node560" class="node">
<title>R2_Stage2_L6_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="2180,-4043 1834,-4043 1834,-3985 2180,-3985 2180,-4043"/>
<text text-anchor="middle" x="2007" y="-4028" font-family="Times,serif" font-size="10.00">Attention TP GPU 81</text>
<text text-anchor="middle" x="2007" y="-4017" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="2007" y="-4006" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="2007" y="-3995" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage2_L6_Attn_Input&#45;&gt;R2_Stage2_L6_Attn_TP2 -->
<g id="edge893" class="edge">
<title>R2_Stage2_L6_Attn_Input&#45;&gt;R2_Stage2_L6_Attn_TP2</title>
<path fill="none" stroke="black" d="M1855.25,-4192.47C1855.25,-4192.47 1855.25,-4053.24 1855.25,-4053.24"/>
<polygon fill="black" stroke="black" points="1858.75,-4053.24 1855.25,-4043.24 1851.75,-4053.24 1858.75,-4053.24"/>
</g>
<!-- R2_Stage2_L6_Attn_Output -->
<g id="node561" class="node">
<title>R2_Stage2_L6_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="1930" cy="-3837" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="1930" y="-3851" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1930" y="-3840" font-family="Times,serif" font-size="10.00">AllReduce GPUs 80&#45;81</text>
<text text-anchor="middle" x="1930" y="-3829" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1930" y="-3818" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Attn_TP1&#45;&gt;R2_Stage2_L6_Attn_Output -->
<g id="edge894" class="edge">
<title>R2_Stage2_L6_Attn_TP1&#45;&gt;R2_Stage2_L6_Attn_Output</title>
<path fill="none" stroke="black" d="M1742.38,-3984.77C1742.38,-3984.77 1742.38,-3870.6 1742.38,-3870.6"/>
<polygon fill="black" stroke="black" points="1745.88,-3870.6 1742.38,-3860.6 1738.88,-3870.6 1745.88,-3870.6"/>
</g>
<!-- R2_Stage2_L6_Attn_TP2&#45;&gt;R2_Stage2_L6_Attn_Output -->
<g id="edge895" class="edge">
<title>R2_Stage2_L6_Attn_TP2&#45;&gt;R2_Stage2_L6_Attn_Output</title>
<path fill="none" stroke="black" d="M2003.62,-3984.77C2003.62,-3984.77 2003.62,-3882.06 2003.62,-3882.06"/>
<polygon fill="black" stroke="black" points="2007.12,-3882.06 2003.62,-3872.06 2000.12,-3882.06 2007.12,-3882.06"/>
</g>
<!-- R2_Stage2_L6_MoE_Input -->
<g id="node562" class="node">
<title>R2_Stage2_L6_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="1930" cy="-3660" rx="225.5" ry="29"/>
<text text-anchor="middle" x="1930" y="-3668.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="1930" y="-3657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="1930" y="-3646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Attn_Output&#45;&gt;R2_Stage2_L6_MoE_Input -->
<g id="edge896" class="edge">
<title>R2_Stage2_L6_Attn_Output&#45;&gt;R2_Stage2_L6_MoE_Input</title>
<path fill="none" stroke="black" d="M1930,-3799.89C1930,-3799.89 1930,-3699.17 1930,-3699.17"/>
<polygon fill="black" stroke="black" points="1933.5,-3699.17 1930,-3689.17 1926.5,-3699.17 1933.5,-3699.17"/>
</g>
<!-- R2_Stage2_L6_Router -->
<g id="node563" class="node">
<title>R2_Stage2_L6_Router</title>
<polygon fill="lightyellow" stroke="black" points="2252.36,-3521 1739.56,-3521 1607.64,-3417 2120.44,-3417 2252.36,-3521"/>
<text text-anchor="middle" x="1930" y="-3483" font-family="Times,serif" font-size="10.00">Router GPU 80</text>
<text text-anchor="middle" x="1930" y="-3472" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="1930" y="-3461" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="1930" y="-3450" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage2_L6_MoE_Input&#45;&gt;R2_Stage2_L6_Router -->
<g id="edge897" class="edge">
<title>R2_Stage2_L6_MoE_Input&#45;&gt;R2_Stage2_L6_Router</title>
<path fill="none" stroke="black" d="M1930,-3630.99C1930,-3630.99 1930,-3531.02 1930,-3531.02"/>
<polygon fill="black" stroke="black" points="1933.5,-3531.02 1930,-3521.02 1926.5,-3531.02 1933.5,-3531.02"/>
</g>
<!-- R2_Stage2_L6_Expert0 -->
<g id="node564" class="node">
<title>R2_Stage2_L6_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="5604,-3307 5344,-3307 5344,-3249 5604,-3249 5604,-3307"/>
<text text-anchor="middle" x="5474" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 80</text>
<text text-anchor="middle" x="5474" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="5474" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert0 -->
<g id="edge898" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2225.8,-3500C3086,-3500 5526,-3500 5526,-3500 5526,-3500 5526,-3317.02 5526,-3317.02"/>
<polygon fill="black" stroke="black" points="5529.5,-3317.02 5526,-3307.02 5522.5,-3317.02 5529.5,-3317.02"/>
<text text-anchor="middle" x="3172.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert1 -->
<g id="node565" class="node">
<title>R2_Stage2_L6_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="5900,-3307 5640,-3307 5640,-3249 5900,-3249 5900,-3307"/>
<text text-anchor="middle" x="5770" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 81</text>
<text text-anchor="middle" x="5770" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="5770" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert1 -->
<g id="edge899" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2229.74,-3503C3141.87,-3503 5822,-3503 5822,-3503 5822,-3503 5822,-3317.41 5822,-3317.41"/>
<polygon fill="black" stroke="black" points="5825.5,-3317.41 5822,-3307.41 5818.5,-3317.41 5825.5,-3317.41"/>
<text text-anchor="middle" x="3292.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert2 -->
<g id="node566" class="node">
<title>R2_Stage2_L6_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="1460,-3307 1200,-3307 1200,-3249 1460,-3249 1460,-3307"/>
<text text-anchor="middle" x="1330" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 82</text>
<text text-anchor="middle" x="1330" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="1330" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert2 -->
<g id="edge900" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1616.51,-3424C1488.57,-3424 1370.12,-3424 1370.12,-3424 1370.12,-3424 1370.12,-3317.19 1370.12,-3317.19"/>
<polygon fill="black" stroke="black" points="1373.62,-3317.19 1370.12,-3307.19 1366.62,-3317.19 1373.62,-3317.19"/>
<text text-anchor="middle" x="1510.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert3 -->
<g id="node567" class="node">
<title>R2_Stage2_L6_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="1756,-3307 1496,-3307 1496,-3249 1756,-3249 1756,-3307"/>
<text text-anchor="middle" x="1626" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 83</text>
<text text-anchor="middle" x="1626" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="1626" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert3 -->
<g id="edge901" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1681.78,-3416.81C1681.78,-3416.81 1681.78,-3317.01 1681.78,-3317.01"/>
<polygon fill="black" stroke="black" points="1685.28,-3317.01 1681.78,-3307.01 1678.28,-3317.01 1685.28,-3317.01"/>
<text text-anchor="middle" x="1753.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert4 -->
<g id="node568" class="node">
<title>R2_Stage2_L6_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="2052,-3307 1792,-3307 1792,-3249 2052,-3249 2052,-3307"/>
<text text-anchor="middle" x="1922" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 84</text>
<text text-anchor="middle" x="1922" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="1922" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert4 -->
<g id="edge902" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1922,-3416.81C1922,-3416.81 1922,-3317.01 1922,-3317.01"/>
<polygon fill="black" stroke="black" points="1925.5,-3317.01 1922,-3307.01 1918.5,-3317.01 1925.5,-3317.01"/>
<text text-anchor="middle" x="1943.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert5 -->
<g id="node569" class="node">
<title>R2_Stage2_L6_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="2348,-3307 2088,-3307 2088,-3249 2348,-3249 2348,-3307"/>
<text text-anchor="middle" x="2218" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 85</text>
<text text-anchor="middle" x="2218" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2218" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert5 -->
<g id="edge903" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2170.22,-3456.17C2170.22,-3456.17 2170.22,-3317.12 2170.22,-3317.12"/>
<polygon fill="black" stroke="black" points="2173.72,-3317.12 2170.22,-3307.12 2166.72,-3317.12 2173.72,-3317.12"/>
<text text-anchor="middle" x="2133.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert6 -->
<g id="node570" class="node">
<title>R2_Stage2_L6_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="2644,-3307 2384,-3307 2384,-3249 2644,-3249 2644,-3307"/>
<text text-anchor="middle" x="2514" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 86</text>
<text text-anchor="middle" x="2514" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2514" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert6 -->
<g id="edge904" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2121.94,-3418C2266.06,-3418 2438.67,-3418 2438.67,-3418 2438.67,-3418 2438.67,-3317.01 2438.67,-3317.01"/>
<polygon fill="black" stroke="black" points="2442.17,-3317.01 2438.67,-3307.01 2435.17,-3317.01 2442.17,-3317.01"/>
<text text-anchor="middle" x="2275.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert7 -->
<g id="node571" class="node">
<title>R2_Stage2_L6_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="2940,-3307 2680,-3307 2680,-3249 2940,-3249 2940,-3307"/>
<text text-anchor="middle" x="2810" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 87</text>
<text text-anchor="middle" x="2810" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2810" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert7 -->
<g id="edge905" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2124.27,-3420C2362.4,-3420 2734.67,-3420 2734.67,-3420 2734.67,-3420 2734.67,-3317.08 2734.67,-3317.08"/>
<polygon fill="black" stroke="black" points="2738.17,-3317.08 2734.67,-3307.08 2731.17,-3317.08 2738.17,-3317.08"/>
<text text-anchor="middle" x="2388.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert8 -->
<g id="node572" class="node">
<title>R2_Stage2_L6_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="3236,-3307 2976,-3307 2976,-3249 3236,-3249 3236,-3307"/>
<text text-anchor="middle" x="3106" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 88</text>
<text text-anchor="middle" x="3106" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3106" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert8 -->
<g id="edge906" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2127.09,-3422C2443.76,-3422 3030.67,-3422 3030.67,-3422 3030.67,-3422 3030.67,-3317.14 3030.67,-3317.14"/>
<polygon fill="black" stroke="black" points="3034.17,-3317.14 3030.67,-3307.14 3027.17,-3317.14 3034.17,-3317.14"/>
<text text-anchor="middle" x="2486.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert9 -->
<g id="node573" class="node">
<title>R2_Stage2_L6_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="3532,-3307 3272,-3307 3272,-3249 3532,-3249 3532,-3307"/>
<text text-anchor="middle" x="3402" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 89</text>
<text text-anchor="middle" x="3402" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3402" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert9 -->
<g id="edge907" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2129.37,-3424C2515.26,-3424 3326.67,-3424 3326.67,-3424 3326.67,-3424 3326.67,-3317.19 3326.67,-3317.19"/>
<polygon fill="black" stroke="black" points="3330.17,-3317.19 3326.67,-3307.19 3323.17,-3317.19 3330.17,-3317.19"/>
<text text-anchor="middle" x="2577.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert10 -->
<g id="node574" class="node">
<title>R2_Stage2_L6_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="3828,-3307 3568,-3307 3568,-3249 3828,-3249 3828,-3307"/>
<text text-anchor="middle" x="3698" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 90</text>
<text text-anchor="middle" x="3698" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3698" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert10 -->
<g id="edge908" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2132.07,-3426C2581.13,-3426 3622.67,-3426 3622.67,-3426 3622.67,-3426 3622.67,-3317.24 3622.67,-3317.24"/>
<polygon fill="black" stroke="black" points="3626.17,-3317.24 3622.67,-3307.24 3619.17,-3317.24 3626.17,-3317.24"/>
<text text-anchor="middle" x="2665.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert11 -->
<g id="node575" class="node">
<title>R2_Stage2_L6_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="4124,-3307 3864,-3307 3864,-3249 4124,-3249 4124,-3307"/>
<text text-anchor="middle" x="3994" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 91</text>
<text text-anchor="middle" x="3994" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3994" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert11 -->
<g id="edge909" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2134.4,-3428C2641.88,-3428 3918.67,-3428 3918.67,-3428 3918.67,-3428 3918.67,-3317.28 3918.67,-3317.28"/>
<polygon fill="black" stroke="black" points="3922.17,-3317.28 3918.67,-3307.28 3915.17,-3317.28 3922.17,-3317.28"/>
<text text-anchor="middle" x="2751.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert12 -->
<g id="node576" class="node">
<title>R2_Stage2_L6_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="4420,-3307 4160,-3307 4160,-3249 4420,-3249 4420,-3307"/>
<text text-anchor="middle" x="4290" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 92</text>
<text text-anchor="middle" x="4290" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4290" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert12 -->
<g id="edge910" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2137.03,-3430C2699.62,-3430 4214.67,-3430 4214.67,-3430 4214.67,-3430 4214.67,-3317.31 4214.67,-3317.31"/>
<polygon fill="black" stroke="black" points="4218.17,-3317.31 4214.67,-3307.31 4211.17,-3317.31 4218.17,-3317.31"/>
<text text-anchor="middle" x="2836.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert13 -->
<g id="node577" class="node">
<title>R2_Stage2_L6_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="4716,-3307 4456,-3307 4456,-3249 4716,-3249 4716,-3307"/>
<text text-anchor="middle" x="4586" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 93</text>
<text text-anchor="middle" x="4586" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4586" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert13 -->
<g id="edge911" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2142.01,-3434C2759.08,-3434 4510.67,-3434 4510.67,-3434 4510.67,-3434 4510.67,-3317.34 4510.67,-3317.34"/>
<polygon fill="black" stroke="black" points="4514.17,-3317.34 4510.67,-3307.34 4507.17,-3317.34 4514.17,-3317.34"/>
<text text-anchor="middle" x="2920.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert14 -->
<g id="node578" class="node">
<title>R2_Stage2_L6_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="5012,-3307 4752,-3307 4752,-3249 5012,-3249 5012,-3307"/>
<text text-anchor="middle" x="4882" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 94</text>
<text text-anchor="middle" x="4882" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4882" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert14 -->
<g id="edge912" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2144.75,-3436C2812.3,-3436 4806.67,-3436 4806.67,-3436 4806.67,-3436 4806.67,-3317.35 4806.67,-3317.35"/>
<polygon fill="black" stroke="black" points="4810.17,-3317.35 4806.67,-3307.35 4803.17,-3317.35 4810.17,-3317.35"/>
<text text-anchor="middle" x="3004.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_Expert15 -->
<g id="node579" class="node">
<title>R2_Stage2_L6_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="5308,-3307 5048,-3307 5048,-3249 5308,-3249 5308,-3307"/>
<text text-anchor="middle" x="5178" y="-3286.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 95</text>
<text text-anchor="middle" x="5178" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="5178" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert15 -->
<g id="edge913" class="edge">
<title>R2_Stage2_L6_Router&#45;&gt;R2_Stage2_L6_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2147.13,-3438C2862.91,-3438 5102.67,-3438 5102.67,-3438 5102.67,-3438 5102.67,-3317.35 5102.67,-3317.35"/>
<polygon fill="black" stroke="black" points="5106.17,-3317.35 5102.67,-3307.35 5099.17,-3317.35 5106.17,-3317.35"/>
<text text-anchor="middle" x="3088.5" y="-3369.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L6_MoE_Output -->
<g id="node580" class="node">
<title>R2_Stage2_L6_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="6109.95,-3139 5583.48,-3139 5448.05,-3035 5974.52,-3035 6109.95,-3139"/>
<text text-anchor="middle" x="5779" y="-3101" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="5779" y="-3090" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="5779" y="-3079" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="5779" y="-3068" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L6_Expert0&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge914" class="edge">
<title>R2_Stage2_L6_Expert0&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M5526.14,-3248.99C5526.14,-3248.99 5526.14,-3105.04 5526.14,-3105.04"/>
<polygon fill="black" stroke="black" points="5529.64,-3105.04 5526.14,-3095.04 5522.64,-3105.04 5529.64,-3105.04"/>
</g>
<!-- R2_Stage2_L6_Expert1&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge915" class="edge">
<title>R2_Stage2_L6_Expert1&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M5770,-3248.99C5770,-3248.99 5770,-3149.02 5770,-3149.02"/>
<polygon fill="black" stroke="black" points="5773.5,-3149.02 5770,-3139.02 5766.5,-3149.02 5773.5,-3149.02"/>
</g>
<!-- R2_Stage2_L6_Expert2&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge916" class="edge">
<title>R2_Stage2_L6_Expert2&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M1408,-3248.65C1408,-3202.96 1408,-3120 1408,-3120 1408,-3120 5548.49,-3120 5548.49,-3120"/>
<polygon fill="black" stroke="black" points="5548.49,-3123.5 5558.49,-3120 5548.49,-3116.5 5548.49,-3123.5"/>
</g>
<!-- R2_Stage2_L6_Expert3&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge917" class="edge">
<title>R2_Stage2_L6_Expert3&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M1704,-3248.84C1704,-3203.43 1704,-3121 1704,-3121 1704,-3121 5549.91,-3121 5549.91,-3121"/>
<polygon fill="black" stroke="black" points="5549.91,-3124.5 5559.91,-3121 5549.91,-3117.5 5549.91,-3124.5"/>
</g>
<!-- R2_Stage2_L6_Expert4&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge918" class="edge">
<title>R2_Stage2_L6_Expert4&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M2000,-3248.66C2000,-3203.47 2000,-3122 2000,-3122 2000,-3122 5551.22,-3122 5551.22,-3122"/>
<polygon fill="black" stroke="black" points="5551.22,-3125.5 5561.22,-3122 5551.22,-3118.5 5551.22,-3125.5"/>
</g>
<!-- R2_Stage2_L6_Expert5&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge919" class="edge">
<title>R2_Stage2_L6_Expert5&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M2296,-3248.67C2296,-3203.99 2296,-3124 2296,-3124 2296,-3124 5553.75,-3124 5553.75,-3124"/>
<polygon fill="black" stroke="black" points="5553.75,-3127.5 5563.75,-3124 5553.75,-3120.5 5553.75,-3127.5"/>
</g>
<!-- R2_Stage2_L6_Expert6&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge920" class="edge">
<title>R2_Stage2_L6_Expert6&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M2592,-3248.86C2592,-3204.47 2592,-3125 2592,-3125 2592,-3125 5554.94,-3125 5554.94,-3125"/>
<polygon fill="black" stroke="black" points="5554.94,-3128.5 5564.94,-3125 5554.94,-3121.5 5554.94,-3128.5"/>
</g>
<!-- R2_Stage2_L6_Expert7&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge921" class="edge">
<title>R2_Stage2_L6_Expert7&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M2888,-3248.69C2888,-3204.52 2888,-3126 2888,-3126 2888,-3126 5556.42,-3126 5556.42,-3126"/>
<polygon fill="black" stroke="black" points="5556.42,-3129.5 5566.42,-3126 5556.42,-3122.5 5556.42,-3129.5"/>
</g>
<!-- R2_Stage2_L6_Expert8&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge922" class="edge">
<title>R2_Stage2_L6_Expert8&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M3184,-3248.72C3184,-3205.07 3184,-3128 3184,-3128 3184,-3128 5559.11,-3128 5559.11,-3128"/>
<polygon fill="black" stroke="black" points="5559.11,-3131.5 5569.11,-3128 5559.11,-3124.5 5559.11,-3131.5"/>
</g>
<!-- R2_Stage2_L6_Expert9&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge923" class="edge">
<title>R2_Stage2_L6_Expert9&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M3480,-3248.92C3480,-3205.56 3480,-3129 3480,-3129 3480,-3129 5560.42,-3129 5560.42,-3129"/>
<polygon fill="black" stroke="black" points="5560.42,-3132.5 5570.42,-3129 5560.42,-3125.5 5560.42,-3132.5"/>
</g>
<!-- R2_Stage2_L6_Expert10&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge924" class="edge">
<title>R2_Stage2_L6_Expert10&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M3776,-3248.76C3776,-3205.63 3776,-3130 3776,-3130 3776,-3130 5561.72,-3130 5561.72,-3130"/>
<polygon fill="black" stroke="black" points="5561.72,-3133.5 5571.72,-3130 5561.72,-3126.5 5561.72,-3133.5"/>
</g>
<!-- R2_Stage2_L6_Expert11&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge925" class="edge">
<title>R2_Stage2_L6_Expert11&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M4072,-3248.81C4072,-3206.2 4072,-3132 4072,-3132 4072,-3132 5563.94,-3132 5563.94,-3132"/>
<polygon fill="black" stroke="black" points="5563.94,-3135.5 5573.94,-3132 5563.94,-3128.5 5563.94,-3135.5"/>
</g>
<!-- R2_Stage2_L6_Expert12&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge926" class="edge">
<title>R2_Stage2_L6_Expert12&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M4368,-3248.66C4368,-3206.29 4368,-3133 4368,-3133 4368,-3133 5565.34,-3133 5565.34,-3133"/>
<polygon fill="black" stroke="black" points="5565.34,-3136.5 5575.34,-3133 5565.34,-3129.5 5565.34,-3136.5"/>
</g>
<!-- R2_Stage2_L6_Expert13&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge927" class="edge">
<title>R2_Stage2_L6_Expert13&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M4638,-3248.86C4638,-3206.78 4638,-3134 4638,-3134 4638,-3134 5566.66,-3134 5566.66,-3134"/>
<polygon fill="black" stroke="black" points="5566.66,-3137.5 5576.66,-3134 5566.66,-3130.5 5566.66,-3137.5"/>
</g>
<!-- R2_Stage2_L6_Expert14&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge928" class="edge">
<title>R2_Stage2_L6_Expert14&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M4934,-3248.92C4934,-3207.38 4934,-3136 4934,-3136 4934,-3136 5569.55,-3136 5569.55,-3136"/>
<polygon fill="black" stroke="black" points="5569.55,-3139.5 5579.55,-3136 5569.55,-3132.5 5569.55,-3139.5"/>
</g>
<!-- R2_Stage2_L6_Expert15&#45;&gt;R2_Stage2_L6_MoE_Output -->
<g id="edge929" class="edge">
<title>R2_Stage2_L6_Expert15&#45;&gt;R2_Stage2_L6_MoE_Output</title>
<path fill="none" stroke="black" d="M5230,-3248.78C5230,-3207.48 5230,-3137 5230,-3137 5230,-3137 5570.8,-3137 5570.8,-3137"/>
<polygon fill="black" stroke="black" points="5570.8,-3140.5 5580.8,-3137 5570.8,-3133.5 5570.8,-3140.5"/>
</g>
<!-- R2_Stage2_L6_MoE_Output&#45;&gt;R2_Stage2_L6_Output -->
<g id="edge930" class="edge">
<title>R2_Stage2_L6_MoE_Output&#45;&gt;R2_Stage2_L6_Output</title>
<path fill="none" stroke="black" d="M5779,-3034.81C5779,-3034.81 5779,-2935.01 5779,-2935.01"/>
<polygon fill="black" stroke="black" points="5782.5,-2935.01 5779,-2925.01 5775.5,-2935.01 5782.5,-2935.01"/>
</g>
<!-- R2_Stage2_L7_Input -->
<g id="node581" class="node">
<title>R2_Stage2_L7_Input</title>
<ellipse fill="lightblue" stroke="black" cx="1157" cy="-4205" rx="225.5" ry="29"/>
<text text-anchor="middle" x="1157" y="-4213.5" font-family="Times,serif" font-size="10.00">Layer 7 Input</text>
<text text-anchor="middle" x="1157" y="-4202.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="1157" y="-4191.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Attn_Input -->
<g id="node582" class="node">
<title>R2_Stage2_L7_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="1157" cy="-4014" rx="225.5" ry="29"/>
<text text-anchor="middle" x="1157" y="-4022.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="1157" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="1157" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Input&#45;&gt;R2_Stage2_L7_Attn_Input -->
<g id="edge931" class="edge">
<title>R2_Stage2_L7_Input&#45;&gt;R2_Stage2_L7_Attn_Input</title>
<path fill="none" stroke="black" d="M1157,-4175.99C1157,-4175.99 1157,-4053.28 1157,-4053.28"/>
<polygon fill="black" stroke="black" points="1160.5,-4053.28 1157,-4043.28 1153.5,-4053.28 1160.5,-4053.28"/>
</g>
<!-- R2_Stage2_L7_Attn_TP1 -->
<g id="node583" class="node">
<title>R2_Stage2_L7_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="1076,-3866 730,-3866 730,-3808 1076,-3808 1076,-3866"/>
<text text-anchor="middle" x="903" y="-3851" font-family="Times,serif" font-size="10.00">Attention TP GPU 80</text>
<text text-anchor="middle" x="903" y="-3840" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="903" y="-3829" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="903" y="-3818" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage2_L7_Attn_Input&#45;&gt;R2_Stage2_L7_Attn_TP1 -->
<g id="edge932" class="edge">
<title>R2_Stage2_L7_Attn_Input&#45;&gt;R2_Stage2_L7_Attn_TP1</title>
<path fill="none" stroke="black" d="M1003.75,-3992.65C1003.75,-3992.65 1003.75,-3876.06 1003.75,-3876.06"/>
<polygon fill="black" stroke="black" points="1007.25,-3876.06 1003.75,-3866.06 1000.25,-3876.06 1007.25,-3876.06"/>
</g>
<!-- R2_Stage2_L7_Attn_TP2 -->
<g id="node584" class="node">
<title>R2_Stage2_L7_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="1458,-3866 1112,-3866 1112,-3808 1458,-3808 1458,-3866"/>
<text text-anchor="middle" x="1285" y="-3851" font-family="Times,serif" font-size="10.00">Attention TP GPU 81</text>
<text text-anchor="middle" x="1285" y="-3840" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="1285" y="-3829" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="1285" y="-3818" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage2_L7_Attn_Input&#45;&gt;R2_Stage2_L7_Attn_TP2 -->
<g id="edge933" class="edge">
<title>R2_Stage2_L7_Attn_Input&#45;&gt;R2_Stage2_L7_Attn_TP2</title>
<path fill="none" stroke="black" d="M1247.25,-3987.12C1247.25,-3987.12 1247.25,-3876.2 1247.25,-3876.2"/>
<polygon fill="black" stroke="black" points="1250.75,-3876.2 1247.25,-3866.2 1243.75,-3876.2 1250.75,-3876.2"/>
</g>
<!-- R2_Stage2_L7_Attn_Output -->
<g id="node585" class="node">
<title>R2_Stage2_L7_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="1039" cy="-3660" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="1039" y="-3674" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="1039" y="-3663" font-family="Times,serif" font-size="10.00">AllReduce GPUs 80&#45;81</text>
<text text-anchor="middle" x="1039" y="-3652" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="1039" y="-3641" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Attn_TP1&#45;&gt;R2_Stage2_L7_Attn_Output -->
<g id="edge934" class="edge">
<title>R2_Stage2_L7_Attn_TP1&#45;&gt;R2_Stage2_L7_Attn_Output</title>
<path fill="none" stroke="black" d="M935.88,-3807.77C935.88,-3807.77 935.88,-3703.5 935.88,-3703.5"/>
<polygon fill="black" stroke="black" points="939.38,-3703.5 935.88,-3693.5 932.38,-3703.5 939.38,-3703.5"/>
</g>
<!-- R2_Stage2_L7_Attn_TP2&#45;&gt;R2_Stage2_L7_Attn_Output -->
<g id="edge935" class="edge">
<title>R2_Stage2_L7_Attn_TP2&#45;&gt;R2_Stage2_L7_Attn_Output</title>
<path fill="none" stroke="black" d="M1197.12,-3807.77C1197.12,-3807.77 1197.12,-3698.1 1197.12,-3698.1"/>
<polygon fill="black" stroke="black" points="1200.62,-3698.1 1197.12,-3688.1 1193.62,-3698.1 1200.62,-3698.1"/>
</g>
<!-- R2_Stage2_L7_MoE_Input -->
<g id="node586" class="node">
<title>R2_Stage2_L7_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="916" cy="-3469" rx="225.5" ry="29"/>
<text text-anchor="middle" x="916" y="-3477.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="916" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="916" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Attn_Output&#45;&gt;R2_Stage2_L7_MoE_Input -->
<g id="edge936" class="edge">
<title>R2_Stage2_L7_Attn_Output&#45;&gt;R2_Stage2_L7_MoE_Input</title>
<path fill="none" stroke="black" d="M968.63,-3624.52C968.63,-3624.52 968.63,-3507.44 968.63,-3507.44"/>
<polygon fill="black" stroke="black" points="972.13,-3507.44 968.63,-3497.44 965.13,-3507.44 972.13,-3507.44"/>
</g>
<!-- R2_Stage2_L7_Router -->
<g id="node587" class="node">
<title>R2_Stage2_L7_Router</title>
<polygon fill="lightyellow" stroke="black" points="1164.36,-3330 651.56,-3330 519.64,-3226 1032.44,-3226 1164.36,-3330"/>
<text text-anchor="middle" x="842" y="-3292" font-family="Times,serif" font-size="10.00">Router GPU 80</text>
<text text-anchor="middle" x="842" y="-3281" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="842" y="-3270" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="842" y="-3259" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage2_L7_MoE_Input&#45;&gt;R2_Stage2_L7_Router -->
<g id="edge937" class="edge">
<title>R2_Stage2_L7_MoE_Input&#45;&gt;R2_Stage2_L7_Router</title>
<path fill="none" stroke="black" d="M916,-3439.99C916,-3439.99 916,-3340.02 916,-3340.02"/>
<polygon fill="black" stroke="black" points="919.5,-3340.02 916,-3330.02 912.5,-3340.02 919.5,-3340.02"/>
</g>
<!-- R2_Stage2_L7_Expert0 -->
<g id="node588" class="node">
<title>R2_Stage2_L7_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="1564,-3116 1304,-3116 1304,-3058 1564,-3058 1564,-3116"/>
<text text-anchor="middle" x="1434" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 80</text>
<text text-anchor="middle" x="1434" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="1434" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert0 -->
<g id="edge938" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1033.76,-3227C1179.83,-3227 1356,-3227 1356,-3227 1356,-3227 1356,-3126.01 1356,-3126.01"/>
<polygon fill="black" stroke="black" points="1359.5,-3126.01 1356,-3116.01 1352.5,-3126.01 1359.5,-3126.01"/>
<text text-anchor="middle" x="1048.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert1 -->
<g id="node589" class="node">
<title>R2_Stage2_L7_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="1860,-3116 1600,-3116 1600,-3058 1860,-3058 1860,-3116"/>
<text text-anchor="middle" x="1730" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 81</text>
<text text-anchor="middle" x="1730" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="1730" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert1 -->
<g id="edge939" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1036.27,-3229C1275.92,-3229 1652,-3229 1652,-3229 1652,-3229 1652,-3126.08 1652,-3126.08"/>
<polygon fill="black" stroke="black" points="1655.5,-3126.08 1652,-3116.08 1648.5,-3126.08 1655.5,-3126.08"/>
<text text-anchor="middle" x="1135.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert2 -->
<g id="node590" class="node">
<title>R2_Stage2_L7_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="2156,-3116 1896,-3116 1896,-3058 2156,-3058 2156,-3116"/>
<text text-anchor="middle" x="2026" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 82</text>
<text text-anchor="middle" x="2026" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2026" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert2 -->
<g id="edge940" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1039.09,-3231C1357.07,-3231 1948,-3231 1948,-3231 1948,-3231 1948,-3126.14 1948,-3126.14"/>
<polygon fill="black" stroke="black" points="1951.5,-3126.14 1948,-3116.14 1944.5,-3126.14 1951.5,-3126.14"/>
<text text-anchor="middle" x="1220.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert3 -->
<g id="node591" class="node">
<title>R2_Stage2_L7_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="2452,-3116 2192,-3116 2192,-3058 2452,-3058 2452,-3116"/>
<text text-anchor="middle" x="2322" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 83</text>
<text text-anchor="middle" x="2322" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2322" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert3 -->
<g id="edge941" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1041.38,-3233C1428.45,-3233 2244,-3233 2244,-3233 2244,-3233 2244,-3126.19 2244,-3126.19"/>
<polygon fill="black" stroke="black" points="2247.5,-3126.19 2244,-3116.19 2240.5,-3126.19 2247.5,-3126.19"/>
<text text-anchor="middle" x="1305.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert4 -->
<g id="node592" class="node">
<title>R2_Stage2_L7_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="2748,-3116 2488,-3116 2488,-3058 2748,-3058 2748,-3116"/>
<text text-anchor="middle" x="2618" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 84</text>
<text text-anchor="middle" x="2618" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2618" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert4 -->
<g id="edge942" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1043.87,-3235C1493.88,-3235 2540,-3235 2540,-3235 2540,-3235 2540,-3126.24 2540,-3126.24"/>
<polygon fill="black" stroke="black" points="2543.5,-3126.24 2540,-3116.24 2536.5,-3126.24 2543.5,-3126.24"/>
<text text-anchor="middle" x="1389.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert5 -->
<g id="node593" class="node">
<title>R2_Stage2_L7_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="3044,-3116 2784,-3116 2784,-3058 3044,-3058 3044,-3116"/>
<text text-anchor="middle" x="2914" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 85</text>
<text text-anchor="middle" x="2914" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2914" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert5 -->
<g id="edge943" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1046.49,-3237C1555.01,-3237 2836,-3237 2836,-3237 2836,-3237 2836,-3126.28 2836,-3126.28"/>
<polygon fill="black" stroke="black" points="2839.5,-3126.28 2836,-3116.28 2832.5,-3126.28 2839.5,-3126.28"/>
<text text-anchor="middle" x="1473.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert6 -->
<g id="node594" class="node">
<title>R2_Stage2_L7_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="3340,-3116 3080,-3116 3080,-3058 3340,-3058 3340,-3116"/>
<text text-anchor="middle" x="3210" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 86</text>
<text text-anchor="middle" x="3210" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3210" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert6 -->
<g id="edge944" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1049.01,-3239C1612.51,-3239 3132,-3239 3132,-3239 3132,-3239 3132,-3126.31 3132,-3126.31"/>
<polygon fill="black" stroke="black" points="3135.5,-3126.31 3132,-3116.31 3128.5,-3126.31 3135.5,-3126.31"/>
<text text-anchor="middle" x="1557.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert7 -->
<g id="node595" class="node">
<title>R2_Stage2_L7_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="3636,-3116 3376,-3116 3376,-3058 3636,-3058 3636,-3116"/>
<text text-anchor="middle" x="3506" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 87</text>
<text text-anchor="middle" x="3506" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3506" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert7 -->
<g id="edge945" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1051.71,-3241C1667.59,-3241 3428,-3241 3428,-3241 3428,-3241 3428,-3126.33 3428,-3126.33"/>
<polygon fill="black" stroke="black" points="3431.5,-3126.33 3428,-3116.33 3424.5,-3126.33 3431.5,-3126.33"/>
<text text-anchor="middle" x="1641.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert8 -->
<g id="node596" class="node">
<title>R2_Stage2_L7_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="3932,-3116 3672,-3116 3672,-3058 3932,-3058 3932,-3116"/>
<text text-anchor="middle" x="3802" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 88</text>
<text text-anchor="middle" x="3802" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3802" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert8 -->
<g id="edge946" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1054.21,-3243C1720.07,-3243 3724,-3243 3724,-3243 3724,-3243 3724,-3126.34 3724,-3126.34"/>
<polygon fill="black" stroke="black" points="3727.5,-3126.34 3724,-3116.34 3720.5,-3126.34 3727.5,-3126.34"/>
<text text-anchor="middle" x="1748.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert9 -->
<g id="node597" class="node">
<title>R2_Stage2_L7_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="4228,-3116 3968,-3116 3968,-3058 4228,-3058 4228,-3116"/>
<text text-anchor="middle" x="4098" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 89</text>
<text text-anchor="middle" x="4098" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4098" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert9 -->
<g id="edge947" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1056.69,-3245C1770.61,-3245 4020,-3245 4020,-3245 4020,-3245 4020,-3126.35 4020,-3126.35"/>
<polygon fill="black" stroke="black" points="4023.5,-3126.35 4020,-3116.35 4016.5,-3126.35 4023.5,-3126.35"/>
<text text-anchor="middle" x="1832.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert10 -->
<g id="node598" class="node">
<title>R2_Stage2_L7_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="4524,-3116 4264,-3116 4264,-3058 4524,-3058 4524,-3116"/>
<text text-anchor="middle" x="4394" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 90</text>
<text text-anchor="middle" x="4394" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4394" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert10 -->
<g id="edge948" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1059.31,-3247C1819.86,-3247 4316,-3247 4316,-3247 4316,-3247 4316,-3126.35 4316,-3126.35"/>
<polygon fill="black" stroke="black" points="4319.5,-3126.35 4316,-3116.35 4312.5,-3126.35 4319.5,-3126.35"/>
<text text-anchor="middle" x="1916.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert11 -->
<g id="node599" class="node">
<title>R2_Stage2_L7_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="4820,-3116 4560,-3116 4560,-3058 4820,-3058 4820,-3116"/>
<text text-anchor="middle" x="4690" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 91</text>
<text text-anchor="middle" x="4690" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4690" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert11 -->
<g id="edge949" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1136.53,-3308C2043.61,-3308 4734,-3308 4734,-3308 4734,-3308 4734,-3126.35 4734,-3126.35"/>
<polygon fill="black" stroke="black" points="4737.5,-3126.35 4734,-3116.35 4730.5,-3126.35 4737.5,-3126.35"/>
<text text-anchor="middle" x="2000.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert12 -->
<g id="node600" class="node">
<title>R2_Stage2_L7_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="5116,-3116 4856,-3116 4856,-3058 5116,-3058 5116,-3116"/>
<text text-anchor="middle" x="4986" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 92</text>
<text text-anchor="middle" x="4986" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4986" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert12 -->
<g id="edge950" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1137.74,-3309C2092.34,-3309 5030,-3309 5030,-3309 5030,-3309 5030,-3126.02 5030,-3126.02"/>
<polygon fill="black" stroke="black" points="5033.5,-3126.02 5030,-3116.02 5026.5,-3126.02 5033.5,-3126.02"/>
<text text-anchor="middle" x="2084.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert13 -->
<g id="node601" class="node">
<title>R2_Stage2_L7_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="5412,-3116 5152,-3116 5152,-3058 5412,-3058 5412,-3116"/>
<text text-anchor="middle" x="5282" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 93</text>
<text text-anchor="middle" x="5282" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="5282" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert13 -->
<g id="edge951" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1140.55,-3311C2143.01,-3311 5326,-3311 5326,-3311 5326,-3311 5326,-3126.28 5326,-3126.28"/>
<polygon fill="black" stroke="black" points="5329.5,-3126.28 5326,-3116.28 5322.5,-3126.28 5329.5,-3126.28"/>
<text text-anchor="middle" x="2168.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert14 -->
<g id="node602" class="node">
<title>R2_Stage2_L7_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="972,-3116 712,-3116 712,-3058 972,-3058 972,-3116"/>
<text text-anchor="middle" x="842" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 94</text>
<text text-anchor="middle" x="842" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="842" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert14 -->
<g id="edge952" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M842,-3225.81C842,-3225.81 842,-3126.01 842,-3126.01"/>
<polygon fill="black" stroke="black" points="845.5,-3126.01 842,-3116.01 838.5,-3126.01 845.5,-3126.01"/>
<text text-anchor="middle" x="863.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_Expert15 -->
<g id="node603" class="node">
<title>R2_Stage2_L7_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="1268,-3116 1008,-3116 1008,-3058 1268,-3058 1268,-3116"/>
<text text-anchor="middle" x="1138" y="-3095.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 95</text>
<text text-anchor="middle" x="1138" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="1138" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert15 -->
<g id="edge953" class="edge">
<title>R2_Stage2_L7_Router&#45;&gt;R2_Stage2_L7_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1086.22,-3268.27C1086.22,-3268.27 1086.22,-3126.03 1086.22,-3126.03"/>
<polygon fill="black" stroke="black" points="1089.72,-3126.02 1086.22,-3116.03 1082.72,-3126.03 1089.72,-3126.02"/>
<text text-anchor="middle" x="958.5" y="-3178.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L7_MoE_Output -->
<g id="node604" class="node">
<title>R2_Stage2_L7_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="5429.95,-2948 4903.48,-2948 4768.05,-2844 5294.52,-2844 5429.95,-2948"/>
<text text-anchor="middle" x="5099" y="-2910" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="5099" y="-2899" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="5099" y="-2888" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="5099" y="-2877" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L7_Expert0&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge954" class="edge">
<title>R2_Stage2_L7_Expert0&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M1546.67,-3057.65C1546.67,-3011.96 1546.67,-2929 1546.67,-2929 1546.67,-2929 4868.46,-2929 4868.46,-2929"/>
<polygon fill="black" stroke="black" points="4868.46,-2932.5 4878.46,-2929 4868.46,-2925.5 4868.46,-2932.5"/>
</g>
<!-- R2_Stage2_L7_Expert1&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge955" class="edge">
<title>R2_Stage2_L7_Expert1&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M1842.67,-3057.66C1842.67,-3012.47 1842.67,-2931 1842.67,-2931 1842.67,-2931 4871.24,-2931 4871.24,-2931"/>
<polygon fill="black" stroke="black" points="4871.24,-2934.5 4881.24,-2931 4871.24,-2927.5 4871.24,-2934.5"/>
</g>
<!-- R2_Stage2_L7_Expert2&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge956" class="edge">
<title>R2_Stage2_L7_Expert2&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M2138.67,-3057.67C2138.67,-3012.99 2138.67,-2933 2138.67,-2933 2138.67,-2933 4873.72,-2933 4873.72,-2933"/>
<polygon fill="black" stroke="black" points="4873.72,-2936.5 4883.72,-2933 4873.72,-2929.5 4873.72,-2936.5"/>
</g>
<!-- R2_Stage2_L7_Expert3&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge957" class="edge">
<title>R2_Stage2_L7_Expert3&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M2434.67,-3057.86C2434.67,-3013.47 2434.67,-2934 2434.67,-2934 2434.67,-2934 4875.19,-2934 4875.19,-2934"/>
<polygon fill="black" stroke="black" points="4875.19,-2937.5 4885.19,-2934 4875.19,-2930.5 4875.19,-2937.5"/>
</g>
<!-- R2_Stage2_L7_Expert4&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge958" class="edge">
<title>R2_Stage2_L7_Expert4&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M2730.67,-3057.89C2730.67,-3014.01 2730.67,-2936 2730.67,-2936 2730.67,-2936 4877.79,-2936 4877.79,-2936"/>
<polygon fill="black" stroke="black" points="4877.79,-2939.5 4887.79,-2936 4877.79,-2932.5 4877.79,-2939.5"/>
</g>
<!-- R2_Stage2_L7_Expert5&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge959" class="edge">
<title>R2_Stage2_L7_Expert5&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M3026.67,-3057.92C3026.67,-3014.56 3026.67,-2938 3026.67,-2938 3026.67,-2938 4880.33,-2938 4880.33,-2938"/>
<polygon fill="black" stroke="black" points="4880.33,-2941.5 4890.33,-2938 4880.33,-2934.5 4880.33,-2941.5"/>
</g>
<!-- R2_Stage2_L7_Expert6&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge960" class="edge">
<title>R2_Stage2_L7_Expert6&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M3322.67,-3057.76C3322.67,-3014.63 3322.67,-2939 3322.67,-2939 3322.67,-2939 4881.76,-2939 4881.76,-2939"/>
<polygon fill="black" stroke="black" points="4881.76,-2942.5 4891.76,-2939 4881.76,-2935.5 4881.76,-2942.5"/>
</g>
<!-- R2_Stage2_L7_Expert7&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge961" class="edge">
<title>R2_Stage2_L7_Expert7&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M3618.67,-3057.81C3618.67,-3015.2 3618.67,-2941 3618.67,-2941 3618.67,-2941 4884.33,-2941 4884.33,-2941"/>
<polygon fill="black" stroke="black" points="4884.33,-2944.5 4894.33,-2941 4884.33,-2937.5 4884.33,-2944.5"/>
</g>
<!-- R2_Stage2_L7_Expert8&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge962" class="edge">
<title>R2_Stage2_L7_Expert8&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M3914.67,-3057.86C3914.67,-3015.78 3914.67,-2943 3914.67,-2943 3914.67,-2943 4886.75,-2943 4886.75,-2943"/>
<polygon fill="black" stroke="black" points="4886.75,-2946.5 4896.75,-2943 4886.75,-2939.5 4886.75,-2946.5"/>
</g>
<!-- R2_Stage2_L7_Expert9&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge963" class="edge">
<title>R2_Stage2_L7_Expert9&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M4202,-3057.72C4202,-3015.88 4202,-2944 4202,-2944 4202,-2944 4888.25,-2944 4888.25,-2944"/>
<polygon fill="black" stroke="black" points="4888.25,-2947.5 4898.25,-2944 4888.25,-2940.5 4888.25,-2947.5"/>
</g>
<!-- R2_Stage2_L7_Expert10&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge964" class="edge">
<title>R2_Stage2_L7_Expert10&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M4498,-3057.78C4498,-3016.48 4498,-2946 4498,-2946 4498,-2946 4890.54,-2946 4890.54,-2946"/>
<polygon fill="black" stroke="black" points="4890.54,-2949.5 4900.54,-2946 4890.54,-2942.5 4890.54,-2949.5"/>
</g>
<!-- R2_Stage2_L7_Expert11&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge965" class="edge">
<title>R2_Stage2_L7_Expert11&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M4794.14,-3057.99C4794.14,-3057.99 4794.14,-2906.08 4794.14,-2906.08"/>
<polygon fill="black" stroke="black" points="4797.64,-2906.08 4794.14,-2896.08 4790.64,-2906.08 4797.64,-2906.08"/>
</g>
<!-- R2_Stage2_L7_Expert12&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge966" class="edge">
<title>R2_Stage2_L7_Expert12&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M4986,-3057.99C4986,-3057.99 4986,-2958.02 4986,-2958.02"/>
<polygon fill="black" stroke="black" points="4989.5,-2958.02 4986,-2948.02 4982.5,-2958.02 4989.5,-2958.02"/>
</g>
<!-- R2_Stage2_L7_Expert13&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge967" class="edge">
<title>R2_Stage2_L7_Expert13&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M5282,-3057.99C5282,-3057.99 5282,-2958.02 5282,-2958.02"/>
<polygon fill="black" stroke="black" points="5285.5,-2958.02 5282,-2948.02 5278.5,-2958.02 5285.5,-2958.02"/>
</g>
<!-- R2_Stage2_L7_Expert14&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge968" class="edge">
<title>R2_Stage2_L7_Expert14&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M954.67,-3057.84C954.67,-3011.45 954.67,-2926 954.67,-2926 954.67,-2926 4864.71,-2926 4864.71,-2926"/>
<polygon fill="black" stroke="black" points="4864.71,-2929.5 4874.71,-2926 4864.71,-2922.5 4864.71,-2929.5"/>
</g>
<!-- R2_Stage2_L7_Expert15&#45;&gt;R2_Stage2_L7_MoE_Output -->
<g id="edge969" class="edge">
<title>R2_Stage2_L7_Expert15&#45;&gt;R2_Stage2_L7_MoE_Output</title>
<path fill="none" stroke="black" d="M1250.67,-3057.84C1250.67,-3011.93 1250.67,-2928 1250.67,-2928 1250.67,-2928 4867.22,-2928 4867.22,-2928"/>
<polygon fill="black" stroke="black" points="4867.22,-2931.5 4877.22,-2928 4867.22,-2924.5 4867.22,-2931.5"/>
</g>
<!-- R2_Stage2_L7_MoE_Output&#45;&gt;R2_Stage2_L7_Output -->
<g id="edge970" class="edge">
<title>R2_Stage2_L7_MoE_Output&#45;&gt;R2_Stage2_L7_Output</title>
<path fill="none" stroke="black" d="M5301.11,-2849.03C5301.11,-2849.03 5301.11,-2755.3 5301.11,-2755.3"/>
<polygon fill="black" stroke="black" points="5304.61,-2755.3 5301.11,-2745.3 5297.61,-2755.3 5304.61,-2755.3"/>
</g>
<!-- R2_Stage2_L8_Input -->
<g id="node605" class="node">
<title>R2_Stage2_L8_Input</title>
<ellipse fill="lightblue" stroke="black" cx="422" cy="-4014" rx="225.5" ry="29"/>
<text text-anchor="middle" x="422" y="-4022.5" font-family="Times,serif" font-size="10.00">Layer 8 Input</text>
<text text-anchor="middle" x="422" y="-4011.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="422" y="-4000.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Attn_Input -->
<g id="node606" class="node">
<title>R2_Stage2_L8_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="422" cy="-3837" rx="225.5" ry="29"/>
<text text-anchor="middle" x="422" y="-3845.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="422" y="-3834.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="422" y="-3823.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Input&#45;&gt;R2_Stage2_L8_Attn_Input -->
<g id="edge971" class="edge">
<title>R2_Stage2_L8_Input&#45;&gt;R2_Stage2_L8_Attn_Input</title>
<path fill="none" stroke="black" d="M422,-3984.77C422,-3984.77 422,-3876.27 422,-3876.27"/>
<polygon fill="black" stroke="black" points="425.5,-3876.27 422,-3866.27 418.5,-3876.27 425.5,-3876.27"/>
</g>
<!-- R2_Stage2_L8_Attn_TP1 -->
<g id="node607" class="node">
<title>R2_Stage2_L8_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="378,-3689 32,-3689 32,-3631 378,-3631 378,-3689"/>
<text text-anchor="middle" x="205" y="-3674" font-family="Times,serif" font-size="10.00">Attention TP GPU 80</text>
<text text-anchor="middle" x="205" y="-3663" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="205" y="-3652" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="205" y="-3641" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage2_L8_Attn_Input&#45;&gt;R2_Stage2_L8_Attn_TP1 -->
<g id="edge972" class="edge">
<title>R2_Stage2_L8_Attn_Input&#45;&gt;R2_Stage2_L8_Attn_TP1</title>
<path fill="none" stroke="black" d="M287.25,-3813.5C287.25,-3813.5 287.25,-3699.2 287.25,-3699.2"/>
<polygon fill="black" stroke="black" points="290.75,-3699.2 287.25,-3689.2 283.75,-3699.2 290.75,-3699.2"/>
</g>
<!-- R2_Stage2_L8_Attn_TP2 -->
<g id="node608" class="node">
<title>R2_Stage2_L8_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="760,-3689 414,-3689 414,-3631 760,-3631 760,-3689"/>
<text text-anchor="middle" x="587" y="-3674" font-family="Times,serif" font-size="10.00">Attention TP GPU 81</text>
<text text-anchor="middle" x="587" y="-3663" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="587" y="-3652" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="587" y="-3641" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage2_L8_Attn_Input&#45;&gt;R2_Stage2_L8_Attn_TP2 -->
<g id="edge973" class="edge">
<title>R2_Stage2_L8_Attn_Input&#45;&gt;R2_Stage2_L8_Attn_TP2</title>
<path fill="none" stroke="black" d="M530.75,-3811.26C530.75,-3811.26 530.75,-3699.01 530.75,-3699.01"/>
<polygon fill="black" stroke="black" points="534.25,-3699.01 530.75,-3689.01 527.25,-3699.01 534.25,-3699.01"/>
</g>
<!-- R2_Stage2_L8_Attn_Output -->
<g id="node609" class="node">
<title>R2_Stage2_L8_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="275" cy="-3469" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="275" y="-3483" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="275" y="-3472" font-family="Times,serif" font-size="10.00">AllReduce GPUs 80&#45;81</text>
<text text-anchor="middle" x="275" y="-3461" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="275" y="-3450" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Attn_TP1&#45;&gt;R2_Stage2_L8_Attn_Output -->
<g id="edge974" class="edge">
<title>R2_Stage2_L8_Attn_TP1&#45;&gt;R2_Stage2_L8_Attn_Output</title>
<path fill="none" stroke="black" d="M205,-3630.99C205,-3630.99 205,-3514.47 205,-3514.47"/>
<polygon fill="black" stroke="black" points="208.5,-3514.47 205,-3504.47 201.5,-3514.47 208.5,-3514.47"/>
</g>
<!-- R2_Stage2_L8_Attn_TP2&#45;&gt;R2_Stage2_L8_Attn_Output -->
<g id="edge975" class="edge">
<title>R2_Stage2_L8_Attn_TP2&#45;&gt;R2_Stage2_L8_Attn_Output</title>
<path fill="none" stroke="black" d="M466.12,-3630.99C466.12,-3630.99 466.12,-3501.97 466.12,-3501.97"/>
<polygon fill="black" stroke="black" points="469.62,-3501.97 466.12,-3491.97 462.62,-3501.97 469.62,-3501.97"/>
</g>
<!-- R2_Stage2_L8_MoE_Input -->
<g id="node610" class="node">
<title>R2_Stage2_L8_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="258" cy="-3278" rx="225.5" ry="29"/>
<text text-anchor="middle" x="258" y="-3286.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="258" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="258" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Attn_Output&#45;&gt;R2_Stage2_L8_MoE_Input -->
<g id="edge976" class="edge">
<title>R2_Stage2_L8_Attn_Output&#45;&gt;R2_Stage2_L8_MoE_Input</title>
<path fill="none" stroke="black" d="M258,-3432.17C258,-3432.17 258,-3317.22 258,-3317.22"/>
<polygon fill="black" stroke="black" points="261.5,-3317.22 258,-3307.22 254.5,-3317.22 261.5,-3317.22"/>
</g>
<!-- R2_Stage2_L8_Router -->
<g id="node611" class="node">
<title>R2_Stage2_L8_Router</title>
<polygon fill="lightyellow" stroke="black" points="676.36,-3139 163.56,-3139 31.64,-3035 544.44,-3035 676.36,-3139"/>
<text text-anchor="middle" x="354" y="-3101" font-family="Times,serif" font-size="10.00">Router GPU 80</text>
<text text-anchor="middle" x="354" y="-3090" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="354" y="-3079" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="354" y="-3068" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage2_L8_MoE_Input&#45;&gt;R2_Stage2_L8_Router -->
<g id="edge977" class="edge">
<title>R2_Stage2_L8_MoE_Input&#45;&gt;R2_Stage2_L8_Router</title>
<path fill="none" stroke="black" d="M258,-3248.99C258,-3248.99 258,-3149.02 258,-3149.02"/>
<polygon fill="black" stroke="black" points="261.5,-3149.02 258,-3139.02 254.5,-3149.02 261.5,-3149.02"/>
</g>
<!-- R2_Stage2_L8_Expert0 -->
<g id="node612" class="node">
<title>R2_Stage2_L8_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="3844,-2925 3584,-2925 3584,-2867 3844,-2867 3844,-2925"/>
<text text-anchor="middle" x="3714" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 80</text>
<text text-anchor="middle" x="3714" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3714" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert0 -->
<g id="edge978" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M568.64,-3054C1292.85,-3054 3601.33,-3054 3601.33,-3054 3601.33,-3054 3601.33,-2935.35 3601.33,-2935.35"/>
<polygon fill="black" stroke="black" points="3604.83,-2935.35 3601.33,-2925.35 3597.83,-2935.35 3604.83,-2935.35"/>
<text text-anchor="middle" x="1607.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert1 -->
<g id="node613" class="node">
<title>R2_Stage2_L8_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="4140,-2925 3880,-2925 3880,-2867 4140,-2867 4140,-2925"/>
<text text-anchor="middle" x="4010" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 81</text>
<text text-anchor="middle" x="4010" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4010" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert1 -->
<g id="edge979" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M571.31,-3056C1341.83,-3056 3897.33,-3056 3897.33,-3056 3897.33,-3056 3897.33,-2935.35 3897.33,-2935.35"/>
<polygon fill="black" stroke="black" points="3900.83,-2935.35 3897.33,-2925.35 3893.83,-2935.35 3900.83,-2935.35"/>
<text text-anchor="middle" x="1691.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert2 -->
<g id="node614" class="node">
<title>R2_Stage2_L8_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="4436,-2925 4176,-2925 4176,-2867 4436,-2867 4436,-2925"/>
<text text-anchor="middle" x="4306" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 82</text>
<text text-anchor="middle" x="4306" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4306" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert2 -->
<g id="edge980" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M648.53,-3117C1555.61,-3117 4246,-3117 4246,-3117 4246,-3117 4246,-2935.35 4246,-2935.35"/>
<polygon fill="black" stroke="black" points="4249.5,-2935.35 4246,-2925.35 4242.5,-2935.35 4249.5,-2935.35"/>
<text text-anchor="middle" x="1775.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert3 -->
<g id="node615" class="node">
<title>R2_Stage2_L8_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="4732,-2925 4472,-2925 4472,-2867 4732,-2867 4732,-2925"/>
<text text-anchor="middle" x="4602" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 83</text>
<text text-anchor="middle" x="4602" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="4602" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert3 -->
<g id="edge981" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M649.74,-3118C1604.34,-3118 4542,-3118 4542,-3118 4542,-3118 4542,-2935.02 4542,-2935.02"/>
<polygon fill="black" stroke="black" points="4545.5,-2935.02 4542,-2925.02 4538.5,-2935.02 4545.5,-2935.02"/>
<text text-anchor="middle" x="1859.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert4 -->
<g id="node616" class="node">
<title>R2_Stage2_L8_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="292,-2925 32,-2925 32,-2867 292,-2867 292,-2925"/>
<text text-anchor="middle" x="162" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 84</text>
<text text-anchor="middle" x="162" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="162" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert4 -->
<g id="edge982" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M162,-3034.81C162,-3034.81 162,-2935.01 162,-2935.01"/>
<polygon fill="black" stroke="black" points="165.5,-2935.01 162,-2925.01 158.5,-2935.01 165.5,-2935.01"/>
<text text-anchor="middle" x="237.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert5 -->
<g id="node617" class="node">
<title>R2_Stage2_L8_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="588,-2925 328,-2925 328,-2867 588,-2867 588,-2925"/>
<text text-anchor="middle" x="458" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 85</text>
<text text-anchor="middle" x="458" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="458" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert5 -->
<g id="edge983" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M458,-3034.81C458,-3034.81 458,-2935.01 458,-2935.01"/>
<polygon fill="black" stroke="black" points="461.5,-2935.01 458,-2925.01 454.5,-2935.01 461.5,-2935.01"/>
<text text-anchor="middle" x="427.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert6 -->
<g id="node618" class="node">
<title>R2_Stage2_L8_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="884,-2925 624,-2925 624,-2867 884,-2867 884,-2925"/>
<text text-anchor="middle" x="754" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 86</text>
<text text-anchor="middle" x="754" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="754" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert6 -->
<g id="edge984" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M650.22,-3086.86C650.22,-3086.86 650.22,-2935.01 650.22,-2935.01"/>
<polygon fill="black" stroke="black" points="653.72,-2935.01 650.22,-2925.01 646.72,-2935.01 653.72,-2935.01"/>
<text text-anchor="middle" x="576.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert7 -->
<g id="node619" class="node">
<title>R2_Stage2_L8_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="1180,-2925 920,-2925 920,-2867 1180,-2867 1180,-2925"/>
<text text-anchor="middle" x="1050" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 87</text>
<text text-anchor="middle" x="1050" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="1050" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert7 -->
<g id="edge985" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M545.81,-3036C715.83,-3036 937.33,-3036 937.33,-3036 937.33,-3036 937.33,-2935.01 937.33,-2935.01"/>
<polygon fill="black" stroke="black" points="940.83,-2935.01 937.33,-2925.01 933.83,-2935.01 940.83,-2935.01"/>
<text text-anchor="middle" x="692.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert8 -->
<g id="node620" class="node">
<title>R2_Stage2_L8_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="1476,-2925 1216,-2925 1216,-2867 1476,-2867 1476,-2925"/>
<text text-anchor="middle" x="1346" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 88</text>
<text text-anchor="middle" x="1346" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="1346" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert8 -->
<g id="edge986" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M548.33,-3038C807.32,-3038 1233.33,-3038 1233.33,-3038 1233.33,-3038 1233.33,-2935.08 1233.33,-2935.08"/>
<polygon fill="black" stroke="black" points="1236.83,-2935.08 1233.33,-2925.08 1229.83,-2935.08 1236.83,-2935.08"/>
<text text-anchor="middle" x="792.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert9 -->
<g id="node621" class="node">
<title>R2_Stage2_L8_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="1772,-2925 1512,-2925 1512,-2867 1772,-2867 1772,-2925"/>
<text text-anchor="middle" x="1642" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 89</text>
<text text-anchor="middle" x="1642" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="1642" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert9 -->
<g id="edge987" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M551.06,-3040C885.74,-3040 1529.33,-3040 1529.33,-3040 1529.33,-3040 1529.33,-2935.14 1529.33,-2935.14"/>
<polygon fill="black" stroke="black" points="1532.83,-2935.14 1529.33,-2925.14 1525.83,-2935.14 1532.83,-2935.14"/>
<text text-anchor="middle" x="884.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert10 -->
<g id="node622" class="node">
<title>R2_Stage2_L8_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="2068,-2925 1808,-2925 1808,-2867 2068,-2867 2068,-2925"/>
<text text-anchor="middle" x="1938" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 90</text>
<text text-anchor="middle" x="1938" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="1938" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert10 -->
<g id="edge988" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M553.58,-3042C955.7,-3042 1825.33,-3042 1825.33,-3042 1825.33,-3042 1825.33,-2935.19 1825.33,-2935.19"/>
<polygon fill="black" stroke="black" points="1828.83,-2935.19 1825.33,-2925.19 1821.83,-2935.19 1828.83,-2935.19"/>
<text text-anchor="middle" x="972.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert11 -->
<g id="node623" class="node">
<title>R2_Stage2_L8_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="2364,-2925 2104,-2925 2104,-2867 2364,-2867 2364,-2925"/>
<text text-anchor="middle" x="2234" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 91</text>
<text text-anchor="middle" x="2234" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2234" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert11 -->
<g id="edge989" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M555.87,-3044C1019.59,-3044 2121.33,-3044 2121.33,-3044 2121.33,-3044 2121.33,-2935.24 2121.33,-2935.24"/>
<polygon fill="black" stroke="black" points="2124.83,-2935.24 2121.33,-2925.24 2117.83,-2935.24 2124.83,-2935.24"/>
<text text-anchor="middle" x="1058.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert12 -->
<g id="node624" class="node">
<title>R2_Stage2_L8_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="2660,-2925 2400,-2925 2400,-2867 2660,-2867 2660,-2925"/>
<text text-anchor="middle" x="2530" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 92</text>
<text text-anchor="middle" x="2530" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2530" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert12 -->
<g id="edge990" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M558.43,-3046C1079.66,-3046 2417.33,-3046 2417.33,-3046 2417.33,-3046 2417.33,-2935.28 2417.33,-2935.28"/>
<polygon fill="black" stroke="black" points="2420.83,-2935.28 2417.33,-2925.28 2413.83,-2935.28 2420.83,-2935.28"/>
<text text-anchor="middle" x="1269.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert13 -->
<g id="node625" class="node">
<title>R2_Stage2_L8_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="2956,-2925 2696,-2925 2696,-2867 2956,-2867 2956,-2925"/>
<text text-anchor="middle" x="2826" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 93</text>
<text text-anchor="middle" x="2826" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="2826" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert13 -->
<g id="edge991" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M561.05,-3048C1136.56,-3048 2713.33,-3048 2713.33,-3048 2713.33,-3048 2713.33,-2935.31 2713.33,-2935.31"/>
<polygon fill="black" stroke="black" points="2716.83,-2935.31 2713.33,-2925.31 2709.83,-2935.31 2716.83,-2935.31"/>
<text text-anchor="middle" x="1354.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert14 -->
<g id="node626" class="node">
<title>R2_Stage2_L8_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="3252,-2925 2992,-2925 2992,-2867 3252,-2867 3252,-2925"/>
<text text-anchor="middle" x="3122" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 94</text>
<text text-anchor="middle" x="3122" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3122" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert14 -->
<g id="edge992" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M563.75,-3050C1191.01,-3050 3009.33,-3050 3009.33,-3050 3009.33,-3050 3009.33,-2935.33 3009.33,-2935.33"/>
<polygon fill="black" stroke="black" points="3012.83,-2935.33 3009.33,-2925.33 3005.83,-2935.33 3012.83,-2935.33"/>
<text text-anchor="middle" x="1439.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_Expert15 -->
<g id="node627" class="node">
<title>R2_Stage2_L8_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="3548,-2925 3288,-2925 3288,-2867 3548,-2867 3548,-2925"/>
<text text-anchor="middle" x="3418" y="-2904.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 95</text>
<text text-anchor="middle" x="3418" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="3418" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert15 -->
<g id="edge993" class="edge">
<title>R2_Stage2_L8_Router&#45;&gt;R2_Stage2_L8_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M566.25,-3052C1242.97,-3052 3305.33,-3052 3305.33,-3052 3305.33,-3052 3305.33,-2935.34 3305.33,-2935.34"/>
<polygon fill="black" stroke="black" points="3308.83,-2935.34 3305.33,-2925.34 3301.83,-2935.34 3308.83,-2935.34"/>
<text text-anchor="middle" x="1523.5" y="-2987.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage2_L8_MoE_Output -->
<g id="node628" class="node">
<title>R2_Stage2_L8_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="2860.95,-2771 2334.48,-2771 2199.05,-2667 2725.52,-2667 2860.95,-2771"/>
<text text-anchor="middle" x="2530" y="-2733" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="2530" y="-2722" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="2530" y="-2711" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="2530" y="-2700" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage2_L8_Expert0&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge994" class="edge">
<title>R2_Stage2_L8_Expert0&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M3714,-2866.73C3714,-2828.67 3714,-2767 3714,-2767 3714,-2767 2865.88,-2767 2865.88,-2767"/>
<polygon fill="black" stroke="black" points="2865.88,-2763.5 2855.88,-2767 2865.88,-2770.5 2865.88,-2763.5"/>
</g>
<!-- R2_Stage2_L8_Expert1&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge995" class="edge">
<title>R2_Stage2_L8_Expert1&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M4010,-2866.83C4010,-2828.5 4010,-2766 4010,-2766 4010,-2766 2864.79,-2766 2864.79,-2766"/>
<polygon fill="black" stroke="black" points="2864.79,-2762.5 2854.79,-2766 2864.79,-2769.5 2864.79,-2762.5"/>
</g>
<!-- R2_Stage2_L8_Expert2&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge996" class="edge">
<title>R2_Stage2_L8_Expert2&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M4306,-2866.93C4306,-2828.33 4306,-2765 4306,-2765 4306,-2765 2863.17,-2765 2863.17,-2765"/>
<polygon fill="black" stroke="black" points="2863.17,-2761.5 2853.17,-2765 2863.17,-2768.5 2863.17,-2761.5"/>
</g>
<!-- R2_Stage2_L8_Expert3&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge997" class="edge">
<title>R2_Stage2_L8_Expert3&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M4602,-2866.7C4602,-2827.82 4602,-2764 4602,-2764 4602,-2764 2862.04,-2764 2862.04,-2764"/>
<polygon fill="black" stroke="black" points="2862.04,-2760.5 2852.04,-2764 2862.04,-2767.5 2862.04,-2760.5"/>
</g>
<!-- R2_Stage2_L8_Expert4&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge998" class="edge">
<title>R2_Stage2_L8_Expert4&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M162,-2866.87C162,-2807.91 162,-2680 162,-2680 162,-2680 2205.85,-2680 2205.85,-2680"/>
<polygon fill="black" stroke="black" points="2205.85,-2683.5 2215.85,-2680 2205.85,-2676.5 2205.85,-2683.5"/>
</g>
<!-- R2_Stage2_L8_Expert5&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge999" class="edge">
<title>R2_Stage2_L8_Expert5&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M458,-2866.92C458,-2810.78 458,-2693 458,-2693 458,-2693 2222.86,-2693 2222.86,-2693"/>
<polygon fill="black" stroke="black" points="2222.86,-2696.5 2232.86,-2693 2222.86,-2689.5 2222.86,-2696.5"/>
</g>
<!-- R2_Stage2_L8_Expert6&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge1000" class="edge">
<title>R2_Stage2_L8_Expert6&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M754,-2866.73C754,-2813.43 754,-2706 754,-2706 754,-2706 2239.57,-2706 2239.57,-2706"/>
<polygon fill="black" stroke="black" points="2239.57,-2709.5 2249.57,-2706 2239.57,-2702.5 2239.57,-2709.5"/>
</g>
<!-- R2_Stage2_L8_Expert7&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge1001" class="edge">
<title>R2_Stage2_L8_Expert7&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M1050,-2866.77C1050,-2816.5 1050,-2719 1050,-2719 1050,-2719 2256.69,-2719 2256.69,-2719"/>
<polygon fill="black" stroke="black" points="2256.69,-2722.5 2266.69,-2719 2256.69,-2715.5 2256.69,-2722.5"/>
</g>
<!-- R2_Stage2_L8_Expert8&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge1002" class="edge">
<title>R2_Stage2_L8_Expert8&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M1346,-2866.68C1346,-2819.51 1346,-2732 1346,-2732 1346,-2732 2273.6,-2732 2273.6,-2732"/>
<polygon fill="black" stroke="black" points="2273.6,-2735.5 2283.6,-2732 2273.6,-2728.5 2273.6,-2735.5"/>
</g>
<!-- R2_Stage2_L8_Expert9&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge1003" class="edge">
<title>R2_Stage2_L8_Expert9&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M1642,-2866.89C1642,-2823.01 1642,-2745 1642,-2745 1642,-2745 2290.45,-2745 2290.45,-2745"/>
<polygon fill="black" stroke="black" points="2290.45,-2748.5 2300.45,-2745 2290.45,-2741.5 2290.45,-2748.5"/>
</g>
<!-- R2_Stage2_L8_Expert10&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge1004" class="edge">
<title>R2_Stage2_L8_Expert10&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M1938,-2866.73C1938,-2826.23 1938,-2758 1938,-2758 1938,-2758 2307.53,-2758 2307.53,-2758"/>
<polygon fill="black" stroke="black" points="2307.53,-2761.5 2317.53,-2758 2307.53,-2754.5 2307.53,-2761.5"/>
</g>
<!-- R2_Stage2_L8_Expert11&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge1005" class="edge">
<title>R2_Stage2_L8_Expert11&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M2281.64,-2866.77C2281.64,-2866.77 2281.64,-2740.66 2281.64,-2740.66"/>
<polygon fill="black" stroke="black" points="2285.14,-2740.66 2281.64,-2730.66 2278.14,-2740.66 2285.14,-2740.66"/>
</g>
<!-- R2_Stage2_L8_Expert12&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge1006" class="edge">
<title>R2_Stage2_L8_Expert12&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M2530,-2866.77C2530,-2866.77 2530,-2781.18 2530,-2781.18"/>
<polygon fill="black" stroke="black" points="2533.5,-2781.18 2530,-2771.18 2526.5,-2781.18 2533.5,-2781.18"/>
</g>
<!-- R2_Stage2_L8_Expert13&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge1007" class="edge">
<title>R2_Stage2_L8_Expert13&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M2778.36,-2866.77C2778.36,-2866.77 2778.36,-2781.18 2778.36,-2781.18"/>
<polygon fill="black" stroke="black" points="2781.86,-2781.18 2778.36,-2771.18 2774.86,-2781.18 2781.86,-2781.18"/>
</g>
<!-- R2_Stage2_L8_Expert14&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge1008" class="edge">
<title>R2_Stage2_L8_Expert14&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M3122,-2866.86C3122,-2829.37 3122,-2769 3122,-2769 3122,-2769 2868.46,-2769 2868.46,-2769"/>
<polygon fill="black" stroke="black" points="2868.46,-2765.5 2858.46,-2769 2868.46,-2772.5 2868.46,-2765.5"/>
</g>
<!-- R2_Stage2_L8_Expert15&#45;&gt;R2_Stage2_L8_MoE_Output -->
<g id="edge1009" class="edge">
<title>R2_Stage2_L8_Expert15&#45;&gt;R2_Stage2_L8_MoE_Output</title>
<path fill="none" stroke="black" d="M3418,-2866.95C3418,-2829.19 3418,-2768 3418,-2768 3418,-2768 2867.19,-2768 2867.19,-2768"/>
<polygon fill="black" stroke="black" points="2867.19,-2764.5 2857.19,-2768 2867.19,-2771.5 2867.19,-2764.5"/>
</g>
<!-- R2_Stage2_L8_MoE_Output&#45;&gt;R2_Stage2_L8_Output -->
<g id="edge1010" class="edge">
<title>R2_Stage2_L8_MoE_Output&#45;&gt;R2_Stage2_L8_Output</title>
<path fill="none" stroke="black" d="M2734.8,-2674C3379.2,-2674 5322.83,-2674 5322.83,-2674 5322.83,-2674 5322.83,-2579.35 5322.83,-2579.35"/>
<polygon fill="black" stroke="black" points="5326.33,-2579.35 5322.83,-2569.35 5319.33,-2579.35 5326.33,-2579.35"/>
</g>
<!-- R2_Stage3_L9_Input -->
<g id="node629" class="node">
<title>R2_Stage3_L9_Input</title>
<ellipse fill="lightblue" stroke="black" cx="17643" cy="-3469" rx="225.5" ry="29"/>
<text text-anchor="middle" x="17643" y="-3477.5" font-family="Times,serif" font-size="10.00">Layer 9 Input</text>
<text text-anchor="middle" x="17643" y="-3466.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="17643" y="-3455.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Attn_Input -->
<g id="node630" class="node">
<title>R2_Stage3_L9_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="17643" cy="-3278" rx="225.5" ry="29"/>
<text text-anchor="middle" x="17643" y="-3286.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="17643" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="17643" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Input&#45;&gt;R2_Stage3_L9_Attn_Input -->
<g id="edge1011" class="edge">
<title>R2_Stage3_L9_Input&#45;&gt;R2_Stage3_L9_Attn_Input</title>
<path fill="none" stroke="black" d="M17643,-3439.99C17643,-3439.99 17643,-3317.28 17643,-3317.28"/>
<polygon fill="black" stroke="black" points="17646.5,-3317.28 17643,-3307.28 17639.5,-3317.28 17646.5,-3317.28"/>
</g>
<!-- R2_Stage3_L9_Attn_TP1 -->
<g id="node631" class="node">
<title>R2_Stage3_L9_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="17671,-3116 17325,-3116 17325,-3058 17671,-3058 17671,-3116"/>
<text text-anchor="middle" x="17498" y="-3101" font-family="Times,serif" font-size="10.00">Attention TP GPU 96</text>
<text text-anchor="middle" x="17498" y="-3090" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="17498" y="-3079" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="17498" y="-3068" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage3_L9_Attn_Input&#45;&gt;R2_Stage3_L9_Attn_TP1 -->
<g id="edge1012" class="edge">
<title>R2_Stage3_L9_Attn_Input&#45;&gt;R2_Stage3_L9_Attn_TP1</title>
<path fill="none" stroke="black" d="M17544.25,-3251.84C17544.25,-3251.84 17544.25,-3126.28 17544.25,-3126.28"/>
<polygon fill="black" stroke="black" points="17547.75,-3126.28 17544.25,-3116.28 17540.75,-3126.28 17547.75,-3126.28"/>
</g>
<!-- R2_Stage3_L9_Attn_TP2 -->
<g id="node632" class="node">
<title>R2_Stage3_L9_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="18053,-3116 17707,-3116 17707,-3058 18053,-3058 18053,-3116"/>
<text text-anchor="middle" x="17880" y="-3101" font-family="Times,serif" font-size="10.00">Attention TP GPU 97</text>
<text text-anchor="middle" x="17880" y="-3090" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="17880" y="-3079" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="17880" y="-3068" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage3_L9_Attn_Input&#45;&gt;R2_Stage3_L9_Attn_TP2 -->
<g id="edge1013" class="edge">
<title>R2_Stage3_L9_Attn_Input&#45;&gt;R2_Stage3_L9_Attn_TP2</title>
<path fill="none" stroke="black" d="M17787.75,-3255.72C17787.75,-3255.72 17787.75,-3126.31 17787.75,-3126.31"/>
<polygon fill="black" stroke="black" points="17791.25,-3126.31 17787.75,-3116.31 17784.25,-3126.31 17791.25,-3126.31"/>
</g>
<!-- R2_Stage3_L9_Attn_Output -->
<g id="node633" class="node">
<title>R2_Stage3_L9_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="17689" cy="-2896" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="17689" y="-2910" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="17689" y="-2899" font-family="Times,serif" font-size="10.00">AllReduce GPUs 96&#45;97</text>
<text text-anchor="middle" x="17689" y="-2888" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="17689" y="-2877" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Attn_TP1&#45;&gt;R2_Stage3_L9_Attn_Output -->
<g id="edge1014" class="edge">
<title>R2_Stage3_L9_Attn_TP1&#45;&gt;R2_Stage3_L9_Attn_Output</title>
<path fill="none" stroke="black" d="M17558.38,-3057.99C17558.38,-3057.99 17558.38,-2937.19 17558.38,-2937.19"/>
<polygon fill="black" stroke="black" points="17561.88,-2937.19 17558.38,-2927.19 17554.88,-2937.19 17561.88,-2937.19"/>
</g>
<!-- R2_Stage3_L9_Attn_TP2&#45;&gt;R2_Stage3_L9_Attn_Output -->
<g id="edge1015" class="edge">
<title>R2_Stage3_L9_Attn_TP2&#45;&gt;R2_Stage3_L9_Attn_Output</title>
<path fill="none" stroke="black" d="M17819.62,-3057.99C17819.62,-3057.99 17819.62,-2937.19 17819.62,-2937.19"/>
<polygon fill="black" stroke="black" points="17823.12,-2937.19 17819.62,-2927.19 17816.12,-2937.19 17823.12,-2937.19"/>
</g>
<!-- R2_Stage3_L9_MoE_Input -->
<g id="node634" class="node">
<title>R2_Stage3_L9_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="17689" cy="-2719" rx="225.5" ry="29"/>
<text text-anchor="middle" x="17689" y="-2727.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="17689" y="-2716.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="17689" y="-2705.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Attn_Output&#45;&gt;R2_Stage3_L9_MoE_Input -->
<g id="edge1016" class="edge">
<title>R2_Stage3_L9_Attn_Output&#45;&gt;R2_Stage3_L9_MoE_Input</title>
<path fill="none" stroke="black" d="M17689,-2858.89C17689,-2858.89 17689,-2758.17 17689,-2758.17"/>
<polygon fill="black" stroke="black" points="17692.5,-2758.17 17689,-2748.17 17685.5,-2758.17 17692.5,-2758.17"/>
</g>
<!-- R2_Stage3_L9_Router -->
<g id="node635" class="node">
<title>R2_Stage3_L9_Router</title>
<polygon fill="lightyellow" stroke="black" points="18011.36,-2594 17498.56,-2594 17366.64,-2490 17879.44,-2490 18011.36,-2594"/>
<text text-anchor="middle" x="17689" y="-2556" font-family="Times,serif" font-size="10.00">Router GPU 96</text>
<text text-anchor="middle" x="17689" y="-2545" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="17689" y="-2534" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="17689" y="-2523" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage3_L9_MoE_Input&#45;&gt;R2_Stage3_L9_Router -->
<g id="edge1017" class="edge">
<title>R2_Stage3_L9_MoE_Input&#45;&gt;R2_Stage3_L9_Router</title>
<path fill="none" stroke="black" d="M17689,-2689.77C17689,-2689.77 17689,-2604.18 17689,-2604.18"/>
<polygon fill="black" stroke="black" points="17692.5,-2604.18 17689,-2594.18 17685.5,-2604.18 17692.5,-2604.18"/>
</g>
<!-- R2_Stage3_L9_Expert0 -->
<g id="node636" class="node">
<title>R2_Stage3_L9_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="18585,-2380 18325,-2380 18325,-2322 18585,-2322 18585,-2380"/>
<text text-anchor="middle" x="18455" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 96</text>
<text text-anchor="middle" x="18455" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18455" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert0 -->
<g id="edge1018" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17883.28,-2493C18110.22,-2493 18455,-2493 18455,-2493 18455,-2493 18455,-2390.08 18455,-2390.08"/>
<polygon fill="black" stroke="black" points="18458.5,-2390.08 18455,-2380.08 18451.5,-2390.08 18458.5,-2390.08"/>
<text text-anchor="middle" x="18317.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert1 -->
<g id="node637" class="node">
<title>R2_Stage3_L9_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="18881,-2380 18621,-2380 18621,-2322 18881,-2322 18881,-2380"/>
<text text-anchor="middle" x="18751" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 97</text>
<text text-anchor="middle" x="18751" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18751" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert1 -->
<g id="edge1019" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17885.95,-2495C18193.01,-2495 18751,-2495 18751,-2495 18751,-2495 18751,-2390.14 18751,-2390.14"/>
<polygon fill="black" stroke="black" points="18754.5,-2390.14 18751,-2380.14 18747.5,-2390.14 18754.5,-2390.14"/>
<text text-anchor="middle" x="18560.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert2 -->
<g id="node638" class="node">
<title>R2_Stage3_L9_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="19177,-2380 18917,-2380 18917,-2322 19177,-2322 19177,-2380"/>
<text text-anchor="middle" x="19047" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 98</text>
<text text-anchor="middle" x="19047" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19047" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert2 -->
<g id="edge1020" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17888.65,-2497C18266.12,-2497 19047,-2497 19047,-2497 19047,-2497 19047,-2390.19 19047,-2390.19"/>
<polygon fill="black" stroke="black" points="19050.5,-2390.19 19047,-2380.19 19043.5,-2390.19 19050.5,-2390.19"/>
<text text-anchor="middle" x="18856.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert3 -->
<g id="node639" class="node">
<title>R2_Stage3_L9_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="19473,-2380 19213,-2380 19213,-2322 19473,-2322 19473,-2380"/>
<text text-anchor="middle" x="19343" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 99</text>
<text text-anchor="middle" x="19343" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19343" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert3 -->
<g id="edge1021" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17890.99,-2499C18332.22,-2499 19343,-2499 19343,-2499 19343,-2499 19343,-2390.24 19343,-2390.24"/>
<polygon fill="black" stroke="black" points="19346.5,-2390.24 19343,-2380.24 19339.5,-2390.24 19346.5,-2390.24"/>
<text text-anchor="middle" x="19152.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert4 -->
<g id="node640" class="node">
<title>R2_Stage3_L9_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="19769,-2380 19509,-2380 19509,-2322 19769,-2322 19769,-2380"/>
<text text-anchor="middle" x="19639" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 100</text>
<text text-anchor="middle" x="19639" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19639" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert4 -->
<g id="edge1022" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17893.54,-2501C18393.89,-2501 19639,-2501 19639,-2501 19639,-2501 19639,-2390.28 19639,-2390.28"/>
<polygon fill="black" stroke="black" points="19642.5,-2390.28 19639,-2380.28 19635.5,-2390.28 19642.5,-2390.28"/>
<text text-anchor="middle" x="19448.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert5 -->
<g id="node641" class="node">
<title>R2_Stage3_L9_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="20065,-2380 19805,-2380 19805,-2322 20065,-2322 20065,-2380"/>
<text text-anchor="middle" x="19935" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 101</text>
<text text-anchor="middle" x="19935" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19935" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert5 -->
<g id="edge1023" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17897.28,-2504C18454.07,-2504 19935,-2504 19935,-2504 19935,-2504 19935,-2390.14 19935,-2390.14"/>
<polygon fill="black" stroke="black" points="19938.5,-2390.14 19935,-2380.14 19931.5,-2390.14 19938.5,-2390.14"/>
<text text-anchor="middle" x="19744.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert6 -->
<g id="node642" class="node">
<title>R2_Stage3_L9_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="15625,-2380 15365,-2380 15365,-2322 15625,-2322 15625,-2380"/>
<text text-anchor="middle" x="15495" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 102</text>
<text text-anchor="middle" x="15495" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="15495" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert6 -->
<g id="edge1024" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17382.99,-2503C16806.11,-2503 15615.12,-2503 15615.12,-2503 15615.12,-2503 15615.12,-2390.31 15615.12,-2390.31"/>
<polygon fill="black" stroke="black" points="15618.62,-2390.31 15615.12,-2380.31 15611.62,-2390.31 15618.62,-2390.31"/>
<text text-anchor="middle" x="15727.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert7 -->
<g id="node643" class="node">
<title>R2_Stage3_L9_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="15921,-2380 15661,-2380 15661,-2322 15921,-2322 15921,-2380"/>
<text text-anchor="middle" x="15791" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 103</text>
<text text-anchor="middle" x="15791" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="15791" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert7 -->
<g id="edge1025" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17379.29,-2500C16855.47,-2500 15851,-2500 15851,-2500 15851,-2500 15851,-2390.08 15851,-2390.08"/>
<polygon fill="black" stroke="black" points="15854.5,-2390.08 15851,-2380.08 15847.5,-2390.08 15854.5,-2390.08"/>
<text text-anchor="middle" x="16022.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert8 -->
<g id="node644" class="node">
<title>R2_Stage3_L9_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="16217,-2380 15957,-2380 15957,-2322 16217,-2322 16217,-2380"/>
<text text-anchor="middle" x="16087" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 104</text>
<text text-anchor="middle" x="16087" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16087" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert8 -->
<g id="edge1026" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17376.32,-2498C16910.1,-2498 16087,-2498 16087,-2498 16087,-2498 16087,-2390.04 16087,-2390.04"/>
<polygon fill="black" stroke="black" points="16090.5,-2390.04 16087,-2380.04 16083.5,-2390.04 16090.5,-2390.04"/>
<text text-anchor="middle" x="16316.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert9 -->
<g id="node645" class="node">
<title>R2_Stage3_L9_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="16513,-2380 16253,-2380 16253,-2322 16513,-2322 16513,-2380"/>
<text text-anchor="middle" x="16383" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 105</text>
<text text-anchor="middle" x="16383" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16383" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert9 -->
<g id="edge1027" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17374.1,-2496C16987.64,-2496 16383,-2496 16383,-2496 16383,-2496 16383,-2390.34 16383,-2390.34"/>
<polygon fill="black" stroke="black" points="16386.5,-2390.34 16383,-2380.34 16379.5,-2390.34 16386.5,-2390.34"/>
<text text-anchor="middle" x="16609.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert10 -->
<g id="node646" class="node">
<title>R2_Stage3_L9_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="16809,-2380 16549,-2380 16549,-2322 16809,-2322 16809,-2380"/>
<text text-anchor="middle" x="16679" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 106</text>
<text text-anchor="middle" x="16679" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16679" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert10 -->
<g id="edge1028" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17371.51,-2494C17075.38,-2494 16679,-2494 16679,-2494 16679,-2494 16679,-2390.28 16679,-2390.28"/>
<polygon fill="black" stroke="black" points="16682.5,-2390.28 16679,-2380.28 16675.5,-2390.28 16682.5,-2390.28"/>
<text text-anchor="middle" x="16898.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert11 -->
<g id="node647" class="node">
<title>R2_Stage3_L9_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="17105,-2380 16845,-2380 16845,-2322 17105,-2322 17105,-2380"/>
<text text-anchor="middle" x="16975" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 107</text>
<text text-anchor="middle" x="16975" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16975" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert11 -->
<g id="edge1029" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17369.07,-2492C17179.11,-2492 16975,-2492 16975,-2492 16975,-2492 16975,-2390.22 16975,-2390.22"/>
<polygon fill="black" stroke="black" points="16978.5,-2390.22 16975,-2380.22 16971.5,-2390.22 16978.5,-2390.22"/>
<text text-anchor="middle" x="17181.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert12 -->
<g id="node648" class="node">
<title>R2_Stage3_L9_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="17401,-2380 17141,-2380 17141,-2322 17401,-2322 17401,-2380"/>
<text text-anchor="middle" x="17271" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 108</text>
<text text-anchor="middle" x="17271" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17271" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert12 -->
<g id="edge1030" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17383.78,-2541.86C17383.78,-2541.86 17383.78,-2390.01 17383.78,-2390.01"/>
<polygon fill="black" stroke="black" points="17387.28,-2390.01 17383.78,-2380.01 17380.28,-2390.01 17387.28,-2390.01"/>
<text text-anchor="middle" x="17451.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert13 -->
<g id="node649" class="node">
<title>R2_Stage3_L9_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="17697,-2380 17437,-2380 17437,-2322 17697,-2322 17697,-2380"/>
<text text-anchor="middle" x="17567" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 109</text>
<text text-anchor="middle" x="17567" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17567" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert13 -->
<g id="edge1031" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17567,-2489.81C17567,-2489.81 17567,-2390.01 17567,-2390.01"/>
<polygon fill="black" stroke="black" points="17570.5,-2390.01 17567,-2380.01 17563.5,-2390.01 17570.5,-2390.01"/>
<text text-anchor="middle" x="17641.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert14 -->
<g id="node650" class="node">
<title>R2_Stage3_L9_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="17993,-2380 17733,-2380 17733,-2322 17993,-2322 17993,-2380"/>
<text text-anchor="middle" x="17863" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 110</text>
<text text-anchor="middle" x="17863" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17863" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert14 -->
<g id="edge1032" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17863,-2489.81C17863,-2489.81 17863,-2390.01 17863,-2390.01"/>
<polygon fill="black" stroke="black" points="17866.5,-2390.01 17863,-2380.01 17859.5,-2390.01 17866.5,-2390.01"/>
<text text-anchor="middle" x="17778.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_Expert15 -->
<g id="node651" class="node">
<title>R2_Stage3_L9_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="18289,-2380 18029,-2380 18029,-2322 18289,-2322 18289,-2380"/>
<text text-anchor="middle" x="18159" y="-2359.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 111</text>
<text text-anchor="middle" x="18159" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18159" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert15 -->
<g id="edge1033" class="edge">
<title>R2_Stage3_L9_Router&#45;&gt;R2_Stage3_L9_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M17880.96,-2491C17963.33,-2491 18041,-2491 18041,-2491 18041,-2491 18041,-2390.01 18041,-2390.01"/>
<polygon fill="black" stroke="black" points="18044.5,-2390.01 18041,-2380.01 18037.5,-2390.01 18044.5,-2390.01"/>
<text text-anchor="middle" x="18074.5" y="-2442.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L9_MoE_Output -->
<g id="node652" class="node">
<title>R2_Stage3_L9_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="16575.95,-2212 16049.48,-2212 15914.05,-2108 16440.52,-2108 16575.95,-2212"/>
<text text-anchor="middle" x="16245" y="-2174" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="16245" y="-2163" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="16245" y="-2152" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="16245" y="-2141" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L9_Expert0&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1034" class="edge">
<title>R2_Stage3_L9_Expert0&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M18334,-2321.89C18334,-2278.01 18334,-2200 18334,-2200 18334,-2200 16570.57,-2200 16570.57,-2200"/>
<polygon fill="black" stroke="black" points="16570.57,-2196.5 16560.57,-2200 16570.57,-2203.5 16570.57,-2196.5"/>
</g>
<!-- R2_Stage3_L9_Expert1&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1035" class="edge">
<title>R2_Stage3_L9_Expert1&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M18630,-2321.86C18630,-2277.47 18630,-2198 18630,-2198 18630,-2198 16568.02,-2198 16568.02,-2198"/>
<polygon fill="black" stroke="black" points="16568.02,-2194.5 16558.02,-2198 16568.02,-2201.5 16568.02,-2194.5"/>
</g>
<!-- R2_Stage3_L9_Expert2&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1036" class="edge">
<title>R2_Stage3_L9_Expert2&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M18926,-2321.85C18926,-2276.95 18926,-2196 18926,-2196 18926,-2196 16565.16,-2196 16565.16,-2196"/>
<polygon fill="black" stroke="black" points="16565.16,-2192.5 16555.16,-2196 16565.16,-2199.5 16565.16,-2192.5"/>
</g>
<!-- R2_Stage3_L9_Expert3&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1037" class="edge">
<title>R2_Stage3_L9_Expert3&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M19222,-2321.84C19222,-2276.43 19222,-2194 19222,-2194 19222,-2194 16562.73,-2194 16562.73,-2194"/>
<polygon fill="black" stroke="black" points="16562.73,-2190.5 16552.73,-2194 16562.73,-2197.5 16562.73,-2190.5"/>
</g>
<!-- R2_Stage3_L9_Expert4&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1038" class="edge">
<title>R2_Stage3_L9_Expert4&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M19518,-2321.84C19518,-2275.93 19518,-2192 19518,-2192 19518,-2192 16559.98,-2192 16559.98,-2192"/>
<polygon fill="black" stroke="black" points="16559.98,-2188.5 16549.98,-2192 16559.98,-2195.5 16559.98,-2188.5"/>
</g>
<!-- R2_Stage3_L9_Expert5&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1039" class="edge">
<title>R2_Stage3_L9_Expert5&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M19814,-2321.84C19814,-2275.45 19814,-2190 19814,-2190 19814,-2190 16557.37,-2190 16557.37,-2190"/>
<polygon fill="black" stroke="black" points="16557.37,-2186.5 16547.37,-2190 16557.37,-2193.5 16557.37,-2186.5"/>
</g>
<!-- R2_Stage3_L9_Expert6&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1040" class="edge">
<title>R2_Stage3_L9_Expert6&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M15591.19,-2321.96C15591.19,-2279.12 15591.19,-2204 15591.19,-2204 15591.19,-2204 16029.03,-2204 16029.03,-2204"/>
<polygon fill="black" stroke="black" points="16029.03,-2207.5 16039.03,-2204 16029.03,-2200.5 16029.03,-2207.5"/>
</g>
<!-- R2_Stage3_L9_Expert7&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1041" class="edge">
<title>R2_Stage3_L9_Expert7&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M15905.18,-2321.85C15905.18,-2276.95 15905.18,-2196 15905.18,-2196 15905.18,-2196 16018.35,-2196 16018.35,-2196"/>
<polygon fill="black" stroke="black" points="16018.35,-2199.5 16028.35,-2196 16018.35,-2192.5 16018.35,-2199.5"/>
</g>
<!-- R2_Stage3_L9_Expert8&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1042" class="edge">
<title>R2_Stage3_L9_Expert8&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M16087,-2321.99C16087,-2321.99 16087,-2222.02 16087,-2222.02"/>
<polygon fill="black" stroke="black" points="16090.5,-2222.02 16087,-2212.02 16083.5,-2222.02 16090.5,-2222.02"/>
</g>
<!-- R2_Stage3_L9_Expert9&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1043" class="edge">
<title>R2_Stage3_L9_Expert9&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M16383,-2321.99C16383,-2321.99 16383,-2222.02 16383,-2222.02"/>
<polygon fill="black" stroke="black" points="16386.5,-2222.02 16383,-2212.02 16379.5,-2222.02 16386.5,-2222.02"/>
</g>
<!-- R2_Stage3_L9_Expert10&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1044" class="edge">
<title>R2_Stage3_L9_Expert10&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M16562.36,-2321.99C16562.36,-2321.99 16562.36,-2170.08 16562.36,-2170.08"/>
<polygon fill="black" stroke="black" points="16565.86,-2170.08 16562.36,-2160.08 16558.86,-2170.08 16565.86,-2170.08"/>
</g>
<!-- R2_Stage3_L9_Expert11&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1045" class="edge">
<title>R2_Stage3_L9_Expert11&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M16858.5,-2321.78C16858.5,-2280.48 16858.5,-2210 16858.5,-2210 16858.5,-2210 16583.75,-2210 16583.75,-2210"/>
<polygon fill="black" stroke="black" points="16583.75,-2206.5 16573.75,-2210 16583.75,-2213.5 16583.75,-2206.5"/>
</g>
<!-- R2_Stage3_L9_Expert12&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1046" class="edge">
<title>R2_Stage3_L9_Expert12&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M17150,-2321.72C17150,-2279.88 17150,-2208 17150,-2208 17150,-2208 16580.77,-2208 16580.77,-2208"/>
<polygon fill="black" stroke="black" points="16580.77,-2204.5 16570.77,-2208 16580.77,-2211.5 16580.77,-2204.5"/>
</g>
<!-- R2_Stage3_L9_Expert13&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1047" class="edge">
<title>R2_Stage3_L9_Expert13&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M17446,-2321.66C17446,-2279.29 17446,-2206 17446,-2206 17446,-2206 16578.43,-2206 16578.43,-2206"/>
<polygon fill="black" stroke="black" points="16578.43,-2202.5 16568.43,-2206 16578.43,-2209.5 16578.43,-2202.5"/>
</g>
<!-- R2_Stage3_L9_Expert14&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1048" class="edge">
<title>R2_Stage3_L9_Expert14&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M17742,-2321.96C17742,-2279.12 17742,-2204 17742,-2204 17742,-2204 16575.68,-2204 16575.68,-2204"/>
<polygon fill="black" stroke="black" points="16575.68,-2200.5 16565.68,-2204 16575.68,-2207.5 16575.68,-2200.5"/>
</g>
<!-- R2_Stage3_L9_Expert15&#45;&gt;R2_Stage3_L9_MoE_Output -->
<g id="edge1049" class="edge">
<title>R2_Stage3_L9_Expert15&#45;&gt;R2_Stage3_L9_MoE_Output</title>
<path fill="none" stroke="black" d="M18038,-2321.92C18038,-2278.56 18038,-2202 18038,-2202 18038,-2202 16572.97,-2202 16572.97,-2202"/>
<polygon fill="black" stroke="black" points="16572.97,-2198.5 16562.97,-2202 16572.97,-2205.5 16572.97,-2198.5"/>
</g>
<!-- R2_Stage3_L9_MoE_Output&#45;&gt;R2_Stage3_L9_Output -->
<g id="edge1050" class="edge">
<title>R2_Stage3_L9_MoE_Output&#45;&gt;R2_Stage3_L9_Output</title>
<path fill="none" stroke="black" d="M16454.87,-2119C17218.1,-2119 19801.75,-2119 19801.75,-2119 19801.75,-2119 19801.75,-1993.66 19801.75,-1993.66"/>
<polygon fill="black" stroke="black" points="19805.25,-1993.66 19801.75,-1983.66 19798.25,-1993.66 19805.25,-1993.66"/>
</g>
<!-- R2_Stage3_L10_Input -->
<g id="node653" class="node">
<title>R2_Stage3_L10_Input</title>
<ellipse fill="lightblue" stroke="black" cx="20516" cy="-3278" rx="225.5" ry="29"/>
<text text-anchor="middle" x="20516" y="-3286.5" font-family="Times,serif" font-size="10.00">Layer 10 Input</text>
<text text-anchor="middle" x="20516" y="-3275.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="20516" y="-3264.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Attn_Input -->
<g id="node654" class="node">
<title>R2_Stage3_L10_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="20516" cy="-3087" rx="225.5" ry="29"/>
<text text-anchor="middle" x="20516" y="-3095.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="20516" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="20516" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Input&#45;&gt;R2_Stage3_L10_Attn_Input -->
<g id="edge1051" class="edge">
<title>R2_Stage3_L10_Input&#45;&gt;R2_Stage3_L10_Attn_Input</title>
<path fill="none" stroke="black" d="M20516,-3248.99C20516,-3248.99 20516,-3126.28 20516,-3126.28"/>
<polygon fill="black" stroke="black" points="20519.5,-3126.28 20516,-3116.28 20512.5,-3126.28 20519.5,-3126.28"/>
</g>
<!-- R2_Stage3_L10_Attn_TP1 -->
<g id="node655" class="node">
<title>R2_Stage3_L10_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="20880,-2925 20534,-2925 20534,-2867 20880,-2867 20880,-2925"/>
<text text-anchor="middle" x="20707" y="-2910" font-family="Times,serif" font-size="10.00">Attention TP GPU 96</text>
<text text-anchor="middle" x="20707" y="-2899" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="20707" y="-2888" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="20707" y="-2877" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage3_L10_Attn_Input&#45;&gt;R2_Stage3_L10_Attn_TP1 -->
<g id="edge1052" class="edge">
<title>R2_Stage3_L10_Attn_Input&#45;&gt;R2_Stage3_L10_Attn_TP1</title>
<path fill="none" stroke="black" d="M20637.75,-3062.42C20637.75,-3062.42 20637.75,-2935.17 20637.75,-2935.17"/>
<polygon fill="black" stroke="black" points="20641.25,-2935.17 20637.75,-2925.17 20634.25,-2935.17 20641.25,-2935.17"/>
</g>
<!-- R2_Stage3_L10_Attn_TP2 -->
<g id="node656" class="node">
<title>R2_Stage3_L10_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="20498,-2925 20152,-2925 20152,-2867 20498,-2867 20498,-2925"/>
<text text-anchor="middle" x="20325" y="-2910" font-family="Times,serif" font-size="10.00">Attention TP GPU 97</text>
<text text-anchor="middle" x="20325" y="-2899" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="20325" y="-2888" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="20325" y="-2877" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage3_L10_Attn_Input&#45;&gt;R2_Stage3_L10_Attn_TP2 -->
<g id="edge1053" class="edge">
<title>R2_Stage3_L10_Attn_Input&#45;&gt;R2_Stage3_L10_Attn_TP2</title>
<path fill="none" stroke="black" d="M20394.25,-3062.42C20394.25,-3062.42 20394.25,-2935.17 20394.25,-2935.17"/>
<polygon fill="black" stroke="black" points="20397.75,-2935.17 20394.25,-2925.17 20390.75,-2935.17 20397.75,-2935.17"/>
</g>
<!-- R2_Stage3_L10_Attn_Output -->
<g id="node657" class="node">
<title>R2_Stage3_L10_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="20423" cy="-2719" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="20423" y="-2733" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="20423" y="-2722" font-family="Times,serif" font-size="10.00">AllReduce GPUs 96&#45;97</text>
<text text-anchor="middle" x="20423" y="-2711" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="20423" y="-2700" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Attn_TP1&#45;&gt;R2_Stage3_L10_Attn_Output -->
<g id="edge1054" class="edge">
<title>R2_Stage3_L10_Attn_TP1&#45;&gt;R2_Stage3_L10_Attn_Output</title>
<path fill="none" stroke="black" d="M20600.12,-2866.77C20600.12,-2866.77 20600.12,-2754.25 20600.12,-2754.25"/>
<polygon fill="black" stroke="black" points="20603.62,-2754.25 20600.12,-2744.25 20596.62,-2754.25 20603.62,-2754.25"/>
</g>
<!-- R2_Stage3_L10_Attn_TP2&#45;&gt;R2_Stage3_L10_Attn_Output -->
<g id="edge1055" class="edge">
<title>R2_Stage3_L10_Attn_TP2&#45;&gt;R2_Stage3_L10_Attn_Output</title>
<path fill="none" stroke="black" d="M20338.88,-2866.77C20338.88,-2866.77 20338.88,-2763.75 20338.88,-2763.75"/>
<polygon fill="black" stroke="black" points="20342.38,-2763.75 20338.88,-2753.75 20335.38,-2763.75 20342.38,-2763.75"/>
</g>
<!-- R2_Stage3_L10_MoE_Input -->
<g id="node658" class="node">
<title>R2_Stage3_L10_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="20423" cy="-2542" rx="225.5" ry="29"/>
<text text-anchor="middle" x="20423" y="-2550.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="20423" y="-2539.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="20423" y="-2528.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Attn_Output&#45;&gt;R2_Stage3_L10_MoE_Input -->
<g id="edge1056" class="edge">
<title>R2_Stage3_L10_Attn_Output&#45;&gt;R2_Stage3_L10_MoE_Input</title>
<path fill="none" stroke="black" d="M20423,-2681.89C20423,-2681.89 20423,-2581.17 20423,-2581.17"/>
<polygon fill="black" stroke="black" points="20426.5,-2581.17 20423,-2571.17 20419.5,-2581.17 20426.5,-2581.17"/>
</g>
<!-- R2_Stage3_L10_Router -->
<g id="node659" class="node">
<title>R2_Stage3_L10_Router</title>
<polygon fill="lightyellow" stroke="black" points="20745.36,-2403 20232.56,-2403 20100.64,-2299 20613.44,-2299 20745.36,-2403"/>
<text text-anchor="middle" x="20423" y="-2365" font-family="Times,serif" font-size="10.00">Router GPU 96</text>
<text text-anchor="middle" x="20423" y="-2354" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="20423" y="-2343" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="20423" y="-2332" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage3_L10_MoE_Input&#45;&gt;R2_Stage3_L10_Router -->
<g id="edge1057" class="edge">
<title>R2_Stage3_L10_MoE_Input&#45;&gt;R2_Stage3_L10_Router</title>
<path fill="none" stroke="black" d="M20423,-2512.99C20423,-2512.99 20423,-2413.02 20423,-2413.02"/>
<polygon fill="black" stroke="black" points="20426.5,-2413.02 20423,-2403.02 20419.5,-2413.02 20426.5,-2413.02"/>
</g>
<!-- R2_Stage3_L10_Expert0 -->
<g id="node660" class="node">
<title>R2_Stage3_L10_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="19536,-2189 19276,-2189 19276,-2131 19536,-2131 19536,-2189"/>
<text text-anchor="middle" x="19406" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 96</text>
<text text-anchor="middle" x="19406" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19406" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert0 -->
<g id="edge1058" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20104.27,-2302C19846.78,-2302 19527,-2302 19527,-2302 19527,-2302 19527,-2199.08 19527,-2199.08"/>
<polygon fill="black" stroke="black" points="19530.5,-2199.08 19527,-2189.08 19523.5,-2199.08 19530.5,-2199.08"/>
<text text-anchor="middle" x="19615.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert1 -->
<g id="node661" class="node">
<title>R2_Stage3_L10_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="19832,-2189 19572,-2189 19572,-2131 19832,-2131 19832,-2189"/>
<text text-anchor="middle" x="19702" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 97</text>
<text text-anchor="middle" x="19702" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19702" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert1 -->
<g id="edge1059" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20101.48,-2300C19958.99,-2300 19823,-2300 19823,-2300 19823,-2300 19823,-2199.01 19823,-2199.01"/>
<polygon fill="black" stroke="black" points="19826.5,-2199.01 19823,-2189.01 19819.5,-2199.01 19826.5,-2199.01"/>
<text text-anchor="middle" x="19887.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert2 -->
<g id="node662" class="node">
<title>R2_Stage3_L10_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="20128,-2189 19868,-2189 19868,-2131 20128,-2131 20128,-2189"/>
<text text-anchor="middle" x="19998" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 98</text>
<text text-anchor="middle" x="19998" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19998" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert2 -->
<g id="edge1060" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20114.28,-2350.86C20114.28,-2350.86 20114.28,-2199.01 20114.28,-2199.01"/>
<polygon fill="black" stroke="black" points="20117.78,-2199.01 20114.28,-2189.01 20110.78,-2199.01 20117.78,-2199.01"/>
<text text-anchor="middle" x="20136.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert3 -->
<g id="node663" class="node">
<title>R2_Stage3_L10_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="20424,-2189 20164,-2189 20164,-2131 20424,-2131 20424,-2189"/>
<text text-anchor="middle" x="20294" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 99</text>
<text text-anchor="middle" x="20294" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="20294" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert3 -->
<g id="edge1061" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20294,-2298.81C20294,-2298.81 20294,-2199.01 20294,-2199.01"/>
<polygon fill="black" stroke="black" points="20297.5,-2199.01 20294,-2189.01 20290.5,-2199.01 20297.5,-2199.01"/>
<text text-anchor="middle" x="20337.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert4 -->
<g id="node664" class="node">
<title>R2_Stage3_L10_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="20720,-2189 20460,-2189 20460,-2131 20720,-2131 20720,-2189"/>
<text text-anchor="middle" x="20590" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 100</text>
<text text-anchor="middle" x="20590" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="20590" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert4 -->
<g id="edge1062" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20590,-2298.81C20590,-2298.81 20590,-2199.01 20590,-2199.01"/>
<polygon fill="black" stroke="black" points="20593.5,-2199.01 20590,-2189.01 20586.5,-2199.01 20593.5,-2199.01"/>
<text text-anchor="middle" x="20527.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert5 -->
<g id="node665" class="node">
<title>R2_Stage3_L10_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="21016,-2189 20756,-2189 20756,-2131 21016,-2131 21016,-2189"/>
<text text-anchor="middle" x="20886" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 101</text>
<text text-anchor="middle" x="20886" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="20886" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert5 -->
<g id="edge1063" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20732.72,-2350.86C20732.72,-2345.08 20732.72,-2160 20732.72,-2160 20732.72,-2160 20746,-2160 20746,-2160"/>
<polygon fill="black" stroke="black" points="20746,-2163.5 20756,-2160 20746,-2156.5 20746,-2163.5"/>
<text text-anchor="middle" x="20800.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert6 -->
<g id="node666" class="node">
<title>R2_Stage3_L10_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="21312,-2189 21052,-2189 21052,-2131 21312,-2131 21312,-2189"/>
<text text-anchor="middle" x="21182" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 102</text>
<text text-anchor="middle" x="21182" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="21182" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert6 -->
<g id="edge1064" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20617.48,-2302C20842.36,-2302 21182,-2302 21182,-2302 21182,-2302 21182,-2199.08 21182,-2199.08"/>
<polygon fill="black" stroke="black" points="21185.5,-2199.08 21182,-2189.08 21178.5,-2199.08 21185.5,-2199.08"/>
<text text-anchor="middle" x="21085.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert7 -->
<g id="node667" class="node">
<title>R2_Stage3_L10_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="16872,-2189 16612,-2189 16612,-2131 16872,-2131 16872,-2189"/>
<text text-anchor="middle" x="16742" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 103</text>
<text text-anchor="middle" x="16742" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16742" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert7 -->
<g id="edge1065" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20207.16,-2383C19430.93,-2383 16827,-2383 16827,-2383 16827,-2383 16827,-2199.15 16827,-2199.15"/>
<polygon fill="black" stroke="black" points="16830.5,-2199.15 16827,-2189.15 16823.5,-2199.15 16830.5,-2199.15"/>
<text text-anchor="middle" x="16974.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert8 -->
<g id="node668" class="node">
<title>R2_Stage3_L10_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="17168,-2189 16908,-2189 16908,-2131 17168,-2131 17168,-2189"/>
<text text-anchor="middle" x="17038" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 104</text>
<text text-anchor="middle" x="17038" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17038" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert8 -->
<g id="edge1066" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20127.22,-2320C19323.47,-2320 17159,-2320 17159,-2320 17159,-2320 17159,-2199.35 17159,-2199.35"/>
<polygon fill="black" stroke="black" points="17162.5,-2199.35 17159,-2189.35 17155.5,-2199.35 17162.5,-2199.35"/>
<text text-anchor="middle" x="17270.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert9 -->
<g id="node669" class="node">
<title>R2_Stage3_L10_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="17464,-2189 17204,-2189 17204,-2131 17464,-2131 17464,-2189"/>
<text text-anchor="middle" x="17334" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 105</text>
<text text-anchor="middle" x="17334" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17334" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert9 -->
<g id="edge1067" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20124.48,-2318C19371.6,-2318 17455,-2318 17455,-2318 17455,-2318 17455,-2199.35 17455,-2199.35"/>
<polygon fill="black" stroke="black" points="17458.5,-2199.35 17455,-2189.35 17451.5,-2199.35 17458.5,-2199.35"/>
<text text-anchor="middle" x="17565.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert10 -->
<g id="node670" class="node">
<title>R2_Stage3_L10_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="17760,-2189 17500,-2189 17500,-2131 17760,-2131 17760,-2189"/>
<text text-anchor="middle" x="17630" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 106</text>
<text text-anchor="middle" x="17630" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17630" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert10 -->
<g id="edge1068" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20122.01,-2316C19423.4,-2316 17751,-2316 17751,-2316 17751,-2316 17751,-2199.34 17751,-2199.34"/>
<polygon fill="black" stroke="black" points="17754.5,-2199.34 17751,-2189.34 17747.5,-2199.34 17754.5,-2199.34"/>
<text text-anchor="middle" x="17859.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert11 -->
<g id="node671" class="node">
<title>R2_Stage3_L10_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="18056,-2189 17796,-2189 17796,-2131 18056,-2131 18056,-2189"/>
<text text-anchor="middle" x="17926" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 107</text>
<text text-anchor="middle" x="17926" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17926" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert11 -->
<g id="edge1069" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20116.94,-2312C19475.07,-2312 18047,-2312 18047,-2312 18047,-2312 18047,-2199.31 18047,-2199.31"/>
<polygon fill="black" stroke="black" points="18050.5,-2199.31 18047,-2189.31 18043.5,-2199.31 18050.5,-2199.31"/>
<text text-anchor="middle" x="18152.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert12 -->
<g id="node672" class="node">
<title>R2_Stage3_L10_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="18352,-2189 18092,-2189 18092,-2131 18352,-2131 18352,-2189"/>
<text text-anchor="middle" x="18222" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 108</text>
<text text-anchor="middle" x="18222" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18222" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert12 -->
<g id="edge1070" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20114.41,-2310C19535.19,-2310 18343,-2310 18343,-2310 18343,-2310 18343,-2199.28 18343,-2199.28"/>
<polygon fill="black" stroke="black" points="18346.5,-2199.28 18343,-2189.28 18339.5,-2199.28 18346.5,-2199.28"/>
<text text-anchor="middle" x="18441.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert13 -->
<g id="node673" class="node">
<title>R2_Stage3_L10_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="18648,-2189 18388,-2189 18388,-2131 18648,-2131 18648,-2189"/>
<text text-anchor="middle" x="18518" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 109</text>
<text text-anchor="middle" x="18518" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18518" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert13 -->
<g id="edge1071" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20112,-2308C19600.8,-2308 18639,-2308 18639,-2308 18639,-2308 18639,-2199.24 18639,-2199.24"/>
<polygon fill="black" stroke="black" points="18642.5,-2199.24 18639,-2189.24 18635.5,-2199.24 18642.5,-2199.24"/>
<text text-anchor="middle" x="18724.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert14 -->
<g id="node674" class="node">
<title>R2_Stage3_L10_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="18944,-2189 18684,-2189 18684,-2131 18944,-2131 18944,-2189"/>
<text text-anchor="middle" x="18814" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 110</text>
<text text-anchor="middle" x="18814" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18814" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert14 -->
<g id="edge1072" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20109.25,-2306C19672.69,-2306 18935,-2306 18935,-2306 18935,-2306 18935,-2199.19 18935,-2199.19"/>
<polygon fill="black" stroke="black" points="18938.5,-2199.19 18935,-2189.19 18931.5,-2199.19 18938.5,-2199.19"/>
<text text-anchor="middle" x="18994.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_Expert15 -->
<g id="node675" class="node">
<title>R2_Stage3_L10_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="19240,-2189 18980,-2189 18980,-2131 19240,-2131 19240,-2189"/>
<text text-anchor="middle" x="19110" y="-2168.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 111</text>
<text text-anchor="middle" x="19110" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19110" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert15 -->
<g id="edge1073" class="edge">
<title>R2_Stage3_L10_Router&#45;&gt;R2_Stage3_L10_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M20106.7,-2304C19753.56,-2304 19231,-2304 19231,-2304 19231,-2304 19231,-2199.14 19231,-2199.14"/>
<polygon fill="black" stroke="black" points="19234.5,-2199.14 19231,-2189.14 19227.5,-2199.14 19234.5,-2199.14"/>
<text text-anchor="middle" x="19237.5" y="-2251.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L10_MoE_Output -->
<g id="node676" class="node">
<title>R2_Stage3_L10_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="20919.95,-2021 20393.48,-2021 20258.05,-1917 20784.52,-1917 20919.95,-2021"/>
<text text-anchor="middle" x="20589" y="-1983" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="20589" y="-1972" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="20589" y="-1961" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="20589" y="-1950" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L10_Expert0&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1074" class="edge">
<title>R2_Stage3_L10_Expert0&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M19515.67,-2130.86C19515.67,-2088.78 19515.67,-2016 19515.67,-2016 19515.67,-2016 20376.8,-2016 20376.8,-2016"/>
<polygon fill="black" stroke="black" points="20376.8,-2019.5 20386.8,-2016 20376.8,-2012.5 20376.8,-2019.5"/>
</g>
<!-- R2_Stage3_L10_Expert1&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1075" class="edge">
<title>R2_Stage3_L10_Expert1&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M19816.87,-2130.72C19816.87,-2088.88 19816.87,-2017 19816.87,-2017 19816.87,-2017 20378.15,-2017 20378.15,-2017"/>
<polygon fill="black" stroke="black" points="20378.15,-2020.5 20388.15,-2017 20378.15,-2013.5 20378.15,-2020.5"/>
</g>
<!-- R2_Stage3_L10_Expert2&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1076" class="edge">
<title>R2_Stage3_L10_Expert2&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M19998,-2130.78C19998,-2089.48 19998,-2019 19998,-2019 19998,-2019 20380.56,-2019 20380.56,-2019"/>
<polygon fill="black" stroke="black" points="20380.56,-2022.5 20390.56,-2019 20380.56,-2015.5 20380.56,-2022.5"/>
</g>
<!-- R2_Stage3_L10_Expert3&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1077" class="edge">
<title>R2_Stage3_L10_Expert3&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M20341.14,-2130.99C20341.14,-2130.99 20341.14,-1991.07 20341.14,-1991.07"/>
<polygon fill="black" stroke="black" points="20344.64,-1991.07 20341.14,-1981.07 20337.64,-1991.07 20344.64,-1991.07"/>
</g>
<!-- R2_Stage3_L10_Expert4&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1078" class="edge">
<title>R2_Stage3_L10_Expert4&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M20590,-2130.99C20590,-2130.99 20590,-2031.02 20590,-2031.02"/>
<polygon fill="black" stroke="black" points="20593.5,-2031.02 20590,-2021.02 20586.5,-2031.02 20593.5,-2031.02"/>
</g>
<!-- R2_Stage3_L10_Expert5&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1079" class="edge">
<title>R2_Stage3_L10_Expert5&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M20837.86,-2130.99C20837.86,-2130.99 20837.86,-2031.02 20837.86,-2031.02"/>
<polygon fill="black" stroke="black" points="20841.36,-2031.02 20837.86,-2021.02 20834.36,-2031.02 20841.36,-2031.02"/>
</g>
<!-- R2_Stage3_L10_Expert6&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1080" class="edge">
<title>R2_Stage3_L10_Expert6&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M21182,-2130.89C21182,-2087.01 21182,-2009 21182,-2009 21182,-2009 20914.6,-2009 20914.6,-2009"/>
<polygon fill="black" stroke="black" points="20914.6,-2005.5 20904.6,-2009 20914.6,-2012.5 20914.6,-2005.5"/>
</g>
<!-- R2_Stage3_L10_Expert7&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1081" class="edge">
<title>R2_Stage3_L10_Expert7&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M16851.67,-2130.65C16851.67,-2084.96 16851.67,-2002 16851.67,-2002 16851.67,-2002 20358.48,-2002 20358.48,-2002"/>
<polygon fill="black" stroke="black" points="20358.48,-2005.5 20368.48,-2002 20358.48,-1998.5 20358.48,-2005.5"/>
</g>
<!-- R2_Stage3_L10_Expert8&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1082" class="edge">
<title>R2_Stage3_L10_Expert8&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M17147.67,-2130.66C17147.67,-2085.47 17147.67,-2004 17147.67,-2004 17147.67,-2004 20361.12,-2004 20361.12,-2004"/>
<polygon fill="black" stroke="black" points="20361.12,-2007.5 20371.12,-2004 20361.12,-2000.5 20361.12,-2007.5"/>
</g>
<!-- R2_Stage3_L10_Expert9&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1083" class="edge">
<title>R2_Stage3_L10_Expert9&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M17443.67,-2130.85C17443.67,-2085.95 17443.67,-2005 17443.67,-2005 17443.67,-2005 20362.5,-2005 20362.5,-2005"/>
<polygon fill="black" stroke="black" points="20362.5,-2008.5 20372.5,-2005 20362.5,-2001.5 20362.5,-2008.5"/>
</g>
<!-- R2_Stage3_L10_Expert10&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1084" class="edge">
<title>R2_Stage3_L10_Expert10&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M17739.67,-2130.86C17739.67,-2086.47 17739.67,-2007 17739.67,-2007 17739.67,-2007 20365.13,-2007 20365.13,-2007"/>
<polygon fill="black" stroke="black" points="20365.13,-2010.5 20375.13,-2007 20365.13,-2003.5 20365.13,-2010.5"/>
</g>
<!-- R2_Stage3_L10_Expert11&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1085" class="edge">
<title>R2_Stage3_L10_Expert11&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M18035.67,-2130.69C18035.67,-2086.52 18035.67,-2008 18035.67,-2008 18035.67,-2008 20366.52,-2008 20366.52,-2008"/>
<polygon fill="black" stroke="black" points="20366.52,-2011.5 20376.52,-2008 20366.52,-2004.5 20366.52,-2011.5"/>
</g>
<!-- R2_Stage3_L10_Expert12&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1086" class="edge">
<title>R2_Stage3_L10_Expert12&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M18331.67,-2130.72C18331.67,-2087.07 18331.67,-2010 18331.67,-2010 18331.67,-2010 20368.92,-2010 20368.92,-2010"/>
<polygon fill="black" stroke="black" points="20368.92,-2013.5 20378.92,-2010 20368.92,-2006.5 20368.92,-2013.5"/>
</g>
<!-- R2_Stage3_L10_Expert13&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1087" class="edge">
<title>R2_Stage3_L10_Expert13&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M18627.67,-2130.92C18627.67,-2087.56 18627.67,-2011 18627.67,-2011 18627.67,-2011 20370.03,-2011 20370.03,-2011"/>
<polygon fill="black" stroke="black" points="20370.03,-2014.5 20380.03,-2011 20370.03,-2007.5 20370.03,-2014.5"/>
</g>
<!-- R2_Stage3_L10_Expert14&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1088" class="edge">
<title>R2_Stage3_L10_Expert14&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M18923.67,-2130.96C18923.67,-2088.12 18923.67,-2013 18923.67,-2013 18923.67,-2013 20372.71,-2013 20372.71,-2013"/>
<polygon fill="black" stroke="black" points="20372.71,-2016.5 20382.71,-2013 20372.71,-2009.5 20372.71,-2016.5"/>
</g>
<!-- R2_Stage3_L10_Expert15&#45;&gt;R2_Stage3_L10_MoE_Output -->
<g id="edge1089" class="edge">
<title>R2_Stage3_L10_Expert15&#45;&gt;R2_Stage3_L10_MoE_Output</title>
<path fill="none" stroke="black" d="M19219.67,-2130.81C19219.67,-2088.2 19219.67,-2014 19219.67,-2014 19219.67,-2014 20374.37,-2014 20374.37,-2014"/>
<polygon fill="black" stroke="black" points="20374.37,-2017.5 20384.37,-2014 20374.37,-2010.5 20374.37,-2017.5"/>
</g>
<!-- R2_Stage3_L10_MoE_Output&#45;&gt;R2_Stage3_L10_Output -->
<g id="edge1090" class="edge">
<title>R2_Stage3_L10_MoE_Output&#45;&gt;R2_Stage3_L10_Output</title>
<path fill="none" stroke="black" d="M20259.09,-1918C20241.58,-1918 20231,-1918 20231,-1918 20231,-1918 20231,-1795.93 20231,-1795.93"/>
<polygon fill="black" stroke="black" points="20234.5,-1795.93 20231,-1785.93 20227.5,-1795.93 20234.5,-1795.93"/>
</g>
<!-- R2_Stage3_L11_Input -->
<g id="node677" class="node">
<title>R2_Stage3_L11_Input</title>
<ellipse fill="lightblue" stroke="black" cx="15288" cy="-3087" rx="225.5" ry="29"/>
<text text-anchor="middle" x="15288" y="-3095.5" font-family="Times,serif" font-size="10.00">Layer 11 Input</text>
<text text-anchor="middle" x="15288" y="-3084.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="15288" y="-3073.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Attn_Input -->
<g id="node678" class="node">
<title>R2_Stage3_L11_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="15288" cy="-2896" rx="225.5" ry="29"/>
<text text-anchor="middle" x="15288" y="-2904.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="15288" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="15288" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Input&#45;&gt;R2_Stage3_L11_Attn_Input -->
<g id="edge1091" class="edge">
<title>R2_Stage3_L11_Input&#45;&gt;R2_Stage3_L11_Attn_Input</title>
<path fill="none" stroke="black" d="M15288,-3057.99C15288,-3057.99 15288,-2935.28 15288,-2935.28"/>
<polygon fill="black" stroke="black" points="15291.5,-2935.28 15288,-2925.28 15284.5,-2935.28 15291.5,-2935.28"/>
</g>
<!-- R2_Stage3_L11_Attn_TP1 -->
<g id="node679" class="node">
<title>R2_Stage3_L11_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="15399,-2748 15053,-2748 15053,-2690 15399,-2690 15399,-2748"/>
<text text-anchor="middle" x="15226" y="-2733" font-family="Times,serif" font-size="10.00">Attention TP GPU 96</text>
<text text-anchor="middle" x="15226" y="-2722" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="15226" y="-2711" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="15226" y="-2700" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage3_L11_Attn_Input&#45;&gt;R2_Stage3_L11_Attn_TP1 -->
<g id="edge1092" class="edge">
<title>R2_Stage3_L11_Attn_Input&#45;&gt;R2_Stage3_L11_Attn_TP1</title>
<path fill="none" stroke="black" d="M15230.75,-2867.56C15230.75,-2867.56 15230.75,-2758.25 15230.75,-2758.25"/>
<polygon fill="black" stroke="black" points="15234.25,-2758.25 15230.75,-2748.25 15227.25,-2758.25 15234.25,-2758.25"/>
</g>
<!-- R2_Stage3_L11_Attn_TP2 -->
<g id="node680" class="node">
<title>R2_Stage3_L11_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="15781,-2748 15435,-2748 15435,-2690 15781,-2690 15781,-2748"/>
<text text-anchor="middle" x="15608" y="-2733" font-family="Times,serif" font-size="10.00">Attention TP GPU 97</text>
<text text-anchor="middle" x="15608" y="-2722" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="15608" y="-2711" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="15608" y="-2700" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage3_L11_Attn_Input&#45;&gt;R2_Stage3_L11_Attn_TP2 -->
<g id="edge1093" class="edge">
<title>R2_Stage3_L11_Attn_Input&#45;&gt;R2_Stage3_L11_Attn_TP2</title>
<path fill="none" stroke="black" d="M15474.25,-2879.35C15474.25,-2879.35 15474.25,-2758.28 15474.25,-2758.28"/>
<polygon fill="black" stroke="black" points="15477.75,-2758.28 15474.25,-2748.28 15470.75,-2758.28 15477.75,-2758.28"/>
</g>
<!-- R2_Stage3_L11_Attn_Output -->
<g id="node681" class="node">
<title>R2_Stage3_L11_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="15362" cy="-2542" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="15362" y="-2556" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="15362" y="-2545" font-family="Times,serif" font-size="10.00">AllReduce GPUs 96&#45;97</text>
<text text-anchor="middle" x="15362" y="-2534" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="15362" y="-2523" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Attn_TP1&#45;&gt;R2_Stage3_L11_Attn_Output -->
<g id="edge1094" class="edge">
<title>R2_Stage3_L11_Attn_TP1&#45;&gt;R2_Stage3_L11_Attn_Output</title>
<path fill="none" stroke="black" d="M15258.88,-2689.77C15258.88,-2689.77 15258.88,-2585.5 15258.88,-2585.5"/>
<polygon fill="black" stroke="black" points="15262.38,-2585.5 15258.88,-2575.5 15255.38,-2585.5 15262.38,-2585.5"/>
</g>
<!-- R2_Stage3_L11_Attn_TP2&#45;&gt;R2_Stage3_L11_Attn_Output -->
<g id="edge1095" class="edge">
<title>R2_Stage3_L11_Attn_TP2&#45;&gt;R2_Stage3_L11_Attn_Output</title>
<path fill="none" stroke="black" d="M15520.12,-2689.77C15520.12,-2689.77 15520.12,-2580.1 15520.12,-2580.1"/>
<polygon fill="black" stroke="black" points="15523.62,-2580.1 15520.12,-2570.1 15516.62,-2580.1 15523.62,-2580.1"/>
</g>
<!-- R2_Stage3_L11_MoE_Input -->
<g id="node682" class="node">
<title>R2_Stage3_L11_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="15103" cy="-2351" rx="225.5" ry="29"/>
<text text-anchor="middle" x="15103" y="-2359.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="15103" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="15103" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Attn_Output&#45;&gt;R2_Stage3_L11_MoE_Input -->
<g id="edge1096" class="edge">
<title>R2_Stage3_L11_Attn_Output&#45;&gt;R2_Stage3_L11_MoE_Input</title>
<path fill="none" stroke="black" d="M15223.63,-2511.74C15223.63,-2511.74 15223.63,-2385.66 15223.63,-2385.66"/>
<polygon fill="black" stroke="black" points="15227.13,-2385.66 15223.63,-2375.66 15220.13,-2385.66 15227.13,-2385.66"/>
</g>
<!-- R2_Stage3_L11_Router -->
<g id="node683" class="node">
<title>R2_Stage3_L11_Router</title>
<polygon fill="lightyellow" stroke="black" points="15487.36,-2212 14974.56,-2212 14842.64,-2108 15355.44,-2108 15487.36,-2212"/>
<text text-anchor="middle" x="15165" y="-2174" font-family="Times,serif" font-size="10.00">Router GPU 96</text>
<text text-anchor="middle" x="15165" y="-2163" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="15165" y="-2152" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="15165" y="-2141" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage3_L11_MoE_Input&#45;&gt;R2_Stage3_L11_Router -->
<g id="edge1097" class="edge">
<title>R2_Stage3_L11_MoE_Input&#45;&gt;R2_Stage3_L11_Router</title>
<path fill="none" stroke="black" d="M15103,-2321.99C15103,-2321.99 15103,-2222.02 15103,-2222.02"/>
<polygon fill="black" stroke="black" points="15106.5,-2222.02 15103,-2212.02 15099.5,-2222.02 15106.5,-2222.02"/>
</g>
<!-- R2_Stage3_L11_Expert0 -->
<g id="node684" class="node">
<title>R2_Stage3_L11_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="19735,-1998 19475,-1998 19475,-1940 19735,-1940 19735,-1998"/>
<text text-anchor="middle" x="19605" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 96</text>
<text text-anchor="middle" x="19605" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19605" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert0 -->
<g id="edge1098" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15465.08,-2159.83C15465.08,-2156.37 15465.08,-2101 15465.08,-2101 15465.08,-2101 19495.33,-2101 19495.33,-2101 19495.33,-2101 19495.33,-2008.3 19495.33,-2008.3"/>
<polygon fill="black" stroke="black" points="19498.83,-2008.3 19495.33,-1998.3 19491.83,-2008.3 19498.83,-2008.3"/>
<text text-anchor="middle" x="16843.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert1 -->
<g id="node685" class="node">
<title>R2_Stage3_L11_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="15295,-1998 15035,-1998 15035,-1940 15295,-1940 15295,-1998"/>
<text text-anchor="middle" x="15165" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 97</text>
<text text-anchor="middle" x="15165" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="15165" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert1 -->
<g id="edge1099" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15165,-2107.81C15165,-2107.81 15165,-2008.01 15165,-2008.01"/>
<polygon fill="black" stroke="black" points="15168.5,-2008.01 15165,-1998.01 15161.5,-2008.01 15168.5,-2008.01"/>
<text text-anchor="middle" x="15186.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert2 -->
<g id="node686" class="node">
<title>R2_Stage3_L11_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="15887,-1998 15627,-1998 15627,-1940 15887,-1940 15887,-1998"/>
<text text-anchor="middle" x="15757" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 98</text>
<text text-anchor="middle" x="15757" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="15757" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert2 -->
<g id="edge1100" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15364.37,-2115C15520.29,-2115 15710.81,-2115 15710.81,-2115 15710.81,-2115 15710.81,-2008.19 15710.81,-2008.19"/>
<polygon fill="black" stroke="black" points="15714.31,-2008.19 15710.81,-1998.19 15707.31,-2008.19 15714.31,-2008.19"/>
<text text-anchor="middle" x="15534.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert3 -->
<g id="node687" class="node">
<title>R2_Stage3_L11_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="16183,-1998 15923,-1998 15923,-1940 16183,-1940 16183,-1998"/>
<text text-anchor="middle" x="16053" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 99</text>
<text text-anchor="middle" x="16053" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16053" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert3 -->
<g id="edge1101" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15374.5,-2123C15590.54,-2123 15896.09,-2123 15896.09,-2123 15896.09,-2123 15896.09,-1969 15896.09,-1969 15896.09,-1969 15912.71,-1969 15912.71,-1969"/>
<polygon fill="black" stroke="black" points="15912.71,-1972.5 15922.71,-1969 15912.71,-1965.5 15912.71,-1972.5"/>
<text text-anchor="middle" x="15655.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert4 -->
<g id="node688" class="node">
<title>R2_Stage3_L11_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="16479,-1998 16219,-1998 16219,-1940 16479,-1940 16479,-1998"/>
<text text-anchor="middle" x="16349" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 100</text>
<text text-anchor="middle" x="16349" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16349" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert4 -->
<g id="edge1102" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15342.17,-2107.82C15342.17,-2070.56 15342.17,-2027 15342.17,-2027 15342.17,-2027 16349,-2027 16349,-2027 16349,-2027 16349,-2008 16349,-2008"/>
<polygon fill="black" stroke="black" points="16352.5,-2008 16349,-1998 16345.5,-2008 16352.5,-2008"/>
<text text-anchor="middle" x="15757.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert5 -->
<g id="node689" class="node">
<title>R2_Stage3_L11_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="16775,-1998 16515,-1998 16515,-1940 16775,-1940 16775,-1998"/>
<text text-anchor="middle" x="16645" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 101</text>
<text text-anchor="middle" x="16645" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16645" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert5 -->
<g id="edge1103" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15353.35,-2107.98C15353.35,-2072.91 15353.35,-2033 15353.35,-2033 15353.35,-2033 16545.36,-2033 16545.36,-2033 16545.36,-2033 16545.36,-2008 16545.36,-2008"/>
<polygon fill="black" stroke="black" points="16548.86,-2008 16545.36,-1998 16541.86,-2008 16548.86,-2008"/>
<text text-anchor="middle" x="15850.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert6 -->
<g id="node690" class="node">
<title>R2_Stage3_L11_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="17071,-1998 16811,-1998 16811,-1940 17071,-1940 17071,-1998"/>
<text text-anchor="middle" x="16941" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 102</text>
<text text-anchor="middle" x="16941" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16941" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert6 -->
<g id="edge1104" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15364.52,-2114.98C15364.52,-2080.92 15364.52,-2040 15364.52,-2040 15364.52,-2040 16831.33,-2040 16831.33,-2040 16831.33,-2040 16831.33,-2008.29 16831.33,-2008.29"/>
<polygon fill="black" stroke="black" points="16834.83,-2008.29 16831.33,-1998.29 16827.83,-2008.29 16834.83,-2008.29"/>
<text text-anchor="middle" x="15939.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert7 -->
<g id="node691" class="node">
<title>R2_Stage3_L11_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="17367,-1998 17107,-1998 17107,-1940 17367,-1940 17367,-1998"/>
<text text-anchor="middle" x="17237" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 103</text>
<text text-anchor="middle" x="17237" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17237" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert7 -->
<g id="edge1105" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15375.69,-2123.93C15375.69,-2090.53 15375.69,-2046 15375.69,-2046 15375.69,-2046 17127.33,-2046 17127.33,-2046 17127.33,-2046 17127.33,-2008.11 17127.33,-2008.11"/>
<polygon fill="black" stroke="black" points="17130.83,-2008.11 17127.33,-1998.11 17123.83,-2008.11 17130.83,-2008.11"/>
<text text-anchor="middle" x="16025.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert8 -->
<g id="node692" class="node">
<title>R2_Stage3_L11_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="19143,-1998 18883,-1998 18883,-1940 19143,-1940 19143,-1998"/>
<text text-anchor="middle" x="19013" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 104</text>
<text text-anchor="middle" x="19013" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19013" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert8 -->
<g id="edge1106" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15442.74,-2159.95C15442.74,-2157.67 15442.74,-2085 15442.74,-2085 15442.74,-2085 18903.33,-2085 18903.33,-2085 18903.33,-2085 18903.33,-2008.27 18903.33,-2008.27"/>
<polygon fill="black" stroke="black" points="18906.83,-2008.27 18903.33,-1998.27 18899.83,-2008.27 18906.83,-2008.27"/>
<text text-anchor="middle" x="16675.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert9 -->
<g id="node693" class="node">
<title>R2_Stage3_L11_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="17663,-1998 17403,-1998 17403,-1940 17663,-1940 17663,-1998"/>
<text text-anchor="middle" x="17533" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 105</text>
<text text-anchor="middle" x="17533" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17533" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert9 -->
<g id="edge1107" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15386.87,-2132.72C15386.87,-2101.02 15386.87,-2053 15386.87,-2053 15386.87,-2053 17423.33,-2053 17423.33,-2053 17423.33,-2053 17423.33,-2008.38 17423.33,-2008.38"/>
<polygon fill="black" stroke="black" points="17426.83,-2008.38 17423.33,-1998.38 17419.83,-2008.38 17426.83,-2008.38"/>
<text text-anchor="middle" x="16110.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert10 -->
<g id="node694" class="node">
<title>R2_Stage3_L11_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="15591,-1998 15331,-1998 15331,-1940 15591,-1940 15591,-1998"/>
<text text-anchor="middle" x="15461" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 106</text>
<text text-anchor="middle" x="15461" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="15461" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert10 -->
<g id="edge1108" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15476.26,-2159.86C15476.26,-2159.86 15476.26,-2008.01 15476.26,-2008.01"/>
<polygon fill="black" stroke="black" points="15479.76,-2008.01 15476.26,-1998.01 15472.76,-2008.01 15479.76,-2008.01"/>
<text text-anchor="middle" x="15376.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert11 -->
<g id="node695" class="node">
<title>R2_Stage3_L11_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="17959,-1998 17699,-1998 17699,-1940 17959,-1940 17959,-1998"/>
<text text-anchor="middle" x="17829" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 107</text>
<text text-anchor="middle" x="17829" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17829" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert11 -->
<g id="edge1109" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15398.04,-2141.48C15398.04,-2112.32 15398.04,-2059 15398.04,-2059 15398.04,-2059 17719.33,-2059 17719.33,-2059 17719.33,-2059 17719.33,-2008.47 17719.33,-2008.47"/>
<polygon fill="black" stroke="black" points="17722.83,-2008.47 17719.33,-1998.47 17715.83,-2008.47 17722.83,-2008.47"/>
<text text-anchor="middle" x="16195.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert12 -->
<g id="node696" class="node">
<title>R2_Stage3_L11_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="18551,-1998 18291,-1998 18291,-1940 18551,-1940 18551,-1998"/>
<text text-anchor="middle" x="18421" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 108</text>
<text text-anchor="middle" x="18421" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18421" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert12 -->
<g id="edge1110" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15420.39,-2159.01C15420.39,-2149.34 15420.39,-2072 15420.39,-2072 15420.39,-2072 18311.33,-2072 18311.33,-2072 18311.33,-2072 18311.33,-2008.24 18311.33,-2008.24"/>
<polygon fill="black" stroke="black" points="18314.83,-2008.24 18311.33,-1998.24 18307.83,-2008.24 18314.83,-2008.24"/>
<text text-anchor="middle" x="16507.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert13 -->
<g id="node697" class="node">
<title>R2_Stage3_L11_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="18255,-1998 17995,-1998 17995,-1940 18255,-1940 18255,-1998"/>
<text text-anchor="middle" x="18125" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 109</text>
<text text-anchor="middle" x="18125" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18125" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert13 -->
<g id="edge1111" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15409.22,-2150.29C15409.22,-2126.28 15409.22,-2066 15409.22,-2066 15409.22,-2066 18015.33,-2066 18015.33,-2066 18015.33,-2066 18015.33,-2008.1 18015.33,-2008.1"/>
<polygon fill="black" stroke="black" points="18018.83,-2008.1 18015.33,-1998.1 18011.83,-2008.1 18018.83,-2008.1"/>
<text text-anchor="middle" x="16423.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert14 -->
<g id="node698" class="node">
<title>R2_Stage3_L11_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="18847,-1998 18587,-1998 18587,-1940 18847,-1940 18847,-1998"/>
<text text-anchor="middle" x="18717" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 110</text>
<text text-anchor="middle" x="18717" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18717" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert14 -->
<g id="edge1112" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15431.56,-2159.94C15431.56,-2157.49 15431.56,-2079 15431.56,-2079 15431.56,-2079 18607.33,-2079 18607.33,-2079 18607.33,-2079 18607.33,-2008.19 18607.33,-2008.19"/>
<polygon fill="black" stroke="black" points="18610.83,-2008.19 18607.33,-1998.19 18603.83,-2008.19 18610.83,-2008.19"/>
<text text-anchor="middle" x="16591.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_Expert15 -->
<g id="node699" class="node">
<title>R2_Stage3_L11_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="19439,-1998 19179,-1998 19179,-1940 19439,-1940 19439,-1998"/>
<text text-anchor="middle" x="19309" y="-1977.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 111</text>
<text text-anchor="middle" x="19309" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="19309" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert15 -->
<g id="edge1113" class="edge">
<title>R2_Stage3_L11_Router&#45;&gt;R2_Stage3_L11_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M15453.91,-2159.95C15453.91,-2157.86 15453.91,-2091 15453.91,-2091 15453.91,-2091 19199.33,-2091 19199.33,-2091 19199.33,-2091 19199.33,-2008.22 19199.33,-2008.22"/>
<polygon fill="black" stroke="black" points="19202.83,-2008.22 19199.33,-1998.22 19195.83,-2008.22 19202.83,-2008.22"/>
<text text-anchor="middle" x="16759.5" y="-2060.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L11_MoE_Output -->
<g id="node700" class="node">
<title>R2_Stage3_L11_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="19752.95,-1830 19226.48,-1830 19091.05,-1726 19617.52,-1726 19752.95,-1830"/>
<text text-anchor="middle" x="19422" y="-1792" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="19422" y="-1781" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="19422" y="-1770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="19422" y="-1759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L11_Expert0&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1114" class="edge">
<title>R2_Stage3_L11_Expert0&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M19605,-1939.99C19605,-1939.99 19605,-1840.02 19605,-1840.02"/>
<polygon fill="black" stroke="black" points="19608.5,-1840.02 19605,-1830.02 19601.5,-1840.02 19608.5,-1840.02"/>
</g>
<!-- R2_Stage3_L11_Expert1&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1115" class="edge">
<title>R2_Stage3_L11_Expert1&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M15277.67,-1939.84C15277.67,-1893.45 15277.67,-1808 15277.67,-1808 15277.67,-1808 19187.71,-1808 19187.71,-1808"/>
<polygon fill="black" stroke="black" points="19187.71,-1811.5 19197.71,-1808 19187.71,-1804.5 19187.71,-1811.5"/>
</g>
<!-- R2_Stage3_L11_Expert2&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1116" class="edge">
<title>R2_Stage3_L11_Expert2&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M15869.67,-1939.65C15869.67,-1893.96 15869.67,-1811 15869.67,-1811 15869.67,-1811 19191.46,-1811 19191.46,-1811"/>
<polygon fill="black" stroke="black" points="19191.46,-1814.5 19201.46,-1811 19191.46,-1807.5 19191.46,-1814.5"/>
</g>
<!-- R2_Stage3_L11_Expert3&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1117" class="edge">
<title>R2_Stage3_L11_Expert3&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M16165.67,-1939.66C16165.67,-1894.47 16165.67,-1813 16165.67,-1813 16165.67,-1813 19194.24,-1813 19194.24,-1813"/>
<polygon fill="black" stroke="black" points="19194.24,-1816.5 19204.24,-1813 19194.24,-1809.5 19194.24,-1816.5"/>
</g>
<!-- R2_Stage3_L11_Expert4&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1118" class="edge">
<title>R2_Stage3_L11_Expert4&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M16461.67,-1939.67C16461.67,-1894.99 16461.67,-1815 16461.67,-1815 16461.67,-1815 19196.72,-1815 19196.72,-1815"/>
<polygon fill="black" stroke="black" points="19196.72,-1818.5 19206.72,-1815 19196.72,-1811.5 19196.72,-1818.5"/>
</g>
<!-- R2_Stage3_L11_Expert5&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1119" class="edge">
<title>R2_Stage3_L11_Expert5&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M16757.67,-1939.86C16757.67,-1895.47 16757.67,-1816 16757.67,-1816 16757.67,-1816 19198.19,-1816 19198.19,-1816"/>
<polygon fill="black" stroke="black" points="19198.19,-1819.5 19208.19,-1816 19198.19,-1812.5 19198.19,-1819.5"/>
</g>
<!-- R2_Stage3_L11_Expert6&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1120" class="edge">
<title>R2_Stage3_L11_Expert6&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M17053.67,-1939.89C17053.67,-1896.01 17053.67,-1818 17053.67,-1818 17053.67,-1818 19200.79,-1818 19200.79,-1818"/>
<polygon fill="black" stroke="black" points="19200.79,-1821.5 19210.79,-1818 19200.79,-1814.5 19200.79,-1821.5"/>
</g>
<!-- R2_Stage3_L11_Expert7&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1121" class="edge">
<title>R2_Stage3_L11_Expert7&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M17349.67,-1939.92C17349.67,-1896.56 17349.67,-1820 17349.67,-1820 17349.67,-1820 19203.33,-1820 19203.33,-1820"/>
<polygon fill="black" stroke="black" points="19203.33,-1823.5 19213.33,-1820 19203.33,-1816.5 19203.33,-1823.5"/>
</g>
<!-- R2_Stage3_L11_Expert8&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1122" class="edge">
<title>R2_Stage3_L11_Expert8&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M19117.14,-1939.99C19117.14,-1939.99 19117.14,-1788.08 19117.14,-1788.08"/>
<polygon fill="black" stroke="black" points="19120.64,-1788.08 19117.14,-1778.08 19113.64,-1788.08 19120.64,-1788.08"/>
</g>
<!-- R2_Stage3_L11_Expert9&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1123" class="edge">
<title>R2_Stage3_L11_Expert9&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M17645.67,-1939.76C17645.67,-1896.63 17645.67,-1821 17645.67,-1821 17645.67,-1821 19204.76,-1821 19204.76,-1821"/>
<polygon fill="black" stroke="black" points="19204.76,-1824.5 19214.76,-1821 19204.76,-1817.5 19204.76,-1824.5"/>
</g>
<!-- R2_Stage3_L11_Expert10&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1124" class="edge">
<title>R2_Stage3_L11_Expert10&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M15573.67,-1939.84C15573.67,-1893.93 15573.67,-1810 15573.67,-1810 15573.67,-1810 19190.22,-1810 19190.22,-1810"/>
<polygon fill="black" stroke="black" points="19190.22,-1813.5 19200.22,-1810 19190.22,-1806.5 19190.22,-1813.5"/>
</g>
<!-- R2_Stage3_L11_Expert11&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1125" class="edge">
<title>R2_Stage3_L11_Expert11&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M17941.67,-1939.81C17941.67,-1897.2 17941.67,-1823 17941.67,-1823 17941.67,-1823 19207.33,-1823 19207.33,-1823"/>
<polygon fill="black" stroke="black" points="19207.33,-1826.5 19217.33,-1823 19207.33,-1819.5 19207.33,-1826.5"/>
</g>
<!-- R2_Stage3_L11_Expert12&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1126" class="edge">
<title>R2_Stage3_L11_Expert12&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M18525,-1939.72C18525,-1897.88 18525,-1826 18525,-1826 18525,-1826 19211.25,-1826 19211.25,-1826"/>
<polygon fill="black" stroke="black" points="19211.25,-1829.5 19221.25,-1826 19211.25,-1822.5 19211.25,-1829.5"/>
</g>
<!-- R2_Stage3_L11_Expert13&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1127" class="edge">
<title>R2_Stage3_L11_Expert13&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M18237.67,-1939.86C18237.67,-1897.78 18237.67,-1825 18237.67,-1825 18237.67,-1825 19209.75,-1825 19209.75,-1825"/>
<polygon fill="black" stroke="black" points="19209.75,-1828.5 19219.75,-1825 19209.75,-1821.5 19209.75,-1828.5"/>
</g>
<!-- R2_Stage3_L11_Expert14&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1128" class="edge">
<title>R2_Stage3_L11_Expert14&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M18821,-1939.78C18821,-1898.48 18821,-1828 18821,-1828 18821,-1828 19213.54,-1828 19213.54,-1828"/>
<polygon fill="black" stroke="black" points="19213.54,-1831.5 19223.54,-1828 19213.54,-1824.5 19213.54,-1831.5"/>
</g>
<!-- R2_Stage3_L11_Expert15&#45;&gt;R2_Stage3_L11_MoE_Output -->
<g id="edge1129" class="edge">
<title>R2_Stage3_L11_Expert15&#45;&gt;R2_Stage3_L11_MoE_Output</title>
<path fill="none" stroke="black" d="M19309,-1939.99C19309,-1939.99 19309,-1840.02 19309,-1840.02"/>
<polygon fill="black" stroke="black" points="19312.5,-1840.02 19309,-1830.02 19305.5,-1840.02 19312.5,-1840.02"/>
</g>
<!-- R2_Stage3_L11_MoE_Output&#45;&gt;R2_Stage3_L11_Output -->
<g id="edge1130" class="edge">
<title>R2_Stage3_L11_MoE_Output&#45;&gt;R2_Stage3_L11_Output</title>
<path fill="none" stroke="black" d="M19582.61,-1725.85C19582.61,-1725.85 19582.61,-1639.21 19582.61,-1639.21"/>
<polygon fill="black" stroke="black" points="19586.11,-1639.21 19582.61,-1629.21 19579.11,-1639.21 19586.11,-1639.21"/>
</g>
<!-- R2_Stage3_L12_Input -->
<g id="node701" class="node">
<title>R2_Stage3_L12_Input</title>
<ellipse fill="lightblue" stroke="black" cx="14728" cy="-2896" rx="225.5" ry="29"/>
<text text-anchor="middle" x="14728" y="-2904.5" font-family="Times,serif" font-size="10.00">Layer 12 Input</text>
<text text-anchor="middle" x="14728" y="-2893.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="14728" y="-2882.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Attn_Input -->
<g id="node702" class="node">
<title>R2_Stage3_L12_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="14728" cy="-2719" rx="225.5" ry="29"/>
<text text-anchor="middle" x="14728" y="-2727.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="14728" y="-2716.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="14728" y="-2705.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Input&#45;&gt;R2_Stage3_L12_Attn_Input -->
<g id="edge1131" class="edge">
<title>R2_Stage3_L12_Input&#45;&gt;R2_Stage3_L12_Attn_Input</title>
<path fill="none" stroke="black" d="M14728,-2866.77C14728,-2866.77 14728,-2758.27 14728,-2758.27"/>
<polygon fill="black" stroke="black" points="14731.5,-2758.27 14728,-2748.27 14724.5,-2758.27 14731.5,-2758.27"/>
</g>
<!-- R2_Stage3_L12_Attn_TP1 -->
<g id="node703" class="node">
<title>R2_Stage3_L12_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="14701,-2571 14355,-2571 14355,-2513 14701,-2513 14701,-2571"/>
<text text-anchor="middle" x="14528" y="-2556" font-family="Times,serif" font-size="10.00">Attention TP GPU 96</text>
<text text-anchor="middle" x="14528" y="-2545" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="14528" y="-2534" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="14528" y="-2523" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage3_L12_Attn_Input&#45;&gt;R2_Stage3_L12_Attn_TP1 -->
<g id="edge1132" class="edge">
<title>R2_Stage3_L12_Attn_Input&#45;&gt;R2_Stage3_L12_Attn_TP1</title>
<path fill="none" stroke="black" d="M14601.75,-2694.76C14601.75,-2694.76 14601.75,-2581.24 14601.75,-2581.24"/>
<polygon fill="black" stroke="black" points="14605.25,-2581.24 14601.75,-2571.24 14598.25,-2581.24 14605.25,-2581.24"/>
</g>
<!-- R2_Stage3_L12_Attn_TP2 -->
<g id="node704" class="node">
<title>R2_Stage3_L12_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="15083,-2571 14737,-2571 14737,-2513 15083,-2513 15083,-2571"/>
<text text-anchor="middle" x="14910" y="-2556" font-family="Times,serif" font-size="10.00">Attention TP GPU 97</text>
<text text-anchor="middle" x="14910" y="-2545" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="14910" y="-2534" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="14910" y="-2523" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage3_L12_Attn_Input&#45;&gt;R2_Stage3_L12_Attn_TP2 -->
<g id="edge1133" class="edge">
<title>R2_Stage3_L12_Attn_Input&#45;&gt;R2_Stage3_L12_Attn_TP2</title>
<path fill="none" stroke="black" d="M14845.25,-2694.02C14845.25,-2694.02 14845.25,-2581.27 14845.25,-2581.27"/>
<polygon fill="black" stroke="black" points="14848.75,-2581.27 14845.25,-2571.27 14841.75,-2581.27 14848.75,-2581.27"/>
</g>
<!-- R2_Stage3_L12_Attn_Output -->
<g id="node705" class="node">
<title>R2_Stage3_L12_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="14598" cy="-2351" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="14598" y="-2365" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="14598" y="-2354" font-family="Times,serif" font-size="10.00">AllReduce GPUs 96&#45;97</text>
<text text-anchor="middle" x="14598" y="-2343" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="14598" y="-2332" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Attn_TP1&#45;&gt;R2_Stage3_L12_Attn_Output -->
<g id="edge1134" class="edge">
<title>R2_Stage3_L12_Attn_TP1&#45;&gt;R2_Stage3_L12_Attn_Output</title>
<path fill="none" stroke="black" d="M14528,-2512.99C14528,-2512.99 14528,-2396.47 14528,-2396.47"/>
<polygon fill="black" stroke="black" points="14531.5,-2396.47 14528,-2386.47 14524.5,-2396.47 14531.5,-2396.47"/>
</g>
<!-- R2_Stage3_L12_Attn_TP2&#45;&gt;R2_Stage3_L12_Attn_Output -->
<g id="edge1135" class="edge">
<title>R2_Stage3_L12_Attn_TP2&#45;&gt;R2_Stage3_L12_Attn_Output</title>
<path fill="none" stroke="black" d="M14789.12,-2512.99C14789.12,-2512.99 14789.12,-2383.97 14789.12,-2383.97"/>
<polygon fill="black" stroke="black" points="14792.62,-2383.97 14789.12,-2373.97 14785.62,-2383.97 14792.62,-2383.97"/>
</g>
<!-- R2_Stage3_L12_MoE_Input -->
<g id="node706" class="node">
<title>R2_Stage3_L12_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="14581" cy="-2160" rx="225.5" ry="29"/>
<text text-anchor="middle" x="14581" y="-2168.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="14581" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="14581" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Attn_Output&#45;&gt;R2_Stage3_L12_MoE_Input -->
<g id="edge1136" class="edge">
<title>R2_Stage3_L12_Attn_Output&#45;&gt;R2_Stage3_L12_MoE_Input</title>
<path fill="none" stroke="black" d="M14581,-2314.17C14581,-2314.17 14581,-2199.22 14581,-2199.22"/>
<polygon fill="black" stroke="black" points="14584.5,-2199.22 14581,-2189.22 14577.5,-2199.22 14584.5,-2199.22"/>
</g>
<!-- R2_Stage3_L12_Router -->
<g id="node707" class="node">
<title>R2_Stage3_L12_Router</title>
<polygon fill="lightyellow" stroke="black" points="14999.36,-2021 14486.56,-2021 14354.64,-1917 14867.44,-1917 14999.36,-2021"/>
<text text-anchor="middle" x="14677" y="-1983" font-family="Times,serif" font-size="10.00">Router GPU 96</text>
<text text-anchor="middle" x="14677" y="-1972" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="14677" y="-1961" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="14677" y="-1950" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage3_L12_MoE_Input&#45;&gt;R2_Stage3_L12_Router -->
<g id="edge1137" class="edge">
<title>R2_Stage3_L12_MoE_Input&#45;&gt;R2_Stage3_L12_Router</title>
<path fill="none" stroke="black" d="M14581,-2130.99C14581,-2130.99 14581,-2031.02 14581,-2031.02"/>
<polygon fill="black" stroke="black" points="14584.5,-2031.02 14581,-2021.02 14577.5,-2031.02 14584.5,-2031.02"/>
</g>
<!-- R2_Stage3_L12_Expert0 -->
<g id="node708" class="node">
<title>R2_Stage3_L12_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="16983,-1807 16723,-1807 16723,-1749 16983,-1749 16983,-1807"/>
<text text-anchor="middle" x="16853" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 96</text>
<text text-anchor="middle" x="16853" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16853" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert0 -->
<g id="edge1138" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14882.86,-1929C15405.09,-1929 16740.33,-1929 16740.33,-1929 16740.33,-1929 16740.33,-1817.11 16740.33,-1817.11"/>
<polygon fill="black" stroke="black" points="16743.83,-1817.11 16740.33,-1807.11 16736.83,-1817.11 16743.83,-1817.11"/>
<text text-anchor="middle" x="15600.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert1 -->
<g id="node709" class="node">
<title>R2_Stage3_L12_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="17279,-1807 17019,-1807 17019,-1749 17279,-1749 17279,-1807"/>
<text text-anchor="middle" x="17149" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 97</text>
<text text-anchor="middle" x="17149" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17149" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert1 -->
<g id="edge1139" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14885.34,-1931C15461.91,-1931 17036.33,-1931 17036.33,-1931 17036.33,-1931 17036.33,-1817.14 17036.33,-1817.14"/>
<polygon fill="black" stroke="black" points="17039.83,-1817.14 17036.33,-1807.14 17032.83,-1817.14 17039.83,-1817.14"/>
<text text-anchor="middle" x="15685.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert2 -->
<g id="node710" class="node">
<title>R2_Stage3_L12_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="17575,-1807 17315,-1807 17315,-1749 17575,-1749 17575,-1807"/>
<text text-anchor="middle" x="17445" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 98</text>
<text text-anchor="middle" x="17445" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17445" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert2 -->
<g id="edge1140" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14886.75,-1932C15514.01,-1932 17332.33,-1932 17332.33,-1932 17332.33,-1932 17332.33,-1817.33 17332.33,-1817.33"/>
<polygon fill="black" stroke="black" points="17335.83,-1817.33 17332.33,-1807.33 17328.83,-1817.33 17335.83,-1817.33"/>
<text text-anchor="middle" x="15770.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert3 -->
<g id="node711" class="node">
<title>R2_Stage3_L12_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="17871,-1807 17611,-1807 17611,-1749 17871,-1749 17871,-1807"/>
<text text-anchor="middle" x="17741" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 99</text>
<text text-anchor="middle" x="17741" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="17741" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert3 -->
<g id="edge1141" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14889.25,-1934C15565.97,-1934 17628.33,-1934 17628.33,-1934 17628.33,-1934 17628.33,-1817.34 17628.33,-1817.34"/>
<polygon fill="black" stroke="black" points="17631.83,-1817.34 17628.33,-1807.34 17624.83,-1817.34 17631.83,-1817.34"/>
<text text-anchor="middle" x="15854.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert4 -->
<g id="node712" class="node">
<title>R2_Stage3_L12_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="18167,-1807 17907,-1807 17907,-1749 18167,-1749 18167,-1807"/>
<text text-anchor="middle" x="18037" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 100</text>
<text text-anchor="middle" x="18037" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18037" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert4 -->
<g id="edge1142" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14891.64,-1936C15615.85,-1936 17924.33,-1936 17924.33,-1936 17924.33,-1936 17924.33,-1817.35 17924.33,-1817.35"/>
<polygon fill="black" stroke="black" points="17927.83,-1817.35 17924.33,-1807.35 17920.83,-1817.35 17927.83,-1817.35"/>
<text text-anchor="middle" x="15938.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert5 -->
<g id="node713" class="node">
<title>R2_Stage3_L12_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="18463,-1807 18203,-1807 18203,-1749 18463,-1749 18463,-1807"/>
<text text-anchor="middle" x="18333" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 101</text>
<text text-anchor="middle" x="18333" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18333" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert5 -->
<g id="edge1143" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14894.31,-1938C15664.83,-1938 18220.33,-1938 18220.33,-1938 18220.33,-1938 18220.33,-1817.35 18220.33,-1817.35"/>
<polygon fill="black" stroke="black" points="18223.83,-1817.35 18220.33,-1807.35 18216.83,-1817.35 18223.83,-1817.35"/>
<text text-anchor="middle" x="16022.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert6 -->
<g id="node714" class="node">
<title>R2_Stage3_L12_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="18759,-1807 18499,-1807 18499,-1749 18759,-1749 18759,-1807"/>
<text text-anchor="middle" x="18629" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 102</text>
<text text-anchor="middle" x="18629" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18629" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert6 -->
<g id="edge1144" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14971.53,-1999C15878.61,-1999 18569,-1999 18569,-1999 18569,-1999 18569,-1817.35 18569,-1817.35"/>
<polygon fill="black" stroke="black" points="18572.5,-1817.35 18569,-1807.35 18565.5,-1817.35 18572.5,-1817.35"/>
<text text-anchor="middle" x="16106.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert7 -->
<g id="node715" class="node">
<title>R2_Stage3_L12_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="19055,-1807 18795,-1807 18795,-1749 19055,-1749 19055,-1807"/>
<text text-anchor="middle" x="18925" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 103</text>
<text text-anchor="middle" x="18925" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="18925" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert7 -->
<g id="edge1145" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14974,-2001C15929.91,-2001 18865,-2001 18865,-2001 18865,-2001 18865,-1817.15 18865,-1817.15"/>
<polygon fill="black" stroke="black" points="18868.5,-1817.15 18865,-1807.15 18861.5,-1817.15 18868.5,-1817.15"/>
<text text-anchor="middle" x="16190.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert8 -->
<g id="node716" class="node">
<title>R2_Stage3_L12_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="14615,-1807 14355,-1807 14355,-1749 14615,-1749 14615,-1807"/>
<text text-anchor="middle" x="14485" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 104</text>
<text text-anchor="middle" x="14485" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="14485" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert8 -->
<g id="edge1146" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14485,-1916.81C14485,-1916.81 14485,-1817.01 14485,-1817.01"/>
<polygon fill="black" stroke="black" points="14488.5,-1817.01 14485,-1807.01 14481.5,-1817.01 14488.5,-1817.01"/>
<text text-anchor="middle" x="14560.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert9 -->
<g id="node717" class="node">
<title>R2_Stage3_L12_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="14911,-1807 14651,-1807 14651,-1749 14911,-1749 14911,-1807"/>
<text text-anchor="middle" x="14781" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 105</text>
<text text-anchor="middle" x="14781" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="14781" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert9 -->
<g id="edge1147" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14781,-1916.81C14781,-1916.81 14781,-1817.01 14781,-1817.01"/>
<polygon fill="black" stroke="black" points="14784.5,-1817.01 14781,-1807.01 14777.5,-1817.01 14784.5,-1817.01"/>
<text text-anchor="middle" x="14750.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert10 -->
<g id="node718" class="node">
<title>R2_Stage3_L12_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="15207,-1807 14947,-1807 14947,-1749 15207,-1749 15207,-1807"/>
<text text-anchor="middle" x="15077" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 106</text>
<text text-anchor="middle" x="15077" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="15077" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert10 -->
<g id="edge1148" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14973.22,-1968.86C14973.22,-1968.86 14973.22,-1817.01 14973.22,-1817.01"/>
<polygon fill="black" stroke="black" points="14976.72,-1817.01 14973.22,-1807.01 14969.72,-1817.01 14976.72,-1817.01"/>
<text text-anchor="middle" x="14899.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert11 -->
<g id="node719" class="node">
<title>R2_Stage3_L12_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="15503,-1807 15243,-1807 15243,-1749 15503,-1749 15503,-1807"/>
<text text-anchor="middle" x="15373" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 107</text>
<text text-anchor="middle" x="15373" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="15373" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert11 -->
<g id="edge1149" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14871.65,-1920C15041.28,-1920 15260.33,-1920 15260.33,-1920 15260.33,-1920 15260.33,-1817.08 15260.33,-1817.08"/>
<polygon fill="black" stroke="black" points="15263.83,-1817.08 15260.33,-1807.08 15256.83,-1817.08 15263.83,-1817.08"/>
<text text-anchor="middle" x="15015.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert12 -->
<g id="node720" class="node">
<title>R2_Stage3_L12_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="15799,-1807 15539,-1807 15539,-1749 15799,-1749 15799,-1807"/>
<text text-anchor="middle" x="15669" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 108</text>
<text text-anchor="middle" x="15669" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="15669" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert12 -->
<g id="edge1150" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14873.79,-1922C15133,-1922 15556.33,-1922 15556.33,-1922 15556.33,-1922 15556.33,-1817.14 15556.33,-1817.14"/>
<polygon fill="black" stroke="black" points="15559.83,-1817.14 15556.33,-1807.14 15552.83,-1817.14 15559.83,-1817.14"/>
<text text-anchor="middle" x="15234.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert13 -->
<g id="node721" class="node">
<title>R2_Stage3_L12_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="16095,-1807 15835,-1807 15835,-1749 16095,-1749 16095,-1807"/>
<text text-anchor="middle" x="15965" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 109</text>
<text text-anchor="middle" x="15965" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="15965" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert13 -->
<g id="edge1151" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14876.38,-1924C15211.71,-1924 15852.33,-1924 15852.33,-1924 15852.33,-1924 15852.33,-1817.19 15852.33,-1817.19"/>
<polygon fill="black" stroke="black" points="15855.83,-1817.19 15852.33,-1807.19 15848.83,-1817.19 15855.83,-1817.19"/>
<text text-anchor="middle" x="15334.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert14 -->
<g id="node722" class="node">
<title>R2_Stage3_L12_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="16391,-1807 16131,-1807 16131,-1749 16391,-1749 16391,-1807"/>
<text text-anchor="middle" x="16261" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 110</text>
<text text-anchor="middle" x="16261" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16261" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert14 -->
<g id="edge1152" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14877.73,-1925C15280.36,-1925 16148.33,-1925 16148.33,-1925 16148.33,-1925 16148.33,-1817.04 16148.33,-1817.04"/>
<polygon fill="black" stroke="black" points="16151.83,-1817.04 16148.33,-1807.04 16144.83,-1817.04 16151.83,-1817.04"/>
<text text-anchor="middle" x="15426.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_Expert15 -->
<g id="node723" class="node">
<title>R2_Stage3_L12_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="16687,-1807 16427,-1807 16427,-1749 16687,-1749 16687,-1807"/>
<text text-anchor="middle" x="16557" y="-1786.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 111</text>
<text text-anchor="middle" x="16557" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="16557" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert15 -->
<g id="edge1153" class="edge">
<title>R2_Stage3_L12_Router&#45;&gt;R2_Stage3_L12_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M14880.17,-1927C15344.64,-1927 16444.33,-1927 16444.33,-1927 16444.33,-1927 16444.33,-1817.08 16444.33,-1817.08"/>
<polygon fill="black" stroke="black" points="16447.83,-1817.08 16444.33,-1807.08 16440.83,-1817.08 16447.83,-1817.08"/>
<text text-anchor="middle" x="15514.5" y="-1869.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage3_L12_MoE_Output -->
<g id="node724" class="node">
<title>R2_Stage3_L12_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="17183.95,-1653 16657.48,-1653 16522.05,-1549 17048.52,-1549 17183.95,-1653"/>
<text text-anchor="middle" x="16853" y="-1615" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="16853" y="-1604" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="16853" y="-1593" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="16853" y="-1582" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage3_L12_Expert0&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1154" class="edge">
<title>R2_Stage3_L12_Expert0&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M16853,-1748.77C16853,-1748.77 16853,-1663.18 16853,-1663.18"/>
<polygon fill="black" stroke="black" points="16856.5,-1663.18 16853,-1653.18 16849.5,-1663.18 16856.5,-1663.18"/>
</g>
<!-- R2_Stage3_L12_Expert1&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1155" class="edge">
<title>R2_Stage3_L12_Expert1&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M17101.36,-1748.77C17101.36,-1748.77 17101.36,-1663.18 17101.36,-1663.18"/>
<polygon fill="black" stroke="black" points="17104.86,-1663.18 17101.36,-1653.18 17097.86,-1663.18 17104.86,-1663.18"/>
</g>
<!-- R2_Stage3_L12_Expert2&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1156" class="edge">
<title>R2_Stage3_L12_Expert2&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M17445,-1748.86C17445,-1711.37 17445,-1651 17445,-1651 17445,-1651 17191.46,-1651 17191.46,-1651"/>
<polygon fill="black" stroke="black" points="17191.46,-1647.5 17181.46,-1651 17191.46,-1654.5 17191.46,-1647.5"/>
</g>
<!-- R2_Stage3_L12_Expert3&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1157" class="edge">
<title>R2_Stage3_L12_Expert3&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M17741,-1748.95C17741,-1711.19 17741,-1650 17741,-1650 17741,-1650 17190.19,-1650 17190.19,-1650"/>
<polygon fill="black" stroke="black" points="17190.19,-1646.5 17180.19,-1650 17190.19,-1653.5 17190.19,-1646.5"/>
</g>
<!-- R2_Stage3_L12_Expert4&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1158" class="edge">
<title>R2_Stage3_L12_Expert4&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M18037,-1748.73C18037,-1710.67 18037,-1649 18037,-1649 18037,-1649 17188.88,-1649 17188.88,-1649"/>
<polygon fill="black" stroke="black" points="17188.88,-1645.5 17178.88,-1649 17188.88,-1652.5 17188.88,-1645.5"/>
</g>
<!-- R2_Stage3_L12_Expert5&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1159" class="edge">
<title>R2_Stage3_L12_Expert5&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M18333,-1748.83C18333,-1710.5 18333,-1648 18333,-1648 18333,-1648 17187.79,-1648 17187.79,-1648"/>
<polygon fill="black" stroke="black" points="17187.79,-1644.5 17177.79,-1648 17187.79,-1651.5 17187.79,-1644.5"/>
</g>
<!-- R2_Stage3_L12_Expert6&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1160" class="edge">
<title>R2_Stage3_L12_Expert6&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M18629,-1748.93C18629,-1710.33 18629,-1647 18629,-1647 18629,-1647 17186.17,-1647 17186.17,-1647"/>
<polygon fill="black" stroke="black" points="17186.17,-1643.5 17176.17,-1647 17186.17,-1650.5 17186.17,-1643.5"/>
</g>
<!-- R2_Stage3_L12_Expert7&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1161" class="edge">
<title>R2_Stage3_L12_Expert7&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M18925,-1748.7C18925,-1709.82 18925,-1646 18925,-1646 18925,-1646 17185.04,-1646 17185.04,-1646"/>
<polygon fill="black" stroke="black" points="17185.04,-1642.5 17175.04,-1646 17185.04,-1649.5 17185.04,-1642.5"/>
</g>
<!-- R2_Stage3_L12_Expert8&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1162" class="edge">
<title>R2_Stage3_L12_Expert8&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M14485,-1748.87C14485,-1689.91 14485,-1562 14485,-1562 14485,-1562 16528.85,-1562 16528.85,-1562"/>
<polygon fill="black" stroke="black" points="16528.85,-1565.5 16538.85,-1562 16528.85,-1558.5 16528.85,-1565.5"/>
</g>
<!-- R2_Stage3_L12_Expert9&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1163" class="edge">
<title>R2_Stage3_L12_Expert9&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M14781,-1748.92C14781,-1692.78 14781,-1575 14781,-1575 14781,-1575 16545.86,-1575 16545.86,-1575"/>
<polygon fill="black" stroke="black" points="16545.86,-1578.5 16555.86,-1575 16545.86,-1571.5 16545.86,-1578.5"/>
</g>
<!-- R2_Stage3_L12_Expert10&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1164" class="edge">
<title>R2_Stage3_L12_Expert10&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M15077,-1748.73C15077,-1695.43 15077,-1588 15077,-1588 15077,-1588 16562.57,-1588 16562.57,-1588"/>
<polygon fill="black" stroke="black" points="16562.57,-1591.5 16572.57,-1588 16562.57,-1584.5 16562.57,-1591.5"/>
</g>
<!-- R2_Stage3_L12_Expert11&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1165" class="edge">
<title>R2_Stage3_L12_Expert11&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M15373,-1748.77C15373,-1698.5 15373,-1601 15373,-1601 15373,-1601 16579.69,-1601 16579.69,-1601"/>
<polygon fill="black" stroke="black" points="16579.69,-1604.5 16589.69,-1601 16579.69,-1597.5 16579.69,-1604.5"/>
</g>
<!-- R2_Stage3_L12_Expert12&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1166" class="edge">
<title>R2_Stage3_L12_Expert12&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M15669,-1748.68C15669,-1701.51 15669,-1614 15669,-1614 15669,-1614 16596.6,-1614 16596.6,-1614"/>
<polygon fill="black" stroke="black" points="16596.6,-1617.5 16606.6,-1614 16596.6,-1610.5 16596.6,-1617.5"/>
</g>
<!-- R2_Stage3_L12_Expert13&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1167" class="edge">
<title>R2_Stage3_L12_Expert13&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M15965,-1748.89C15965,-1705.01 15965,-1627 15965,-1627 15965,-1627 16613.45,-1627 16613.45,-1627"/>
<polygon fill="black" stroke="black" points="16613.45,-1630.5 16623.45,-1627 16613.45,-1623.5 16613.45,-1630.5"/>
</g>
<!-- R2_Stage3_L12_Expert14&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1168" class="edge">
<title>R2_Stage3_L12_Expert14&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M16261,-1748.73C16261,-1708.23 16261,-1640 16261,-1640 16261,-1640 16630.53,-1640 16630.53,-1640"/>
<polygon fill="black" stroke="black" points="16630.53,-1643.5 16640.53,-1640 16630.53,-1636.5 16630.53,-1643.5"/>
</g>
<!-- R2_Stage3_L12_Expert15&#45;&gt;R2_Stage3_L12_MoE_Output -->
<g id="edge1169" class="edge">
<title>R2_Stage3_L12_Expert15&#45;&gt;R2_Stage3_L12_MoE_Output</title>
<path fill="none" stroke="black" d="M16604.64,-1748.77C16604.64,-1748.77 16604.64,-1622.66 16604.64,-1622.66"/>
<polygon fill="black" stroke="black" points="16608.14,-1622.66 16604.64,-1612.66 16601.14,-1622.66 16608.14,-1622.66"/>
</g>
<!-- R2_Stage3_L12_MoE_Output&#45;&gt;R2_Stage3_L12_Output -->
<g id="edge1170" class="edge">
<title>R2_Stage3_L12_MoE_Output&#45;&gt;R2_Stage3_L12_Output</title>
<path fill="none" stroke="black" d="M17057.79,-1556C17689.08,-1556 19562.83,-1556 19562.83,-1556 19562.83,-1556 19562.83,-1461.35 19562.83,-1461.35"/>
<polygon fill="black" stroke="black" points="19566.33,-1461.35 19562.83,-1451.35 19559.33,-1461.35 19566.33,-1461.35"/>
</g>
<!-- R2_Stage4_L13_Input -->
<g id="node725" class="node">
<title>R2_Stage4_L13_Input</title>
<ellipse fill="lightblue" stroke="black" cx="24769" cy="-2351" rx="225.5" ry="29"/>
<text text-anchor="middle" x="24769" y="-2359.5" font-family="Times,serif" font-size="10.00">Layer 13 Input</text>
<text text-anchor="middle" x="24769" y="-2348.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="24769" y="-2337.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Attn_Input -->
<g id="node726" class="node">
<title>R2_Stage4_L13_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="24769" cy="-2160" rx="225.5" ry="29"/>
<text text-anchor="middle" x="24769" y="-2168.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="24769" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="24769" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Input&#45;&gt;R2_Stage4_L13_Attn_Input -->
<g id="edge1171" class="edge">
<title>R2_Stage4_L13_Input&#45;&gt;R2_Stage4_L13_Attn_Input</title>
<path fill="none" stroke="black" d="M24769,-2321.99C24769,-2321.99 24769,-2199.28 24769,-2199.28"/>
<polygon fill="black" stroke="black" points="24772.5,-2199.28 24769,-2189.28 24765.5,-2199.28 24772.5,-2199.28"/>
</g>
<!-- R2_Stage4_L13_Attn_TP1 -->
<g id="node727" class="node">
<title>R2_Stage4_L13_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="24751,-1998 24405,-1998 24405,-1940 24751,-1940 24751,-1998"/>
<text text-anchor="middle" x="24578" y="-1983" font-family="Times,serif" font-size="10.00">Attention TP GPU 112</text>
<text text-anchor="middle" x="24578" y="-1972" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="24578" y="-1961" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="24578" y="-1950" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage4_L13_Attn_Input&#45;&gt;R2_Stage4_L13_Attn_TP1 -->
<g id="edge1172" class="edge">
<title>R2_Stage4_L13_Attn_Input&#45;&gt;R2_Stage4_L13_Attn_TP1</title>
<path fill="none" stroke="black" d="M24647.25,-2135.42C24647.25,-2135.42 24647.25,-2008.17 24647.25,-2008.17"/>
<polygon fill="black" stroke="black" points="24650.75,-2008.17 24647.25,-1998.17 24643.75,-2008.17 24650.75,-2008.17"/>
</g>
<!-- R2_Stage4_L13_Attn_TP2 -->
<g id="node728" class="node">
<title>R2_Stage4_L13_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="25133,-1998 24787,-1998 24787,-1940 25133,-1940 25133,-1998"/>
<text text-anchor="middle" x="24960" y="-1983" font-family="Times,serif" font-size="10.00">Attention TP GPU 113</text>
<text text-anchor="middle" x="24960" y="-1972" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="24960" y="-1961" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="24960" y="-1950" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage4_L13_Attn_Input&#45;&gt;R2_Stage4_L13_Attn_TP2 -->
<g id="edge1173" class="edge">
<title>R2_Stage4_L13_Attn_Input&#45;&gt;R2_Stage4_L13_Attn_TP2</title>
<path fill="none" stroke="black" d="M24890.75,-2135.42C24890.75,-2135.42 24890.75,-2008.17 24890.75,-2008.17"/>
<polygon fill="black" stroke="black" points="24894.25,-2008.17 24890.75,-1998.17 24887.25,-2008.17 24894.25,-2008.17"/>
</g>
<!-- R2_Stage4_L13_Attn_Output -->
<g id="node729" class="node">
<title>R2_Stage4_L13_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="24676" cy="-1778" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="24676" y="-1792" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="24676" y="-1781" font-family="Times,serif" font-size="10.00">AllReduce GPUs 112&#45;113</text>
<text text-anchor="middle" x="24676" y="-1770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="24676" y="-1759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Attn_TP1&#45;&gt;R2_Stage4_L13_Attn_Output -->
<g id="edge1174" class="edge">
<title>R2_Stage4_L13_Attn_TP1&#45;&gt;R2_Stage4_L13_Attn_Output</title>
<path fill="none" stroke="black" d="M24591.88,-1939.99C24591.88,-1939.99 24591.88,-1822.8 24591.88,-1822.8"/>
<polygon fill="black" stroke="black" points="24595.38,-1822.8 24591.88,-1812.8 24588.38,-1822.8 24595.38,-1822.8"/>
</g>
<!-- R2_Stage4_L13_Attn_TP2&#45;&gt;R2_Stage4_L13_Attn_Output -->
<g id="edge1175" class="edge">
<title>R2_Stage4_L13_Attn_TP2&#45;&gt;R2_Stage4_L13_Attn_Output</title>
<path fill="none" stroke="black" d="M24853.12,-1939.99C24853.12,-1939.99 24853.12,-1813.31 24853.12,-1813.31"/>
<polygon fill="black" stroke="black" points="24856.62,-1813.31 24853.12,-1803.31 24849.62,-1813.31 24856.62,-1813.31"/>
</g>
<!-- R2_Stage4_L13_MoE_Input -->
<g id="node730" class="node">
<title>R2_Stage4_L13_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="24676" cy="-1601" rx="225.5" ry="29"/>
<text text-anchor="middle" x="24676" y="-1609.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="24676" y="-1598.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="24676" y="-1587.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Attn_Output&#45;&gt;R2_Stage4_L13_MoE_Input -->
<g id="edge1176" class="edge">
<title>R2_Stage4_L13_Attn_Output&#45;&gt;R2_Stage4_L13_MoE_Input</title>
<path fill="none" stroke="black" d="M24676,-1740.89C24676,-1740.89 24676,-1640.17 24676,-1640.17"/>
<polygon fill="black" stroke="black" points="24679.5,-1640.17 24676,-1630.17 24672.5,-1640.17 24679.5,-1640.17"/>
</g>
<!-- R2_Stage4_L13_Router -->
<g id="node731" class="node">
<title>R2_Stage4_L13_Router</title>
<polygon fill="lightyellow" stroke="black" points="24998.36,-1476 24485.56,-1476 24353.64,-1372 24866.44,-1372 24998.36,-1476"/>
<text text-anchor="middle" x="24676" y="-1438" font-family="Times,serif" font-size="10.00">Router GPU 112</text>
<text text-anchor="middle" x="24676" y="-1427" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="24676" y="-1416" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="24676" y="-1405" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage4_L13_MoE_Input&#45;&gt;R2_Stage4_L13_Router -->
<g id="edge1177" class="edge">
<title>R2_Stage4_L13_MoE_Input&#45;&gt;R2_Stage4_L13_Router</title>
<path fill="none" stroke="black" d="M24676,-1571.77C24676,-1571.77 24676,-1486.18 24676,-1486.18"/>
<polygon fill="black" stroke="black" points="24679.5,-1486.18 24676,-1476.18 24672.5,-1486.18 24679.5,-1486.18"/>
</g>
<!-- R2_Stage4_L13_Expert0 -->
<g id="node732" class="node">
<title>R2_Stage4_L13_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="26750,-1262 26490,-1262 26490,-1204 26750,-1204 26750,-1262"/>
<text text-anchor="middle" x="26620" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 112</text>
<text text-anchor="middle" x="26620" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="26620" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert0 -->
<g id="edge1178" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24880.83,-1383C25380.24,-1383 26620,-1383 26620,-1383 26620,-1383 26620,-1272.28 26620,-1272.28"/>
<polygon fill="black" stroke="black" points="26623.5,-1272.28 26620,-1262.28 26616.5,-1272.28 26623.5,-1272.28"/>
<text text-anchor="middle" x="26349.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert1 -->
<g id="node733" class="node">
<title>R2_Stage4_L13_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="27046,-1262 26786,-1262 26786,-1204 27046,-1204 27046,-1262"/>
<text text-anchor="middle" x="26916" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 113</text>
<text text-anchor="middle" x="26916" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="26916" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert1 -->
<g id="edge1179" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24884.22,-1386C25439.91,-1386 26916,-1386 26916,-1386 26916,-1386 26916,-1272.14 26916,-1272.14"/>
<polygon fill="black" stroke="black" points="26919.5,-1272.14 26916,-1262.14 26912.5,-1272.14 26919.5,-1272.14"/>
<text text-anchor="middle" x="26685.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert2 -->
<g id="node734" class="node">
<title>R2_Stage4_L13_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="22606,-1262 22346,-1262 22346,-1204 22606,-1204 22606,-1262"/>
<text text-anchor="middle" x="22476" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 114</text>
<text text-anchor="middle" x="22476" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="22476" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert2 -->
<g id="edge1180" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24369.95,-1385C23791.71,-1385 22596.12,-1385 22596.12,-1385 22596.12,-1385 22596.12,-1272.31 22596.12,-1272.31"/>
<polygon fill="black" stroke="black" points="22599.62,-1272.31 22596.12,-1262.31 22592.62,-1272.31 22599.62,-1272.31"/>
<text text-anchor="middle" x="22707.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert3 -->
<g id="node735" class="node">
<title>R2_Stage4_L13_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="22902,-1262 22642,-1262 22642,-1204 22902,-1204 22902,-1262"/>
<text text-anchor="middle" x="22772" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 115</text>
<text text-anchor="middle" x="22772" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="22772" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert3 -->
<g id="edge1181" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24366.25,-1382C23844.93,-1382 22848.5,-1382 22848.5,-1382 22848.5,-1382 22848.5,-1272.08 22848.5,-1272.08"/>
<polygon fill="black" stroke="black" points="22852,-1272.08 22848.5,-1262.08 22845,-1272.08 22852,-1272.08"/>
<text text-anchor="middle" x="23002.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert4 -->
<g id="node736" class="node">
<title>R2_Stage4_L13_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="23198,-1262 22938,-1262 22938,-1204 23198,-1204 23198,-1262"/>
<text text-anchor="middle" x="23068" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 116</text>
<text text-anchor="middle" x="23068" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23068" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert4 -->
<g id="edge1182" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24363.58,-1380C23895.88,-1380 23068,-1380 23068,-1380 23068,-1380 23068,-1272.04 23068,-1272.04"/>
<polygon fill="black" stroke="black" points="23071.5,-1272.04 23068,-1262.04 23064.5,-1272.04 23071.5,-1272.04"/>
<text text-anchor="middle" x="23295.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert5 -->
<g id="node737" class="node">
<title>R2_Stage4_L13_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="23494,-1262 23234,-1262 23234,-1204 23494,-1204 23494,-1262"/>
<text text-anchor="middle" x="23364" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 117</text>
<text text-anchor="middle" x="23364" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23364" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert5 -->
<g id="edge1183" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24360.91,-1378C23972.73,-1378 23364,-1378 23364,-1378 23364,-1378 23364,-1272.34 23364,-1272.34"/>
<polygon fill="black" stroke="black" points="23367.5,-1272.34 23364,-1262.34 23360.5,-1272.34 23367.5,-1272.34"/>
<text text-anchor="middle" x="23585.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert6 -->
<g id="node738" class="node">
<title>R2_Stage4_L13_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="23790,-1262 23530,-1262 23530,-1204 23790,-1204 23790,-1262"/>
<text text-anchor="middle" x="23660" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 118</text>
<text text-anchor="middle" x="23660" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23660" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert6 -->
<g id="edge1184" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24358.71,-1376C24060.6,-1376 23660,-1376 23660,-1376 23660,-1376 23660,-1272.28 23660,-1272.28"/>
<polygon fill="black" stroke="black" points="23663.5,-1272.28 23660,-1262.28 23656.5,-1272.28 23663.5,-1272.28"/>
<text text-anchor="middle" x="23870.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert7 -->
<g id="node739" class="node">
<title>R2_Stage4_L13_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="24086,-1262 23826,-1262 23826,-1204 24086,-1204 24086,-1262"/>
<text text-anchor="middle" x="23956" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 119</text>
<text text-anchor="middle" x="23956" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23956" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert7 -->
<g id="edge1185" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24356,-1374C24163.71,-1374 23956,-1374 23956,-1374 23956,-1374 23956,-1272.22 23956,-1272.22"/>
<polygon fill="black" stroke="black" points="23959.5,-1272.22 23956,-1262.22 23952.5,-1272.22 23959.5,-1272.22"/>
<text text-anchor="middle" x="24144.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert8 -->
<g id="node740" class="node">
<title>R2_Stage4_L13_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="24382,-1262 24122,-1262 24122,-1204 24382,-1204 24382,-1262"/>
<text text-anchor="middle" x="24252" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 120</text>
<text text-anchor="middle" x="24252" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24252" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert8 -->
<g id="edge1186" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24367.78,-1423.86C24367.78,-1423.86 24367.78,-1272.01 24367.78,-1272.01"/>
<polygon fill="black" stroke="black" points="24371.28,-1272.01 24367.78,-1262.01 24364.28,-1272.01 24371.28,-1272.01"/>
<text text-anchor="middle" x="24395.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert9 -->
<g id="node741" class="node">
<title>R2_Stage4_L13_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="24678,-1262 24418,-1262 24418,-1204 24678,-1204 24678,-1262"/>
<text text-anchor="middle" x="24548" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 121</text>
<text text-anchor="middle" x="24548" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24548" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert9 -->
<g id="edge1187" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24548,-1371.81C24548,-1371.81 24548,-1272.01 24548,-1272.01"/>
<polygon fill="black" stroke="black" points="24551.5,-1272.01 24548,-1262.01 24544.5,-1272.01 24551.5,-1272.01"/>
<text text-anchor="middle" x="24602.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert10 -->
<g id="node742" class="node">
<title>R2_Stage4_L13_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="24974,-1262 24714,-1262 24714,-1204 24974,-1204 24974,-1262"/>
<text text-anchor="middle" x="24844" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 122</text>
<text text-anchor="middle" x="24844" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24844" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert10 -->
<g id="edge1188" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24844,-1371.81C24844,-1371.81 24844,-1272.01 24844,-1272.01"/>
<polygon fill="black" stroke="black" points="24847.5,-1272.01 24844,-1262.01 24840.5,-1272.01 24847.5,-1272.01"/>
<text text-anchor="middle" x="24792.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert11 -->
<g id="node743" class="node">
<title>R2_Stage4_L13_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="25270,-1262 25010,-1262 25010,-1204 25270,-1204 25270,-1262"/>
<text text-anchor="middle" x="25140" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 123</text>
<text text-anchor="middle" x="25140" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25140" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert11 -->
<g id="edge1189" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24986.22,-1423.86C24986.22,-1418.08 24986.22,-1233 24986.22,-1233 24986.22,-1233 24999.91,-1233 24999.91,-1233"/>
<polygon fill="black" stroke="black" points="24999.91,-1236.5 25009.91,-1233 24999.91,-1229.5 24999.91,-1236.5"/>
<text text-anchor="middle" x="25035.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert12 -->
<g id="node744" class="node">
<title>R2_Stage4_L13_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="25566,-1262 25306,-1262 25306,-1204 25566,-1204 25566,-1262"/>
<text text-anchor="middle" x="25436" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 124</text>
<text text-anchor="middle" x="25436" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25436" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert12 -->
<g id="edge1190" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24869.25,-1374C25094.42,-1374 25436,-1374 25436,-1374 25436,-1374 25436,-1272.22 25436,-1272.22"/>
<polygon fill="black" stroke="black" points="25439.5,-1272.22 25436,-1262.22 25432.5,-1272.22 25439.5,-1272.22"/>
<text text-anchor="middle" x="25251.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert13 -->
<g id="node745" class="node">
<title>R2_Stage4_L13_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="25862,-1262 25602,-1262 25602,-1204 25862,-1204 25862,-1262"/>
<text text-anchor="middle" x="25732" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 125</text>
<text text-anchor="middle" x="25732" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25732" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert13 -->
<g id="edge1191" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24871.53,-1376C25176.79,-1376 25732,-1376 25732,-1376 25732,-1376 25732,-1272.28 25732,-1272.28"/>
<polygon fill="black" stroke="black" points="25735.5,-1272.28 25732,-1262.28 25728.5,-1272.28 25735.5,-1272.28"/>
<text text-anchor="middle" x="25401.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert14 -->
<g id="node746" class="node">
<title>R2_Stage4_L13_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="26158,-1262 25898,-1262 25898,-1204 26158,-1204 26158,-1262"/>
<text text-anchor="middle" x="26028" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 126</text>
<text text-anchor="middle" x="26028" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="26028" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert14 -->
<g id="edge1192" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24875.49,-1379C25251.57,-1379 26028,-1379 26028,-1379 26028,-1379 26028,-1272.19 26028,-1272.19"/>
<polygon fill="black" stroke="black" points="26031.5,-1272.19 26028,-1262.19 26024.5,-1272.19 26031.5,-1272.19"/>
<text text-anchor="middle" x="25519.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_Expert15 -->
<g id="node747" class="node">
<title>R2_Stage4_L13_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="26454,-1262 26194,-1262 26194,-1204 26454,-1204 26454,-1262"/>
<text text-anchor="middle" x="26324" y="-1241.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 127</text>
<text text-anchor="middle" x="26324" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="26324" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert15 -->
<g id="edge1193" class="edge">
<title>R2_Stage4_L13_Router&#45;&gt;R2_Stage4_L13_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M24878.08,-1381C25318.14,-1381 26324,-1381 26324,-1381 26324,-1381 26324,-1272.24 26324,-1272.24"/>
<polygon fill="black" stroke="black" points="26327.5,-1272.24 26324,-1262.24 26320.5,-1272.24 26327.5,-1272.24"/>
<text text-anchor="middle" x="25974.5" y="-1324.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L13_MoE_Output -->
<g id="node748" class="node">
<title>R2_Stage4_L13_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="23556.95,-1094 23030.48,-1094 22895.05,-990 23421.52,-990 23556.95,-1094"/>
<text text-anchor="middle" x="23226" y="-1056" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="23226" y="-1045" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="23226" y="-1034" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="23226" y="-1023" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L13_Expert0&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1194" class="edge">
<title>R2_Stage4_L13_Expert0&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M26499,-1203.84C26499,-1157.93 26499,-1074 26499,-1074 26499,-1074 23540.98,-1074 23540.98,-1074"/>
<polygon fill="black" stroke="black" points="23540.98,-1070.5 23530.98,-1074 23540.98,-1077.5 23540.98,-1070.5"/>
</g>
<!-- R2_Stage4_L13_Expert1&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1195" class="edge">
<title>R2_Stage4_L13_Expert1&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M26795,-1203.84C26795,-1157.45 26795,-1072 26795,-1072 26795,-1072 23538.37,-1072 23538.37,-1072"/>
<polygon fill="black" stroke="black" points="23538.37,-1068.5 23528.37,-1072 23538.37,-1075.5 23538.37,-1068.5"/>
</g>
<!-- R2_Stage4_L13_Expert2&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1196" class="edge">
<title>R2_Stage4_L13_Expert2&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M22555.28,-1203.96C22555.28,-1161.12 22555.28,-1086 22555.28,-1086 22555.28,-1086 23009.75,-1086 23009.75,-1086"/>
<polygon fill="black" stroke="black" points="23009.75,-1089.5 23019.75,-1086 23009.75,-1082.5 23009.75,-1089.5"/>
</g>
<!-- R2_Stage4_L13_Expert3&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1197" class="edge">
<title>R2_Stage4_L13_Expert3&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M22886.18,-1203.85C22886.18,-1158.95 22886.18,-1078 22886.18,-1078 22886.18,-1078 22999.35,-1078 22999.35,-1078"/>
<polygon fill="black" stroke="black" points="22999.35,-1081.5 23009.35,-1078 22999.35,-1074.5 22999.35,-1081.5"/>
</g>
<!-- R2_Stage4_L13_Expert4&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1198" class="edge">
<title>R2_Stage4_L13_Expert4&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M23068,-1203.99C23068,-1203.99 23068,-1104.02 23068,-1104.02"/>
<polygon fill="black" stroke="black" points="23071.5,-1104.02 23068,-1094.02 23064.5,-1104.02 23071.5,-1104.02"/>
</g>
<!-- R2_Stage4_L13_Expert5&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1199" class="edge">
<title>R2_Stage4_L13_Expert5&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M23364,-1203.99C23364,-1203.99 23364,-1104.02 23364,-1104.02"/>
<polygon fill="black" stroke="black" points="23367.5,-1104.02 23364,-1094.02 23360.5,-1104.02 23367.5,-1104.02"/>
</g>
<!-- R2_Stage4_L13_Expert6&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1200" class="edge">
<title>R2_Stage4_L13_Expert6&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M23543.36,-1203.99C23543.36,-1203.99 23543.36,-1052.08 23543.36,-1052.08"/>
<polygon fill="black" stroke="black" points="23546.86,-1052.08 23543.36,-1042.08 23539.86,-1052.08 23546.86,-1052.08"/>
</g>
<!-- R2_Stage4_L13_Expert7&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1201" class="edge">
<title>R2_Stage4_L13_Expert7&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M23839.5,-1203.78C23839.5,-1162.48 23839.5,-1092 23839.5,-1092 23839.5,-1092 23564.75,-1092 23564.75,-1092"/>
<polygon fill="black" stroke="black" points="23564.75,-1088.5 23554.75,-1092 23564.75,-1095.5 23564.75,-1088.5"/>
</g>
<!-- R2_Stage4_L13_Expert8&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1202" class="edge">
<title>R2_Stage4_L13_Expert8&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M24131,-1203.72C24131,-1161.88 24131,-1090 24131,-1090 24131,-1090 23561.77,-1090 23561.77,-1090"/>
<polygon fill="black" stroke="black" points="23561.77,-1086.5 23551.77,-1090 23561.77,-1093.5 23561.77,-1086.5"/>
</g>
<!-- R2_Stage4_L13_Expert9&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1203" class="edge">
<title>R2_Stage4_L13_Expert9&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M24427,-1203.66C24427,-1161.29 24427,-1088 24427,-1088 24427,-1088 23559.43,-1088 23559.43,-1088"/>
<polygon fill="black" stroke="black" points="23559.43,-1084.5 23549.43,-1088 23559.43,-1091.5 23559.43,-1084.5"/>
</g>
<!-- R2_Stage4_L13_Expert10&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1204" class="edge">
<title>R2_Stage4_L13_Expert10&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M24723,-1203.96C24723,-1161.12 24723,-1086 24723,-1086 24723,-1086 23556.68,-1086 23556.68,-1086"/>
<polygon fill="black" stroke="black" points="23556.68,-1082.5 23546.68,-1086 23556.68,-1089.5 23556.68,-1082.5"/>
</g>
<!-- R2_Stage4_L13_Expert11&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1205" class="edge">
<title>R2_Stage4_L13_Expert11&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M25019,-1203.92C25019,-1160.56 25019,-1084 25019,-1084 25019,-1084 23553.97,-1084 23553.97,-1084"/>
<polygon fill="black" stroke="black" points="23553.97,-1080.5 23543.97,-1084 23553.97,-1087.5 23553.97,-1080.5"/>
</g>
<!-- R2_Stage4_L13_Expert12&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1206" class="edge">
<title>R2_Stage4_L13_Expert12&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M25315,-1203.89C25315,-1160.01 25315,-1082 25315,-1082 25315,-1082 23551.57,-1082 23551.57,-1082"/>
<polygon fill="black" stroke="black" points="23551.57,-1078.5 23541.57,-1082 23551.57,-1085.5 23551.57,-1078.5"/>
</g>
<!-- R2_Stage4_L13_Expert13&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1207" class="edge">
<title>R2_Stage4_L13_Expert13&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M25611,-1203.86C25611,-1159.47 25611,-1080 25611,-1080 25611,-1080 23549.02,-1080 23549.02,-1080"/>
<polygon fill="black" stroke="black" points="23549.02,-1076.5 23539.02,-1080 23549.02,-1083.5 23549.02,-1076.5"/>
</g>
<!-- R2_Stage4_L13_Expert14&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1208" class="edge">
<title>R2_Stage4_L13_Expert14&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M25907,-1203.85C25907,-1158.95 25907,-1078 25907,-1078 25907,-1078 23546.16,-1078 23546.16,-1078"/>
<polygon fill="black" stroke="black" points="23546.16,-1074.5 23536.16,-1078 23546.16,-1081.5 23546.16,-1074.5"/>
</g>
<!-- R2_Stage4_L13_Expert15&#45;&gt;R2_Stage4_L13_MoE_Output -->
<g id="edge1209" class="edge">
<title>R2_Stage4_L13_Expert15&#45;&gt;R2_Stage4_L13_MoE_Output</title>
<path fill="none" stroke="black" d="M26203,-1203.84C26203,-1158.43 26203,-1076 26203,-1076 26203,-1076 23543.73,-1076 23543.73,-1076"/>
<polygon fill="black" stroke="black" points="23543.73,-1072.5 23533.73,-1076 23543.73,-1079.5 23543.73,-1072.5"/>
</g>
<!-- R2_Stage4_L13_MoE_Output&#45;&gt;R2_Stage4_L13_Output -->
<g id="edge1210" class="edge">
<title>R2_Stage4_L13_MoE_Output&#45;&gt;R2_Stage4_L13_Output</title>
<path fill="none" stroke="black" d="M23435.87,-1001C24199.1,-1001 26782.75,-1001 26782.75,-1001 26782.75,-1001 26782.75,-875.66 26782.75,-875.66"/>
<polygon fill="black" stroke="black" points="26786.25,-875.66 26782.75,-865.66 26779.25,-875.66 26786.25,-875.66"/>
</g>
<!-- R2_Stage4_L14_Input -->
<g id="node749" class="node">
<title>R2_Stage4_L14_Input</title>
<ellipse fill="lightblue" stroke="black" cx="27497" cy="-2160" rx="225.5" ry="29"/>
<text text-anchor="middle" x="27497" y="-2168.5" font-family="Times,serif" font-size="10.00">Layer 14 Input</text>
<text text-anchor="middle" x="27497" y="-2157.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="27497" y="-2146.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Attn_Input -->
<g id="node750" class="node">
<title>R2_Stage4_L14_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="27497" cy="-1969" rx="225.5" ry="29"/>
<text text-anchor="middle" x="27497" y="-1977.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="27497" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="27497" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Input&#45;&gt;R2_Stage4_L14_Attn_Input -->
<g id="edge1211" class="edge">
<title>R2_Stage4_L14_Input&#45;&gt;R2_Stage4_L14_Attn_Input</title>
<path fill="none" stroke="black" d="M27497,-2130.99C27497,-2130.99 27497,-2008.28 27497,-2008.28"/>
<polygon fill="black" stroke="black" points="27500.5,-2008.28 27497,-1998.28 27493.5,-2008.28 27500.5,-2008.28"/>
</g>
<!-- R2_Stage4_L14_Attn_TP1 -->
<g id="node751" class="node">
<title>R2_Stage4_L14_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="27861,-1807 27515,-1807 27515,-1749 27861,-1749 27861,-1807"/>
<text text-anchor="middle" x="27688" y="-1792" font-family="Times,serif" font-size="10.00">Attention TP GPU 112</text>
<text text-anchor="middle" x="27688" y="-1781" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="27688" y="-1770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="27688" y="-1759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage4_L14_Attn_Input&#45;&gt;R2_Stage4_L14_Attn_TP1 -->
<g id="edge1212" class="edge">
<title>R2_Stage4_L14_Attn_Input&#45;&gt;R2_Stage4_L14_Attn_TP1</title>
<path fill="none" stroke="black" d="M27618.75,-1944.42C27618.75,-1944.42 27618.75,-1817.17 27618.75,-1817.17"/>
<polygon fill="black" stroke="black" points="27622.25,-1817.17 27618.75,-1807.17 27615.25,-1817.17 27622.25,-1817.17"/>
</g>
<!-- R2_Stage4_L14_Attn_TP2 -->
<g id="node752" class="node">
<title>R2_Stage4_L14_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="27479,-1807 27133,-1807 27133,-1749 27479,-1749 27479,-1807"/>
<text text-anchor="middle" x="27306" y="-1792" font-family="Times,serif" font-size="10.00">Attention TP GPU 113</text>
<text text-anchor="middle" x="27306" y="-1781" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="27306" y="-1770" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="27306" y="-1759" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage4_L14_Attn_Input&#45;&gt;R2_Stage4_L14_Attn_TP2 -->
<g id="edge1213" class="edge">
<title>R2_Stage4_L14_Attn_Input&#45;&gt;R2_Stage4_L14_Attn_TP2</title>
<path fill="none" stroke="black" d="M27375.25,-1944.42C27375.25,-1944.42 27375.25,-1817.17 27375.25,-1817.17"/>
<polygon fill="black" stroke="black" points="27378.75,-1817.17 27375.25,-1807.17 27371.75,-1817.17 27378.75,-1817.17"/>
</g>
<!-- R2_Stage4_L14_Attn_Output -->
<g id="node753" class="node">
<title>R2_Stage4_L14_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="27404" cy="-1601" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="27404" y="-1615" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="27404" y="-1604" font-family="Times,serif" font-size="10.00">AllReduce GPUs 112&#45;113</text>
<text text-anchor="middle" x="27404" y="-1593" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="27404" y="-1582" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Attn_TP1&#45;&gt;R2_Stage4_L14_Attn_Output -->
<g id="edge1214" class="edge">
<title>R2_Stage4_L14_Attn_TP1&#45;&gt;R2_Stage4_L14_Attn_Output</title>
<path fill="none" stroke="black" d="M27581.12,-1748.77C27581.12,-1748.77 27581.12,-1636.25 27581.12,-1636.25"/>
<polygon fill="black" stroke="black" points="27584.62,-1636.25 27581.12,-1626.25 27577.62,-1636.25 27584.62,-1636.25"/>
</g>
<!-- R2_Stage4_L14_Attn_TP2&#45;&gt;R2_Stage4_L14_Attn_Output -->
<g id="edge1215" class="edge">
<title>R2_Stage4_L14_Attn_TP2&#45;&gt;R2_Stage4_L14_Attn_Output</title>
<path fill="none" stroke="black" d="M27319.88,-1748.77C27319.88,-1748.77 27319.88,-1645.75 27319.88,-1645.75"/>
<polygon fill="black" stroke="black" points="27323.38,-1645.75 27319.88,-1635.75 27316.38,-1645.75 27323.38,-1645.75"/>
</g>
<!-- R2_Stage4_L14_MoE_Input -->
<g id="node754" class="node">
<title>R2_Stage4_L14_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="27404" cy="-1424" rx="225.5" ry="29"/>
<text text-anchor="middle" x="27404" y="-1432.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="27404" y="-1421.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="27404" y="-1410.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Attn_Output&#45;&gt;R2_Stage4_L14_MoE_Input -->
<g id="edge1216" class="edge">
<title>R2_Stage4_L14_Attn_Output&#45;&gt;R2_Stage4_L14_MoE_Input</title>
<path fill="none" stroke="black" d="M27404,-1563.89C27404,-1563.89 27404,-1463.17 27404,-1463.17"/>
<polygon fill="black" stroke="black" points="27407.5,-1463.17 27404,-1453.17 27400.5,-1463.17 27407.5,-1463.17"/>
</g>
<!-- R2_Stage4_L14_Router -->
<g id="node755" class="node">
<title>R2_Stage4_L14_Router</title>
<polygon fill="lightyellow" stroke="black" points="27726.36,-1285 27213.56,-1285 27081.64,-1181 27594.44,-1181 27726.36,-1285"/>
<text text-anchor="middle" x="27404" y="-1247" font-family="Times,serif" font-size="10.00">Router GPU 112</text>
<text text-anchor="middle" x="27404" y="-1236" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="27404" y="-1225" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="27404" y="-1214" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage4_L14_MoE_Input&#45;&gt;R2_Stage4_L14_Router -->
<g id="edge1217" class="edge">
<title>R2_Stage4_L14_MoE_Input&#45;&gt;R2_Stage4_L14_Router</title>
<path fill="none" stroke="black" d="M27404,-1394.99C27404,-1394.99 27404,-1295.02 27404,-1295.02"/>
<polygon fill="black" stroke="black" points="27407.5,-1295.02 27404,-1285.02 27400.5,-1295.02 27407.5,-1295.02"/>
</g>
<!-- R2_Stage4_L14_Expert0 -->
<g id="node756" class="node">
<title>R2_Stage4_L14_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="26517,-1071 26257,-1071 26257,-1013 26517,-1013 26517,-1071"/>
<text text-anchor="middle" x="26387" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 112</text>
<text text-anchor="middle" x="26387" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="26387" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert0 -->
<g id="edge1218" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27085.27,-1184C26827.78,-1184 26508,-1184 26508,-1184 26508,-1184 26508,-1081.08 26508,-1081.08"/>
<polygon fill="black" stroke="black" points="26511.5,-1081.08 26508,-1071.08 26504.5,-1081.08 26511.5,-1081.08"/>
<text text-anchor="middle" x="26596.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert1 -->
<g id="node757" class="node">
<title>R2_Stage4_L14_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="26813,-1071 26553,-1071 26553,-1013 26813,-1013 26813,-1071"/>
<text text-anchor="middle" x="26683" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 113</text>
<text text-anchor="middle" x="26683" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="26683" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert1 -->
<g id="edge1219" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27082.48,-1182C26939.99,-1182 26804,-1182 26804,-1182 26804,-1182 26804,-1081.01 26804,-1081.01"/>
<polygon fill="black" stroke="black" points="26807.5,-1081.01 26804,-1071.01 26800.5,-1081.01 26807.5,-1081.01"/>
<text text-anchor="middle" x="26868.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert2 -->
<g id="node758" class="node">
<title>R2_Stage4_L14_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="27109,-1071 26849,-1071 26849,-1013 27109,-1013 27109,-1071"/>
<text text-anchor="middle" x="26979" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 114</text>
<text text-anchor="middle" x="26979" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="26979" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert2 -->
<g id="edge1220" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27095.28,-1232.86C27095.28,-1232.86 27095.28,-1081.01 27095.28,-1081.01"/>
<polygon fill="black" stroke="black" points="27098.78,-1081.01 27095.28,-1071.01 27091.78,-1081.01 27098.78,-1081.01"/>
<text text-anchor="middle" x="27117.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert3 -->
<g id="node759" class="node">
<title>R2_Stage4_L14_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="27405,-1071 27145,-1071 27145,-1013 27405,-1013 27405,-1071"/>
<text text-anchor="middle" x="27275" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 115</text>
<text text-anchor="middle" x="27275" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="27275" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert3 -->
<g id="edge1221" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27275,-1180.81C27275,-1180.81 27275,-1081.01 27275,-1081.01"/>
<polygon fill="black" stroke="black" points="27278.5,-1081.01 27275,-1071.01 27271.5,-1081.01 27278.5,-1081.01"/>
<text text-anchor="middle" x="27318.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert4 -->
<g id="node760" class="node">
<title>R2_Stage4_L14_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="27701,-1071 27441,-1071 27441,-1013 27701,-1013 27701,-1071"/>
<text text-anchor="middle" x="27571" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 116</text>
<text text-anchor="middle" x="27571" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="27571" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert4 -->
<g id="edge1222" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27571,-1180.81C27571,-1180.81 27571,-1081.01 27571,-1081.01"/>
<polygon fill="black" stroke="black" points="27574.5,-1081.01 27571,-1071.01 27567.5,-1081.01 27574.5,-1081.01"/>
<text text-anchor="middle" x="27508.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert5 -->
<g id="node761" class="node">
<title>R2_Stage4_L14_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="27997,-1071 27737,-1071 27737,-1013 27997,-1013 27997,-1071"/>
<text text-anchor="middle" x="27867" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 117</text>
<text text-anchor="middle" x="27867" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="27867" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert5 -->
<g id="edge1223" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27713.72,-1232.86C27713.72,-1227.08 27713.72,-1042 27713.72,-1042 27713.72,-1042 27727,-1042 27727,-1042"/>
<polygon fill="black" stroke="black" points="27727,-1045.5 27737,-1042 27727,-1038.5 27727,-1045.5"/>
<text text-anchor="middle" x="27781.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert6 -->
<g id="node762" class="node">
<title>R2_Stage4_L14_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="28293,-1071 28033,-1071 28033,-1013 28293,-1013 28293,-1071"/>
<text text-anchor="middle" x="28163" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 118</text>
<text text-anchor="middle" x="28163" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="28163" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert6 -->
<g id="edge1224" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27598.48,-1184C27823.36,-1184 28163,-1184 28163,-1184 28163,-1184 28163,-1081.08 28163,-1081.08"/>
<polygon fill="black" stroke="black" points="28166.5,-1081.08 28163,-1071.08 28159.5,-1081.08 28166.5,-1081.08"/>
<text text-anchor="middle" x="28066.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert7 -->
<g id="node763" class="node">
<title>R2_Stage4_L14_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="23853,-1071 23593,-1071 23593,-1013 23853,-1013 23853,-1071"/>
<text text-anchor="middle" x="23723" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 119</text>
<text text-anchor="middle" x="23723" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23723" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert7 -->
<g id="edge1225" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27188.16,-1265C26411.93,-1265 23808,-1265 23808,-1265 23808,-1265 23808,-1081.15 23808,-1081.15"/>
<polygon fill="black" stroke="black" points="23811.5,-1081.15 23808,-1071.15 23804.5,-1081.15 23811.5,-1081.15"/>
<text text-anchor="middle" x="23955.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert8 -->
<g id="node764" class="node">
<title>R2_Stage4_L14_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="24149,-1071 23889,-1071 23889,-1013 24149,-1013 24149,-1071"/>
<text text-anchor="middle" x="24019" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 120</text>
<text text-anchor="middle" x="24019" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24019" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert8 -->
<g id="edge1226" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27108.22,-1202C26304.47,-1202 24140,-1202 24140,-1202 24140,-1202 24140,-1081.35 24140,-1081.35"/>
<polygon fill="black" stroke="black" points="24143.5,-1081.35 24140,-1071.35 24136.5,-1081.35 24143.5,-1081.35"/>
<text text-anchor="middle" x="24251.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert9 -->
<g id="node765" class="node">
<title>R2_Stage4_L14_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="24445,-1071 24185,-1071 24185,-1013 24445,-1013 24445,-1071"/>
<text text-anchor="middle" x="24315" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 121</text>
<text text-anchor="middle" x="24315" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24315" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert9 -->
<g id="edge1227" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27105.48,-1200C26352.6,-1200 24436,-1200 24436,-1200 24436,-1200 24436,-1081.35 24436,-1081.35"/>
<polygon fill="black" stroke="black" points="24439.5,-1081.35 24436,-1071.35 24432.5,-1081.35 24439.5,-1081.35"/>
<text text-anchor="middle" x="24546.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert10 -->
<g id="node766" class="node">
<title>R2_Stage4_L14_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="24741,-1071 24481,-1071 24481,-1013 24741,-1013 24741,-1071"/>
<text text-anchor="middle" x="24611" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 122</text>
<text text-anchor="middle" x="24611" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24611" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert10 -->
<g id="edge1228" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27103.01,-1198C26404.4,-1198 24732,-1198 24732,-1198 24732,-1198 24732,-1081.34 24732,-1081.34"/>
<polygon fill="black" stroke="black" points="24735.5,-1081.34 24732,-1071.34 24728.5,-1081.34 24735.5,-1081.34"/>
<text text-anchor="middle" x="24840.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert11 -->
<g id="node767" class="node">
<title>R2_Stage4_L14_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="25037,-1071 24777,-1071 24777,-1013 25037,-1013 25037,-1071"/>
<text text-anchor="middle" x="24907" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 123</text>
<text text-anchor="middle" x="24907" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24907" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert11 -->
<g id="edge1229" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27097.94,-1194C26456.07,-1194 25028,-1194 25028,-1194 25028,-1194 25028,-1081.31 25028,-1081.31"/>
<polygon fill="black" stroke="black" points="25031.5,-1081.31 25028,-1071.31 25024.5,-1081.31 25031.5,-1081.31"/>
<text text-anchor="middle" x="25133.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert12 -->
<g id="node768" class="node">
<title>R2_Stage4_L14_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="25333,-1071 25073,-1071 25073,-1013 25333,-1013 25333,-1071"/>
<text text-anchor="middle" x="25203" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 124</text>
<text text-anchor="middle" x="25203" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25203" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert12 -->
<g id="edge1230" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27095.41,-1192C26516.19,-1192 25324,-1192 25324,-1192 25324,-1192 25324,-1081.28 25324,-1081.28"/>
<polygon fill="black" stroke="black" points="25327.5,-1081.28 25324,-1071.28 25320.5,-1081.28 25327.5,-1081.28"/>
<text text-anchor="middle" x="25422.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert13 -->
<g id="node769" class="node">
<title>R2_Stage4_L14_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="25629,-1071 25369,-1071 25369,-1013 25629,-1013 25629,-1071"/>
<text text-anchor="middle" x="25499" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 125</text>
<text text-anchor="middle" x="25499" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25499" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert13 -->
<g id="edge1231" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27093,-1190C26581.8,-1190 25620,-1190 25620,-1190 25620,-1190 25620,-1081.24 25620,-1081.24"/>
<polygon fill="black" stroke="black" points="25623.5,-1081.24 25620,-1071.24 25616.5,-1081.24 25623.5,-1081.24"/>
<text text-anchor="middle" x="25705.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert14 -->
<g id="node770" class="node">
<title>R2_Stage4_L14_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="25925,-1071 25665,-1071 25665,-1013 25925,-1013 25925,-1071"/>
<text text-anchor="middle" x="25795" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 126</text>
<text text-anchor="middle" x="25795" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25795" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert14 -->
<g id="edge1232" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27090.25,-1188C26653.69,-1188 25916,-1188 25916,-1188 25916,-1188 25916,-1081.19 25916,-1081.19"/>
<polygon fill="black" stroke="black" points="25919.5,-1081.19 25916,-1071.19 25912.5,-1081.19 25919.5,-1081.19"/>
<text text-anchor="middle" x="25975.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_Expert15 -->
<g id="node771" class="node">
<title>R2_Stage4_L14_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="26221,-1071 25961,-1071 25961,-1013 26221,-1013 26221,-1071"/>
<text text-anchor="middle" x="26091" y="-1050.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 127</text>
<text text-anchor="middle" x="26091" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="26091" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert15 -->
<g id="edge1233" class="edge">
<title>R2_Stage4_L14_Router&#45;&gt;R2_Stage4_L14_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M27087.7,-1186C26734.56,-1186 26212,-1186 26212,-1186 26212,-1186 26212,-1081.14 26212,-1081.14"/>
<polygon fill="black" stroke="black" points="26215.5,-1081.14 26212,-1071.14 26208.5,-1081.14 26215.5,-1081.14"/>
<text text-anchor="middle" x="26218.5" y="-1133.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L14_MoE_Output -->
<g id="node772" class="node">
<title>R2_Stage4_L14_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="27900.95,-903 27374.48,-903 27239.05,-799 27765.52,-799 27900.95,-903"/>
<text text-anchor="middle" x="27570" y="-865" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="27570" y="-854" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="27570" y="-843" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="27570" y="-832" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L14_Expert0&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1234" class="edge">
<title>R2_Stage4_L14_Expert0&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M26496.67,-1012.86C26496.67,-970.78 26496.67,-898 26496.67,-898 26496.67,-898 27357.8,-898 27357.8,-898"/>
<polygon fill="black" stroke="black" points="27357.8,-901.5 27367.8,-898 27357.8,-894.5 27357.8,-901.5"/>
</g>
<!-- R2_Stage4_L14_Expert1&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1235" class="edge">
<title>R2_Stage4_L14_Expert1&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M26797.87,-1012.72C26797.87,-970.88 26797.87,-899 26797.87,-899 26797.87,-899 27359.15,-899 27359.15,-899"/>
<polygon fill="black" stroke="black" points="27359.15,-902.5 27369.15,-899 27359.15,-895.5 27359.15,-902.5"/>
</g>
<!-- R2_Stage4_L14_Expert2&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1236" class="edge">
<title>R2_Stage4_L14_Expert2&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M26979,-1012.78C26979,-971.48 26979,-901 26979,-901 26979,-901 27361.56,-901 27361.56,-901"/>
<polygon fill="black" stroke="black" points="27361.56,-904.5 27371.56,-901 27361.56,-897.5 27361.56,-904.5"/>
</g>
<!-- R2_Stage4_L14_Expert3&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1237" class="edge">
<title>R2_Stage4_L14_Expert3&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M27322.14,-1012.99C27322.14,-1012.99 27322.14,-873.07 27322.14,-873.07"/>
<polygon fill="black" stroke="black" points="27325.64,-873.07 27322.14,-863.07 27318.64,-873.07 27325.64,-873.07"/>
</g>
<!-- R2_Stage4_L14_Expert4&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1238" class="edge">
<title>R2_Stage4_L14_Expert4&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M27571,-1012.99C27571,-1012.99 27571,-913.02 27571,-913.02"/>
<polygon fill="black" stroke="black" points="27574.5,-913.02 27571,-903.02 27567.5,-913.02 27574.5,-913.02"/>
</g>
<!-- R2_Stage4_L14_Expert5&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1239" class="edge">
<title>R2_Stage4_L14_Expert5&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M27818.86,-1012.99C27818.86,-1012.99 27818.86,-913.02 27818.86,-913.02"/>
<polygon fill="black" stroke="black" points="27822.36,-913.02 27818.86,-903.02 27815.36,-913.02 27822.36,-913.02"/>
</g>
<!-- R2_Stage4_L14_Expert6&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1240" class="edge">
<title>R2_Stage4_L14_Expert6&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M28163,-1012.99C28163,-959.56 28163,-851 28163,-851 28163,-851 27843.55,-851 27843.55,-851"/>
<polygon fill="black" stroke="black" points="27843.55,-847.5 27833.55,-851 27843.55,-854.5 27843.55,-847.5"/>
</g>
<!-- R2_Stage4_L14_Expert7&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1241" class="edge">
<title>R2_Stage4_L14_Expert7&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M23832.67,-1012.65C23832.67,-966.96 23832.67,-884 23832.67,-884 23832.67,-884 27339.48,-884 27339.48,-884"/>
<polygon fill="black" stroke="black" points="27339.48,-887.5 27349.48,-884 27339.48,-880.5 27339.48,-887.5"/>
</g>
<!-- R2_Stage4_L14_Expert8&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1242" class="edge">
<title>R2_Stage4_L14_Expert8&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M24128.67,-1012.66C24128.67,-967.47 24128.67,-886 24128.67,-886 24128.67,-886 27342.12,-886 27342.12,-886"/>
<polygon fill="black" stroke="black" points="27342.12,-889.5 27352.12,-886 27342.12,-882.5 27342.12,-889.5"/>
</g>
<!-- R2_Stage4_L14_Expert9&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1243" class="edge">
<title>R2_Stage4_L14_Expert9&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M24424.67,-1012.85C24424.67,-967.95 24424.67,-887 24424.67,-887 24424.67,-887 27343.5,-887 27343.5,-887"/>
<polygon fill="black" stroke="black" points="27343.5,-890.5 27353.5,-887 27343.5,-883.5 27343.5,-890.5"/>
</g>
<!-- R2_Stage4_L14_Expert10&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1244" class="edge">
<title>R2_Stage4_L14_Expert10&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M24720.67,-1012.86C24720.67,-968.47 24720.67,-889 24720.67,-889 24720.67,-889 27346.13,-889 27346.13,-889"/>
<polygon fill="black" stroke="black" points="27346.13,-892.5 27356.13,-889 27346.13,-885.5 27346.13,-892.5"/>
</g>
<!-- R2_Stage4_L14_Expert11&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1245" class="edge">
<title>R2_Stage4_L14_Expert11&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M25016.67,-1012.69C25016.67,-968.52 25016.67,-890 25016.67,-890 25016.67,-890 27347.52,-890 27347.52,-890"/>
<polygon fill="black" stroke="black" points="27347.52,-893.5 27357.52,-890 27347.52,-886.5 27347.52,-893.5"/>
</g>
<!-- R2_Stage4_L14_Expert12&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1246" class="edge">
<title>R2_Stage4_L14_Expert12&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M25312.67,-1012.72C25312.67,-969.07 25312.67,-892 25312.67,-892 25312.67,-892 27349.92,-892 27349.92,-892"/>
<polygon fill="black" stroke="black" points="27349.92,-895.5 27359.92,-892 27349.92,-888.5 27349.92,-895.5"/>
</g>
<!-- R2_Stage4_L14_Expert13&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1247" class="edge">
<title>R2_Stage4_L14_Expert13&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M25608.67,-1012.92C25608.67,-969.56 25608.67,-893 25608.67,-893 25608.67,-893 27351.03,-893 27351.03,-893"/>
<polygon fill="black" stroke="black" points="27351.03,-896.5 27361.03,-893 27351.03,-889.5 27351.03,-896.5"/>
</g>
<!-- R2_Stage4_L14_Expert14&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1248" class="edge">
<title>R2_Stage4_L14_Expert14&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M25904.67,-1012.96C25904.67,-970.12 25904.67,-895 25904.67,-895 25904.67,-895 27353.71,-895 27353.71,-895"/>
<polygon fill="black" stroke="black" points="27353.71,-898.5 27363.71,-895 27353.71,-891.5 27353.71,-898.5"/>
</g>
<!-- R2_Stage4_L14_Expert15&#45;&gt;R2_Stage4_L14_MoE_Output -->
<g id="edge1249" class="edge">
<title>R2_Stage4_L14_Expert15&#45;&gt;R2_Stage4_L14_MoE_Output</title>
<path fill="none" stroke="black" d="M26200.67,-1012.81C26200.67,-970.2 26200.67,-896 26200.67,-896 26200.67,-896 27355.37,-896 27355.37,-896"/>
<polygon fill="black" stroke="black" points="27355.37,-899.5 27365.37,-896 27355.37,-892.5 27355.37,-899.5"/>
</g>
<!-- R2_Stage4_L14_MoE_Output&#45;&gt;R2_Stage4_L14_Output -->
<g id="edge1250" class="edge">
<title>R2_Stage4_L14_MoE_Output&#45;&gt;R2_Stage4_L14_Output</title>
<path fill="none" stroke="black" d="M27240.09,-800C27222.58,-800 27212,-800 27212,-800 27212,-800 27212,-677.93 27212,-677.93"/>
<polygon fill="black" stroke="black" points="27215.5,-677.93 27212,-667.93 27208.5,-677.93 27215.5,-677.93"/>
</g>
<!-- R2_Stage4_L15_Input -->
<g id="node773" class="node">
<title>R2_Stage4_L15_Input</title>
<ellipse fill="lightblue" stroke="black" cx="22347" cy="-1969" rx="225.5" ry="29"/>
<text text-anchor="middle" x="22347" y="-1977.5" font-family="Times,serif" font-size="10.00">Layer 15 Input</text>
<text text-anchor="middle" x="22347" y="-1966.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="22347" y="-1955.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Attn_Input -->
<g id="node774" class="node">
<title>R2_Stage4_L15_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="22347" cy="-1778" rx="225.5" ry="29"/>
<text text-anchor="middle" x="22347" y="-1786.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="22347" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="22347" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Input&#45;&gt;R2_Stage4_L15_Attn_Input -->
<g id="edge1251" class="edge">
<title>R2_Stage4_L15_Input&#45;&gt;R2_Stage4_L15_Attn_Input</title>
<path fill="none" stroke="black" d="M22347,-1939.99C22347,-1939.99 22347,-1817.28 22347,-1817.28"/>
<polygon fill="black" stroke="black" points="22350.5,-1817.28 22347,-1807.28 22343.5,-1817.28 22350.5,-1817.28"/>
</g>
<!-- R2_Stage4_L15_Attn_TP1 -->
<g id="node775" class="node">
<title>R2_Stage4_L15_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="22413,-1630 22067,-1630 22067,-1572 22413,-1572 22413,-1630"/>
<text text-anchor="middle" x="22240" y="-1615" font-family="Times,serif" font-size="10.00">Attention TP GPU 112</text>
<text text-anchor="middle" x="22240" y="-1604" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="22240" y="-1593" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="22240" y="-1582" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage4_L15_Attn_Input&#45;&gt;R2_Stage4_L15_Attn_TP1 -->
<g id="edge1252" class="edge">
<title>R2_Stage4_L15_Attn_Input&#45;&gt;R2_Stage4_L15_Attn_TP1</title>
<path fill="none" stroke="black" d="M22267.25,-1750.73C22267.25,-1750.73 22267.25,-1640.07 22267.25,-1640.07"/>
<polygon fill="black" stroke="black" points="22270.75,-1640.07 22267.25,-1630.07 22263.75,-1640.07 22270.75,-1640.07"/>
</g>
<!-- R2_Stage4_L15_Attn_TP2 -->
<g id="node776" class="node">
<title>R2_Stage4_L15_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="22795,-1630 22449,-1630 22449,-1572 22795,-1572 22795,-1630"/>
<text text-anchor="middle" x="22622" y="-1615" font-family="Times,serif" font-size="10.00">Attention TP GPU 113</text>
<text text-anchor="middle" x="22622" y="-1604" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="22622" y="-1593" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="22622" y="-1582" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage4_L15_Attn_Input&#45;&gt;R2_Stage4_L15_Attn_TP2 -->
<g id="edge1253" class="edge">
<title>R2_Stage4_L15_Attn_Input&#45;&gt;R2_Stage4_L15_Attn_TP2</title>
<path fill="none" stroke="black" d="M22510.75,-1758.04C22510.75,-1758.04 22510.75,-1640.27 22510.75,-1640.27"/>
<polygon fill="black" stroke="black" points="22514.25,-1640.27 22510.75,-1630.27 22507.25,-1640.27 22514.25,-1640.27"/>
</g>
<!-- R2_Stage4_L15_Attn_Output -->
<g id="node777" class="node">
<title>R2_Stage4_L15_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="22343" cy="-1424" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="22343" y="-1438" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="22343" y="-1427" font-family="Times,serif" font-size="10.00">AllReduce GPUs 112&#45;113</text>
<text text-anchor="middle" x="22343" y="-1416" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="22343" y="-1405" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Attn_TP1&#45;&gt;R2_Stage4_L15_Attn_Output -->
<g id="edge1254" class="edge">
<title>R2_Stage4_L15_Attn_TP1&#45;&gt;R2_Stage4_L15_Attn_Output</title>
<path fill="none" stroke="black" d="M22256.38,-1571.77C22256.38,-1571.77 22256.38,-1468.43 22256.38,-1468.43"/>
<polygon fill="black" stroke="black" points="22259.88,-1468.43 22256.38,-1458.43 22252.88,-1468.43 22259.88,-1468.43"/>
</g>
<!-- R2_Stage4_L15_Attn_TP2&#45;&gt;R2_Stage4_L15_Attn_Output -->
<g id="edge1255" class="edge">
<title>R2_Stage4_L15_Attn_TP2&#45;&gt;R2_Stage4_L15_Attn_Output</title>
<path fill="none" stroke="black" d="M22517.62,-1571.77C22517.62,-1571.77 22517.62,-1459.81 22517.62,-1459.81"/>
<polygon fill="black" stroke="black" points="22521.12,-1459.81 22517.62,-1449.81 22514.12,-1459.81 22521.12,-1459.81"/>
</g>
<!-- R2_Stage4_L15_MoE_Input -->
<g id="node778" class="node">
<title>R2_Stage4_L15_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="22084" cy="-1233" rx="225.5" ry="29"/>
<text text-anchor="middle" x="22084" y="-1241.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="22084" y="-1230.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="22084" y="-1219.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Attn_Output&#45;&gt;R2_Stage4_L15_MoE_Input -->
<g id="edge1256" class="edge">
<title>R2_Stage4_L15_Attn_Output&#45;&gt;R2_Stage4_L15_MoE_Input</title>
<path fill="none" stroke="black" d="M22204.63,-1393.74C22204.63,-1393.74 22204.63,-1267.66 22204.63,-1267.66"/>
<polygon fill="black" stroke="black" points="22208.13,-1267.66 22204.63,-1257.66 22201.13,-1267.66 22208.13,-1267.66"/>
</g>
<!-- R2_Stage4_L15_Router -->
<g id="node779" class="node">
<title>R2_Stage4_L15_Router</title>
<polygon fill="lightyellow" stroke="black" points="22468.36,-1094 21955.56,-1094 21823.64,-990 22336.44,-990 22468.36,-1094"/>
<text text-anchor="middle" x="22146" y="-1056" font-family="Times,serif" font-size="10.00">Router GPU 112</text>
<text text-anchor="middle" x="22146" y="-1045" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="22146" y="-1034" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="22146" y="-1023" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage4_L15_MoE_Input&#45;&gt;R2_Stage4_L15_Router -->
<g id="edge1257" class="edge">
<title>R2_Stage4_L15_MoE_Input&#45;&gt;R2_Stage4_L15_Router</title>
<path fill="none" stroke="black" d="M22084,-1203.99C22084,-1203.99 22084,-1104.02 22084,-1104.02"/>
<polygon fill="black" stroke="black" points="22087.5,-1104.02 22084,-1094.02 22080.5,-1104.02 22087.5,-1104.02"/>
</g>
<!-- R2_Stage4_L15_Expert0 -->
<g id="node780" class="node">
<title>R2_Stage4_L15_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="26716,-880 26456,-880 26456,-822 26716,-822 26716,-880"/>
<text text-anchor="middle" x="26586" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 112</text>
<text text-anchor="middle" x="26586" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="26586" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert0 -->
<g id="edge1258" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22446.08,-1041.83C22446.08,-1038.37 22446.08,-983 22446.08,-983 22446.08,-983 26476.33,-983 26476.33,-983 26476.33,-983 26476.33,-890.3 26476.33,-890.3"/>
<polygon fill="black" stroke="black" points="26479.83,-890.3 26476.33,-880.3 26472.83,-890.3 26479.83,-890.3"/>
<text text-anchor="middle" x="23680.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert1 -->
<g id="node781" class="node">
<title>R2_Stage4_L15_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="22276,-880 22016,-880 22016,-822 22276,-822 22276,-880"/>
<text text-anchor="middle" x="22146" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 113</text>
<text text-anchor="middle" x="22146" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="22146" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert1 -->
<g id="edge1259" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22146,-989.81C22146,-989.81 22146,-890.01 22146,-890.01"/>
<polygon fill="black" stroke="black" points="22149.5,-890.01 22146,-880.01 22142.5,-890.01 22149.5,-890.01"/>
<text text-anchor="middle" x="22167.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert2 -->
<g id="node782" class="node">
<title>R2_Stage4_L15_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="22572,-880 22312,-880 22312,-822 22572,-822 22572,-880"/>
<text text-anchor="middle" x="22442" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 114</text>
<text text-anchor="middle" x="22442" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="22442" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert2 -->
<g id="edge1260" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22457.26,-1041.86C22457.26,-1041.86 22457.26,-890.01 22457.26,-890.01"/>
<polygon fill="black" stroke="black" points="22460.76,-890.01 22457.26,-880.01 22453.76,-890.01 22460.76,-890.01"/>
<text text-anchor="middle" x="22357.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert3 -->
<g id="node783" class="node">
<title>R2_Stage4_L15_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="25532,-880 25272,-880 25272,-822 25532,-822 25532,-880"/>
<text text-anchor="middle" x="25402" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 115</text>
<text text-anchor="middle" x="25402" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25402" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert3 -->
<g id="edge1261" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22401.39,-1041.01C22401.39,-1031.34 22401.39,-954 22401.39,-954 22401.39,-954 25292.33,-954 25292.33,-954 25292.33,-954 25292.33,-890.24 25292.33,-890.24"/>
<polygon fill="black" stroke="black" points="25295.83,-890.24 25292.33,-880.24 25288.83,-890.24 25295.83,-890.24"/>
<text text-anchor="middle" x="23344.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert4 -->
<g id="node784" class="node">
<title>R2_Stage4_L15_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="23164,-880 22904,-880 22904,-822 23164,-822 23164,-880"/>
<text text-anchor="middle" x="23034" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 116</text>
<text text-anchor="middle" x="23034" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23034" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert4 -->
<g id="edge1262" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22355.5,-1005C22571.54,-1005 22877.09,-1005 22877.09,-1005 22877.09,-1005 22877.09,-851 22877.09,-851 22877.09,-851 22893.71,-851 22893.71,-851"/>
<polygon fill="black" stroke="black" points="22893.71,-854.5 22903.71,-851 22893.71,-847.5 22893.71,-854.5"/>
<text text-anchor="middle" x="22636.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert5 -->
<g id="node785" class="node">
<title>R2_Stage4_L15_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="23756,-880 23496,-880 23496,-822 23756,-822 23756,-880"/>
<text text-anchor="middle" x="23626" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 117</text>
<text text-anchor="middle" x="23626" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23626" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert5 -->
<g id="edge1263" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22334.35,-989.98C22334.35,-954.91 22334.35,-915 22334.35,-915 22334.35,-915 23526.36,-915 23526.36,-915 23526.36,-915 23526.36,-890 23526.36,-890"/>
<polygon fill="black" stroke="black" points="23529.86,-890 23526.36,-880 23522.86,-890 23529.86,-890"/>
<text text-anchor="middle" x="22831.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert6 -->
<g id="node786" class="node">
<title>R2_Stage4_L15_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="24052,-880 23792,-880 23792,-822 24052,-822 24052,-880"/>
<text text-anchor="middle" x="23922" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 118</text>
<text text-anchor="middle" x="23922" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23922" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert6 -->
<g id="edge1264" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22345.52,-996.98C22345.52,-962.92 22345.52,-922 22345.52,-922 22345.52,-922 23812.33,-922 23812.33,-922 23812.33,-922 23812.33,-890.29 23812.33,-890.29"/>
<polygon fill="black" stroke="black" points="23815.83,-890.29 23812.33,-880.29 23808.83,-890.29 23815.83,-890.29"/>
<text text-anchor="middle" x="22920.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert7 -->
<g id="node787" class="node">
<title>R2_Stage4_L15_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="24348,-880 24088,-880 24088,-822 24348,-822 24348,-880"/>
<text text-anchor="middle" x="24218" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 119</text>
<text text-anchor="middle" x="24218" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24218" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert7 -->
<g id="edge1265" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22356.69,-1005.93C22356.69,-972.53 22356.69,-928 22356.69,-928 22356.69,-928 24108.33,-928 24108.33,-928 24108.33,-928 24108.33,-890.11 24108.33,-890.11"/>
<polygon fill="black" stroke="black" points="24111.83,-890.11 24108.33,-880.11 24104.83,-890.11 24111.83,-890.11"/>
<text text-anchor="middle" x="23006.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert8 -->
<g id="node788" class="node">
<title>R2_Stage4_L15_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="26124,-880 25864,-880 25864,-822 26124,-822 26124,-880"/>
<text text-anchor="middle" x="25994" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 120</text>
<text text-anchor="middle" x="25994" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25994" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert8 -->
<g id="edge1266" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22423.74,-1041.95C22423.74,-1039.67 22423.74,-967 22423.74,-967 22423.74,-967 25884.33,-967 25884.33,-967 25884.33,-967 25884.33,-890.27 25884.33,-890.27"/>
<polygon fill="black" stroke="black" points="25887.83,-890.27 25884.33,-880.27 25880.83,-890.27 25887.83,-890.27"/>
<text text-anchor="middle" x="23512.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert9 -->
<g id="node789" class="node">
<title>R2_Stage4_L15_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="24644,-880 24384,-880 24384,-822 24644,-822 24644,-880"/>
<text text-anchor="middle" x="24514" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 121</text>
<text text-anchor="middle" x="24514" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24514" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert9 -->
<g id="edge1267" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22367.87,-1014.72C22367.87,-983.02 22367.87,-935 22367.87,-935 22367.87,-935 24404.33,-935 24404.33,-935 24404.33,-935 24404.33,-890.38 24404.33,-890.38"/>
<polygon fill="black" stroke="black" points="24407.83,-890.38 24404.33,-880.38 24400.83,-890.38 24407.83,-890.38"/>
<text text-anchor="middle" x="23091.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert10 -->
<g id="node790" class="node">
<title>R2_Stage4_L15_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="24940,-880 24680,-880 24680,-822 24940,-822 24940,-880"/>
<text text-anchor="middle" x="24810" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 122</text>
<text text-anchor="middle" x="24810" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24810" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert10 -->
<g id="edge1268" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22379.04,-1023.48C22379.04,-994.32 22379.04,-941 22379.04,-941 22379.04,-941 24700.33,-941 24700.33,-941 24700.33,-941 24700.33,-890.47 24700.33,-890.47"/>
<polygon fill="black" stroke="black" points="24703.83,-890.47 24700.33,-880.47 24696.83,-890.47 24703.83,-890.47"/>
<text text-anchor="middle" x="23176.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert11 -->
<g id="node791" class="node">
<title>R2_Stage4_L15_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="25236,-880 24976,-880 24976,-822 25236,-822 25236,-880"/>
<text text-anchor="middle" x="25106" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 123</text>
<text text-anchor="middle" x="25106" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25106" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert11 -->
<g id="edge1269" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22390.22,-1032.29C22390.22,-1008.28 22390.22,-948 22390.22,-948 22390.22,-948 24996.33,-948 24996.33,-948 24996.33,-948 24996.33,-890.1 24996.33,-890.1"/>
<polygon fill="black" stroke="black" points="24999.83,-890.1 24996.33,-880.1 24992.83,-890.1 24999.83,-890.1"/>
<text text-anchor="middle" x="23260.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert12 -->
<g id="node792" class="node">
<title>R2_Stage4_L15_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="25828,-880 25568,-880 25568,-822 25828,-822 25828,-880"/>
<text text-anchor="middle" x="25698" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 124</text>
<text text-anchor="middle" x="25698" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25698" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert12 -->
<g id="edge1270" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22412.56,-1041.94C22412.56,-1039.49 22412.56,-961 22412.56,-961 22412.56,-961 25588.33,-961 25588.33,-961 25588.33,-961 25588.33,-890.19 25588.33,-890.19"/>
<polygon fill="black" stroke="black" points="25591.83,-890.19 25588.33,-880.19 25584.83,-890.19 25591.83,-890.19"/>
<text text-anchor="middle" x="23428.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert13 -->
<g id="node793" class="node">
<title>R2_Stage4_L15_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="22868,-880 22608,-880 22608,-822 22868,-822 22868,-880"/>
<text text-anchor="middle" x="22738" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 125</text>
<text text-anchor="middle" x="22738" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="22738" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert13 -->
<g id="edge1271" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22345.37,-997C22501.29,-997 22691.81,-997 22691.81,-997 22691.81,-997 22691.81,-890.19 22691.81,-890.19"/>
<polygon fill="black" stroke="black" points="22695.31,-890.19 22691.81,-880.19 22688.31,-890.19 22695.31,-890.19"/>
<text text-anchor="middle" x="22515.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert14 -->
<g id="node794" class="node">
<title>R2_Stage4_L15_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="23460,-880 23200,-880 23200,-822 23460,-822 23460,-880"/>
<text text-anchor="middle" x="23330" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 126</text>
<text text-anchor="middle" x="23330" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23330" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert14 -->
<g id="edge1272" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22323.17,-989.82C22323.17,-952.56 22323.17,-909 22323.17,-909 22323.17,-909 23330,-909 23330,-909 23330,-909 23330,-890 23330,-890"/>
<polygon fill="black" stroke="black" points="23333.5,-890 23330,-880 23326.5,-890 23333.5,-890"/>
<text text-anchor="middle" x="22738.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_Expert15 -->
<g id="node795" class="node">
<title>R2_Stage4_L15_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="26420,-880 26160,-880 26160,-822 26420,-822 26420,-880"/>
<text text-anchor="middle" x="26290" y="-859.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 127</text>
<text text-anchor="middle" x="26290" y="-848.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="26290" y="-837.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert15 -->
<g id="edge1273" class="edge">
<title>R2_Stage4_L15_Router&#45;&gt;R2_Stage4_L15_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M22434.91,-1041.95C22434.91,-1039.86 22434.91,-973 22434.91,-973 22434.91,-973 26180.33,-973 26180.33,-973 26180.33,-973 26180.33,-890.22 26180.33,-890.22"/>
<polygon fill="black" stroke="black" points="26183.83,-890.22 26180.33,-880.22 26176.83,-890.22 26183.83,-890.22"/>
<text text-anchor="middle" x="23596.5" y="-942.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L15_MoE_Output -->
<g id="node796" class="node">
<title>R2_Stage4_L15_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="26733.95,-712 26207.48,-712 26072.05,-608 26598.52,-608 26733.95,-712"/>
<text text-anchor="middle" x="26403" y="-674" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="26403" y="-663" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="26403" y="-652" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="26403" y="-641" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L15_Expert0&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1274" class="edge">
<title>R2_Stage4_L15_Expert0&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M26586,-821.99C26586,-821.99 26586,-722.02 26586,-722.02"/>
<polygon fill="black" stroke="black" points="26589.5,-722.02 26586,-712.02 26582.5,-722.02 26589.5,-722.02"/>
</g>
<!-- R2_Stage4_L15_Expert1&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1275" class="edge">
<title>R2_Stage4_L15_Expert1&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M22258.67,-821.84C22258.67,-775.45 22258.67,-690 22258.67,-690 22258.67,-690 26168.71,-690 26168.71,-690"/>
<polygon fill="black" stroke="black" points="26168.71,-693.5 26178.71,-690 26168.71,-686.5 26168.71,-693.5"/>
</g>
<!-- R2_Stage4_L15_Expert2&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1276" class="edge">
<title>R2_Stage4_L15_Expert2&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M22554.67,-821.84C22554.67,-775.93 22554.67,-692 22554.67,-692 22554.67,-692 26171.22,-692 26171.22,-692"/>
<polygon fill="black" stroke="black" points="26171.22,-695.5 26181.22,-692 26171.22,-688.5 26171.22,-695.5"/>
</g>
<!-- R2_Stage4_L15_Expert3&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1277" class="edge">
<title>R2_Stage4_L15_Expert3&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M25506,-821.72C25506,-779.88 25506,-708 25506,-708 25506,-708 26192.25,-708 26192.25,-708"/>
<polygon fill="black" stroke="black" points="26192.25,-711.5 26202.25,-708 26192.25,-704.5 26192.25,-711.5"/>
</g>
<!-- R2_Stage4_L15_Expert4&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1278" class="edge">
<title>R2_Stage4_L15_Expert4&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M23146.67,-821.66C23146.67,-776.47 23146.67,-695 23146.67,-695 23146.67,-695 26175.24,-695 26175.24,-695"/>
<polygon fill="black" stroke="black" points="26175.24,-698.5 26185.24,-695 26175.24,-691.5 26175.24,-698.5"/>
</g>
<!-- R2_Stage4_L15_Expert5&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1279" class="edge">
<title>R2_Stage4_L15_Expert5&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M23738.67,-821.86C23738.67,-777.47 23738.67,-698 23738.67,-698 23738.67,-698 26179.19,-698 26179.19,-698"/>
<polygon fill="black" stroke="black" points="26179.19,-701.5 26189.19,-698 26179.19,-694.5 26179.19,-701.5"/>
</g>
<!-- R2_Stage4_L15_Expert6&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1280" class="edge">
<title>R2_Stage4_L15_Expert6&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M24034.67,-821.89C24034.67,-778.01 24034.67,-700 24034.67,-700 24034.67,-700 26181.79,-700 26181.79,-700"/>
<polygon fill="black" stroke="black" points="26181.79,-703.5 26191.79,-700 26181.79,-696.5 26181.79,-703.5"/>
</g>
<!-- R2_Stage4_L15_Expert7&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1281" class="edge">
<title>R2_Stage4_L15_Expert7&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M24330.67,-821.92C24330.67,-778.56 24330.67,-702 24330.67,-702 24330.67,-702 26184.33,-702 26184.33,-702"/>
<polygon fill="black" stroke="black" points="26184.33,-705.5 26194.33,-702 26184.33,-698.5 26184.33,-705.5"/>
</g>
<!-- R2_Stage4_L15_Expert8&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1282" class="edge">
<title>R2_Stage4_L15_Expert8&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M26098.14,-821.99C26098.14,-821.99 26098.14,-670.08 26098.14,-670.08"/>
<polygon fill="black" stroke="black" points="26101.64,-670.08 26098.14,-660.08 26094.64,-670.08 26101.64,-670.08"/>
</g>
<!-- R2_Stage4_L15_Expert9&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1283" class="edge">
<title>R2_Stage4_L15_Expert9&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M24626.67,-821.76C24626.67,-778.63 24626.67,-703 24626.67,-703 24626.67,-703 26185.76,-703 26185.76,-703"/>
<polygon fill="black" stroke="black" points="26185.76,-706.5 26195.76,-703 26185.76,-699.5 26185.76,-706.5"/>
</g>
<!-- R2_Stage4_L15_Expert10&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1284" class="edge">
<title>R2_Stage4_L15_Expert10&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M24922.67,-821.81C24922.67,-779.2 24922.67,-705 24922.67,-705 24922.67,-705 26188.33,-705 26188.33,-705"/>
<polygon fill="black" stroke="black" points="26188.33,-708.5 26198.33,-705 26188.33,-701.5 26188.33,-708.5"/>
</g>
<!-- R2_Stage4_L15_Expert11&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1285" class="edge">
<title>R2_Stage4_L15_Expert11&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M25218.67,-821.86C25218.67,-779.78 25218.67,-707 25218.67,-707 25218.67,-707 26190.75,-707 26190.75,-707"/>
<polygon fill="black" stroke="black" points="26190.75,-710.5 26200.75,-707 26190.75,-703.5 26190.75,-710.5"/>
</g>
<!-- R2_Stage4_L15_Expert12&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1286" class="edge">
<title>R2_Stage4_L15_Expert12&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M25802,-821.78C25802,-780.48 25802,-710 25802,-710 25802,-710 26194.54,-710 26194.54,-710"/>
<polygon fill="black" stroke="black" points="26194.54,-713.5 26204.54,-710 26194.54,-706.5 26194.54,-713.5"/>
</g>
<!-- R2_Stage4_L15_Expert13&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1287" class="edge">
<title>R2_Stage4_L15_Expert13&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M22850.67,-821.65C22850.67,-775.96 22850.67,-693 22850.67,-693 22850.67,-693 26172.46,-693 26172.46,-693"/>
<polygon fill="black" stroke="black" points="26172.46,-696.5 26182.46,-693 26172.46,-689.5 26172.46,-696.5"/>
</g>
<!-- R2_Stage4_L15_Expert14&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1288" class="edge">
<title>R2_Stage4_L15_Expert14&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M23442.67,-821.67C23442.67,-776.99 23442.67,-697 23442.67,-697 23442.67,-697 26177.72,-697 26177.72,-697"/>
<polygon fill="black" stroke="black" points="26177.72,-700.5 26187.72,-697 26177.72,-693.5 26177.72,-700.5"/>
</g>
<!-- R2_Stage4_L15_Expert15&#45;&gt;R2_Stage4_L15_MoE_Output -->
<g id="edge1289" class="edge">
<title>R2_Stage4_L15_Expert15&#45;&gt;R2_Stage4_L15_MoE_Output</title>
<path fill="none" stroke="black" d="M26290,-821.99C26290,-821.99 26290,-722.02 26290,-722.02"/>
<polygon fill="black" stroke="black" points="26293.5,-722.02 26290,-712.02 26286.5,-722.02 26293.5,-722.02"/>
</g>
<!-- R2_Stage4_L15_MoE_Output&#45;&gt;R2_Stage4_L15_Output -->
<g id="edge1290" class="edge">
<title>R2_Stage4_L15_MoE_Output&#45;&gt;R2_Stage4_L15_Output</title>
<path fill="none" stroke="black" d="M26403,-607.85C26403,-607.85 26403,-522.22 26403,-522.22"/>
<polygon fill="black" stroke="black" points="26406.5,-522.22 26403,-512.22 26399.5,-522.22 26406.5,-522.22"/>
</g>
<!-- R2_Stage4_L16_Input -->
<g id="node797" class="node">
<title>R2_Stage4_L16_Input</title>
<ellipse fill="lightblue" stroke="black" cx="21713" cy="-1778" rx="225.5" ry="29"/>
<text text-anchor="middle" x="21713" y="-1786.5" font-family="Times,serif" font-size="10.00">Layer 16 Input</text>
<text text-anchor="middle" x="21713" y="-1775.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="21713" y="-1764.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Attn_Input -->
<g id="node798" class="node">
<title>R2_Stage4_L16_Attn_Input</title>
<ellipse fill="lightblue" stroke="black" cx="21713" cy="-1601" rx="225.5" ry="29"/>
<text text-anchor="middle" x="21713" y="-1609.5" font-family="Times,serif" font-size="10.00">Attention Input</text>
<text text-anchor="middle" x="21713" y="-1598.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="21713" y="-1587.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Input&#45;&gt;R2_Stage4_L16_Attn_Input -->
<g id="edge1291" class="edge">
<title>R2_Stage4_L16_Input&#45;&gt;R2_Stage4_L16_Attn_Input</title>
<path fill="none" stroke="black" d="M21713,-1748.77C21713,-1748.77 21713,-1640.27 21713,-1640.27"/>
<polygon fill="black" stroke="black" points="21716.5,-1640.27 21713,-1630.27 21709.5,-1640.27 21716.5,-1640.27"/>
</g>
<!-- R2_Stage4_L16_Attn_TP1 -->
<g id="node799" class="node">
<title>R2_Stage4_L16_Attn_TP1</title>
<polygon fill="lightgreen" stroke="black" points="21682,-1453 21336,-1453 21336,-1395 21682,-1395 21682,-1453"/>
<text text-anchor="middle" x="21509" y="-1438" font-family="Times,serif" font-size="10.00">Attention TP GPU 112</text>
<text text-anchor="middle" x="21509" y="-1427" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="21509" y="-1416" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="21509" y="-1405" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage4_L16_Attn_Input&#45;&gt;R2_Stage4_L16_Attn_TP1 -->
<g id="edge1292" class="edge">
<title>R2_Stage4_L16_Attn_Input&#45;&gt;R2_Stage4_L16_Attn_TP1</title>
<path fill="none" stroke="black" d="M21584.75,-1577.13C21584.75,-1577.13 21584.75,-1463.07 21584.75,-1463.07"/>
<polygon fill="black" stroke="black" points="21588.25,-1463.07 21584.75,-1453.07 21581.25,-1463.07 21588.25,-1463.07"/>
</g>
<!-- R2_Stage4_L16_Attn_TP2 -->
<g id="node800" class="node">
<title>R2_Stage4_L16_Attn_TP2</title>
<polygon fill="lightgreen" stroke="black" points="22064,-1453 21718,-1453 21718,-1395 22064,-1395 22064,-1453"/>
<text text-anchor="middle" x="21891" y="-1438" font-family="Times,serif" font-size="10.00">Attention TP GPU 113</text>
<text text-anchor="middle" x="21891" y="-1427" font-family="Times,serif" font-size="10.00">8 heads</text>
<text text-anchor="middle" x="21891" y="-1416" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="21891" y="-1405" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, heads=8, d_k=32]</text>
</g>
<!-- R2_Stage4_L16_Attn_Input&#45;&gt;R2_Stage4_L16_Attn_TP2 -->
<g id="edge1293" class="edge">
<title>R2_Stage4_L16_Attn_Input&#45;&gt;R2_Stage4_L16_Attn_TP2</title>
<path fill="none" stroke="black" d="M21828.25,-1576.02C21828.25,-1576.02 21828.25,-1463.27 21828.25,-1463.27"/>
<polygon fill="black" stroke="black" points="21831.75,-1463.27 21828.25,-1453.27 21824.75,-1463.27 21831.75,-1463.27"/>
</g>
<!-- R2_Stage4_L16_Attn_Output -->
<g id="node801" class="node">
<title>R2_Stage4_L16_Attn_Output</title>
<ellipse fill="lightblue" stroke="black" cx="21579" cy="-1233" rx="243.49" ry="36.54"/>
<text text-anchor="middle" x="21579" y="-1247" font-family="Times,serif" font-size="10.00">Attention Output</text>
<text text-anchor="middle" x="21579" y="-1236" font-family="Times,serif" font-size="10.00">AllReduce GPUs 112&#45;113</text>
<text text-anchor="middle" x="21579" y="-1225" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="21579" y="-1214" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Attn_TP1&#45;&gt;R2_Stage4_L16_Attn_Output -->
<g id="edge1294" class="edge">
<title>R2_Stage4_L16_Attn_TP1&#45;&gt;R2_Stage4_L16_Attn_Output</title>
<path fill="none" stroke="black" d="M21509,-1394.99C21509,-1394.99 21509,-1278.47 21509,-1278.47"/>
<polygon fill="black" stroke="black" points="21512.5,-1278.47 21509,-1268.47 21505.5,-1278.47 21512.5,-1278.47"/>
</g>
<!-- R2_Stage4_L16_Attn_TP2&#45;&gt;R2_Stage4_L16_Attn_Output -->
<g id="edge1295" class="edge">
<title>R2_Stage4_L16_Attn_TP2&#45;&gt;R2_Stage4_L16_Attn_Output</title>
<path fill="none" stroke="black" d="M21770.12,-1394.99C21770.12,-1394.99 21770.12,-1265.97 21770.12,-1265.97"/>
<polygon fill="black" stroke="black" points="21773.62,-1265.97 21770.12,-1255.97 21766.62,-1265.97 21773.62,-1265.97"/>
</g>
<!-- R2_Stage4_L16_MoE_Input -->
<g id="node802" class="node">
<title>R2_Stage4_L16_MoE_Input</title>
<ellipse fill="lightblue" stroke="black" cx="21562" cy="-1042" rx="225.5" ry="29"/>
<text text-anchor="middle" x="21562" y="-1050.5" font-family="Times,serif" font-size="10.00">MoE Input</text>
<text text-anchor="middle" x="21562" y="-1039.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="21562" y="-1028.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Attn_Output&#45;&gt;R2_Stage4_L16_MoE_Input -->
<g id="edge1296" class="edge">
<title>R2_Stage4_L16_Attn_Output&#45;&gt;R2_Stage4_L16_MoE_Input</title>
<path fill="none" stroke="black" d="M21562,-1196.17C21562,-1196.17 21562,-1081.22 21562,-1081.22"/>
<polygon fill="black" stroke="black" points="21565.5,-1081.22 21562,-1071.22 21558.5,-1081.22 21565.5,-1081.22"/>
</g>
<!-- R2_Stage4_L16_Router -->
<g id="node803" class="node">
<title>R2_Stage4_L16_Router</title>
<polygon fill="lightyellow" stroke="black" points="21980.36,-903 21467.56,-903 21335.64,-799 21848.44,-799 21980.36,-903"/>
<text text-anchor="middle" x="21658" y="-865" font-family="Times,serif" font-size="10.00">Router GPU 112</text>
<text text-anchor="middle" x="21658" y="-854" font-family="Times,serif" font-size="10.00">Expert Selection</text>
<text text-anchor="middle" x="21658" y="-843" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="21658" y="-832" font-family="Times,serif" font-size="10.00">Output: routing decisions</text>
</g>
<!-- R2_Stage4_L16_MoE_Input&#45;&gt;R2_Stage4_L16_Router -->
<g id="edge1297" class="edge">
<title>R2_Stage4_L16_MoE_Input&#45;&gt;R2_Stage4_L16_Router</title>
<path fill="none" stroke="black" d="M21562,-1012.99C21562,-1012.99 21562,-913.02 21562,-913.02"/>
<polygon fill="black" stroke="black" points="21565.5,-913.02 21562,-903.02 21558.5,-913.02 21565.5,-913.02"/>
</g>
<!-- R2_Stage4_L16_Expert0 -->
<g id="node804" class="node">
<title>R2_Stage4_L16_Expert0</title>
<polygon fill="lightgreen" stroke="black" points="22780,-689 22520,-689 22520,-631 22780,-631 22780,-689"/>
<text text-anchor="middle" x="22650" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 0 GPU 112</text>
<text text-anchor="middle" x="22650" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="22650" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert0 -->
<g id="edge1298" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21854.79,-804C22114,-804 22537.33,-804 22537.33,-804 22537.33,-804 22537.33,-699.14 22537.33,-699.14"/>
<polygon fill="black" stroke="black" points="22540.83,-699.14 22537.33,-689.14 22533.83,-699.14 22540.83,-699.14"/>
<text text-anchor="middle" x="22096.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert1 -->
<g id="node805" class="node">
<title>R2_Stage4_L16_Expert1</title>
<polygon fill="lightgreen" stroke="black" points="23076,-689 22816,-689 22816,-631 23076,-631 23076,-689"/>
<text text-anchor="middle" x="22946" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 1 GPU 113</text>
<text text-anchor="middle" x="22946" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="22946" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert1 -->
<g id="edge1299" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21857.38,-806C22192.71,-806 22833.33,-806 22833.33,-806 22833.33,-806 22833.33,-699.19 22833.33,-699.19"/>
<polygon fill="black" stroke="black" points="22836.83,-699.19 22833.33,-689.19 22829.83,-699.19 22836.83,-699.19"/>
<text text-anchor="middle" x="22188.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert2 -->
<g id="node806" class="node">
<title>R2_Stage4_L16_Expert2</title>
<polygon fill="lightgreen" stroke="black" points="23372,-689 23112,-689 23112,-631 23372,-631 23372,-689"/>
<text text-anchor="middle" x="23242" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 2 GPU 114</text>
<text text-anchor="middle" x="23242" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23242" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert2 -->
<g id="edge1300" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert2</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21858.73,-807C22261.36,-807 23129.33,-807 23129.33,-807 23129.33,-807 23129.33,-699.04 23129.33,-699.04"/>
<polygon fill="black" stroke="black" points="23132.83,-699.04 23129.33,-689.04 23125.83,-699.04 23132.83,-699.04"/>
<text text-anchor="middle" x="22276.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert3 -->
<g id="node807" class="node">
<title>R2_Stage4_L16_Expert3</title>
<polygon fill="lightgreen" stroke="black" points="23668,-689 23408,-689 23408,-631 23668,-631 23668,-689"/>
<text text-anchor="middle" x="23538" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 3 GPU 115</text>
<text text-anchor="middle" x="23538" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23538" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert3 -->
<g id="edge1301" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert3</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21861.17,-809C22325.64,-809 23425.33,-809 23425.33,-809 23425.33,-809 23425.33,-699.08 23425.33,-699.08"/>
<polygon fill="black" stroke="black" points="23428.83,-699.08 23425.33,-689.08 23421.83,-699.08 23428.83,-699.08"/>
<text text-anchor="middle" x="22362.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert4 -->
<g id="node808" class="node">
<title>R2_Stage4_L16_Expert4</title>
<polygon fill="lightgreen" stroke="black" points="23964,-689 23704,-689 23704,-631 23964,-631 23964,-689"/>
<text text-anchor="middle" x="23834" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 4 GPU 116</text>
<text text-anchor="middle" x="23834" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="23834" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert4 -->
<g id="edge1302" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert4</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21863.86,-811C22386.09,-811 23721.33,-811 23721.33,-811 23721.33,-811 23721.33,-699.11 23721.33,-699.11"/>
<polygon fill="black" stroke="black" points="23724.83,-699.11 23721.33,-689.11 23717.83,-699.11 23724.83,-699.11"/>
<text text-anchor="middle" x="22447.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert5 -->
<g id="node809" class="node">
<title>R2_Stage4_L16_Expert5</title>
<polygon fill="lightgreen" stroke="black" points="24260,-689 24000,-689 24000,-631 24260,-631 24260,-689"/>
<text text-anchor="middle" x="24130" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 5 GPU 117</text>
<text text-anchor="middle" x="24130" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24130" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert5 -->
<g id="edge1303" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert5</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21866.34,-813C22442.91,-813 24017.33,-813 24017.33,-813 24017.33,-813 24017.33,-699.14 24017.33,-699.14"/>
<polygon fill="black" stroke="black" points="24020.83,-699.14 24017.33,-689.14 24013.83,-699.14 24020.83,-699.14"/>
<text text-anchor="middle" x="22532.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert6 -->
<g id="node810" class="node">
<title>R2_Stage4_L16_Expert6</title>
<polygon fill="lightgreen" stroke="black" points="24556,-689 24296,-689 24296,-631 24556,-631 24556,-689"/>
<text text-anchor="middle" x="24426" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 6 GPU 118</text>
<text text-anchor="middle" x="24426" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24426" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert6 -->
<g id="edge1304" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert6</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21867.75,-814C22495.01,-814 24313.33,-814 24313.33,-814 24313.33,-814 24313.33,-699.33 24313.33,-699.33"/>
<polygon fill="black" stroke="black" points="24316.83,-699.33 24313.33,-689.33 24309.83,-699.33 24316.83,-699.33"/>
<text text-anchor="middle" x="22616.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert7 -->
<g id="node811" class="node">
<title>R2_Stage4_L16_Expert7</title>
<polygon fill="lightgreen" stroke="black" points="24852,-689 24592,-689 24592,-631 24852,-631 24852,-689"/>
<text text-anchor="middle" x="24722" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 7 GPU 119</text>
<text text-anchor="middle" x="24722" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="24722" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert7 -->
<g id="edge1305" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert7</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21870.25,-816C22546.97,-816 24609.33,-816 24609.33,-816 24609.33,-816 24609.33,-699.34 24609.33,-699.34"/>
<polygon fill="black" stroke="black" points="24612.83,-699.34 24609.33,-689.34 24605.83,-699.34 24612.83,-699.34"/>
<text text-anchor="middle" x="22700.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert8 -->
<g id="node812" class="node">
<title>R2_Stage4_L16_Expert8</title>
<polygon fill="lightgreen" stroke="black" points="25148,-689 24888,-689 24888,-631 25148,-631 25148,-689"/>
<text text-anchor="middle" x="25018" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 8 GPU 120</text>
<text text-anchor="middle" x="25018" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25018" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert8 -->
<g id="edge1306" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21872.64,-818C22596.85,-818 24905.33,-818 24905.33,-818 24905.33,-818 24905.33,-699.35 24905.33,-699.35"/>
<polygon fill="black" stroke="black" points="24908.83,-699.35 24905.33,-689.35 24901.83,-699.35 24908.83,-699.35"/>
<text text-anchor="middle" x="22784.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert9 -->
<g id="node813" class="node">
<title>R2_Stage4_L16_Expert9</title>
<polygon fill="lightgreen" stroke="black" points="25444,-689 25184,-689 25184,-631 25444,-631 25444,-689"/>
<text text-anchor="middle" x="25314" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 9 GPU 121</text>
<text text-anchor="middle" x="25314" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25314" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert9 -->
<g id="edge1307" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21875.31,-820C22645.83,-820 25201.33,-820 25201.33,-820 25201.33,-820 25201.33,-699.35 25201.33,-699.35"/>
<polygon fill="black" stroke="black" points="25204.83,-699.35 25201.33,-689.35 25197.83,-699.35 25204.83,-699.35"/>
<text text-anchor="middle" x="22868.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert10 -->
<g id="node814" class="node">
<title>R2_Stage4_L16_Expert10</title>
<polygon fill="lightgreen" stroke="black" points="25740,-689 25480,-689 25480,-631 25740,-631 25740,-689"/>
<text text-anchor="middle" x="25610" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 10 GPU 122</text>
<text text-anchor="middle" x="25610" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25610" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert10 -->
<g id="edge1308" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21952.53,-881C22859.61,-881 25550,-881 25550,-881 25550,-881 25550,-699.35 25550,-699.35"/>
<polygon fill="black" stroke="black" points="25553.5,-699.35 25550,-689.35 25546.5,-699.35 25553.5,-699.35"/>
<text text-anchor="middle" x="22952.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert11 -->
<g id="node815" class="node">
<title>R2_Stage4_L16_Expert11</title>
<polygon fill="lightgreen" stroke="black" points="26036,-689 25776,-689 25776,-631 26036,-631 26036,-689"/>
<text text-anchor="middle" x="25906" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 11 GPU 123</text>
<text text-anchor="middle" x="25906" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="25906" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert11 -->
<g id="edge1309" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21955,-883C22910.91,-883 25846,-883 25846,-883 25846,-883 25846,-699.15 25846,-699.15"/>
<polygon fill="black" stroke="black" points="25849.5,-699.15 25846,-689.15 25842.5,-699.15 25849.5,-699.15"/>
<text text-anchor="middle" x="23036.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert12 -->
<g id="node816" class="node">
<title>R2_Stage4_L16_Expert12</title>
<polygon fill="lightgreen" stroke="black" points="21596,-689 21336,-689 21336,-631 21596,-631 21596,-689"/>
<text text-anchor="middle" x="21466" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 12 GPU 124</text>
<text text-anchor="middle" x="21466" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="21466" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert12 -->
<g id="edge1310" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21466,-798.81C21466,-798.81 21466,-699.01 21466,-699.01"/>
<polygon fill="black" stroke="black" points="21469.5,-699.01 21466,-689.01 21462.5,-699.01 21469.5,-699.01"/>
<text text-anchor="middle" x="21541.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert13 -->
<g id="node817" class="node">
<title>R2_Stage4_L16_Expert13</title>
<polygon fill="lightgreen" stroke="black" points="21892,-689 21632,-689 21632,-631 21892,-631 21892,-689"/>
<text text-anchor="middle" x="21762" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 13 GPU 125</text>
<text text-anchor="middle" x="21762" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="21762" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert13 -->
<g id="edge1311" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21762,-798.81C21762,-798.81 21762,-699.01 21762,-699.01"/>
<polygon fill="black" stroke="black" points="21765.5,-699.01 21762,-689.01 21758.5,-699.01 21765.5,-699.01"/>
<text text-anchor="middle" x="21731.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert14 -->
<g id="node818" class="node">
<title>R2_Stage4_L16_Expert14</title>
<polygon fill="lightgreen" stroke="black" points="22188,-689 21928,-689 21928,-631 22188,-631 22188,-689"/>
<text text-anchor="middle" x="22058" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 14 GPU 126</text>
<text text-anchor="middle" x="22058" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="22058" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert14 -->
<g id="edge1312" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21954.22,-850.86C21954.22,-850.86 21954.22,-699.01 21954.22,-699.01"/>
<polygon fill="black" stroke="black" points="21957.72,-699.01 21954.22,-689.01 21950.72,-699.01 21957.72,-699.01"/>
<text text-anchor="middle" x="21880.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_Expert15 -->
<g id="node819" class="node">
<title>R2_Stage4_L16_Expert15</title>
<polygon fill="lightgreen" stroke="black" points="22484,-689 22224,-689 22224,-631 22484,-631 22484,-689"/>
<text text-anchor="middle" x="22354" y="-668.5" font-family="Times,serif" font-size="10.00">Expert 15 GPU 127</text>
<text text-anchor="middle" x="22354" y="-657.5" font-family="Times,serif" font-size="10.00">Input: [batch_size=?, seq_len=?, hidden=512]</text>
<text text-anchor="middle" x="22354" y="-646.5" font-family="Times,serif" font-size="10.00">Output: [batch_size=?, seq_len=?, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert15 -->
<g id="edge1313" class="edge">
<title>R2_Stage4_L16_Router&#45;&gt;R2_Stage4_L16_Expert15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M21852.65,-802C22022.28,-802 22241.33,-802 22241.33,-802 22241.33,-802 22241.33,-699.08 22241.33,-699.08"/>
<polygon fill="black" stroke="black" points="22244.83,-699.08 22241.33,-689.08 22237.83,-699.08 22244.83,-699.08"/>
<text text-anchor="middle" x="21996.5" y="-751.8" font-family="Times,serif" font-size="14.00">select</text>
</g>
<!-- R2_Stage4_L16_MoE_Output -->
<g id="node820" class="node">
<title>R2_Stage4_L16_MoE_Output</title>
<polygon fill="lightyellow" stroke="black" points="24164.95,-535 23638.48,-535 23503.05,-431 24029.52,-431 24164.95,-535"/>
<text text-anchor="middle" x="23834" y="-497" font-family="Times,serif" font-size="10.00">MoE Output</text>
<text text-anchor="middle" x="23834" y="-486" font-family="Times,serif" font-size="10.00">Expert Aggregation</text>
<text text-anchor="middle" x="23834" y="-475" font-family="Times,serif" font-size="10.00">Input: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
<text text-anchor="middle" x="23834" y="-464" font-family="Times,serif" font-size="10.00">Output: [batch_size=128, seq_len=128&#45;10240, hidden=512]</text>
</g>
<!-- R2_Stage4_L16_Expert0&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1314" class="edge">
<title>R2_Stage4_L16_Expert0&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M22650,-630.68C22650,-583.51 22650,-496 22650,-496 22650,-496 23577.6,-496 23577.6,-496"/>
<polygon fill="black" stroke="black" points="23577.6,-499.5 23587.6,-496 23577.6,-492.5 23577.6,-499.5"/>
</g>
<!-- R2_Stage4_L16_Expert1&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1315" class="edge">
<title>R2_Stage4_L16_Expert1&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M22946,-630.89C22946,-587.01 22946,-509 22946,-509 22946,-509 23594.45,-509 23594.45,-509"/>
<polygon fill="black" stroke="black" points="23594.45,-512.5 23604.45,-509 23594.45,-505.5 23594.45,-512.5"/>
</g>
<!-- R2_Stage4_L16_Expert2&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1316" class="edge">
<title>R2_Stage4_L16_Expert2&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M23242,-630.73C23242,-590.23 23242,-522 23242,-522 23242,-522 23611.53,-522 23611.53,-522"/>
<polygon fill="black" stroke="black" points="23611.53,-525.5 23621.53,-522 23611.53,-518.5 23611.53,-525.5"/>
</g>
<!-- R2_Stage4_L16_Expert3&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1317" class="edge">
<title>R2_Stage4_L16_Expert3&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M23585.64,-630.77C23585.64,-630.77 23585.64,-504.66 23585.64,-504.66"/>
<polygon fill="black" stroke="black" points="23589.14,-504.66 23585.64,-494.66 23582.14,-504.66 23589.14,-504.66"/>
</g>
<!-- R2_Stage4_L16_Expert4&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1318" class="edge">
<title>R2_Stage4_L16_Expert4&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M23834,-630.77C23834,-630.77 23834,-545.18 23834,-545.18"/>
<polygon fill="black" stroke="black" points="23837.5,-545.18 23834,-535.18 23830.5,-545.18 23837.5,-545.18"/>
</g>
<!-- R2_Stage4_L16_Expert5&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1319" class="edge">
<title>R2_Stage4_L16_Expert5&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M24082.36,-630.77C24082.36,-630.77 24082.36,-545.18 24082.36,-545.18"/>
<polygon fill="black" stroke="black" points="24085.86,-545.18 24082.36,-535.18 24078.86,-545.18 24085.86,-545.18"/>
</g>
<!-- R2_Stage4_L16_Expert6&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1320" class="edge">
<title>R2_Stage4_L16_Expert6&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M24426,-630.86C24426,-593.37 24426,-533 24426,-533 24426,-533 24172.46,-533 24172.46,-533"/>
<polygon fill="black" stroke="black" points="24172.46,-529.5 24162.46,-533 24172.46,-536.5 24172.46,-529.5"/>
</g>
<!-- R2_Stage4_L16_Expert7&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1321" class="edge">
<title>R2_Stage4_L16_Expert7&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M24722,-630.73C24722,-592.67 24722,-531 24722,-531 24722,-531 24169.93,-531 24169.93,-531"/>
<polygon fill="black" stroke="black" points="24169.93,-527.5 24159.93,-531 24169.93,-534.5 24169.93,-527.5"/>
</g>
<!-- R2_Stage4_L16_Expert8&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1322" class="edge">
<title>R2_Stage4_L16_Expert8&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M25062.83,-630.83C25062.83,-592.5 25062.83,-530 25062.83,-530 25062.83,-530 24168.47,-530 24168.47,-530"/>
<polygon fill="black" stroke="black" points="24168.47,-526.5 24158.47,-530 24168.47,-533.5 24168.47,-526.5"/>
</g>
<!-- R2_Stage4_L16_Expert9&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1323" class="edge">
<title>R2_Stage4_L16_Expert9&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M25237.17,-630.7C25237.17,-591.82 25237.17,-528 25237.17,-528 25237.17,-528 24165.91,-528 24165.91,-528"/>
<polygon fill="black" stroke="black" points="24165.91,-524.5 24155.91,-528 24165.91,-531.5 24165.91,-524.5"/>
</g>
<!-- R2_Stage4_L16_Expert10&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1324" class="edge">
<title>R2_Stage4_L16_Expert10&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M25610,-630.92C25610,-591.51 25610,-526 25610,-526 25610,-526 24163.31,-526 24163.31,-526"/>
<polygon fill="black" stroke="black" points="24163.31,-522.5 24153.31,-526 24163.31,-529.5 24163.31,-522.5"/>
</g>
<!-- R2_Stage4_L16_Expert11&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1325" class="edge">
<title>R2_Stage4_L16_Expert11&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M25906,-630.71C25906,-591 25906,-525 25906,-525 25906,-525 24162.08,-525 24162.08,-525"/>
<polygon fill="black" stroke="black" points="24162.08,-521.5 24152.08,-525 24162.08,-528.5 24162.08,-521.5"/>
</g>
<!-- R2_Stage4_L16_Expert12&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1326" class="edge">
<title>R2_Stage4_L16_Expert12&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M21466,-630.87C21466,-571.91 21466,-444 21466,-444 21466,-444 23509.85,-444 23509.85,-444"/>
<polygon fill="black" stroke="black" points="23509.85,-447.5 23519.85,-444 23509.85,-440.5 23509.85,-447.5"/>
</g>
<!-- R2_Stage4_L16_Expert13&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1327" class="edge">
<title>R2_Stage4_L16_Expert13&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M21762,-630.92C21762,-574.78 21762,-457 21762,-457 21762,-457 23526.86,-457 23526.86,-457"/>
<polygon fill="black" stroke="black" points="23526.86,-460.5 23536.86,-457 23526.86,-453.5 23526.86,-460.5"/>
</g>
<!-- R2_Stage4_L16_Expert14&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1328" class="edge">
<title>R2_Stage4_L16_Expert14&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M22058,-630.73C22058,-577.43 22058,-470 22058,-470 22058,-470 23543.57,-470 23543.57,-470"/>
<polygon fill="black" stroke="black" points="23543.57,-473.5 23553.57,-470 23543.57,-466.5 23543.57,-473.5"/>
</g>
<!-- R2_Stage4_L16_Expert15&#45;&gt;R2_Stage4_L16_MoE_Output -->
<g id="edge1329" class="edge">
<title>R2_Stage4_L16_Expert15&#45;&gt;R2_Stage4_L16_MoE_Output</title>
<path fill="none" stroke="black" d="M22354,-630.77C22354,-580.5 22354,-483 22354,-483 22354,-483 23560.69,-483 23560.69,-483"/>
<polygon fill="black" stroke="black" points="23560.69,-486.5 23570.69,-483 23560.69,-479.5 23560.69,-486.5"/>
</g>
<!-- R2_Stage4_L16_MoE_Output&#45;&gt;R2_Stage4_L16_Output -->
<g id="edge1330" class="edge">
<title>R2_Stage4_L16_MoE_Output&#45;&gt;R2_Stage4_L16_Output</title>
<path fill="none" stroke="black" d="M24044.1,-442C24374.34,-442 24977.67,-442 24977.67,-442 24977.67,-442 24977.67,-361.87 24977.67,-361.87"/>
<polygon fill="black" stroke="black" points="24981.17,-361.87 24977.67,-351.87 24974.17,-361.87 24981.17,-361.87"/>
</g>
</g>
</svg>
