<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: LLM_Parallel_Deployment Pages: 1 -->
<svg width="7500pt" height="811pt"
 viewBox="0.00 0.00 1800.00 194.67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.78 0.78) rotate(0) translate(4 1040.62)">
<title>LLM_Parallel_Deployment</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1040.62 9655,-1040.62 9655,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="white" stroke="black" d="M2388,-780.08C2388,-780.08 2740,-780.08 2740,-780.08 2746,-780.08 2752,-786.08 2752,-792.08 2752,-792.08 2752,-865.08 2752,-865.08 2752,-871.08 2746,-877.08 2740,-877.08 2740,-877.08 2388,-877.08 2388,-877.08 2382,-877.08 2376,-871.08 2376,-865.08 2376,-865.08 2376,-792.08 2376,-792.08 2376,-786.08 2382,-780.08 2388,-780.08"/>
<text text-anchor="middle" x="2564" y="-861.88" font-family="Arial" font-size="14.00">Input Layer (Batch Size: 128, Seq Len: 10240)</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_gpu0</title>
<path fill="white" stroke="black" d="M20,-147.54C20,-147.54 3574,-147.54 3574,-147.54 3580,-147.54 3586,-153.54 3586,-159.54 3586,-159.54 3586,-729.08 3586,-729.08 3586,-735.08 3580,-741.08 3574,-741.08 3574,-741.08 20,-741.08 20,-741.08 14,-741.08 8,-735.08 8,-729.08 8,-729.08 8,-159.54 8,-159.54 8,-153.54 14,-147.54 20,-147.54"/>
<text text-anchor="middle" x="1797" y="-725.88" font-family="Arial" font-size="14.00">GPU 0 (Pipeline Stage 0, TP Group 0)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_gpu1</title>
<path fill="white" stroke="black" d="M5693,-147.54C5693,-147.54 9247,-147.54 9247,-147.54 9253,-147.54 9259,-153.54 9259,-159.54 9259,-159.54 9259,-729.08 9259,-729.08 9259,-735.08 9253,-741.08 9247,-741.08 9247,-741.08 5693,-741.08 5693,-741.08 5687,-741.08 5681,-735.08 5681,-729.08 5681,-729.08 5681,-159.54 5681,-159.54 5681,-153.54 5687,-147.54 5693,-147.54"/>
<text text-anchor="middle" x="7470" y="-725.88" font-family="Arial" font-size="14.00">GPU 1 (Pipeline Stage 0, TP Group 0)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_tp_comm</title>
<path fill="white" stroke="black" d="M3606,-244.54C3606,-244.54 5631,-244.54 5631,-244.54 5637,-244.54 5643,-250.54 5643,-256.54 5643,-256.54 5643,-345.08 5643,-345.08 5643,-351.08 5637,-357.08 5631,-357.08 5631,-357.08 3606,-357.08 3606,-357.08 3600,-357.08 3594,-351.08 3594,-345.08 3594,-345.08 3594,-256.54 3594,-256.54 3594,-250.54 3600,-244.54 3606,-244.54"/>
<text text-anchor="middle" x="4618.5" y="-341.88" font-family="Arial" font-size="14.00">Tensor Parallel Communication</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_ep_comm</title>
<path fill="white" stroke="black" d="M5217,-613.31C5217,-613.31 5661,-613.31 5661,-613.31 5667,-613.31 5673,-619.31 5673,-625.31 5673,-625.31 5673,-713.85 5673,-713.85 5673,-719.85 5667,-725.85 5661,-725.85 5661,-725.85 5217,-725.85 5217,-725.85 5211,-725.85 5205,-719.85 5205,-713.85 5205,-713.85 5205,-625.31 5205,-625.31 5205,-619.31 5211,-613.31 5217,-613.31"/>
<text text-anchor="middle" x="5439" y="-710.65" font-family="Arial" font-size="14.00">Expert Parallel Communication</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_pp_comm</title>
<path fill="white" stroke="black" d="M7874,-8C7874,-8 8366,-8 8366,-8 8372,-8 8378,-14 8378,-20 8378,-20 8378,-108.54 8378,-108.54 8378,-114.54 8372,-120.54 8366,-120.54 8366,-120.54 7874,-120.54 7874,-120.54 7868,-120.54 7862,-114.54 7862,-108.54 7862,-108.54 7862,-20 7862,-20 7862,-14 7868,-8 7874,-8"/>
<text text-anchor="middle" x="8120" y="-105.34" font-family="Arial" font-size="14.00">Pipeline Parallel Communication</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_dp_comm</title>
<path fill="white" stroke="black" d="M7232,-916.08C7232,-916.08 7670,-916.08 7670,-916.08 7676,-916.08 7682,-922.08 7682,-928.08 7682,-928.08 7682,-1016.62 7682,-1016.62 7682,-1022.62 7676,-1028.62 7670,-1028.62 7670,-1028.62 7232,-1028.62 7232,-1028.62 7226,-1028.62 7220,-1022.62 7220,-1016.62 7220,-1016.62 7220,-928.08 7220,-928.08 7220,-922.08 7226,-916.08 7232,-916.08"/>
<text text-anchor="middle" x="7451" y="-1013.42" font-family="Arial" font-size="14.00">Data Parallel Communication</text>
</g>
<g id="clust8" class="cluster">
<title>cluster_routing</title>
<path fill="white" stroke="black" d="M6703,-768.08C6703,-768.08 7785,-768.08 7785,-768.08 7791,-768.08 7797,-774.08 7797,-780.08 7797,-780.08 7797,-877.08 7797,-877.08 7797,-883.08 7791,-889.08 7785,-889.08 7785,-889.08 6703,-889.08 6703,-889.08 6697,-889.08 6691,-883.08 6691,-877.08 6691,-877.08 6691,-780.08 6691,-780.08 6691,-774.08 6697,-768.08 6703,-768.08"/>
<text text-anchor="middle" x="7244" y="-873.88" font-family="Arial" font-size="14.00">Routing &amp; Load Balancing</text>
</g>
<g id="clust9" class="cluster">
<title>cluster_output</title>
<path fill="white" stroke="black" d="M9279,-621.08C9279,-621.08 9631,-621.08 9631,-621.08 9637,-621.08 9643,-627.08 9643,-633.08 9643,-633.08 9643,-706.08 9643,-706.08 9643,-712.08 9637,-718.08 9631,-718.08 9631,-718.08 9279,-718.08 9279,-718.08 9273,-718.08 9267,-712.08 9267,-706.08 9267,-706.08 9267,-633.08 9267,-633.08 9267,-627.08 9273,-621.08 9279,-621.08"/>
<text text-anchor="middle" x="9455" y="-702.88" font-family="Arial" font-size="14.00">Output Layer</text>
</g>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="lightgreen" stroke="black" points="2744,-846.08 2384,-846.08 2384,-788.08 2744,-788.08 2744,-846.08"/>
<text text-anchor="middle" x="2564" y="-825.58" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="2564" y="-814.58" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="2564" y="-803.58" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu0_l0_q_proj -->
<g id="node2" class="node">
<title>gpu0_l0_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="291.5,-684.08 16.5,-684.08 16.5,-632.08 291.5,-632.08 291.5,-684.08"/>
<text text-anchor="middle" x="154" y="-672.08" font-family="Arial" font-size="10.00">Layer 0 Q Projection</text>
<text text-anchor="middle" x="154" y="-661.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="154" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="154" y="-639.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- input&#45;&gt;gpu0_l0_q_proj -->
<g id="edge1" class="edge">
<title>input&#45;&gt;gpu0_l0_q_proj</title>
<path fill="none" stroke="black" d="M2383.87,-812.57C2036.56,-805.42 1250.19,-787.29 589,-758.08 460.9,-752.42 424.09,-776.99 301,-741.08 263.37,-730.1 224.82,-708.12 196.64,-689.67"/>
<polygon fill="black" stroke="black" points="198.51,-686.71 188.25,-684.08 194.63,-692.54 198.51,-686.71"/>
<text text-anchor="middle" x="607" y="-751.68" font-family="Arial" font-size="8.00">batch split</text>
</g>
<!-- gpu0_l0_k_proj -->
<g id="node3" class="node">
<title>gpu0_l0_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="584.5,-684.08 309.5,-684.08 309.5,-632.08 584.5,-632.08 584.5,-684.08"/>
<text text-anchor="middle" x="447" y="-672.08" font-family="Arial" font-size="10.00">Layer 0 K Projection</text>
<text text-anchor="middle" x="447" y="-661.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="447" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="447" y="-639.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- input&#45;&gt;gpu0_l0_k_proj -->
<g id="edge2" class="edge">
<title>input&#45;&gt;gpu0_l0_k_proj</title>
<path fill="none" stroke="black" d="M2383.84,-811.16C2077.2,-802.5 1434.26,-783.04 891,-758.08 758.92,-752.01 720.96,-778 594,-741.08 556.36,-730.13 517.81,-708.15 489.64,-689.7"/>
<polygon fill="black" stroke="black" points="491.5,-686.73 481.24,-684.1 487.62,-692.56 491.5,-686.73"/>
<text text-anchor="middle" x="909" y="-751.68" font-family="Arial" font-size="8.00">batch split</text>
</g>
<!-- gpu0_l0_v_proj -->
<g id="node4" class="node">
<title>gpu0_l0_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="877.5,-684.08 602.5,-684.08 602.5,-632.08 877.5,-632.08 877.5,-684.08"/>
<text text-anchor="middle" x="740" y="-672.08" font-family="Arial" font-size="10.00">Layer 0 V Projection</text>
<text text-anchor="middle" x="740" y="-661.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="740" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="740" y="-639.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- input&#45;&gt;gpu0_l0_v_proj -->
<g id="edge3" class="edge">
<title>input&#45;&gt;gpu0_l0_v_proj</title>
<path fill="none" stroke="black" d="M2383.68,-812.74C1979.79,-804.58 1026.81,-781.3 886,-741.08 848.51,-730.37 810.22,-708.37 782.27,-689.86"/>
<polygon fill="black" stroke="black" points="784.19,-686.93 773.94,-684.24 780.27,-692.73 784.19,-686.93"/>
<text text-anchor="middle" x="994" y="-751.68" font-family="Arial" font-size="8.00">batch split</text>
</g>
<!-- gpu1_l0_q_proj -->
<g id="node29" class="node">
<title>gpu1_l0_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="6550.5,-684.08 6275.5,-684.08 6275.5,-632.08 6550.5,-632.08 6550.5,-684.08"/>
<text text-anchor="middle" x="6413" y="-672.08" font-family="Arial" font-size="10.00">Layer 0 Q Projection</text>
<text text-anchor="middle" x="6413" y="-661.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6413" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="6413" y="-639.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- input&#45;&gt;gpu1_l0_q_proj -->
<g id="edge4" class="edge">
<title>input&#45;&gt;gpu1_l0_q_proj</title>
<path fill="none" stroke="black" d="M2744.21,-809.69C3212.06,-793.1 4432.11,-749.93 4475,-749.08 4499.88,-748.59 6242.94,-747.43 6267,-741.08 6305.08,-731.02 6343.75,-708.65 6371.71,-689.8"/>
<polygon fill="black" stroke="black" points="6373.78,-692.63 6380.04,-684.09 6369.81,-686.86 6373.78,-692.63"/>
<text text-anchor="middle" x="4493" y="-751.68" font-family="Arial" font-size="8.00">batch split</text>
</g>
<!-- gpu1_l0_k_proj -->
<g id="node30" class="node">
<title>gpu1_l0_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="5964.5,-684.08 5689.5,-684.08 5689.5,-632.08 5964.5,-632.08 5964.5,-684.08"/>
<text text-anchor="middle" x="5827" y="-672.08" font-family="Arial" font-size="10.00">Layer 0 K Projection</text>
<text text-anchor="middle" x="5827" y="-661.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="5827" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="5827" y="-639.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- input&#45;&gt;gpu1_l0_k_proj -->
<g id="edge5" class="edge">
<title>input&#45;&gt;gpu1_l0_k_proj</title>
<path fill="none" stroke="black" d="M2744.43,-801.19C2952.42,-784.79 3304.64,-759.39 3608,-749.08 3636.72,-748.1 5649.17,-748.25 5677,-741.08 5715.94,-731.05 5755.68,-708.67 5784.46,-689.82"/>
<polygon fill="black" stroke="black" points="5786.65,-692.56 5793.03,-684.1 5782.77,-686.74 5786.65,-692.56"/>
<text text-anchor="middle" x="3626" y="-751.68" font-family="Arial" font-size="8.00">batch split</text>
</g>
<!-- gpu1_l0_v_proj -->
<g id="node31" class="node">
<title>gpu1_l0_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="6257.5,-684.08 5982.5,-684.08 5982.5,-632.08 6257.5,-632.08 6257.5,-684.08"/>
<text text-anchor="middle" x="6120" y="-672.08" font-family="Arial" font-size="10.00">Layer 0 V Projection</text>
<text text-anchor="middle" x="6120" y="-661.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6120" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="6120" y="-639.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- input&#45;&gt;gpu1_l0_v_proj -->
<g id="edge6" class="edge">
<title>input&#45;&gt;gpu1_l0_v_proj</title>
<path fill="none" stroke="black" d="M2744.12,-806.35C3040.52,-790.83 3649.77,-761.01 4166,-749.08 4191.1,-748.5 5949.72,-747.49 5974,-741.08 6012.08,-731.03 6050.75,-708.65 6078.71,-689.8"/>
<polygon fill="black" stroke="black" points="6080.78,-692.63 6087.04,-684.09 6076.81,-686.86 6080.78,-692.63"/>
<text text-anchor="middle" x="4184" y="-751.68" font-family="Arial" font-size="8.00">batch split</text>
</g>
<!-- gpu0_l0_attn_scores -->
<g id="node5" class="node">
<title>gpu0_l0_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="822.5,-551.08 547.5,-551.08 547.5,-499.08 822.5,-499.08 822.5,-551.08"/>
<text text-anchor="middle" x="685" y="-539.08" font-family="Arial" font-size="10.00">Layer 0 Attention Scores</text>
<text text-anchor="middle" x="685" y="-528.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="685" y="-517.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="685" y="-506.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l0_q_proj&#45;&gt;gpu0_l0_attn_scores -->
<g id="edge7" class="edge">
<title>gpu0_l0_q_proj&#45;&gt;gpu0_l0_attn_scores</title>
<path fill="none" stroke="black" d="M220.39,-632.02C245.43,-623.1 274.31,-613.45 301,-606.08 378.11,-584.77 465.31,-566.17 537.1,-552.28"/>
<polygon fill="black" stroke="black" points="537.97,-555.68 547.13,-550.35 536.65,-548.8 537.97,-555.68"/>
</g>
<!-- gpu0_l0_k_proj&#45;&gt;gpu0_l0_attn_scores -->
<g id="edge8" class="edge">
<title>gpu0_l0_k_proj&#45;&gt;gpu0_l0_attn_scores</title>
<path fill="none" stroke="black" d="M492.61,-631.98C531.97,-610.31 588.9,-578.97 630.62,-556.01"/>
<polygon fill="black" stroke="black" points="632.47,-558.98 639.55,-551.1 629.1,-552.85 632.47,-558.98"/>
</g>
<!-- gpu0_l0_v_proj&#45;&gt;gpu0_l0_attn_scores -->
<g id="edge9" class="edge">
<title>gpu0_l0_v_proj&#45;&gt;gpu0_l0_attn_scores</title>
<path fill="none" stroke="black" d="M729.4,-631.82C720.91,-611.61 708.93,-583.06 699.55,-560.72"/>
<polygon fill="black" stroke="black" points="702.67,-559.12 695.57,-551.26 696.22,-561.83 702.67,-559.12"/>
</g>
<!-- gpu0_l0_attn_output -->
<g id="node6" class="node">
<title>gpu0_l0_attn_output</title>
<polygon fill="lightgreen" stroke="black" points="2405,-444.08 2137,-444.08 2137,-392.08 2405,-392.08 2405,-444.08"/>
<text text-anchor="middle" x="2271" y="-432.08" font-family="Arial" font-size="10.00">Layer 0 Attention Output</text>
<text text-anchor="middle" x="2271" y="-421.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2271" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="2271" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu0_l0_attn_scores&#45;&gt;gpu0_l0_attn_output -->
<g id="edge10" class="edge">
<title>gpu0_l0_attn_scores&#45;&gt;gpu0_l0_attn_output</title>
<path fill="none" stroke="black" d="M822.54,-513.41C931.4,-505.39 1087.33,-494.83 1224,-489.08 1327.82,-484.71 2057.76,-494.46 2159,-471.08 2179.46,-466.35 2200.66,-457.63 2219.04,-448.66"/>
<polygon fill="black" stroke="black" points="2220.73,-451.73 2228.09,-444.11 2217.59,-445.47 2220.73,-451.73"/>
</g>
<!-- tp_l0_allreduce -->
<g id="node56" class="node">
<title>tp_l0_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="5388" cy="-289.31" rx="247.47" ry="36.54"/>
<text text-anchor="middle" x="5388" y="-303.31" font-family="Arial" font-size="10.00">TP All&#45;Reduce Layer 0</text>
<text text-anchor="middle" x="5388" y="-292.31" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="5388" y="-281.31" font-family="Arial" font-size="10.00">Input: partial attention results</text>
<text text-anchor="middle" x="5388" y="-270.31" font-family="Arial" font-size="10.00">Output: aggregated attention [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu0_l0_attn_output&#45;&gt;tp_l0_allreduce -->
<g id="edge15" class="edge">
<title>gpu0_l0_attn_output&#45;&gt;tp_l0_allreduce</title>
<path fill="none" stroke="black" d="M2405.05,-393.09C2408.39,-392.72 2411.72,-392.38 2415,-392.08 3016.03,-336.39 4532.77,-437.44 5131,-357.08 5179.31,-350.59 5231.56,-338.07 5276.25,-325.61"/>
<polygon fill="black" stroke="black" points="5277.29,-328.95 5285.96,-322.87 5275.39,-322.21 5277.29,-328.95"/>
<text text-anchor="middle" x="5078" y="-367.68" font-family="Arial" font-size="8.00">partial results</text>
</g>
<!-- gpu0_l0_gate -->
<g id="node7" class="node">
<title>gpu0_l0_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="2227.8,-710.08 1704.75,-710.08 1570.2,-606.08 2093.25,-606.08 2227.8,-710.08"/>
<text text-anchor="middle" x="1899" y="-672.08" font-family="Arial" font-size="10.00">Layer 0 Gate Router</text>
<text text-anchor="middle" x="1899" y="-661.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1899" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1899" y="-639.08" font-family="Arial" font-size="10.00">Output: routing decisions [batch_size=43, seq_len=10240, 8 experts]</text>
</g>
<!-- gpu0_l0_moe -->
<g id="node8" class="node">
<title>gpu0_l0_moe</title>
<polygon fill="lightgreen" stroke="black" points="1557,-561.08 1233,-561.08 1233,-489.08 1557,-489.08 1557,-561.08"/>
<text text-anchor="middle" x="1395" y="-539.08" font-family="Arial" font-size="10.00">Layer 0 MoE (8 Experts)</text>
<text text-anchor="middle" x="1395" y="-528.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1395" y="-517.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=256]</text>
<text text-anchor="middle" x="1395" y="-506.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu0_l0_gate&#45;&gt;gpu0_l0_moe -->
<g id="edge21" class="edge">
<title>gpu0_l0_gate&#45;&gt;gpu0_l0_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1702.7,-606.06C1648.3,-591.92 1590.25,-576.83 1539.41,-563.61"/>
<polygon fill="black" stroke="black" points="1540.23,-560.21 1529.67,-561.08 1538.46,-566.98 1540.23,-560.21"/>
<text text-anchor="middle" x="1658.5" y="-581.68" font-family="Arial" font-size="8.00">routing weights</text>
</g>
<!-- gpu0_l1_q_proj -->
<g id="node9" class="node">
<title>gpu0_l1_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="1239.5,-444.08 964.5,-444.08 964.5,-392.08 1239.5,-392.08 1239.5,-444.08"/>
<text text-anchor="middle" x="1102" y="-432.08" font-family="Arial" font-size="10.00">Layer 1 Q Projection</text>
<text text-anchor="middle" x="1102" y="-421.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1102" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1102" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l0_moe&#45;&gt;gpu0_l1_q_proj -->
<g id="edge27" class="edge">
<title>gpu0_l0_moe&#45;&gt;gpu0_l1_q_proj</title>
<path fill="none" stroke="black" d="M1297.03,-488.97C1259.62,-475.56 1217.45,-460.45 1181.92,-447.72"/>
<polygon fill="black" stroke="black" points="1182.68,-444.27 1172.09,-444.19 1180.32,-450.86 1182.68,-444.27"/>
<text text-anchor="middle" x="1273.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu0_l1_k_proj -->
<g id="node10" class="node">
<title>gpu0_l1_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="1532.5,-444.08 1257.5,-444.08 1257.5,-392.08 1532.5,-392.08 1532.5,-444.08"/>
<text text-anchor="middle" x="1395" y="-432.08" font-family="Arial" font-size="10.00">Layer 1 K Projection</text>
<text text-anchor="middle" x="1395" y="-421.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1395" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1395" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l0_moe&#45;&gt;gpu0_l1_k_proj -->
<g id="edge28" class="edge">
<title>gpu0_l0_moe&#45;&gt;gpu0_l1_k_proj</title>
<path fill="none" stroke="black" d="M1395,-488.82C1395,-477.72 1395,-465.45 1395,-454.34"/>
<polygon fill="black" stroke="black" points="1398.5,-454.13 1395,-444.13 1391.5,-454.13 1398.5,-454.13"/>
<text text-anchor="middle" x="1429.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu0_l1_v_proj -->
<g id="node11" class="node">
<title>gpu0_l1_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="946.5,-444.08 671.5,-444.08 671.5,-392.08 946.5,-392.08 946.5,-444.08"/>
<text text-anchor="middle" x="809" y="-432.08" font-family="Arial" font-size="10.00">Layer 1 V Projection</text>
<text text-anchor="middle" x="809" y="-421.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="809" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="809" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l0_moe&#45;&gt;gpu0_l1_v_proj -->
<g id="edge29" class="edge">
<title>gpu0_l0_moe&#45;&gt;gpu0_l1_v_proj</title>
<path fill="none" stroke="black" d="M1232.93,-495.04C1146.42,-479.54 1040.74,-460.6 956.53,-445.51"/>
<polygon fill="black" stroke="black" points="957.09,-442.06 946.63,-443.74 955.86,-448.95 957.09,-442.06"/>
<text text-anchor="middle" x="1118.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- ep_all2all -->
<g id="node60" class="node">
<title>ep_all2all</title>
<ellipse fill="lightblue" stroke="black" cx="5439" cy="-658.08" rx="226.05" ry="36.54"/>
<text text-anchor="middle" x="5439" y="-672.08" font-family="Arial" font-size="10.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="5439" y="-661.08" font-family="Arial" font-size="10.00">GPUs: 0,1,2,3,4,5,6,7</text>
<text text-anchor="middle" x="5439" y="-650.08" font-family="Arial" font-size="10.00">Input: token representations</text>
<text text-anchor="middle" x="5439" y="-639.08" font-family="Arial" font-size="10.00">Output: routed tokens [batch_size=86, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu0_l0_moe&#45;&gt;ep_all2all -->
<g id="edge23" class="edge">
<title>gpu0_l0_moe&#45;&gt;ep_all2all</title>
<path fill="none" stroke="black" d="M1557.13,-532.53C1755.59,-540.24 2101.95,-553.1 2399,-561.08 2822.48,-572.46 2928.54,-567.17 3352,-579.08 4028.74,-598.11 4828.54,-630.88 5211.87,-647.21"/>
<polygon fill="black" stroke="black" points="5211.83,-650.72 5221.97,-647.65 5212.13,-643.72 5211.83,-650.72"/>
<text text-anchor="middle" x="3662" y="-581.68" font-family="Arial" font-size="8.00">tokens to route</text>
</g>
<!-- gpu0_l1_attn_scores -->
<g id="node12" class="node">
<title>gpu0_l1_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="1348.5,-315.31 1073.5,-315.31 1073.5,-263.31 1348.5,-263.31 1348.5,-315.31"/>
<text text-anchor="middle" x="1211" y="-303.31" font-family="Arial" font-size="10.00">Layer 1 Attention Scores</text>
<text text-anchor="middle" x="1211" y="-292.31" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1211" y="-281.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="1211" y="-270.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l1_q_proj&#45;&gt;gpu0_l1_attn_scores -->
<g id="edge33" class="edge">
<title>gpu0_l1_q_proj&#45;&gt;gpu0_l1_attn_scores</title>
<path fill="none" stroke="black" d="M1123.53,-392.03C1140.44,-372.37 1164.13,-344.82 1182.59,-323.35"/>
<polygon fill="black" stroke="black" points="1185.27,-325.6 1189.14,-315.74 1179.96,-321.04 1185.27,-325.6"/>
</g>
<!-- gpu0_l1_k_proj&#45;&gt;gpu0_l1_attn_scores -->
<g id="edge34" class="edge">
<title>gpu0_l1_k_proj&#45;&gt;gpu0_l1_attn_scores</title>
<path fill="none" stroke="black" d="M1358.65,-392.03C1329.26,-371.78 1287.73,-343.17 1256.2,-321.45"/>
<polygon fill="black" stroke="black" points="1257.81,-318.31 1247.59,-315.52 1253.84,-324.07 1257.81,-318.31"/>
</g>
<!-- gpu0_l1_v_proj&#45;&gt;gpu0_l1_attn_scores -->
<g id="edge35" class="edge">
<title>gpu0_l1_v_proj&#45;&gt;gpu0_l1_attn_scores</title>
<path fill="none" stroke="black" d="M888.42,-392.03C955.62,-370.84 1051.87,-340.49 1121.72,-318.46"/>
<polygon fill="black" stroke="black" points="1122.92,-321.76 1131.4,-315.41 1120.81,-315.08 1122.92,-321.76"/>
</g>
<!-- gpu0_l1_attn_output -->
<g id="node13" class="node">
<title>gpu0_l1_attn_output</title>
<polygon fill="lightgreen" stroke="black" points="1609,-207.54 1341,-207.54 1341,-155.54 1609,-155.54 1609,-207.54"/>
<text text-anchor="middle" x="1475" y="-195.54" font-family="Arial" font-size="10.00">Layer 1 Attention Output</text>
<text text-anchor="middle" x="1475" y="-184.54" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1475" y="-173.54" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="1475" y="-162.54" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu0_l1_attn_scores&#45;&gt;gpu0_l1_attn_output -->
<g id="edge36" class="edge">
<title>gpu0_l1_attn_scores&#45;&gt;gpu0_l1_attn_output</title>
<path fill="none" stroke="black" d="M1273.56,-263.24C1312.47,-247.66 1362.61,-227.57 1403.14,-211.33"/>
<polygon fill="black" stroke="black" points="1404.45,-214.58 1412.43,-207.61 1401.84,-208.08 1404.45,-214.58"/>
</g>
<!-- tp_l1_allreduce -->
<g id="node57" class="node">
<title>tp_l1_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="3849" cy="-289.31" rx="247.47" ry="36.54"/>
<text text-anchor="middle" x="3849" y="-303.31" font-family="Arial" font-size="10.00">TP All&#45;Reduce Layer 1</text>
<text text-anchor="middle" x="3849" y="-292.31" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="3849" y="-281.31" font-family="Arial" font-size="10.00">Input: partial attention results</text>
<text text-anchor="middle" x="3849" y="-270.31" font-family="Arial" font-size="10.00">Output: aggregated attention [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu0_l1_attn_output&#45;&gt;tp_l1_allreduce -->
<g id="edge41" class="edge">
<title>gpu0_l1_attn_output&#45;&gt;tp_l1_allreduce</title>
<path fill="none" stroke="black" d="M1609.11,-189.24C1723.57,-194.78 1892.56,-202.52 2040,-207.54 2728.69,-230.99 2904.06,-178.74 3590,-244.54 3623.16,-247.72 3658.48,-252.65 3692.03,-258.07"/>
<polygon fill="black" stroke="black" points="3691.47,-261.52 3701.91,-259.69 3692.6,-254.62 3691.47,-261.52"/>
<text text-anchor="middle" x="3495" y="-228.14" font-family="Arial" font-size="8.00">partial results</text>
</g>
<!-- gpu0_l1_gate -->
<g id="node14" class="node">
<title>gpu0_l1_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="2902.8,-710.08 2379.75,-710.08 2245.2,-606.08 2768.25,-606.08 2902.8,-710.08"/>
<text text-anchor="middle" x="2574" y="-672.08" font-family="Arial" font-size="10.00">Layer 1 Gate Router</text>
<text text-anchor="middle" x="2574" y="-661.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2574" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="2574" y="-639.08" font-family="Arial" font-size="10.00">Output: routing decisions [batch_size=43, seq_len=10240, 8 experts]</text>
</g>
<!-- gpu0_l1_moe -->
<g id="node15" class="node">
<title>gpu0_l1_moe</title>
<polygon fill="lightgreen" stroke="black" points="2732,-561.08 2408,-561.08 2408,-489.08 2732,-489.08 2732,-561.08"/>
<text text-anchor="middle" x="2570" y="-539.08" font-family="Arial" font-size="10.00">Layer 1 MoE (8 Experts)</text>
<text text-anchor="middle" x="2570" y="-528.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2570" y="-517.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=256]</text>
<text text-anchor="middle" x="2570" y="-506.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu0_l1_gate&#45;&gt;gpu0_l1_moe -->
<g id="edge47" class="edge">
<title>gpu0_l1_gate&#45;&gt;gpu0_l1_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2572.44,-606.06C2572.1,-594.73 2571.73,-582.8 2571.39,-571.71"/>
<polygon fill="black" stroke="black" points="2574.88,-571.27 2571.08,-561.38 2567.88,-571.48 2574.88,-571.27"/>
<text text-anchor="middle" x="2598.5" y="-581.68" font-family="Arial" font-size="8.00">routing weights</text>
</g>
<!-- gpu0_l2_q_proj -->
<g id="node16" class="node">
<title>gpu0_l2_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="2118.5,-444.08 1843.5,-444.08 1843.5,-392.08 2118.5,-392.08 2118.5,-444.08"/>
<text text-anchor="middle" x="1981" y="-432.08" font-family="Arial" font-size="10.00">Layer 2 Q Projection</text>
<text text-anchor="middle" x="1981" y="-421.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1981" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1981" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l1_moe&#45;&gt;gpu0_l2_q_proj -->
<g id="edge49" class="edge">
<title>gpu0_l1_moe&#45;&gt;gpu0_l2_q_proj</title>
<path fill="none" stroke="black" d="M2407.88,-495.18C2320.59,-479.62 2213.69,-460.56 2128.71,-445.41"/>
<polygon fill="black" stroke="black" points="2129.18,-441.94 2118.72,-443.63 2127.95,-448.83 2129.18,-441.94"/>
<text text-anchor="middle" x="2291.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu0_l2_k_proj -->
<g id="node17" class="node">
<title>gpu0_l2_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="2698.5,-444.08 2423.5,-444.08 2423.5,-392.08 2698.5,-392.08 2698.5,-444.08"/>
<text text-anchor="middle" x="2561" y="-432.08" font-family="Arial" font-size="10.00">Layer 2 K Projection</text>
<text text-anchor="middle" x="2561" y="-421.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2561" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="2561" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l1_moe&#45;&gt;gpu0_l2_k_proj -->
<g id="edge50" class="edge">
<title>gpu0_l1_moe&#45;&gt;gpu0_l2_k_proj</title>
<path fill="none" stroke="black" d="M2566.98,-488.82C2566.03,-477.72 2564.97,-465.45 2564.02,-454.34"/>
<polygon fill="black" stroke="black" points="2567.49,-453.79 2563.15,-444.13 2560.51,-454.39 2567.49,-453.79"/>
<text text-anchor="middle" x="2599.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu0_l2_v_proj -->
<g id="node18" class="node">
<title>gpu0_l2_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="1825.5,-444.08 1550.5,-444.08 1550.5,-392.08 1825.5,-392.08 1825.5,-444.08"/>
<text text-anchor="middle" x="1688" y="-432.08" font-family="Arial" font-size="10.00">Layer 2 V Projection</text>
<text text-anchor="middle" x="1688" y="-421.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1688" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1688" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l1_moe&#45;&gt;gpu0_l2_v_proj -->
<g id="edge51" class="edge">
<title>gpu0_l1_moe&#45;&gt;gpu0_l2_v_proj</title>
<path fill="none" stroke="black" d="M2407.99,-509.26C2261.23,-495.19 2038.88,-472.22 1835.65,-444.13"/>
<polygon fill="black" stroke="black" points="1836.06,-440.66 1825.68,-442.75 1835.1,-447.59 1836.06,-440.66"/>
<text text-anchor="middle" x="2070.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu0_l2_attn_scores -->
<g id="node19" class="node">
<title>gpu0_l2_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="1978.5,-315.31 1703.5,-315.31 1703.5,-263.31 1978.5,-263.31 1978.5,-315.31"/>
<text text-anchor="middle" x="1841" y="-303.31" font-family="Arial" font-size="10.00">Layer 2 AttentionScores</text>
<text text-anchor="middle" x="1841" y="-292.31" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1841" y="-281.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="1841" y="-270.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l2_q_proj&#45;&gt;gpu0_l2_attn_scores -->
<g id="edge55" class="edge">
<title>gpu0_l2_q_proj&#45;&gt;gpu0_l2_attn_scores</title>
<path fill="none" stroke="black" d="M1953.34,-392.03C1931.34,-372.11 1900.39,-344.09 1876.55,-322.5"/>
<polygon fill="black" stroke="black" points="1878.84,-319.85 1869.08,-315.74 1874.14,-325.04 1878.84,-319.85"/>
</g>
<!-- gpu0_l2_k_proj&#45;&gt;gpu0_l2_attn_scores -->
<g id="edge56" class="edge">
<title>gpu0_l2_k_proj&#45;&gt;gpu0_l2_attn_scores</title>
<path fill="none" stroke="black" d="M2423.35,-393.21C2420.21,-392.81 2417.09,-392.43 2414,-392.08 2225.28,-370.28 2170.77,-408.9 1988,-357.08 1956.4,-348.12 1922.93,-333.37 1895.92,-320.01"/>
<polygon fill="black" stroke="black" points="1897.16,-316.72 1886.65,-315.36 1894.01,-322.97 1897.16,-316.72"/>
</g>
<!-- gpu0_l2_v_proj&#45;&gt;gpu0_l2_attn_scores -->
<g id="edge57" class="edge">
<title>gpu0_l2_v_proj&#45;&gt;gpu0_l2_attn_scores</title>
<path fill="none" stroke="black" d="M1718.23,-392.03C1742.46,-371.96 1776.61,-343.66 1802.74,-322.01"/>
<polygon fill="black" stroke="black" points="1805.11,-324.59 1810.57,-315.52 1800.64,-319.2 1805.11,-324.59"/>
</g>
<!-- gpu0_l2_attn_output -->
<g id="node20" class="node">
<title>gpu0_l2_attn_output</title>
<polygon fill="lightgreen" stroke="black" points="2317,-207.54 2049,-207.54 2049,-155.54 2317,-155.54 2317,-207.54"/>
<text text-anchor="middle" x="2183" y="-195.54" font-family="Arial" font-size="10.00">Layer 2 Attention Output</text>
<text text-anchor="middle" x="2183" y="-184.54" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2183" y="-173.54" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="2183" y="-162.54" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu0_l2_attn_scores&#45;&gt;gpu0_l2_attn_output -->
<g id="edge58" class="edge">
<title>gpu0_l2_attn_scores&#45;&gt;gpu0_l2_attn_output</title>
<path fill="none" stroke="black" d="M1922.05,-263.24C1973.19,-247.43 2039.33,-226.97 2092.22,-210.61"/>
<polygon fill="black" stroke="black" points="2093.42,-213.91 2101.94,-207.61 2091.35,-207.22 2093.42,-213.91"/>
</g>
<!-- tp_l2_allreduce -->
<g id="node58" class="node">
<title>tp_l2_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="4362" cy="-289.31" rx="247.47" ry="36.54"/>
<text text-anchor="middle" x="4362" y="-303.31" font-family="Arial" font-size="10.00">TP All&#45;Reduce Layer 2</text>
<text text-anchor="middle" x="4362" y="-292.31" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="4362" y="-281.31" font-family="Arial" font-size="10.00">Input: partial attention results</text>
<text text-anchor="middle" x="4362" y="-270.31" font-family="Arial" font-size="10.00">Output: aggregated attention [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu0_l2_attn_output&#45;&gt;tp_l2_allreduce -->
<g id="edge63" class="edge">
<title>gpu0_l2_attn_output&#45;&gt;tp_l2_allreduce</title>
<path fill="none" stroke="black" d="M2317.17,-188.58C2439.95,-193.99 2626.68,-201.91 2789,-207.54 3373.77,-227.82 3522.71,-187.06 4105,-244.54 4137.55,-247.75 4172.21,-252.64 4205.19,-258"/>
<polygon fill="black" stroke="black" points="4204.93,-261.51 4215.36,-259.68 4206.07,-254.6 4204.93,-261.51"/>
<text text-anchor="middle" x="3997" y="-228.14" font-family="Arial" font-size="8.00">partial results</text>
</g>
<!-- gpu0_l2_gate -->
<g id="node21" class="node">
<title>gpu0_l2_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3577.8,-710.08 3054.75,-710.08 2920.2,-606.08 3443.25,-606.08 3577.8,-710.08"/>
<text text-anchor="middle" x="3249" y="-672.08" font-family="Arial" font-size="10.00">Layer 2 Gate Router</text>
<text text-anchor="middle" x="3249" y="-661.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="3249" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="3249" y="-639.08" font-family="Arial" font-size="10.00">Output: routing decisions [batch_size=43, seq_len=10240, 8 experts]</text>
</g>
<!-- gpu0_l2_moe -->
<g id="node22" class="node">
<title>gpu0_l2_moe</title>
<polygon fill="lightgreen" stroke="black" points="3486,-561.08 3162,-561.08 3162,-489.08 3486,-489.08 3486,-561.08"/>
<text text-anchor="middle" x="3324" y="-539.08" font-family="Arial" font-size="10.00">Layer 2 MoE (8 Experts)</text>
<text text-anchor="middle" x="3324" y="-528.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="3324" y="-517.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=256]</text>
<text text-anchor="middle" x="3324" y="-506.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu0_l2_gate&#45;&gt;gpu0_l2_moe -->
<g id="edge69" class="edge">
<title>gpu0_l2_gate&#45;&gt;gpu0_l2_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3278.21,-606.06C3284.96,-594.26 3292.09,-581.81 3298.66,-570.34"/>
<polygon fill="black" stroke="black" points="3301.86,-571.8 3303.79,-561.38 3295.78,-568.32 3301.86,-571.8"/>
<text text-anchor="middle" x="3320.5" y="-581.68" font-family="Arial" font-size="8.00">routing weights</text>
</g>
<!-- gpu0_l3_q_proj -->
<g id="node23" class="node">
<title>gpu0_l3_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="3284.5,-444.08 3009.5,-444.08 3009.5,-392.08 3284.5,-392.08 3284.5,-444.08"/>
<text text-anchor="middle" x="3147" y="-432.08" font-family="Arial" font-size="10.00">Layer 3 Q Projection</text>
<text text-anchor="middle" x="3147" y="-421.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="3147" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="3147" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l2_moe&#45;&gt;gpu0_l3_q_proj -->
<g id="edge71" class="edge">
<title>gpu0_l2_moe&#45;&gt;gpu0_l3_q_proj</title>
<path fill="none" stroke="black" d="M3264.57,-488.82C3242.95,-476 3218.73,-461.63 3197.92,-449.28"/>
<polygon fill="black" stroke="black" points="3199.61,-446.22 3189.22,-444.13 3196.04,-452.24 3199.61,-446.22"/>
<text text-anchor="middle" x="3264.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu0_l3_k_proj -->
<g id="node24" class="node">
<title>gpu0_l3_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="3577.5,-444.08 3302.5,-444.08 3302.5,-392.08 3577.5,-392.08 3577.5,-444.08"/>
<text text-anchor="middle" x="3440" y="-432.08" font-family="Arial" font-size="10.00">Layer 3 K Projection</text>
<text text-anchor="middle" x="3440" y="-421.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="3440" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="3440" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l2_moe&#45;&gt;gpu0_l3_k_proj -->
<g id="edge72" class="edge">
<title>gpu0_l2_moe&#45;&gt;gpu0_l3_k_proj</title>
<path fill="none" stroke="black" d="M3362.95,-488.82C3376.48,-476.57 3391.58,-462.91 3404.79,-450.95"/>
<polygon fill="black" stroke="black" points="3407.26,-453.43 3412.33,-444.13 3402.57,-448.24 3407.26,-453.43"/>
<text text-anchor="middle" x="3426.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu0_l3_v_proj -->
<g id="node25" class="node">
<title>gpu0_l3_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="2991.5,-444.08 2716.5,-444.08 2716.5,-392.08 2991.5,-392.08 2991.5,-444.08"/>
<text text-anchor="middle" x="2854" y="-432.08" font-family="Arial" font-size="10.00">Layer 3 V Projection</text>
<text text-anchor="middle" x="2854" y="-421.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2854" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="2854" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l2_moe&#45;&gt;gpu0_l3_v_proj -->
<g id="edge73" class="edge">
<title>gpu0_l2_moe&#45;&gt;gpu0_l3_v_proj</title>
<path fill="none" stroke="black" d="M3167.17,-489.04C3104.97,-475.15 3034.51,-459.41 2976.21,-446.38"/>
<polygon fill="black" stroke="black" points="2976.74,-442.91 2966.21,-444.15 2975.21,-449.74 2976.74,-442.91"/>
<text text-anchor="middle" x="3108.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu0_l3_attn_scores -->
<g id="node26" class="node">
<title>gpu0_l3_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="2271.5,-315.31 1996.5,-315.31 1996.5,-263.31 2271.5,-263.31 2271.5,-315.31"/>
<text text-anchor="middle" x="2134" y="-303.31" font-family="Arial" font-size="10.00">Layer 3 Attention Scores</text>
<text text-anchor="middle" x="2134" y="-292.31" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2134" y="-281.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="2134" y="-270.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l3_q_proj&#45;&gt;gpu0_l3_attn_scores -->
<g id="edge77" class="edge">
<title>gpu0_l3_q_proj&#45;&gt;gpu0_l3_attn_scores</title>
<path fill="none" stroke="black" d="M3009.13,-392.91C3006.4,-392.61 3003.69,-392.33 3001,-392.08 2977.16,-389.8 2156.26,-390.68 2139,-374.08 2126.39,-361.95 2124.51,-342.77 2126.07,-325.82"/>
<polygon fill="black" stroke="black" points="2129.57,-326.01 2127.42,-315.64 2122.64,-325.09 2129.57,-326.01"/>
</g>
<!-- gpu0_l3_k_proj&#45;&gt;gpu0_l3_attn_scores -->
<g id="edge78" class="edge">
<title>gpu0_l3_k_proj&#45;&gt;gpu0_l3_attn_scores</title>
<path fill="none" stroke="black" d="M3302.12,-393.01C3299.39,-392.68 3296.68,-392.37 3294,-392.08 3126.36,-373.81 3083.13,-387.08 2915,-374.08 2693.99,-356.99 2438.75,-327.83 2281.87,-308.81"/>
<polygon fill="black" stroke="black" points="2282.03,-305.31 2271.68,-307.58 2281.18,-312.26 2282.03,-305.31"/>
</g>
<!-- gpu0_l3_v_proj&#45;&gt;gpu0_l3_attn_scores -->
<g id="edge79" class="edge">
<title>gpu0_l3_v_proj&#45;&gt;gpu0_l3_attn_scores</title>
<path fill="none" stroke="black" d="M2716.13,-392.95C2713.4,-392.64 2710.69,-392.35 2708,-392.08 2676.15,-388.87 2154.28,-397.07 2132,-374.08 2119.84,-361.53 2119.53,-342.33 2122.63,-325.47"/>
<polygon fill="black" stroke="black" points="2126.12,-325.88 2124.92,-315.36 2119.29,-324.33 2126.12,-325.88"/>
</g>
<!-- gpu0_l3_attn_output -->
<g id="node27" class="node">
<title>gpu0_l3_attn_output</title>
<polygon fill="lightgreen" stroke="black" points="3066,-207.54 2798,-207.54 2798,-155.54 3066,-155.54 3066,-207.54"/>
<text text-anchor="middle" x="2932" y="-195.54" font-family="Arial" font-size="10.00">Layer 3 Attention Output</text>
<text text-anchor="middle" x="2932" y="-184.54" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2932" y="-173.54" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="2932" y="-162.54" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu0_l3_attn_scores&#45;&gt;gpu0_l3_attn_output -->
<g id="edge80" class="edge">
<title>gpu0_l3_attn_scores&#45;&gt;gpu0_l3_attn_output</title>
<path fill="none" stroke="black" d="M2129.8,-263.22C2129.13,-250.14 2131.04,-234.95 2141,-225.54 2152.58,-214.59 2562.27,-196.95 2787.35,-188.05"/>
<polygon fill="black" stroke="black" points="2787.74,-191.54 2797.59,-187.65 2787.46,-184.54 2787.74,-191.54"/>
</g>
<!-- tp_l3_allreduce -->
<g id="node59" class="node">
<title>tp_l3_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="4875" cy="-289.31" rx="247.47" ry="36.54"/>
<text text-anchor="middle" x="4875" y="-303.31" font-family="Arial" font-size="10.00">TP All&#45;Reduce Layer 3</text>
<text text-anchor="middle" x="4875" y="-292.31" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="4875" y="-281.31" font-family="Arial" font-size="10.00">Input: partial attention results</text>
<text text-anchor="middle" x="4875" y="-270.31" font-family="Arial" font-size="10.00">Output: aggregated attention [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu0_l3_attn_output&#45;&gt;tp_l3_allreduce -->
<g id="edge85" class="edge">
<title>gpu0_l3_attn_output&#45;&gt;tp_l3_allreduce</title>
<path fill="none" stroke="black" d="M3066.11,-185.16C3410.16,-192.24 4318.1,-213.39 4618,-244.54 4650.23,-247.89 4684.53,-252.78 4717.23,-258.11"/>
<polygon fill="black" stroke="black" points="4716.89,-261.6 4727.32,-259.77 4718.02,-254.69 4716.89,-261.6"/>
<text text-anchor="middle" x="4504" y="-228.14" font-family="Arial" font-size="8.00">partial results</text>
</g>
<!-- gpu0_l3_gate -->
<g id="node28" class="node">
<title>gpu0_l3_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1552.8,-710.08 1029.75,-710.08 895.2,-606.08 1418.25,-606.08 1552.8,-710.08"/>
<text text-anchor="middle" x="1224" y="-672.08" font-family="Arial" font-size="10.00">Layer 3 Gate Router</text>
<text text-anchor="middle" x="1224" y="-661.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1224" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1224" y="-639.08" font-family="Arial" font-size="10.00">Output: routing decisions [batch_size=43, seq_len=10240, 8 experts]</text>
</g>
<!-- gpu0_l3_moe -->
<g id="node66" class="node">
<title>gpu0_l3_moe</title>
<polygon fill="lightgrey" stroke="black" points="5368,-199.54 5294,-199.54 5294,-163.54 5368,-163.54 5368,-199.54"/>
<text text-anchor="middle" x="5331" y="-179.04" font-family="Arial" font-size="10.00">gpu0_l3_moe</text>
</g>
<!-- gpu0_l3_gate&#45;&gt;gpu0_l3_moe -->
<g id="edge91" class="edge">
<title>gpu0_l3_gate&#45;&gt;gpu0_l3_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M896.72,-607.45C893.46,-606.99 890.22,-606.53 887,-606.08 809.78,-595.24 600.13,-609.49 539,-561.08 478.16,-512.89 440.66,-447.5 495,-392.08 529.74,-356.65 2231.45,-359.69 2281,-357.08 2864.11,-326.33 3007.15,-279.95 3590,-244.54 4261.73,-203.73 5081.01,-187.02 5283.89,-183.35"/>
<polygon fill="black" stroke="black" points="5283.97,-186.85 5293.91,-183.17 5283.85,-179.85 5283.97,-186.85"/>
<text text-anchor="middle" x="522.5" y="-416.18" font-family="Arial" font-size="8.00">routing weights</text>
</g>
<!-- gpu1_l0_attn_scores -->
<g id="node32" class="node">
<title>gpu1_l0_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="6159.5,-551.08 5884.5,-551.08 5884.5,-499.08 6159.5,-499.08 6159.5,-551.08"/>
<text text-anchor="middle" x="6022" y="-539.08" font-family="Arial" font-size="10.00">Layer 0 Attention Scores</text>
<text text-anchor="middle" x="6022" y="-528.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6022" y="-517.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="6022" y="-506.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l0_q_proj&#45;&gt;gpu1_l0_attn_scores -->
<g id="edge11" class="edge">
<title>gpu1_l0_q_proj&#45;&gt;gpu1_l0_attn_scores</title>
<path fill="none" stroke="black" d="M6342.18,-632.01C6318.33,-623.66 6291.55,-614.37 6267,-606.08 6215.06,-588.53 6156.71,-569.45 6109.99,-554.33"/>
<polygon fill="black" stroke="black" points="6110.79,-550.91 6100.2,-551.16 6108.64,-557.57 6110.79,-550.91"/>
</g>
<!-- gpu1_l0_k_proj&#45;&gt;gpu1_l0_attn_scores -->
<g id="edge12" class="edge">
<title>gpu1_l0_k_proj&#45;&gt;gpu1_l0_attn_scores</title>
<path fill="none" stroke="black" d="M5864.6,-631.82C5896.43,-610.44 5942.17,-579.71 5976.15,-556.88"/>
<polygon fill="black" stroke="black" points="5978.17,-559.74 5984.52,-551.26 5974.26,-553.93 5978.17,-559.74"/>
</g>
<!-- gpu1_l0_v_proj&#45;&gt;gpu1_l0_attn_scores -->
<g id="edge13" class="edge">
<title>gpu1_l0_v_proj&#45;&gt;gpu1_l0_attn_scores</title>
<path fill="none" stroke="black" d="M6101.1,-631.82C6085.72,-611.25 6063.86,-582.04 6047.02,-559.53"/>
<polygon fill="black" stroke="black" points="6049.63,-557.17 6040.84,-551.26 6044.03,-561.36 6049.63,-557.17"/>
</g>
<!-- gpu1_l0_attn_output -->
<g id="node33" class="node">
<title>gpu1_l0_attn_output</title>
<polygon fill="lightgreen" stroke="black" points="5957,-444.08 5689,-444.08 5689,-392.08 5957,-392.08 5957,-444.08"/>
<text text-anchor="middle" x="5823" y="-432.08" font-family="Arial" font-size="10.00">Layer 0 Attention Output</text>
<text text-anchor="middle" x="5823" y="-421.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="5823" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="5823" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu1_l0_attn_scores&#45;&gt;gpu1_l0_attn_output -->
<g id="edge14" class="edge">
<title>gpu1_l0_attn_scores&#45;&gt;gpu1_l0_attn_output</title>
<path fill="none" stroke="black" d="M5974.59,-499.06C5946.04,-484 5909.53,-464.73 5879.49,-448.89"/>
<polygon fill="black" stroke="black" points="5880.87,-445.66 5870.39,-444.09 5877.6,-451.85 5880.87,-445.66"/>
</g>
<!-- gpu1_l0_attn_output&#45;&gt;tp_l0_allreduce -->
<g id="edge16" class="edge">
<title>gpu1_l0_attn_output&#45;&gt;tp_l0_allreduce</title>
<path fill="none" stroke="black" d="M5737.06,-392.03C5671.42,-372.9 5580.17,-346.31 5507.44,-325.12"/>
<polygon fill="black" stroke="black" points="5508.34,-321.73 5497.76,-322.29 5506.38,-328.45 5508.34,-321.73"/>
<text text-anchor="middle" x="5693" y="-367.68" font-family="Arial" font-size="8.00">partial results</text>
</g>
<!-- gpu1_l0_gate -->
<g id="node34" class="node">
<title>gpu1_l0_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="7225.8,-710.08 6702.75,-710.08 6568.2,-606.08 7091.25,-606.08 7225.8,-710.08"/>
<text text-anchor="middle" x="6897" y="-672.08" font-family="Arial" font-size="10.00">Layer 0 Gate Router</text>
<text text-anchor="middle" x="6897" y="-661.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6897" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="6897" y="-639.08" font-family="Arial" font-size="10.00">Output: routing decisions [batch_size=43, seq_len=10240, 8 experts]</text>
</g>
<!-- gpu1_l0_moe -->
<g id="node35" class="node">
<title>gpu1_l0_moe</title>
<polygon fill="lightgreen" stroke="black" points="6568,-561.08 6244,-561.08 6244,-489.08 6568,-489.08 6568,-561.08"/>
<text text-anchor="middle" x="6406" y="-539.08" font-family="Arial" font-size="10.00">Layer 0 MoE (8 Experts)</text>
<text text-anchor="middle" x="6406" y="-528.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6406" y="-517.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=256]</text>
<text text-anchor="middle" x="6406" y="-506.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu1_l0_gate&#45;&gt;gpu1_l0_moe -->
<g id="edge22" class="edge">
<title>gpu1_l0_gate&#45;&gt;gpu1_l0_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6705.76,-606.06C6652.87,-591.95 6596.45,-576.89 6546.99,-563.69"/>
<polygon fill="black" stroke="black" points="6547.76,-560.28 6537.19,-561.08 6545.95,-567.04 6547.76,-560.28"/>
<text text-anchor="middle" x="6663.5" y="-581.68" font-family="Arial" font-size="8.00">routing weights</text>
</g>
<!-- gpu1_l1_q_proj -->
<g id="node36" class="node">
<title>gpu1_l1_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="6836.5,-444.08 6561.5,-444.08 6561.5,-392.08 6836.5,-392.08 6836.5,-444.08"/>
<text text-anchor="middle" x="6699" y="-432.08" font-family="Arial" font-size="10.00">Layer 1 Q Projection</text>
<text text-anchor="middle" x="6699" y="-421.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6699" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="6699" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l0_moe&#45;&gt;gpu1_l1_q_proj -->
<g id="edge30" class="edge">
<title>gpu1_l0_moe&#45;&gt;gpu1_l1_q_proj</title>
<path fill="none" stroke="black" d="M6503.97,-488.97C6541.38,-475.56 6583.55,-460.45 6619.08,-447.72"/>
<polygon fill="black" stroke="black" points="6620.68,-450.86 6628.91,-444.19 6618.32,-444.27 6620.68,-450.86"/>
<text text-anchor="middle" x="6612.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu1_l1_k_proj -->
<g id="node37" class="node">
<title>gpu1_l1_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="6250.5,-444.08 5975.5,-444.08 5975.5,-392.08 6250.5,-392.08 6250.5,-444.08"/>
<text text-anchor="middle" x="6113" y="-432.08" font-family="Arial" font-size="10.00">Layer 1 K Projection</text>
<text text-anchor="middle" x="6113" y="-421.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6113" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="6113" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l0_moe&#45;&gt;gpu1_l1_k_proj -->
<g id="edge31" class="edge">
<title>gpu1_l0_moe&#45;&gt;gpu1_l1_k_proj</title>
<path fill="none" stroke="black" d="M6308.03,-488.97C6270.62,-475.56 6228.45,-460.45 6192.92,-447.72"/>
<polygon fill="black" stroke="black" points="6193.68,-444.27 6183.09,-444.19 6191.32,-450.86 6193.68,-444.27"/>
<text text-anchor="middle" x="6284.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu1_l1_v_proj -->
<g id="node38" class="node">
<title>gpu1_l1_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="6543.5,-444.08 6268.5,-444.08 6268.5,-392.08 6543.5,-392.08 6543.5,-444.08"/>
<text text-anchor="middle" x="6406" y="-432.08" font-family="Arial" font-size="10.00">Layer 1 V Projection</text>
<text text-anchor="middle" x="6406" y="-421.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6406" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="6406" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l0_moe&#45;&gt;gpu1_l1_v_proj -->
<g id="edge32" class="edge">
<title>gpu1_l0_moe&#45;&gt;gpu1_l1_v_proj</title>
<path fill="none" stroke="black" d="M6406,-488.82C6406,-477.72 6406,-465.45 6406,-454.34"/>
<polygon fill="black" stroke="black" points="6409.5,-454.13 6406,-444.13 6402.5,-454.13 6409.5,-454.13"/>
<text text-anchor="middle" x="6440.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu1_l0_moe&#45;&gt;ep_all2all -->
<g id="edge24" class="edge">
<title>gpu1_l0_moe&#45;&gt;ep_all2all</title>
<path fill="none" stroke="black" d="M6243.74,-552.56C6218.77,-555.91 6193.23,-558.91 6169,-561.08 6043.66,-572.29 5725.3,-549.43 5603,-579.08 5569.55,-587.19 5534.8,-602.57 5505.94,-617.54"/>
<polygon fill="black" stroke="black" points="5503.99,-614.61 5496.79,-622.38 5507.27,-620.8 5503.99,-614.61"/>
<text text-anchor="middle" x="5630" y="-581.68" font-family="Arial" font-size="8.00">tokens to route</text>
</g>
<!-- gpu1_l1_attn_scores -->
<g id="node39" class="node">
<title>gpu1_l1_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="6825.5,-315.31 6550.5,-315.31 6550.5,-263.31 6825.5,-263.31 6825.5,-315.31"/>
<text text-anchor="middle" x="6688" y="-303.31" font-family="Arial" font-size="10.00">Layer 1 Attention Scores</text>
<text text-anchor="middle" x="6688" y="-292.31" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6688" y="-281.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="6688" y="-270.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l1_q_proj&#45;&gt;gpu1_l1_attn_scores -->
<g id="edge37" class="edge">
<title>gpu1_l1_q_proj&#45;&gt;gpu1_l1_attn_scores</title>
<path fill="none" stroke="black" d="M6696.83,-392.03C6695.19,-373.14 6692.92,-346.98 6691.09,-325.92"/>
<polygon fill="black" stroke="black" points="6694.56,-325.4 6690.21,-315.74 6687.58,-326 6694.56,-325.4"/>
</g>
<!-- gpu1_l1_k_proj&#45;&gt;gpu1_l1_attn_scores -->
<g id="edge38" class="edge">
<title>gpu1_l1_k_proj&#45;&gt;gpu1_l1_attn_scores</title>
<path fill="none" stroke="black" d="M6226.6,-392.03C6324,-370.56 6464.05,-339.68 6564.27,-317.59"/>
<polygon fill="black" stroke="black" points="6565.13,-320.98 6574.14,-315.41 6563.62,-314.15 6565.13,-320.98"/>
</g>
<!-- gpu1_l1_v_proj&#45;&gt;gpu1_l1_attn_scores -->
<g id="edge39" class="edge">
<title>gpu1_l1_v_proj&#45;&gt;gpu1_l1_attn_scores</title>
<path fill="none" stroke="black" d="M6543.69,-393.51C6546.82,-393.02 6549.93,-392.55 6553,-392.08 6582.7,-387.56 6667.08,-396.57 6687,-374.08 6698.5,-361.09 6699.5,-342.03 6697.29,-325.36"/>
<polygon fill="black" stroke="black" points="6700.72,-324.63 6695.56,-315.38 6693.82,-325.83 6700.72,-324.63"/>
</g>
<!-- gpu1_l1_attn_output -->
<g id="node40" class="node">
<title>gpu1_l1_attn_output</title>
<polygon fill="lightgreen" stroke="black" points="6292,-207.54 6024,-207.54 6024,-155.54 6292,-155.54 6292,-207.54"/>
<text text-anchor="middle" x="6158" y="-195.54" font-family="Arial" font-size="10.00">Layer 1 Attention Output</text>
<text text-anchor="middle" x="6158" y="-184.54" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6158" y="-173.54" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="6158" y="-162.54" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu1_l1_attn_scores&#45;&gt;gpu1_l1_attn_output -->
<g id="edge40" class="edge">
<title>gpu1_l1_attn_scores&#45;&gt;gpu1_l1_attn_output</title>
<path fill="none" stroke="black" d="M6562.4,-263.24C6481.51,-247.1 6376.39,-226.12 6293.6,-209.6"/>
<polygon fill="black" stroke="black" points="6294.11,-206.13 6283.62,-207.61 6292.74,-213 6294.11,-206.13"/>
</g>
<!-- gpu1_l1_attn_output&#45;&gt;tp_l1_allreduce -->
<g id="edge42" class="edge">
<title>gpu1_l1_attn_output&#45;&gt;tp_l1_allreduce</title>
<path fill="none" stroke="black" d="M6023.97,-187.44C5868.41,-192.98 5604.16,-201.96 5377,-207.54 4909.07,-219.03 4791.44,-201.2 4324,-225.54 4226.88,-230.6 4202.46,-232.14 4106,-244.54 4075.32,-248.48 4042.7,-253.44 4011.36,-258.59"/>
<polygon fill="black" stroke="black" points="4010.53,-255.18 4001.24,-260.27 4011.67,-262.09 4010.53,-255.18"/>
<text text-anchor="middle" x="4348" y="-228.14" font-family="Arial" font-size="8.00">partial results</text>
</g>
<!-- gpu1_l1_gate -->
<g id="node41" class="node">
<title>gpu1_l1_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="7900.8,-710.08 7377.75,-710.08 7243.2,-606.08 7766.25,-606.08 7900.8,-710.08"/>
<text text-anchor="middle" x="7572" y="-672.08" font-family="Arial" font-size="10.00">Layer 1 Gate Router</text>
<text text-anchor="middle" x="7572" y="-661.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="7572" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="7572" y="-639.08" font-family="Arial" font-size="10.00">Output: routing decisions [batch_size=43, seq_len=10240, 8 experts]</text>
</g>
<!-- gpu1_l1_moe -->
<g id="node42" class="node">
<title>gpu1_l1_moe</title>
<polygon fill="lightgreen" stroke="black" points="7251,-561.08 6927,-561.08 6927,-489.08 7251,-489.08 7251,-561.08"/>
<text text-anchor="middle" x="7089" y="-539.08" font-family="Arial" font-size="10.00">Layer 1 MoE (8 Experts)</text>
<text text-anchor="middle" x="7089" y="-528.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="7089" y="-517.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=256]</text>
<text text-anchor="middle" x="7089" y="-506.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu1_l1_gate&#45;&gt;gpu1_l1_moe -->
<g id="edge48" class="edge">
<title>gpu1_l1_gate&#45;&gt;gpu1_l1_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7383.88,-606.06C7331.96,-591.97 7276.58,-576.95 7228,-563.78"/>
<polygon fill="black" stroke="black" points="7228.62,-560.32 7218.06,-561.08 7226.79,-567.08 7228.62,-560.32"/>
<text text-anchor="middle" x="7343.5" y="-581.68" font-family="Arial" font-size="8.00">routing weights</text>
</g>
<!-- gpu1_l2_q_proj -->
<g id="node43" class="node">
<title>gpu1_l2_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="7422.5,-444.08 7147.5,-444.08 7147.5,-392.08 7422.5,-392.08 7422.5,-444.08"/>
<text text-anchor="middle" x="7285" y="-432.08" font-family="Arial" font-size="10.00">Layer 2 Q Projection</text>
<text text-anchor="middle" x="7285" y="-421.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="7285" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="7285" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l1_moe&#45;&gt;gpu1_l2_q_proj -->
<g id="edge52" class="edge">
<title>gpu1_l1_moe&#45;&gt;gpu1_l2_q_proj</title>
<path fill="none" stroke="black" d="M7154.54,-488.97C7178.71,-476.02 7205.84,-461.48 7229.08,-449.03"/>
<polygon fill="black" stroke="black" points="7230.95,-452 7238.12,-444.19 7227.65,-445.83 7230.95,-452"/>
<text text-anchor="middle" x="7238.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu1_l2_k_proj -->
<g id="node44" class="node">
<title>gpu1_l2_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="7715.5,-444.08 7440.5,-444.08 7440.5,-392.08 7715.5,-392.08 7715.5,-444.08"/>
<text text-anchor="middle" x="7578" y="-432.08" font-family="Arial" font-size="10.00">Layer 2 K Projection</text>
<text text-anchor="middle" x="7578" y="-421.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="7578" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="7578" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l1_moe&#45;&gt;gpu1_l2_k_proj -->
<g id="edge53" class="edge">
<title>gpu1_l1_moe&#45;&gt;gpu1_l2_k_proj</title>
<path fill="none" stroke="black" d="M7251.15,-489.26C7316.33,-475.26 7390.35,-459.37 7451.45,-446.25"/>
<polygon fill="black" stroke="black" points="7452.49,-449.61 7461.53,-444.09 7451.02,-442.76 7452.49,-449.61"/>
<text text-anchor="middle" x="7411.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu1_l2_v_proj -->
<g id="node45" class="node">
<title>gpu1_l2_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="7129.5,-444.08 6854.5,-444.08 6854.5,-392.08 7129.5,-392.08 7129.5,-444.08"/>
<text text-anchor="middle" x="6992" y="-432.08" font-family="Arial" font-size="10.00">Layer 2 V Projection</text>
<text text-anchor="middle" x="6992" y="-421.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6992" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="6992" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l1_moe&#45;&gt;gpu1_l2_v_proj -->
<g id="edge54" class="edge">
<title>gpu1_l1_moe&#45;&gt;gpu1_l2_v_proj</title>
<path fill="none" stroke="black" d="M7056.43,-488.82C7045.32,-476.8 7032.96,-463.42 7022.06,-451.62"/>
<polygon fill="black" stroke="black" points="7024.5,-449.1 7015.14,-444.13 7019.35,-453.85 7024.5,-449.1"/>
<text text-anchor="middle" x="7071.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu1_l2_attn_scores -->
<g id="node46" class="node">
<title>gpu1_l2_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="7203.5,-315.31 6928.5,-315.31 6928.5,-263.31 7203.5,-263.31 7203.5,-315.31"/>
<text text-anchor="middle" x="7066" y="-303.31" font-family="Arial" font-size="10.00">Layer 2 Attention Scores</text>
<text text-anchor="middle" x="7066" y="-292.31" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="7066" y="-281.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="7066" y="-270.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l2_q_proj&#45;&gt;gpu1_l2_attn_scores -->
<g id="edge59" class="edge">
<title>gpu1_l2_q_proj&#45;&gt;gpu1_l2_attn_scores</title>
<path fill="none" stroke="black" d="M7241.73,-392.03C7206.3,-371.52 7156.06,-342.44 7118.36,-320.62"/>
<polygon fill="black" stroke="black" points="7119.96,-317.5 7109.55,-315.52 7116.45,-323.56 7119.96,-317.5"/>
</g>
<!-- gpu1_l2_k_proj&#45;&gt;gpu1_l2_attn_scores -->
<g id="edge60" class="edge">
<title>gpu1_l2_k_proj&#45;&gt;gpu1_l2_attn_scores</title>
<path fill="none" stroke="black" d="M7476.85,-392.03C7390.47,-370.65 7266.42,-339.93 7177.26,-317.86"/>
<polygon fill="black" stroke="black" points="7177.93,-314.42 7167.38,-315.41 7176.25,-321.21 7177.93,-314.42"/>
</g>
<!-- gpu1_l2_v_proj&#45;&gt;gpu1_l2_attn_scores -->
<g id="edge61" class="edge">
<title>gpu1_l2_v_proj&#45;&gt;gpu1_l2_attn_scores</title>
<path fill="none" stroke="black" d="M7006.62,-392.03C7017.9,-372.71 7033.62,-345.78 7046.05,-324.48"/>
<polygon fill="black" stroke="black" points="7049.14,-326.14 7051.16,-315.74 7043.09,-322.61 7049.14,-326.14"/>
</g>
<!-- gpu1_l2_attn_output -->
<g id="node47" class="node">
<title>gpu1_l2_attn_output</title>
<polygon fill="lightgreen" stroke="black" points="6746,-207.54 6478,-207.54 6478,-155.54 6746,-155.54 6746,-207.54"/>
<text text-anchor="middle" x="6612" y="-195.54" font-family="Arial" font-size="10.00">Layer 2 Attention Output</text>
<text text-anchor="middle" x="6612" y="-184.54" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="6612" y="-173.54" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="6612" y="-162.54" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu1_l2_attn_scores&#45;&gt;gpu1_l2_attn_output -->
<g id="edge62" class="edge">
<title>gpu1_l2_attn_scores&#45;&gt;gpu1_l2_attn_output</title>
<path fill="none" stroke="black" d="M6958.41,-263.24C6889.54,-247.2 6800.17,-226.38 6729.46,-209.9"/>
<polygon fill="black" stroke="black" points="6730.14,-206.47 6719.61,-207.61 6728.55,-213.29 6730.14,-206.47"/>
</g>
<!-- gpu1_l2_attn_output&#45;&gt;tp_l2_allreduce -->
<g id="edge64" class="edge">
<title>gpu1_l2_attn_output&#45;&gt;tp_l2_allreduce</title>
<path fill="none" stroke="black" d="M6477.78,-194.94C6423,-199.58 6359.01,-204.47 6301,-207.54 6066.36,-219.96 5478.91,-229.66 5244,-234.54 5105.12,-237.42 4757.31,-231.73 4619,-244.54 4586.12,-247.58 4551.11,-252.45 4517.85,-257.85"/>
<polygon fill="black" stroke="black" points="4516.89,-254.46 4507.59,-259.54 4518.03,-261.37 4516.89,-254.46"/>
<text text-anchor="middle" x="5698" y="-228.14" font-family="Arial" font-size="8.00">partial results</text>
</g>
<!-- gpu1_l2_gate -->
<g id="node48" class="node">
<title>gpu1_l2_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="8575.8,-710.08 8052.75,-710.08 7918.2,-606.08 8441.25,-606.08 8575.8,-710.08"/>
<text text-anchor="middle" x="8247" y="-672.08" font-family="Arial" font-size="10.00">Layer 2 Gate Router</text>
<text text-anchor="middle" x="8247" y="-661.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="8247" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="8247" y="-639.08" font-family="Arial" font-size="10.00">Output: routing decisions [batch_size=43, seq_len=10240, 8 experts]</text>
</g>
<!-- gpu1_l2_moe -->
<g id="node49" class="node">
<title>gpu1_l2_moe</title>
<polygon fill="lightgreen" stroke="black" points="8216,-561.08 7892,-561.08 7892,-489.08 8216,-489.08 8216,-561.08"/>
<text text-anchor="middle" x="8054" y="-539.08" font-family="Arial" font-size="10.00">Layer 2 MoE (8 Experts)</text>
<text text-anchor="middle" x="8054" y="-528.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="8054" y="-517.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=256]</text>
<text text-anchor="middle" x="8054" y="-506.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu1_l2_gate&#45;&gt;gpu1_l2_moe -->
<g id="edge70" class="edge">
<title>gpu1_l2_gate&#45;&gt;gpu1_l2_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M8171.83,-606.06C8152.82,-593.15 8132.65,-579.46 8114.47,-567.12"/>
<polygon fill="black" stroke="black" points="8115.95,-563.9 8105.71,-561.18 8112.02,-569.69 8115.95,-563.9"/>
<text text-anchor="middle" x="8171.5" y="-581.68" font-family="Arial" font-size="8.00">routing weights</text>
</g>
<!-- gpu1_l3_q_proj -->
<g id="node50" class="node">
<title>gpu1_l3_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="8594.5,-444.08 8319.5,-444.08 8319.5,-392.08 8594.5,-392.08 8594.5,-444.08"/>
<text text-anchor="middle" x="8457" y="-432.08" font-family="Arial" font-size="10.00">Layer 3 Q Projection</text>
<text text-anchor="middle" x="8457" y="-421.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="8457" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="8457" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l2_moe&#45;&gt;gpu1_l3_q_proj -->
<g id="edge74" class="edge">
<title>gpu1_l2_moe&#45;&gt;gpu1_l3_q_proj</title>
<path fill="none" stroke="black" d="M8188.47,-489.04C8241.37,-475.26 8301.22,-459.67 8350.97,-446.7"/>
<polygon fill="black" stroke="black" points="8351.99,-450.06 8360.78,-444.15 8350.22,-443.28 8351.99,-450.06"/>
<text text-anchor="middle" x="8325.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu1_l3_k_proj -->
<g id="node51" class="node">
<title>gpu1_l3_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="8008.5,-444.08 7733.5,-444.08 7733.5,-392.08 8008.5,-392.08 8008.5,-444.08"/>
<text text-anchor="middle" x="7871" y="-432.08" font-family="Arial" font-size="10.00">Layer 3 K Projection</text>
<text text-anchor="middle" x="7871" y="-421.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="7871" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="7871" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l2_moe&#45;&gt;gpu1_l3_k_proj -->
<g id="edge75" class="edge">
<title>gpu1_l2_moe&#45;&gt;gpu1_l3_k_proj</title>
<path fill="none" stroke="black" d="M7992.81,-488.97C7970.34,-476.08 7945.13,-461.61 7923.5,-449.2"/>
<polygon fill="black" stroke="black" points="7925.19,-446.14 7914.77,-444.19 7921.71,-452.21 7925.19,-446.14"/>
<text text-anchor="middle" x="7991.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu1_l3_v_proj -->
<g id="node52" class="node">
<title>gpu1_l3_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="8301.5,-444.08 8026.5,-444.08 8026.5,-392.08 8301.5,-392.08 8301.5,-444.08"/>
<text text-anchor="middle" x="8164" y="-432.08" font-family="Arial" font-size="10.00">Layer 3 V Projection</text>
<text text-anchor="middle" x="8164" y="-421.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="8164" y="-410.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="8164" y="-399.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l2_moe&#45;&gt;gpu1_l3_v_proj -->
<g id="edge76" class="edge">
<title>gpu1_l2_moe&#45;&gt;gpu1_l3_v_proj</title>
<path fill="none" stroke="black" d="M8090.93,-488.82C8103.65,-476.69 8117.81,-463.17 8130.26,-451.28"/>
<polygon fill="black" stroke="black" points="8132.94,-453.56 8137.76,-444.13 8128.11,-448.5 8132.94,-453.56"/>
<text text-anchor="middle" x="8152.5" y="-464.68" font-family="Arial" font-size="8.00">residual connection</text>
</g>
<!-- gpu1_l3_attn_scores -->
<g id="node53" class="node">
<title>gpu1_l3_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="8154.5,-315.31 7879.5,-315.31 7879.5,-263.31 8154.5,-263.31 8154.5,-315.31"/>
<text text-anchor="middle" x="8017" y="-303.31" font-family="Arial" font-size="10.00">Layer 3 Attention Scores</text>
<text text-anchor="middle" x="8017" y="-292.31" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="8017" y="-281.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="8017" y="-270.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l3_q_proj&#45;&gt;gpu1_l3_attn_scores -->
<g id="edge81" class="edge">
<title>gpu1_l3_q_proj&#45;&gt;gpu1_l3_attn_scores</title>
<path fill="none" stroke="black" d="M8370.07,-392.03C8296.22,-370.75 8190.31,-340.24 8113.78,-318.19"/>
<polygon fill="black" stroke="black" points="8114.7,-314.82 8104.12,-315.41 8112.77,-321.54 8114.7,-314.82"/>
</g>
<!-- gpu1_l3_k_proj&#45;&gt;gpu1_l3_attn_scores -->
<g id="edge82" class="edge">
<title>gpu1_l3_k_proj&#45;&gt;gpu1_l3_attn_scores</title>
<path fill="none" stroke="black" d="M7899.84,-392.03C7922.79,-372.11 7955.06,-344.09 7979.92,-322.5"/>
<polygon fill="black" stroke="black" points="7982.46,-324.94 7987.72,-315.74 7977.87,-319.65 7982.46,-324.94"/>
</g>
<!-- gpu1_l3_v_proj&#45;&gt;gpu1_l3_attn_scores -->
<g id="edge83" class="edge">
<title>gpu1_l3_v_proj&#45;&gt;gpu1_l3_attn_scores</title>
<path fill="none" stroke="black" d="M8134.96,-392.03C8111.78,-372.04 8079.15,-343.91 8054.08,-322.29"/>
<polygon fill="black" stroke="black" points="8056.09,-319.4 8046.23,-315.52 8051.52,-324.7 8056.09,-319.4"/>
</g>
<!-- gpu1_l3_attn_output -->
<g id="node54" class="node">
<title>gpu1_l3_attn_output</title>
<polygon fill="lightgreen" stroke="black" points="7518,-207.54 7250,-207.54 7250,-155.54 7518,-155.54 7518,-207.54"/>
<text text-anchor="middle" x="7384" y="-195.54" font-family="Arial" font-size="10.00">Layer 3 Attention Output</text>
<text text-anchor="middle" x="7384" y="-184.54" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="7384" y="-173.54" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="7384" y="-162.54" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=256]</text>
</g>
<!-- gpu1_l3_attn_scores&#45;&gt;gpu1_l3_attn_output -->
<g id="edge84" class="edge">
<title>gpu1_l3_attn_scores&#45;&gt;gpu1_l3_attn_output</title>
<path fill="none" stroke="black" d="M7879.26,-265.29C7775.5,-247.96 7633.6,-224.24 7528.28,-206.65"/>
<polygon fill="black" stroke="black" points="7528.64,-203.16 7518.2,-204.96 7527.49,-210.06 7528.64,-203.16"/>
</g>
<!-- gpu1_l3_attn_output&#45;&gt;tp_l3_allreduce -->
<g id="edge86" class="edge">
<title>gpu1_l3_attn_output&#45;&gt;tp_l3_allreduce</title>
<path fill="none" stroke="black" d="M7249.97,-188.39C7122.64,-193.83 6925.81,-201.9 6755,-207.54 6297.76,-222.62 6183.38,-224.69 5726,-234.54 5594.01,-237.38 5263.45,-232.31 5132,-244.54 5099.12,-247.6 5064.11,-252.47 5030.86,-257.87"/>
<polygon fill="black" stroke="black" points="5029.89,-254.48 5020.6,-259.56 5031.03,-261.39 5029.89,-254.48"/>
<text text-anchor="middle" x="6160" y="-228.14" font-family="Arial" font-size="8.00">partial results</text>
</g>
<!-- gpu1_l3_gate -->
<g id="node55" class="node">
<title>gpu1_l3_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="9250.8,-710.08 8727.75,-710.08 8593.2,-606.08 9116.25,-606.08 9250.8,-710.08"/>
<text text-anchor="middle" x="8922" y="-672.08" font-family="Arial" font-size="10.00">Layer 3 Gate Router</text>
<text text-anchor="middle" x="8922" y="-661.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="8922" y="-650.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="8922" y="-639.08" font-family="Arial" font-size="10.00">Output: routing decisions [batch_size=43, seq_len=10240, 8 experts]</text>
</g>
<!-- gpu1_l3_moe -->
<g id="node67" class="node">
<title>gpu1_l3_moe</title>
<polygon fill="lightgrey" stroke="black" points="9387,-199.54 9313,-199.54 9313,-163.54 9387,-163.54 9387,-199.54"/>
<text text-anchor="middle" x="9350" y="-179.04" font-family="Arial" font-size="10.00">gpu1_l3_moe</text>
</g>
<!-- gpu1_l3_gate&#45;&gt;gpu1_l3_moe -->
<g id="edge92" class="edge">
<title>gpu1_l3_gate&#45;&gt;gpu1_l3_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M9139.25,-623.67C9180.33,-617.62 9222.96,-611.51 9263,-606.08 9328.66,-597.18 9350.48,-615.06 9411,-588.08 9449.26,-571.02 9482,-567.97 9482,-526.08 9482,-526.08 9482,-526.08 9482,-288.31 9482,-243.23 9434.55,-214.19 9396.54,-198.15"/>
<polygon fill="black" stroke="black" points="9397.7,-194.85 9387.12,-194.35 9395.09,-201.34 9397.7,-194.85"/>
<text text-anchor="middle" x="9509.5" y="-416.18" font-family="Arial" font-size="8.00">routing weights</text>
</g>
<!-- tp_l0_allreduce&#45;&gt;gpu0_l0_moe -->
<g id="edge17" class="edge">
<title>tp_l0_allreduce&#45;&gt;gpu0_l0_moe</title>
<path fill="none" stroke="black" d="M5286.29,-322.9C5239.52,-336.29 5182.99,-350.23 5131,-357.08 5115.28,-359.15 577.17,-380.83 566,-392.08 549.72,-408.48 550.46,-426.97 566,-444.08 587.8,-468.08 986.26,-497.74 1222.7,-513.33"/>
<polygon fill="black" stroke="black" points="1222.57,-516.83 1232.78,-513.99 1223.03,-509.84 1222.57,-516.83"/>
<text text-anchor="middle" x="614.5" y="-416.18" font-family="Arial" font-size="8.00">aggregated [d_model=512]</text>
</g>
<!-- tp_l0_allreduce&#45;&gt;gpu1_l0_moe -->
<g id="edge18" class="edge">
<title>tp_l0_allreduce&#45;&gt;gpu1_l0_moe</title>
<path fill="none" stroke="black" d="M5491.34,-322.8C5538.85,-336.16 5596.25,-350.12 5649,-357.08 5689.69,-362.45 8575.15,-362.88 8604,-392.08 8682.93,-471.95 8476.08,-464.09 8364,-471.08 7722.53,-511.05 7560.19,-463.15 6918,-489.08 6804.71,-493.65 6677.54,-502.33 6578.28,-509.9"/>
<polygon fill="black" stroke="black" points="6577.86,-506.42 6568.15,-510.67 6578.39,-513.4 6577.86,-506.42"/>
<text text-anchor="middle" x="8669.5" y="-416.18" font-family="Arial" font-size="8.00">aggregated [d_model=512]</text>
</g>
<!-- tp_l1_allreduce&#45;&gt;gpu0_l1_moe -->
<g id="edge43" class="edge">
<title>tp_l1_allreduce&#45;&gt;gpu0_l1_moe</title>
<path fill="none" stroke="black" d="M3799.71,-325.62C3748.77,-360.55 3665.79,-413.13 3587,-444.08 3535.31,-464.38 3520.01,-463.45 3465,-471.08 3327.42,-490.15 3291.66,-480.92 3153,-489.08 3014.81,-497.21 2858.21,-506.62 2742.13,-513.64"/>
<polygon fill="black" stroke="black" points="2741.86,-510.15 2732.09,-514.25 2742.28,-517.14 2741.86,-510.15"/>
<text text-anchor="middle" x="3739.5" y="-416.18" font-family="Arial" font-size="8.00">aggregated [d_model=512]</text>
</g>
<!-- tp_l1_allreduce&#45;&gt;gpu1_l1_moe -->
<g id="edge44" class="edge">
<title>tp_l1_allreduce&#45;&gt;gpu1_l1_moe</title>
<path fill="none" stroke="black" d="M3879.41,-325.84C3913.8,-363.12 3973.61,-419.65 4039,-444.08 4200.84,-504.55 4643.27,-467.19 4816,-471.08 5598.51,-488.67 5794.89,-458.37 6577,-489.08 6690.29,-493.53 6817.47,-502.2 6916.73,-509.8"/>
<polygon fill="black" stroke="black" points="6916.61,-513.3 6926.85,-510.58 6917.15,-506.32 6916.61,-513.3"/>
<text text-anchor="middle" x="4087.5" y="-416.18" font-family="Arial" font-size="8.00">aggregated [d_model=512]</text>
</g>
<!-- tp_l2_allreduce&#45;&gt;gpu0_l2_moe -->
<g id="edge65" class="edge">
<title>tp_l2_allreduce&#45;&gt;gpu0_l2_moe</title>
<path fill="none" stroke="black" d="M4324.18,-325.68C4282.56,-362.27 4211.96,-417.67 4140,-444.08 4025.75,-486.01 3700.09,-507.62 3496.39,-517.34"/>
<polygon fill="black" stroke="black" points="3496.01,-513.86 3486.18,-517.83 3496.34,-520.85 3496.01,-513.86"/>
<text text-anchor="middle" x="4285.5" y="-416.18" font-family="Arial" font-size="8.00">aggregated [d_model=512]</text>
</g>
<!-- tp_l2_allreduce&#45;&gt;gpu1_l2_moe -->
<g id="edge66" class="edge">
<title>tp_l2_allreduce&#45;&gt;gpu1_l2_moe</title>
<path fill="none" stroke="black" d="M4469.62,-322.47C4515.31,-335.03 4569.38,-348.45 4619,-357.08 5042.83,-430.75 5153.75,-415.75 5583,-444.08 6326.98,-493.17 6514.75,-466.15 7260,-489.08 7474.07,-495.66 7720.44,-507.13 7881.25,-515.14"/>
<polygon fill="black" stroke="black" points="7881.55,-518.66 7891.72,-515.66 7881.9,-511.67 7881.55,-518.66"/>
<text text-anchor="middle" x="5631.5" y="-416.18" font-family="Arial" font-size="8.00">aggregated [d_model=512]</text>
</g>
<!-- tp_l3_allreduce&#45;&gt;gpu0_l3_moe -->
<g id="edge87" class="edge">
<title>tp_l3_allreduce&#45;&gt;gpu0_l3_moe</title>
<path fill="none" stroke="black" d="M5005.67,-258C5098.85,-236.39 5218.73,-208.58 5283.83,-193.48"/>
<polygon fill="black" stroke="black" points="5284.84,-196.84 5293.79,-191.17 5283.26,-190.02 5284.84,-196.84"/>
<text text-anchor="middle" x="5191.5" y="-228.14" font-family="Arial" font-size="8.00">aggregated [d_model=512]</text>
</g>
<!-- tp_l3_allreduce&#45;&gt;gpu1_l3_moe -->
<g id="edge88" class="edge">
<title>tp_l3_allreduce&#45;&gt;gpu1_l3_moe</title>
<path fill="none" stroke="black" d="M5019.21,-259.42C5055.85,-253.27 5095.25,-247.69 5132,-244.54 5189.17,-239.64 9207.71,-249.87 9263,-234.54 9274.23,-231.43 9297.11,-217.62 9316.59,-205.02"/>
<polygon fill="black" stroke="black" points="9318.52,-207.94 9324.97,-199.54 9314.69,-202.09 9318.52,-207.94"/>
<text text-anchor="middle" x="9330.5" y="-228.14" font-family="Arial" font-size="8.00">aggregated [d_model=512]</text>
</g>
<!-- ep_all2all&#45;&gt;gpu0_l0_moe -->
<g id="edge25" class="edge">
<title>ep_all2all&#45;&gt;gpu0_l0_moe</title>
<path fill="none" stroke="black" d="M5226.41,-645.47C4897.73,-628 4246.33,-595.28 3693,-579.08 3118.08,-562.24 2974,-575.1 2399,-561.08 2106.87,-553.96 1767.07,-541.16 1567.13,-533.17"/>
<polygon fill="black" stroke="black" points="1567.25,-529.68 1557.12,-532.77 1566.97,-536.67 1567.25,-529.68"/>
<text text-anchor="middle" x="3954.5" y="-581.68" font-family="Arial" font-size="8.00">routed tokens</text>
</g>
<!-- ep_all2all&#45;&gt;gpu0_l1_moe -->
<g id="edge97" class="edge">
<title>ep_all2all&#45;&gt;gpu0_l1_moe</title>
<path fill="none" stroke="black" d="M5283.14,-631.37C5163.84,-612.96 4995.02,-589.63 4846,-579.08 4470.7,-552.5 3529.01,-574.36 3153,-561.08 3014.78,-556.2 2858.34,-546.58 2742.34,-538.66"/>
<polygon fill="black" stroke="black" points="2742.52,-535.17 2732.3,-537.97 2742.04,-542.15 2742.52,-535.17"/>
<text text-anchor="middle" x="4967.5" y="-581.68" font-family="Arial" font-size="8.00">routed tokens</text>
</g>
<!-- ep_all2all&#45;&gt;gpu0_l2_moe -->
<g id="edge99" class="edge">
<title>ep_all2all&#45;&gt;gpu0_l2_moe</title>
<path fill="none" stroke="black" d="M5340.5,-624.86C5283.96,-607.91 5211.24,-588.7 5145,-579.08 4830.39,-533.39 3886.96,-526.77 3496.31,-526.04"/>
<polygon fill="black" stroke="black" points="3496.06,-522.54 3486.05,-526.02 3496.04,-529.54 3496.06,-522.54"/>
<text text-anchor="middle" x="5217.5" y="-581.68" font-family="Arial" font-size="8.00">routed tokens</text>
</g>
<!-- ep_all2all&#45;&gt;gpu1_l0_moe -->
<g id="edge26" class="edge">
<title>ep_all2all&#45;&gt;gpu1_l0_moe</title>
<path fill="none" stroke="black" d="M5466.13,-621.28C5480.5,-605.25 5499.59,-587.98 5521,-579.08 5587.51,-551.42 6097.25,-567.35 6169,-561.08 6190.02,-559.24 6212.02,-556.76 6233.78,-553.96"/>
<polygon fill="black" stroke="black" points="6234.29,-557.42 6243.75,-552.65 6233.38,-550.48 6234.29,-557.42"/>
<text text-anchor="middle" x="5545.5" y="-581.68" font-family="Arial" font-size="8.00">routed tokens</text>
</g>
<!-- ep_all2all&#45;&gt;gpu1_l1_moe -->
<g id="edge98" class="edge">
<title>ep_all2all&#45;&gt;gpu1_l1_moe</title>
<path fill="none" stroke="black" d="M5539.11,-625.01C5603.5,-604.64 5678.03,-581.63 5694,-579.08 5887.8,-548.08 6380.93,-569.77 6577,-561.08 6690.27,-556.06 6817.44,-547.38 6916.71,-539.92"/>
<polygon fill="black" stroke="black" points="6917.13,-543.4 6926.83,-539.16 6916.6,-536.42 6917.13,-543.4"/>
<text text-anchor="middle" x="5718.5" y="-581.68" font-family="Arial" font-size="8.00">routed tokens</text>
</g>
<!-- ep_all2all&#45;&gt;gpu1_l2_moe -->
<g id="edge100" class="edge">
<title>ep_all2all&#45;&gt;gpu1_l2_moe</title>
<path fill="none" stroke="black" d="M5559.36,-626.88C5596.82,-618.67 5638.41,-610.77 5677,-606.08 6026.35,-563.62 6908.29,-573.31 7260,-561.08 7474.04,-553.63 7720.42,-542.35 7881.24,-534.62"/>
<polygon fill="black" stroke="black" points="7881.88,-538.09 7891.7,-534.11 7881.55,-531.1 7881.88,-538.09"/>
<text text-anchor="middle" x="6130.5" y="-581.68" font-family="Arial" font-size="8.00">routed tokens</text>
</g>
<!-- ep_all2all&#45;&gt;gpu0_l3_moe -->
<g id="edge101" class="edge">
<title>ep_all2all&#45;&gt;gpu0_l3_moe</title>
<path fill="none" stroke="black" d="M5557.46,-626.67C5595.38,-618.29 5637.72,-610.34 5677,-606.08 5701.76,-603.39 9245.44,-605.73 9263,-588.08 9332.91,-517.82 9333,-435.24 9263,-365.08 9245.41,-347.45 5696.34,-372.77 5677,-357.08 5630.59,-319.42 5692.83,-266.18 5649,-225.54 5610.59,-189.92 5457.01,-183.43 5378.19,-182.49"/>
<polygon fill="black" stroke="black" points="5378.08,-178.99 5368.05,-182.4 5378.01,-185.99 5378.08,-178.99"/>
<text text-anchor="middle" x="9334.5" y="-416.18" font-family="Arial" font-size="8.00">routed tokens</text>
</g>
<!-- ep_all2all&#45;&gt;gpu1_l3_moe -->
<g id="edge102" class="edge">
<title>ep_all2all&#45;&gt;gpu1_l3_moe</title>
<path fill="none" stroke="black" d="M5557.46,-626.67C5595.38,-618.29 5637.72,-610.34 5677,-606.08 5776.53,-595.28 9183.95,-612.64 9281,-588.08 9337.67,-573.73 9397,-584.54 9397,-526.08 9397,-526.08 9397,-526.08 9397,-288.31 9397,-259.73 9395.1,-251.44 9383,-225.54 9380.18,-219.5 9376.39,-213.5 9372.38,-208"/>
<polygon fill="black" stroke="black" points="9374.92,-205.56 9366.02,-199.8 9369.39,-209.85 9374.92,-205.56"/>
<text text-anchor="middle" x="9421.5" y="-416.18" font-family="Arial" font-size="8.00">routed tokens</text>
</g>
<!-- pp_sendrecv_stage0_to_1 -->
<g id="node61" class="node">
<title>pp_sendrecv_stage0_to_1</title>
<ellipse fill="lightblue" stroke="black" cx="8120" cy="-52.77" rx="250.13" ry="36.54"/>
<text text-anchor="middle" x="8120" y="-66.77" font-family="Arial" font-size="10.00">PP Send/Recv Stage0Stage1</text>
<text text-anchor="middle" x="8120" y="-55.77" font-family="Arial" font-size="10.00">GPUs: 0&#45;7  8&#45;15</text>
<text text-anchor="middle" x="8120" y="-44.77" font-family="Arial" font-size="10.00">Input: activations from stage 0</text>
<text text-anchor="middle" x="8120" y="-33.77" font-family="Arial" font-size="10.00">Output: forwarded activations [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- dp_allreduce_grads -->
<g id="node62" class="node">
<title>dp_allreduce_grads</title>
<ellipse fill="lightblue" stroke="black" cx="7451" cy="-960.85" rx="223.39" ry="36.54"/>
<text text-anchor="middle" x="7451" y="-974.85" font-family="Arial" font-size="10.00">DP All&#45;Reduce Gradients</text>
<text text-anchor="middle" x="7451" y="-963.85" font-family="Arial" font-size="10.00">GPUs: 0&#45;23</text>
<text text-anchor="middle" x="7451" y="-952.85" font-family="Arial" font-size="10.00">Input: gradient chunks from all DP groups</text>
<text text-anchor="middle" x="7451" y="-941.85" font-family="Arial" font-size="10.00">Output: synchronized gradients [batch_size=128, total_params=10B]</text>
</g>
<!-- global_aggregator -->
<g id="node64" class="node">
<title>global_aggregator</title>
<polygon fill="lightyellow" stroke="black" points="7788.96,-858.08 7251.34,-858.08 7113.04,-776.08 7650.66,-776.08 7788.96,-858.08"/>
<text text-anchor="middle" x="7451" y="-825.58" font-family="Arial" font-size="10.00">Global Result Aggregator</text>
<text text-anchor="middle" x="7451" y="-814.58" font-family="Arial" font-size="10.00">Input: distributed results from all GPUs</text>
<text text-anchor="middle" x="7451" y="-803.58" font-family="Arial" font-size="10.00">Output: final predictions [batch_size=128, seq_len=10240, vocab_size]</text>
</g>
<!-- dp_allreduce_grads&#45;&gt;global_aggregator -->
<g id="edge95" class="edge">
<title>dp_allreduce_grads&#45;&gt;global_aggregator</title>
<path fill="none" stroke="black" d="M7451,-924.07C7451,-907.12 7451,-886.57 7451,-868.11"/>
<polygon fill="black" stroke="black" points="7454.5,-868.09 7451,-858.09 7447.5,-868.09 7454.5,-868.09"/>
<text text-anchor="middle" x="7492" y="-899.68" font-family="Arial" font-size="8.00">synchronized gradients</text>
</g>
<!-- load_balancer -->
<g id="node63" class="node">
<title>load_balancer</title>
<polygon fill="lightyellow" stroke="black" points="7095.04,-858.08 6780,-858.08 6698.96,-776.08 7014,-776.08 7095.04,-858.08"/>
<text text-anchor="middle" x="6897" y="-825.58" font-family="Arial" font-size="10.00">Global Load Balancer</text>
<text text-anchor="middle" x="6897" y="-814.58" font-family="Arial" font-size="10.00">Input: GPU utilization metrics</text>
<text text-anchor="middle" x="6897" y="-803.58" font-family="Arial" font-size="10.00">Output: balancing decisions for all gates</text>
</g>
<!-- load_balancer&#45;&gt;gpu0_l0_gate -->
<g id="edge19" class="edge">
<title>load_balancer&#45;&gt;gpu0_l0_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6736,-813.68C6378.57,-807.92 5491.75,-791.27 4750,-758.08 4685.94,-755.21 4670.09,-751.19 4606,-749.08 4540.2,-746.91 2301.35,-749.03 2236,-741.08 2186.27,-735.03 2133.26,-724.25 2084.37,-712.46"/>
<polygon fill="black" stroke="black" points="2085.19,-709.05 2074.65,-710.08 2083.53,-715.85 2085.19,-709.05"/>
<text text-anchor="middle" x="4784.5" y="-751.68" font-family="Arial" font-size="8.00">balancing decisions</text>
</g>
<!-- load_balancer&#45;&gt;gpu0_l1_gate -->
<g id="edge45" class="edge">
<title>load_balancer&#45;&gt;gpu0_l1_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6731.37,-809.15C6379.86,-794.78 5533.26,-762.03 4823,-749.08 4769.9,-748.11 2963.72,-747.51 2911,-741.08 2861.51,-735.04 2808.78,-724.33 2760.09,-712.6"/>
<polygon fill="black" stroke="black" points="2760.63,-709.13 2750.08,-710.16 2758.97,-715.93 2760.63,-709.13"/>
<text text-anchor="middle" x="5254.5" y="-751.68" font-family="Arial" font-size="8.00">balancing decisions</text>
</g>
<!-- load_balancer&#45;&gt;gpu0_l2_gate -->
<g id="edge67" class="edge">
<title>load_balancer&#45;&gt;gpu0_l2_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6731.37,-808.95C6159.84,-784.35 4265.49,-702.83 3537.48,-671.49"/>
<polygon fill="black" stroke="black" points="3537.52,-667.99 3527.38,-671.06 3537.22,-674.99 3537.52,-667.99"/>
<text text-anchor="middle" x="5541.5" y="-751.68" font-family="Arial" font-size="8.00">balancing decisions</text>
</g>
<!-- load_balancer&#45;&gt;gpu0_l3_gate -->
<g id="edge89" class="edge">
<title>load_balancer&#45;&gt;gpu0_l3_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6737.86,-815.51C6242.3,-813.29 4747.03,-802.9 4533,-758.08 4522.66,-755.91 4521.36,-751.13 4511,-749.08 4430.62,-733.16 1642.35,-750.94 1561,-741.08 1511.26,-735.05 1458.26,-724.27 1409.37,-712.48"/>
<polygon fill="black" stroke="black" points="1410.19,-709.08 1399.64,-710.11 1408.53,-715.88 1410.19,-709.08"/>
<text text-anchor="middle" x="4567.5" y="-751.68" font-family="Arial" font-size="8.00">balancing decisions</text>
</g>
<!-- load_balancer&#45;&gt;gpu1_l0_gate -->
<g id="edge20" class="edge">
<title>load_balancer&#45;&gt;gpu1_l0_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M6897,-776.05C6897,-759.19 6897,-739.18 6897,-720.52"/>
<polygon fill="black" stroke="black" points="6900.5,-720.32 6897,-710.32 6893.5,-720.32 6900.5,-720.32"/>
<text text-anchor="middle" x="6931.5" y="-751.68" font-family="Arial" font-size="8.00">balancing decisions</text>
</g>
<!-- load_balancer&#45;&gt;gpu1_l1_gate -->
<g id="edge46" class="edge">
<title>load_balancer&#45;&gt;gpu1_l1_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7024.15,-786.07C7050.52,-780 7078.14,-773.74 7104,-768.08 7162.07,-755.36 7177,-754.11 7235,-741.08 7277.1,-731.62 7322.05,-721.03 7364.94,-710.69"/>
<polygon fill="black" stroke="black" points="7366.02,-714.02 7374.92,-708.27 7364.38,-707.22 7366.02,-714.02"/>
<text text-anchor="middle" x="7230.5" y="-751.68" font-family="Arial" font-size="8.00">balancing decisions</text>
</g>
<!-- load_balancer&#45;&gt;gpu1_l2_gate -->
<g id="edge68" class="edge">
<title>load_balancer&#45;&gt;gpu1_l2_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7021.38,-783.36C7048.44,-777.33 7077.05,-771.78 7104,-768.08 7150.28,-761.72 7477.31,-750.62 7524,-749.08 7609.75,-746.25 7824.92,-752.18 7910,-741.08 7958.74,-734.72 8010.66,-724.08 8058.77,-712.54"/>
<polygon fill="black" stroke="black" points="8059.77,-715.9 8068.66,-710.14 8058.12,-709.09 8059.77,-715.9"/>
<text text-anchor="middle" x="7558.5" y="-751.68" font-family="Arial" font-size="8.00">balancing decisions</text>
</g>
<!-- load_balancer&#45;&gt;gpu1_l3_gate -->
<g id="edge90" class="edge">
<title>load_balancer&#45;&gt;gpu1_l3_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M7021.03,-782.87C7048.18,-776.85 7076.91,-771.43 7104,-768.08 7144.83,-763.03 8544.19,-746.35 8585,-741.08 8633.89,-734.76 8685.97,-724.1 8734.2,-712.52"/>
<polygon fill="black" stroke="black" points="8735.22,-715.88 8744.11,-710.12 8733.57,-709.07 8735.22,-715.88"/>
<text text-anchor="middle" x="8213.5" y="-751.68" font-family="Arial" font-size="8.00">balancing decisions</text>
</g>
<!-- final_output -->
<g id="node65" class="node">
<title>final_output</title>
<polygon fill="lightgreen" stroke="black" points="9635,-687.08 9275,-687.08 9275,-629.08 9635,-629.08 9635,-687.08"/>
<text text-anchor="middle" x="9455" y="-666.58" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="9455" y="-655.58" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="9455" y="-644.58" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10240, vocab_size]</text>
</g>
<!-- global_aggregator&#45;&gt;final_output -->
<g id="edge96" class="edge">
<title>global_aggregator&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M7719.72,-816.81C8150.83,-816 8977.5,-805.67 9263,-741.08 9308.79,-730.72 9357.39,-709.85 9394.24,-691.76"/>
<polygon fill="black" stroke="black" points="9395.96,-694.82 9403.35,-687.23 9392.84,-688.55 9395.96,-694.82"/>
<text text-anchor="middle" x="9238.5" y="-751.68" font-family="Arial" font-size="8.00">final predictions</text>
</g>
<!-- gpu0_l3_moe&#45;&gt;pp_sendrecv_stage0_to_1 -->
<g id="edge93" class="edge">
<title>gpu0_l3_moe&#45;&gt;pp_sendrecv_stage0_to_1</title>
<path fill="none" stroke="black" d="M5368.07,-176.31C5431.33,-169.24 5564.26,-155.07 5677,-147.54 6472.93,-94.35 7416.91,-68.72 7862.57,-58.85"/>
<polygon fill="black" stroke="black" points="7862.76,-62.35 7872.68,-58.63 7862.61,-55.35 7862.76,-62.35"/>
<text text-anchor="middle" x="5959.5" y="-131.14" font-family="Arial" font-size="8.00">activations</text>
</g>
<!-- gpu1_l3_moe&#45;&gt;pp_sendrecv_stage0_to_1 -->
<g id="edge94" class="edge">
<title>gpu1_l3_moe&#45;&gt;pp_sendrecv_stage0_to_1</title>
<path fill="none" stroke="black" d="M9312.6,-163.71C9297.49,-157.62 9279.7,-151.31 9263,-147.54 9098.12,-110.29 8649.11,-81.2 8365.43,-65.83"/>
<polygon fill="black" stroke="black" points="8365.58,-62.34 8355.41,-65.29 8365.2,-69.33 8365.58,-62.34"/>
<text text-anchor="middle" x="9209.5" y="-131.14" font-family="Arial" font-size="8.00">activations</text>
</g>
</g>
</svg>
