<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: LLM_Parallel_Strategy Pages: 1 -->
<svg width="19854pt" height="4813pt"
 viewBox="0.00 0.00 4765.00 1155.08" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(4.17 4.17) rotate(0) translate(4 1151.08)">
<title>LLM_Parallel_Strategy</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1151.08 4761,-1151.08 4761,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="white" stroke="black" d="M3174,-1040.08C3174,-1040.08 3452,-1040.08 3452,-1040.08 3458,-1040.08 3464,-1046.08 3464,-1052.08 3464,-1052.08 3464,-1127.08 3464,-1127.08 3464,-1133.08 3458,-1139.08 3452,-1139.08 3452,-1139.08 3174,-1139.08 3174,-1139.08 3168,-1139.08 3162,-1133.08 3162,-1127.08 3162,-1127.08 3162,-1052.08 3162,-1052.08 3162,-1046.08 3168,-1040.08 3174,-1040.08"/>
<text text-anchor="middle" x="3313" y="-1125.48" font-family="Arial" font-size="12.00">Input Layer</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_gpu0_complete</title>
<path fill="white" stroke="black" d="M226,-263.77C226,-263.77 2291,-263.77 2291,-263.77 2297,-263.77 2303,-269.77 2303,-275.77 2303,-275.77 2303,-874.08 2303,-874.08 2303,-880.08 2297,-886.08 2291,-886.08 2291,-886.08 226,-886.08 226,-886.08 220,-886.08 214,-880.08 214,-874.08 214,-874.08 214,-275.77 214,-275.77 214,-269.77 220,-263.77 226,-263.77"/>
<text text-anchor="middle" x="1258.5" y="-872.48" font-family="Arial" font-size="12.00">GPU 0 (Complete Stack)</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_gpu1_complete</title>
<path fill="white" stroke="black" d="M2807,-263.77C2807,-263.77 4737,-263.77 4737,-263.77 4743,-263.77 4749,-269.77 4749,-275.77 4749,-275.77 4749,-874.08 4749,-874.08 4749,-880.08 4743,-886.08 4737,-886.08 4737,-886.08 2807,-886.08 2807,-886.08 2801,-886.08 2795,-880.08 2795,-874.08 2795,-874.08 2795,-275.77 2795,-275.77 2795,-269.77 2801,-263.77 2807,-263.77"/>
<text text-anchor="middle" x="3772" y="-872.48" font-family="Arial" font-size="12.00">GPU 1 (Complete Stack)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_remaining_gpus</title>
<path fill="white" stroke="black" d="M2377,-371.54C2377,-371.54 2528,-371.54 2528,-371.54 2534,-371.54 2540,-377.54 2540,-383.54 2540,-383.54 2540,-469.54 2540,-469.54 2540,-475.54 2534,-481.54 2528,-481.54 2528,-481.54 2377,-481.54 2377,-481.54 2371,-481.54 2365,-475.54 2365,-469.54 2365,-469.54 2365,-383.54 2365,-383.54 2365,-377.54 2371,-371.54 2377,-371.54"/>
<text text-anchor="middle" x="2452.5" y="-467.94" font-family="Arial" font-size="12.00">GPUs 2&#45;23 (Similar Structure)</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_output_final</title>
<path fill="white" stroke="black" d="M2463,-8C2463,-8 2711,-8 2711,-8 2717,-8 2723,-14 2723,-20 2723,-20 2723,-95 2723,-95 2723,-101 2717,-107 2711,-107 2711,-107 2463,-107 2463,-107 2457,-107 2451,-101 2451,-95 2451,-95 2451,-20 2451,-20 2451,-14 2457,-8 2463,-8"/>
<text text-anchor="middle" x="2587" y="-93.4" font-family="Arial" font-size="12.00">Final Output Layer</text>
</g>
<!-- input_node -->
<g id="node1" class="node">
<title>input_node</title>
<polygon fill="lightgreen" stroke="black" points="3456,-1089.08 3170,-1089.08 3170,-1048.08 3456,-1048.08 3456,-1089.08"/>
<text text-anchor="middle" x="3313" y="-1077.08" font-family="Arial" font-size="10.00">Input</text>
<text text-anchor="middle" x="3313" y="-1066.08" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10240, heads=16, d_k=32]</text>
<text text-anchor="middle" x="3313" y="-1055.08" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10240, heads=16, d_k=32]</text>
</g>
<!-- dp_split -->
<g id="node2" class="node">
<title>dp_split</title>
<polygon fill="lightyellow" stroke="black" points="3466.38,-1003.08 3222.39,-1003.08 3159.62,-921.08 3403.61,-921.08 3466.38,-1003.08"/>
<text text-anchor="middle" x="3313" y="-970.58" font-family="Arial" font-size="10.00">DP Batch Split</text>
<text text-anchor="middle" x="3313" y="-959.58" font-family="Arial" font-size="10.00">Input: [batch_size=128, ...]</text>
<text text-anchor="middle" x="3313" y="-948.58" font-family="Arial" font-size="10.00">Output: 3×[batch_size=43, ...]</text>
</g>
<!-- input_node&#45;&gt;dp_split -->
<g id="edge1" class="edge">
<title>input_node&#45;&gt;dp_split</title>
<path fill="none" stroke="black" d="M3313,-1047.92C3313,-1038.13 3313,-1025.79 3313,-1013.59"/>
<polygon fill="black" stroke="black" points="3316.5,-1013.42 3313,-1003.42 3309.5,-1013.42 3316.5,-1013.42"/>
<text text-anchor="middle" x="3329" y="-1023.68" font-family="Arial" font-size="8.00">full batch</text>
</g>
<!-- gpu0_l0_q_proj -->
<g id="node3" class="node">
<title>gpu0_l0_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="2294.5,-810.08 2019.5,-810.08 2019.5,-758.08 2294.5,-758.08 2294.5,-810.08"/>
<text text-anchor="middle" x="2157" y="-798.08" font-family="Arial" font-size="10.00">L0 Q Projection</text>
<text text-anchor="middle" x="2157" y="-787.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2157" y="-776.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="2157" y="-765.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- dp_split&#45;&gt;gpu0_l0_q_proj -->
<g id="edge2" class="edge">
<title>dp_split&#45;&gt;gpu0_l0_q_proj</title>
<path fill="none" stroke="black" d="M3188.39,-958.72C3022.6,-953.6 2721.08,-937.4 2469,-886.08 2385.02,-868.98 2291.94,-837.07 2229.48,-813.68"/>
<polygon fill="black" stroke="black" points="2230.7,-810.4 2220.11,-810.15 2228.24,-816.95 2230.7,-810.4"/>
<text text-anchor="middle" x="2572.5" y="-896.68" font-family="Arial" font-size="8.00">batch 0</text>
</g>
<!-- gpu0_l0_k_proj -->
<g id="node4" class="node">
<title>gpu0_l0_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="1708.5,-810.08 1433.5,-810.08 1433.5,-758.08 1708.5,-758.08 1708.5,-810.08"/>
<text text-anchor="middle" x="1571" y="-798.08" font-family="Arial" font-size="10.00">L0 K Projection</text>
<text text-anchor="middle" x="1571" y="-787.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1571" y="-776.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1571" y="-765.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- dp_split&#45;&gt;gpu0_l0_k_proj -->
<g id="edge3" class="edge">
<title>dp_split&#45;&gt;gpu0_l0_k_proj</title>
<path fill="none" stroke="black" d="M3187.57,-957.72C2955.77,-951.02 2444.74,-933.91 2015,-903.08 1974.46,-900.17 1964.55,-896.87 1924,-894.08 1901.15,-892.51 1739.74,-893.29 1718,-886.08 1675.07,-871.83 1633.27,-840.96 1605.29,-817.07"/>
<polygon fill="black" stroke="black" points="1607.26,-814.15 1597.42,-810.22 1602.66,-819.43 1607.26,-814.15"/>
<text text-anchor="middle" x="2028.5" y="-896.68" font-family="Arial" font-size="8.00">batch 0</text>
</g>
<!-- gpu0_l0_v_proj -->
<g id="node5" class="node">
<title>gpu0_l0_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="2001.5,-810.08 1726.5,-810.08 1726.5,-758.08 2001.5,-758.08 2001.5,-810.08"/>
<text text-anchor="middle" x="1864" y="-798.08" font-family="Arial" font-size="10.00">L0 V Projection</text>
<text text-anchor="middle" x="1864" y="-787.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1864" y="-776.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1864" y="-765.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- dp_split&#45;&gt;gpu0_l0_v_proj -->
<g id="edge4" class="edge">
<title>dp_split&#45;&gt;gpu0_l0_v_proj</title>
<path fill="none" stroke="black" d="M3187.47,-957.69C2882.63,-948.91 2120.28,-923.48 2011,-886.08 1968.34,-871.48 1926.65,-840.8 1898.62,-817.07"/>
<polygon fill="black" stroke="black" points="1900.6,-814.15 1890.74,-810.27 1896.02,-819.45 1900.6,-814.15"/>
<text text-anchor="middle" x="2113.5" y="-896.68" font-family="Arial" font-size="8.00">batch 0</text>
</g>
<!-- gpu1_l0_q_proj -->
<g id="node17" class="node">
<title>gpu1_l0_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="4740.5,-810.08 4465.5,-810.08 4465.5,-758.08 4740.5,-758.08 4740.5,-810.08"/>
<text text-anchor="middle" x="4603" y="-798.08" font-family="Arial" font-size="10.00">L0 Q Projection</text>
<text text-anchor="middle" x="4603" y="-787.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="4603" y="-776.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="4603" y="-765.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- dp_split&#45;&gt;gpu1_l0_q_proj -->
<g id="edge25" class="edge">
<title>dp_split&#45;&gt;gpu1_l0_q_proj</title>
<path fill="none" stroke="black" d="M3434.39,-961.26C3689.07,-960.31 4271.05,-950.88 4457,-886.08 4499.38,-871.31 4540.79,-840.66 4568.62,-816.98"/>
<polygon fill="black" stroke="black" points="4571.19,-819.38 4576.45,-810.19 4566.6,-814.09 4571.19,-819.38"/>
<text text-anchor="middle" x="4438.5" y="-896.68" font-family="Arial" font-size="8.00">batch 1</text>
</g>
<!-- gpu1_l0_k_proj -->
<g id="node18" class="node">
<title>gpu1_l0_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="4154.5,-810.08 3879.5,-810.08 3879.5,-758.08 4154.5,-758.08 4154.5,-810.08"/>
<text text-anchor="middle" x="4017" y="-798.08" font-family="Arial" font-size="10.00">L0 K Projection</text>
<text text-anchor="middle" x="4017" y="-787.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="4017" y="-776.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="4017" y="-765.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- dp_split&#45;&gt;gpu1_l0_k_proj -->
<g id="edge26" class="edge">
<title>dp_split&#45;&gt;gpu1_l0_k_proj</title>
<path fill="none" stroke="black" d="M3434.07,-960.83C3549.67,-956.93 3726.95,-941.22 3870,-886.08 3911.68,-870.01 3953.06,-839.98 3981.25,-816.82"/>
<polygon fill="black" stroke="black" points="3983.77,-819.28 3989.2,-810.19 3979.28,-813.91 3983.77,-819.28"/>
<text text-anchor="middle" x="3854.5" y="-896.68" font-family="Arial" font-size="8.00">batch 1</text>
</g>
<!-- gpu1_l0_v_proj -->
<g id="node19" class="node">
<title>gpu1_l0_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="4447.5,-810.08 4172.5,-810.08 4172.5,-758.08 4447.5,-758.08 4447.5,-810.08"/>
<text text-anchor="middle" x="4310" y="-798.08" font-family="Arial" font-size="10.00">L0 V Projection</text>
<text text-anchor="middle" x="4310" y="-787.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="4310" y="-776.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="4310" y="-765.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- dp_split&#45;&gt;gpu1_l0_v_proj -->
<g id="edge27" class="edge">
<title>dp_split&#45;&gt;gpu1_l0_v_proj</title>
<path fill="none" stroke="black" d="M3432.27,-958.08C3633.8,-951.76 4032.61,-933.53 4164,-886.08 4206.08,-870.88 4247.39,-840.44 4275.26,-816.93"/>
<polygon fill="black" stroke="black" points="4277.8,-819.36 4283.11,-810.2 4273.25,-814.05 4277.8,-819.36"/>
<text text-anchor="middle" x="4139.5" y="-896.68" font-family="Arial" font-size="8.00">batch 1</text>
</g>
<!-- gpu0_l0_attn_scores -->
<g id="node6" class="node">
<title>gpu0_l0_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="2295,-687.08 2003,-687.08 2003,-635.08 2295,-635.08 2295,-687.08"/>
<text text-anchor="middle" x="2149" y="-675.08" font-family="Arial" font-size="10.00">L0 Attention Scores</text>
<text text-anchor="middle" x="2149" y="-664.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2149" y="-653.08" font-family="Arial" font-size="10.00">Input: QKV [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="2149" y="-642.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l0_q_proj&#45;&gt;gpu0_l0_attn_scores -->
<g id="edge5" class="edge">
<title>gpu0_l0_q_proj&#45;&gt;gpu0_l0_attn_scores</title>
<path fill="none" stroke="black" d="M2155.34,-758.01C2154.18,-740.4 2152.61,-716.62 2151.32,-697.14"/>
<polygon fill="black" stroke="black" points="2154.81,-696.86 2150.66,-687.12 2147.82,-697.33 2154.81,-696.86"/>
</g>
<!-- gpu0_l0_k_proj&#45;&gt;gpu0_l0_attn_scores -->
<g id="edge6" class="edge">
<title>gpu0_l0_k_proj&#45;&gt;gpu0_l0_attn_scores</title>
<path fill="none" stroke="black" d="M1635.39,-758.03C1660.83,-748.85 1690.5,-739.03 1718,-732.08 1721.47,-731.2 1870.81,-707 1992.72,-687.3"/>
<polygon fill="black" stroke="black" points="1993.62,-690.7 2002.93,-685.65 1992.5,-683.79 1993.62,-690.7"/>
</g>
<!-- gpu0_l0_v_proj&#45;&gt;gpu0_l0_attn_scores -->
<g id="edge7" class="edge">
<title>gpu0_l0_v_proj&#45;&gt;gpu0_l0_attn_scores</title>
<path fill="none" stroke="black" d="M1923.05,-758.01C1968.91,-738.54 2032.56,-711.51 2080.63,-691.11"/>
<polygon fill="black" stroke="black" points="2082.19,-694.25 2090.02,-687.12 2079.45,-687.8 2082.19,-694.25"/>
</g>
<!-- gpu0_l0_out_proj -->
<g id="node7" class="node">
<title>gpu0_l0_out_proj</title>
<polygon fill="lightgreen" stroke="black" points="2292,-579.31 2024,-579.31 2024,-527.31 2292,-527.31 2292,-579.31"/>
<text text-anchor="middle" x="2158" y="-567.31" font-family="Arial" font-size="10.00">L0 Output Projection</text>
<text text-anchor="middle" x="2158" y="-556.31" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="2158" y="-545.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="2158" y="-534.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu0_l0_attn_scores&#45;&gt;gpu0_l0_out_proj -->
<g id="edge8" class="edge">
<title>gpu0_l0_attn_scores&#45;&gt;gpu0_l0_out_proj</title>
<path fill="none" stroke="black" d="M2151.13,-635.01C2152.28,-621.54 2153.71,-604.71 2154.97,-589.9"/>
<polygon fill="black" stroke="black" points="2158.49,-589.82 2155.85,-579.56 2151.52,-589.23 2158.49,-589.82"/>
</g>
<!-- tp_l0_allreduce -->
<g id="node31" class="node">
<title>tp_l0_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="2568" cy="-784.08" rx="89.61" ry="36.54"/>
<text text-anchor="middle" x="2568" y="-798.08" font-family="Arial" font-size="10.00">TP All&#45;Reduce L0</text>
<text text-anchor="middle" x="2568" y="-787.08" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="2568" y="-776.08" font-family="Arial" font-size="10.00">Input: partial tensors</text>
<text text-anchor="middle" x="2568" y="-765.08" font-family="Arial" font-size="10.00">Output: complete tensors</text>
</g>
<!-- gpu0_l0_out_proj&#45;&gt;tp_l0_allreduce -->
<g id="edge9" class="edge">
<title>gpu0_l0_out_proj&#45;&gt;tp_l0_allreduce</title>
<path fill="none" stroke="black" d="M2283.59,-579.36C2335.5,-590.31 2386.16,-602.03 2397,-608.08 2455.64,-640.81 2507.08,-699.87 2537.84,-740.24"/>
<polygon fill="black" stroke="black" points="2535.09,-742.41 2543.89,-748.31 2540.69,-738.21 2535.09,-742.41"/>
</g>
<!-- gpu0_l0_gate -->
<g id="node8" class="node">
<title>gpu0_l0_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="742.45,-836.08 328.13,-836.08 221.55,-732.08 635.87,-732.08 742.45,-836.08"/>
<text text-anchor="middle" x="482" y="-798.08" font-family="Arial" font-size="10.00">L0 Gate Router</text>
<text text-anchor="middle" x="482" y="-787.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="482" y="-776.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="482" y="-765.08" font-family="Arial" font-size="10.00">Output: routing decisions</text>
</g>
<!-- gpu0_l0_moe -->
<g id="node9" class="node">
<title>gpu0_l0_moe</title>
<polygon fill="lightgreen" stroke="black" points="1985,-687.08 1727,-687.08 1727,-635.08 1985,-635.08 1985,-687.08"/>
<text text-anchor="middle" x="1856" y="-675.08" font-family="Arial" font-size="10.00">L0 MoE (8 experts)</text>
<text text-anchor="middle" x="1856" y="-664.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1856" y="-653.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1856" y="-642.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu0_l0_gate&#45;&gt;gpu0_l0_moe -->
<g id="edge12" class="edge">
<title>gpu0_l0_gate&#45;&gt;gpu0_l0_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M662.2,-757.53C731.98,-748.37 812.6,-738.69 886,-732.08 1033.62,-718.79 1071.12,-724.11 1219,-714.08 1390.38,-702.45 1587.43,-685.87 1716.43,-674.58"/>
<polygon fill="black" stroke="black" points="1717.1,-678.04 1726.76,-673.68 1716.49,-671.06 1717.1,-678.04"/>
<text text-anchor="middle" x="1370" y="-707.68" font-family="Arial" font-size="8.00">routing decisions</text>
</g>
<!-- gpu0_l1_q_proj -->
<g id="node10" class="node">
<title>gpu0_l1_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="1415.5,-579.31 1140.5,-579.31 1140.5,-527.31 1415.5,-527.31 1415.5,-579.31"/>
<text text-anchor="middle" x="1278" y="-567.31" font-family="Arial" font-size="10.00">L1 Q Projection</text>
<text text-anchor="middle" x="1278" y="-556.31" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1278" y="-545.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1278" y="-534.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l0_moe&#45;&gt;gpu0_l1_q_proj -->
<g id="edge14" class="edge">
<title>gpu0_l0_moe&#45;&gt;gpu0_l1_q_proj</title>
<path fill="none" stroke="black" d="M1726.81,-641.78C1640.95,-628.95 1525.86,-610.51 1425,-590.08 1412.38,-587.52 1399.21,-584.63 1386.16,-581.64"/>
<polygon fill="black" stroke="black" points="1386.74,-578.18 1376.21,-579.32 1385.16,-585 1386.74,-578.18"/>
<text text-anchor="middle" x="1590.5" y="-610.68" font-family="Arial" font-size="8.00">layer 0 output</text>
</g>
<!-- gpu0_l1_k_proj -->
<g id="node11" class="node">
<title>gpu0_l1_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="1708.5,-579.31 1433.5,-579.31 1433.5,-527.31 1708.5,-527.31 1708.5,-579.31"/>
<text text-anchor="middle" x="1571" y="-567.31" font-family="Arial" font-size="10.00">L1 K Projection</text>
<text text-anchor="middle" x="1571" y="-556.31" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1571" y="-545.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1571" y="-534.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l0_moe&#45;&gt;gpu0_l1_k_proj -->
<g id="edge15" class="edge">
<title>gpu0_l0_moe&#45;&gt;gpu0_l1_k_proj</title>
<path fill="none" stroke="black" d="M1788.46,-635.01C1746.29,-619.36 1691.87,-599.17 1648.02,-582.89"/>
<polygon fill="black" stroke="black" points="1649.14,-579.58 1638.55,-579.38 1646.71,-586.14 1649.14,-579.58"/>
<text text-anchor="middle" x="1763.5" y="-610.68" font-family="Arial" font-size="8.00">layer 0 output</text>
</g>
<!-- gpu0_l1_v_proj -->
<g id="node12" class="node">
<title>gpu0_l1_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="2001.5,-579.31 1726.5,-579.31 1726.5,-527.31 2001.5,-527.31 2001.5,-579.31"/>
<text text-anchor="middle" x="1864" y="-567.31" font-family="Arial" font-size="10.00">L1 V Projection</text>
<text text-anchor="middle" x="1864" y="-556.31" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1864" y="-545.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1864" y="-534.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l0_moe&#45;&gt;gpu0_l1_v_proj -->
<g id="edge16" class="edge">
<title>gpu0_l0_moe&#45;&gt;gpu0_l1_v_proj</title>
<path fill="none" stroke="black" d="M1857.9,-635.01C1858.91,-621.54 1860.19,-604.71 1861.31,-589.9"/>
<polygon fill="black" stroke="black" points="1864.83,-589.8 1862.09,-579.56 1857.85,-589.27 1864.83,-589.8"/>
<text text-anchor="middle" x="1883.5" y="-610.68" font-family="Arial" font-size="8.00">layer 0 output</text>
</g>
<!-- ep_all2all -->
<g id="node33" class="node">
<title>ep_all2all</title>
<ellipse fill="lightblue" stroke="black" cx="2679" cy="-553.31" rx="97.66" ry="36.54"/>
<text text-anchor="middle" x="2679" y="-567.31" font-family="Arial" font-size="10.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="2679" y="-556.31" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="2679" y="-545.31" font-family="Arial" font-size="10.00">Input: token representations</text>
<text text-anchor="middle" x="2679" y="-534.31" font-family="Arial" font-size="10.00">Output: routed tokens</text>
</g>
<!-- gpu0_l0_moe&#45;&gt;ep_all2all -->
<g id="edge13" class="edge">
<title>gpu0_l0_moe&#45;&gt;ep_all2all</title>
<path fill="none" stroke="black" d="M1985.2,-636.07C1988.16,-635.72 1991.09,-635.38 1994,-635.08 2058.67,-628.26 2516.79,-636.03 2579,-617.08 2596.7,-611.69 2614.36,-602.29 2629.79,-592.39"/>
<polygon fill="black" stroke="black" points="2631.73,-595.3 2638.13,-586.85 2627.86,-589.47 2631.73,-595.3"/>
<text text-anchor="middle" x="2626" y="-610.68" font-family="Arial" font-size="8.00">tokens to route</text>
</g>
<!-- gpu0_l1_attn_scores -->
<g id="node13" class="node">
<title>gpu0_l1_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="1570,-431.54 1278,-431.54 1278,-379.54 1570,-379.54 1570,-431.54"/>
<text text-anchor="middle" x="1424" y="-419.54" font-family="Arial" font-size="10.00">L1 Attention Scores</text>
<text text-anchor="middle" x="1424" y="-408.54" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1424" y="-397.54" font-family="Arial" font-size="10.00">Input: QKV [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="1424" y="-386.54" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu0_l1_q_proj&#45;&gt;gpu0_l1_attn_scores -->
<g id="edge17" class="edge">
<title>gpu0_l1_q_proj&#45;&gt;gpu0_l1_attn_scores</title>
<path fill="none" stroke="black" d="M1303.1,-527.25C1327.54,-502.84 1364.82,-465.63 1391.51,-438.98"/>
<polygon fill="black" stroke="black" points="1394.14,-441.3 1398.74,-431.76 1389.19,-436.35 1394.14,-441.3"/>
</g>
<!-- gpu0_l1_k_proj&#45;&gt;gpu0_l1_attn_scores -->
<g id="edge18" class="edge">
<title>gpu0_l1_k_proj&#45;&gt;gpu0_l1_attn_scores</title>
<path fill="none" stroke="black" d="M1545.73,-527.25C1521.12,-502.84 1483.59,-465.63 1456.71,-438.98"/>
<polygon fill="black" stroke="black" points="1459,-436.31 1449.43,-431.76 1454.07,-441.29 1459,-436.31"/>
</g>
<!-- gpu0_l1_v_proj&#45;&gt;gpu0_l1_attn_scores -->
<g id="edge19" class="edge">
<title>gpu0_l1_v_proj&#45;&gt;gpu0_l1_attn_scores</title>
<path fill="none" stroke="black" d="M1788.36,-527.25C1710.8,-501.55 1590.38,-461.66 1509.43,-434.84"/>
<polygon fill="black" stroke="black" points="1510.35,-431.46 1499.76,-431.64 1508.15,-438.1 1510.35,-431.46"/>
</g>
<!-- gpu0_l1_out_proj -->
<g id="node14" class="node">
<title>gpu0_l1_out_proj</title>
<polygon fill="lightgreen" stroke="black" points="1022,-323.77 754,-323.77 754,-271.77 1022,-271.77 1022,-323.77"/>
<text text-anchor="middle" x="888" y="-311.77" font-family="Arial" font-size="10.00">L1 Output Projection</text>
<text text-anchor="middle" x="888" y="-300.77" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="888" y="-289.77" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="888" y="-278.77" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu0_l1_attn_scores&#45;&gt;gpu0_l1_out_proj -->
<g id="edge20" class="edge">
<title>gpu0_l1_attn_scores&#45;&gt;gpu0_l1_out_proj</title>
<path fill="none" stroke="black" d="M1296.98,-379.47C1215.08,-363.31 1108.64,-342.31 1024.88,-325.78"/>
<polygon fill="black" stroke="black" points="1025.53,-322.34 1015.04,-323.84 1024.17,-329.21 1025.53,-322.34"/>
</g>
<!-- tp_l1_allreduce -->
<g id="node32" class="node">
<title>tp_l1_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="114" cy="-784.08" rx="89.61" ry="36.54"/>
<text text-anchor="middle" x="114" y="-798.08" font-family="Arial" font-size="10.00">TP All&#45;Reduce L1</text>
<text text-anchor="middle" x="114" y="-787.08" font-family="Arial" font-size="10.00">GPUs: 0,1</text>
<text text-anchor="middle" x="114" y="-776.08" font-family="Arial" font-size="10.00">Input: partial tensors</text>
<text text-anchor="middle" x="114" y="-765.08" font-family="Arial" font-size="10.00">Output: complete tensors</text>
</g>
<!-- gpu0_l1_out_proj&#45;&gt;tp_l1_allreduce -->
<g id="edge21" class="edge">
<title>gpu0_l1_out_proj&#45;&gt;tp_l1_allreduce</title>
<path fill="none" stroke="black" d="M753.93,-299.64C526.19,-302.22 82.64,-312.4 24,-352.54 3,-366.92 0,-379.09 0,-404.54 0,-662.08 0,-662.08 0,-662.08 0,-697.67 26.46,-727.05 53.88,-747.95"/>
<polygon fill="black" stroke="black" points="51.86,-750.81 62,-753.88 56,-745.16 51.86,-750.81"/>
</g>
<!-- gpu0_l1_gate -->
<g id="node15" class="node">
<title>gpu0_l1_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="1415.45,-836.08 1001.13,-836.08 894.55,-732.08 1308.87,-732.08 1415.45,-836.08"/>
<text text-anchor="middle" x="1155" y="-798.08" font-family="Arial" font-size="10.00">L1 Gate Router</text>
<text text-anchor="middle" x="1155" y="-787.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1155" y="-776.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1155" y="-765.08" font-family="Arial" font-size="10.00">Output: routing decisions</text>
</g>
<!-- gpu0_l1_moe -->
<g id="node16" class="node">
<title>gpu0_l1_moe</title>
<polygon fill="lightgreen" stroke="black" points="1284,-687.08 1026,-687.08 1026,-635.08 1284,-635.08 1284,-687.08"/>
<text text-anchor="middle" x="1155" y="-675.08" font-family="Arial" font-size="10.00">L1 MoE (8 experts)</text>
<text text-anchor="middle" x="1155" y="-664.08" font-family="Arial" font-size="10.00">GPU: 0</text>
<text text-anchor="middle" x="1155" y="-653.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="1155" y="-642.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu0_l1_gate&#45;&gt;gpu0_l1_moe -->
<g id="edge24" class="edge">
<title>gpu0_l1_gate&#45;&gt;gpu0_l1_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1155,-731.76C1155,-720.17 1155,-708.11 1155,-697.36"/>
<polygon fill="black" stroke="black" points="1158.5,-697.09 1155,-687.09 1151.5,-697.09 1158.5,-697.09"/>
<text text-anchor="middle" x="1185" y="-707.68" font-family="Arial" font-size="8.00">routing decisions</text>
</g>
<!-- pp_stage0 -->
<g id="node36" class="node">
<title>pp_stage0</title>
<ellipse fill="lightblue" stroke="black" cx="2452" cy="-553.31" rx="102.56" ry="36.54"/>
<text text-anchor="middle" x="2452" y="-567.31" font-family="Arial" font-size="10.00">PP Stage 0→1</text>
<text text-anchor="middle" x="2452" y="-556.31" font-family="Arial" font-size="10.00">GPUs: 0&#45;7 → 8&#45;15</text>
<text text-anchor="middle" x="2452" y="-545.31" font-family="Arial" font-size="10.00">Input: activations</text>
<text text-anchor="middle" x="2452" y="-534.31" font-family="Arial" font-size="10.00">Output: forwarded activations</text>
</g>
<!-- gpu0_l1_moe&#45;&gt;pp_stage0 -->
<g id="edge54" class="edge">
<title>gpu0_l1_moe&#45;&gt;pp_stage0</title>
<path fill="none" stroke="black" d="M1284.14,-653.61C1563.8,-639.4 2208.26,-605.51 2307,-590.08 2325.13,-587.24 2344.32,-583.24 2362.6,-578.94"/>
<polygon fill="black" stroke="black" points="2363.45,-582.33 2372.35,-576.59 2361.81,-575.53 2363.45,-582.33"/>
<text text-anchor="middle" x="2113" y="-610.68" font-family="Arial" font-size="8.00">stage 0 output</text>
</g>
<!-- gpu1_l0_attn_scores -->
<g id="node20" class="node">
<title>gpu1_l0_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="3789,-687.08 3497,-687.08 3497,-635.08 3789,-635.08 3789,-687.08"/>
<text text-anchor="middle" x="3643" y="-675.08" font-family="Arial" font-size="10.00">L0 Attention Scores</text>
<text text-anchor="middle" x="3643" y="-664.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="3643" y="-653.08" font-family="Arial" font-size="10.00">Input: QKV [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="3643" y="-642.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l0_q_proj&#45;&gt;gpu1_l0_attn_scores -->
<g id="edge28" class="edge">
<title>gpu1_l0_q_proj&#45;&gt;gpu1_l0_attn_scores</title>
<path fill="none" stroke="black" d="M4542.17,-758C4516.33,-748.36 4485.62,-738.21 4457,-732.08 4231.65,-683.83 3964.47,-668.63 3799.32,-663.96"/>
<polygon fill="black" stroke="black" points="3799.18,-660.46 3789.08,-663.68 3798.98,-667.45 3799.18,-660.46"/>
</g>
<!-- gpu1_l0_k_proj&#45;&gt;gpu1_l0_attn_scores -->
<g id="edge29" class="edge">
<title>gpu1_l0_k_proj&#45;&gt;gpu1_l0_attn_scores</title>
<path fill="none" stroke="black" d="M3946.51,-758.06C3922.32,-749.63 3895.03,-740.28 3870,-732.08 3826.28,-717.76 3777.56,-702.63 3736.49,-690.11"/>
<polygon fill="black" stroke="black" points="3737.36,-686.71 3726.77,-687.15 3735.32,-693.41 3737.36,-686.71"/>
</g>
<!-- gpu1_l0_v_proj&#45;&gt;gpu1_l0_attn_scores -->
<g id="edge30" class="edge">
<title>gpu1_l0_v_proj&#45;&gt;gpu1_l0_attn_scores</title>
<path fill="none" stroke="black" d="M4247.23,-758.02C4221.75,-748.67 4191.81,-738.73 4164,-732.08 4043.08,-703.15 3903.32,-685.19 3799.01,-674.71"/>
<polygon fill="black" stroke="black" points="3799.32,-671.23 3789.03,-673.72 3798.63,-678.19 3799.32,-671.23"/>
</g>
<!-- gpu1_l0_out_proj -->
<g id="node21" class="node">
<title>gpu1_l0_out_proj</title>
<polygon fill="lightgreen" stroke="black" points="3951,-579.31 3683,-579.31 3683,-527.31 3951,-527.31 3951,-579.31"/>
<text text-anchor="middle" x="3817" y="-567.31" font-family="Arial" font-size="10.00">L0 Output Projection</text>
<text text-anchor="middle" x="3817" y="-556.31" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="3817" y="-545.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="3817" y="-534.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu1_l0_attn_scores&#45;&gt;gpu1_l0_out_proj -->
<g id="edge31" class="edge">
<title>gpu1_l0_attn_scores&#45;&gt;gpu1_l0_out_proj</title>
<path fill="none" stroke="black" d="M3684.24,-635.01C3709.07,-619.92 3740.85,-600.6 3767.09,-584.65"/>
<polygon fill="black" stroke="black" points="3769.03,-587.56 3775.76,-579.38 3765.4,-581.58 3769.03,-587.56"/>
</g>
<!-- gpu1_l0_out_proj&#45;&gt;tp_l0_allreduce -->
<g id="edge32" class="edge">
<title>gpu1_l0_out_proj&#45;&gt;tp_l0_allreduce</title>
<path fill="none" stroke="black" d="M3821.82,-579.39C3826.05,-609.78 3827.58,-660.25 3798,-687.08 3787.63,-696.48 2804.87,-730.2 2791,-732.08 2744.27,-738.41 2692.92,-749.84 2651.29,-760.28"/>
<polygon fill="black" stroke="black" points="2650.3,-756.92 2641.47,-762.76 2652.02,-763.7 2650.3,-756.92"/>
</g>
<!-- gpu1_l0_gate -->
<g id="node22" class="node">
<title>gpu1_l0_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3861.45,-836.08 3447.13,-836.08 3340.55,-732.08 3754.87,-732.08 3861.45,-836.08"/>
<text text-anchor="middle" x="3601" y="-798.08" font-family="Arial" font-size="10.00">L0 Gate Router</text>
<text text-anchor="middle" x="3601" y="-787.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="3601" y="-776.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="3601" y="-765.08" font-family="Arial" font-size="10.00">Output: routing decisions</text>
</g>
<!-- gpu1_l0_moe -->
<g id="node23" class="node">
<title>gpu1_l0_moe</title>
<polygon fill="lightgreen" stroke="black" points="3337,-687.08 3079,-687.08 3079,-635.08 3337,-635.08 3337,-687.08"/>
<text text-anchor="middle" x="3208" y="-675.08" font-family="Arial" font-size="10.00">L0 MoE (8 experts)</text>
<text text-anchor="middle" x="3208" y="-664.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="3208" y="-653.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="3208" y="-642.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu1_l0_gate&#45;&gt;gpu1_l0_moe -->
<g id="edge35" class="edge">
<title>gpu1_l0_gate&#45;&gt;gpu1_l0_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3435.19,-732.03C3388.51,-717.66 3339.47,-702.56 3298.94,-690.08"/>
<polygon fill="black" stroke="black" points="3299.95,-686.73 3289.37,-687.13 3297.9,-693.42 3299.95,-686.73"/>
<text text-anchor="middle" x="3399" y="-707.68" font-family="Arial" font-size="8.00">routing decisions</text>
</g>
<!-- gpu1_l1_q_proj -->
<g id="node24" class="node">
<title>gpu1_l1_q_proj</title>
<polygon fill="lightgreen" stroke="black" points="3078.5,-579.31 2803.5,-579.31 2803.5,-527.31 3078.5,-527.31 3078.5,-579.31"/>
<text text-anchor="middle" x="2941" y="-567.31" font-family="Arial" font-size="10.00">L1 Q Projection</text>
<text text-anchor="middle" x="2941" y="-556.31" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="2941" y="-545.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="2941" y="-534.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l0_moe&#45;&gt;gpu1_l1_q_proj -->
<g id="edge37" class="edge">
<title>gpu1_l0_moe&#45;&gt;gpu1_l1_q_proj</title>
<path fill="none" stroke="black" d="M3144.72,-635.01C3105.38,-619.43 3054.66,-599.34 3013.67,-583.1"/>
<polygon fill="black" stroke="black" points="3014.87,-579.81 3004.28,-579.38 3012.29,-586.31 3014.87,-579.81"/>
<text text-anchor="middle" x="3122.5" y="-610.68" font-family="Arial" font-size="8.00">layer 0 output</text>
</g>
<!-- gpu1_l1_k_proj -->
<g id="node25" class="node">
<title>gpu1_l1_k_proj</title>
<polygon fill="lightgreen" stroke="black" points="3371.5,-579.31 3096.5,-579.31 3096.5,-527.31 3371.5,-527.31 3371.5,-579.31"/>
<text text-anchor="middle" x="3234" y="-567.31" font-family="Arial" font-size="10.00">L1 K Projection</text>
<text text-anchor="middle" x="3234" y="-556.31" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="3234" y="-545.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="3234" y="-534.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l0_moe&#45;&gt;gpu1_l1_k_proj -->
<g id="edge38" class="edge">
<title>gpu1_l0_moe&#45;&gt;gpu1_l1_k_proj</title>
<path fill="none" stroke="black" d="M3214.16,-635.01C3217.5,-621.41 3221.69,-604.38 3225.36,-589.47"/>
<polygon fill="black" stroke="black" points="3228.8,-590.11 3227.79,-579.56 3222.01,-588.44 3228.8,-590.11"/>
<text text-anchor="middle" x="3244.5" y="-610.68" font-family="Arial" font-size="8.00">layer 0 output</text>
</g>
<!-- gpu1_l1_v_proj -->
<g id="node26" class="node">
<title>gpu1_l1_v_proj</title>
<polygon fill="lightgreen" stroke="black" points="3664.5,-579.31 3389.5,-579.31 3389.5,-527.31 3664.5,-527.31 3664.5,-579.31"/>
<text text-anchor="middle" x="3527" y="-567.31" font-family="Arial" font-size="10.00">L1 V Projection</text>
<text text-anchor="middle" x="3527" y="-556.31" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="3527" y="-545.31" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="3527" y="-534.31" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l0_moe&#45;&gt;gpu1_l1_v_proj -->
<g id="edge39" class="edge">
<title>gpu1_l0_moe&#45;&gt;gpu1_l1_v_proj</title>
<path fill="none" stroke="black" d="M3283.6,-635.01C3331.1,-619.26 3392.48,-598.91 3441.71,-582.59"/>
<polygon fill="black" stroke="black" points="3443,-585.85 3451.39,-579.38 3440.8,-579.2 3443,-585.85"/>
<text text-anchor="middle" x="3381.5" y="-610.68" font-family="Arial" font-size="8.00">layer 0 output</text>
</g>
<!-- gpu1_l0_moe&#45;&gt;ep_all2all -->
<g id="edge36" class="edge">
<title>gpu1_l0_moe&#45;&gt;ep_all2all</title>
<path fill="none" stroke="black" d="M3078.73,-636.58C3075.79,-636.07 3072.88,-635.57 3070,-635.08 2946.2,-613.88 2913.16,-619.27 2791,-590.08 2780.74,-587.63 2770.06,-584.71 2759.54,-581.61"/>
<polygon fill="black" stroke="black" points="2760.53,-578.25 2749.95,-578.72 2758.52,-584.96 2760.53,-578.25"/>
<text text-anchor="middle" x="2966" y="-610.68" font-family="Arial" font-size="8.00">tokens to route</text>
</g>
<!-- gpu1_l1_attn_scores -->
<g id="node27" class="node">
<title>gpu1_l1_attn_scores</title>
<polygon fill="lightgreen" stroke="black" points="3237,-431.54 2945,-431.54 2945,-379.54 3237,-379.54 3237,-431.54"/>
<text text-anchor="middle" x="3091" y="-419.54" font-family="Arial" font-size="10.00">L1 Attention Scores</text>
<text text-anchor="middle" x="3091" y="-408.54" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="3091" y="-397.54" font-family="Arial" font-size="10.00">Input: QKV [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="3091" y="-386.54" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
</g>
<!-- gpu1_l1_q_proj&#45;&gt;gpu1_l1_attn_scores -->
<g id="edge40" class="edge">
<title>gpu1_l1_q_proj&#45;&gt;gpu1_l1_attn_scores</title>
<path fill="none" stroke="black" d="M2966.79,-527.25C2991.9,-502.84 3030.19,-465.63 3057.62,-438.98"/>
<polygon fill="black" stroke="black" points="3060.32,-441.24 3065.05,-431.76 3055.44,-436.22 3060.32,-441.24"/>
</g>
<!-- gpu1_l1_k_proj&#45;&gt;gpu1_l1_attn_scores -->
<g id="edge41" class="edge">
<title>gpu1_l1_k_proj&#45;&gt;gpu1_l1_attn_scores</title>
<path fill="none" stroke="black" d="M3209.42,-527.25C3185.48,-502.84 3148.97,-465.63 3122.82,-438.98"/>
<polygon fill="black" stroke="black" points="3125.24,-436.45 3115.74,-431.76 3120.24,-441.35 3125.24,-436.45"/>
</g>
<!-- gpu1_l1_v_proj&#45;&gt;gpu1_l1_attn_scores -->
<g id="edge42" class="edge">
<title>gpu1_l1_v_proj&#45;&gt;gpu1_l1_attn_scores</title>
<path fill="none" stroke="black" d="M3452.05,-527.25C3375.19,-501.55 3255.86,-461.66 3175.65,-434.84"/>
<polygon fill="black" stroke="black" points="3176.66,-431.49 3166.07,-431.64 3174.44,-438.13 3176.66,-431.49"/>
</g>
<!-- gpu1_l1_out_proj -->
<g id="node28" class="node">
<title>gpu1_l1_out_proj</title>
<polygon fill="lightgreen" stroke="black" points="3078,-323.77 2810,-323.77 2810,-271.77 3078,-271.77 3078,-323.77"/>
<text text-anchor="middle" x="2944" y="-311.77" font-family="Arial" font-size="10.00">L1 Output Projection</text>
<text text-anchor="middle" x="2944" y="-300.77" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="2944" y="-289.77" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, heads=8, d_k=32]</text>
<text text-anchor="middle" x="2944" y="-278.77" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu1_l1_attn_scores&#45;&gt;gpu1_l1_out_proj -->
<g id="edge43" class="edge">
<title>gpu1_l1_attn_scores&#45;&gt;gpu1_l1_out_proj</title>
<path fill="none" stroke="black" d="M3056.16,-379.47C3035.46,-364.58 3009.04,-345.56 2987.04,-329.73"/>
<polygon fill="black" stroke="black" points="2989,-326.84 2978.84,-323.84 2984.91,-332.52 2989,-326.84"/>
</g>
<!-- gpu1_l1_out_proj&#45;&gt;tp_l1_allreduce -->
<g id="edge44" class="edge">
<title>gpu1_l1_out_proj&#45;&gt;tp_l1_allreduce</title>
<path fill="none" stroke="black" d="M2854.19,-323.85C2835.13,-328.23 2815.01,-332.14 2796,-334.54 2510.91,-370.57 495.87,-342.3 210,-371.54 132.57,-379.46 38,-326.7 38,-404.54 38,-662.08 38,-662.08 38,-662.08 38,-691.9 54.76,-720.41 72.55,-742.25"/>
<polygon fill="black" stroke="black" points="69.97,-744.62 79.11,-749.98 75.31,-740.09 69.97,-744.62"/>
</g>
<!-- gpu1_l1_gate -->
<g id="node29" class="node">
<title>gpu1_l1_gate</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="3323.45,-836.08 2909.13,-836.08 2802.55,-732.08 3216.87,-732.08 3323.45,-836.08"/>
<text text-anchor="middle" x="3063" y="-798.08" font-family="Arial" font-size="10.00">L1 Gate Router</text>
<text text-anchor="middle" x="3063" y="-787.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="3063" y="-776.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="3063" y="-765.08" font-family="Arial" font-size="10.00">Output: routing decisions</text>
</g>
<!-- gpu1_l1_moe -->
<g id="node30" class="node">
<title>gpu1_l1_moe</title>
<polygon fill="lightgreen" stroke="black" points="3061,-687.08 2803,-687.08 2803,-635.08 3061,-635.08 3061,-687.08"/>
<text text-anchor="middle" x="2932" y="-675.08" font-family="Arial" font-size="10.00">L1 MoE (8 experts)</text>
<text text-anchor="middle" x="2932" y="-664.08" font-family="Arial" font-size="10.00">GPU: 1</text>
<text text-anchor="middle" x="2932" y="-653.08" font-family="Arial" font-size="10.00">Input: [batch_size=43, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="2932" y="-642.08" font-family="Arial" font-size="10.00">Output: [batch_size=43, seq_len=10240, d_model=512]</text>
</g>
<!-- gpu1_l1_gate&#45;&gt;gpu1_l1_moe -->
<g id="edge47" class="edge">
<title>gpu1_l1_gate&#45;&gt;gpu1_l1_moe</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M3007.44,-731.76C2993.58,-718.96 2979.12,-705.6 2966.6,-694.04"/>
<polygon fill="black" stroke="black" points="2968.8,-691.31 2959.08,-687.09 2964.05,-696.45 2968.8,-691.31"/>
<text text-anchor="middle" x="3015" y="-707.68" font-family="Arial" font-size="8.00">routing decisions</text>
</g>
<!-- gpu1_l1_moe&#45;&gt;pp_stage0 -->
<g id="edge55" class="edge">
<title>gpu1_l1_moe&#45;&gt;pp_stage0</title>
<path fill="none" stroke="black" d="M2802.8,-654.52C2703.44,-648.73 2575.25,-637.55 2527,-617.08 2514.54,-611.79 2502.58,-603.72 2492,-595.1"/>
<polygon fill="black" stroke="black" points="2494.07,-592.27 2484.2,-588.44 2489.53,-597.59 2494.07,-592.27"/>
<text text-anchor="middle" x="2553" y="-610.68" font-family="Arial" font-size="8.00">stage 0 output</text>
</g>
<!-- tp_l0_allreduce&#45;&gt;gpu0_l0_gate -->
<g id="edge10" class="edge">
<title>tp_l0_allreduce&#45;&gt;gpu0_l0_gate</title>
<path fill="none" stroke="black" d="M2508.38,-811.64C2456.47,-834.03 2378.51,-863.84 2307,-876.08 2151.37,-902.7 1042.9,-893.72 886,-876.08 818.18,-868.45 745.13,-853.84 680.05,-838.47"/>
<polygon fill="black" stroke="black" points="680.64,-835.01 670.1,-836.1 679.01,-841.82 680.64,-835.01"/>
<text text-anchor="middle" x="788" y="-896.68" font-family="Arial" font-size="8.00">attention output</text>
</g>
<!-- tp_l0_allreduce&#45;&gt;gpu0_l0_moe -->
<g id="edge11" class="edge">
<title>tp_l0_allreduce&#45;&gt;gpu0_l0_moe</title>
<path fill="none" stroke="black" d="M2488.81,-766.53C2437.16,-756.01 2368.22,-742.45 2307,-732.08 2171.68,-709.15 2134.45,-709.57 1995.45,-687.29"/>
<polygon fill="black" stroke="black" points="1995.69,-683.78 1985.26,-685.64 1994.57,-690.69 1995.69,-683.78"/>
<text text-anchor="middle" x="2215" y="-707.68" font-family="Arial" font-size="8.00">attention output</text>
</g>
<!-- tp_l0_allreduce&#45;&gt;gpu1_l0_gate -->
<g id="edge33" class="edge">
<title>tp_l0_allreduce&#45;&gt;gpu1_l0_gate</title>
<path fill="none" stroke="black" d="M2622.46,-813.63C2666.48,-835.75 2730.82,-864.15 2791,-876.08 2908.93,-899.45 3213.41,-895.8 3332,-876.08 3377.04,-868.59 3424.65,-854.5 3467.1,-839.56"/>
<polygon fill="black" stroke="black" points="3468.39,-842.81 3476.64,-836.16 3466.04,-836.22 3468.39,-842.81"/>
<text text-anchor="middle" x="2999" y="-896.68" font-family="Arial" font-size="8.00">attention output</text>
</g>
<!-- tp_l0_allreduce&#45;&gt;gpu1_l0_moe -->
<g id="edge34" class="edge">
<title>tp_l0_allreduce&#45;&gt;gpu1_l0_moe</title>
<path fill="none" stroke="black" d="M2644.11,-764.38C2687.09,-754.15 2741.88,-741.65 2791,-732.08 2911.16,-708.67 2944.52,-708.28 3068.83,-687.26"/>
<polygon fill="black" stroke="black" points="3069.46,-690.7 3078.73,-685.57 3068.28,-683.8 3069.46,-690.7"/>
<text text-anchor="middle" x="2981" y="-707.68" font-family="Arial" font-size="8.00">attention output</text>
</g>
<!-- tp_l1_allreduce&#45;&gt;gpu0_l1_gate -->
<g id="edge22" class="edge">
<title>tp_l1_allreduce&#45;&gt;gpu0_l1_gate</title>
<path fill="none" stroke="black" d="M139.46,-819.46C156.71,-840.25 181.51,-864.63 210,-876.08 321.55,-920.9 631.53,-889.51 751,-876.08 828.49,-867.37 912.79,-849.54 984.25,-831.87"/>
<polygon fill="black" stroke="black" points="985.38,-835.2 994.24,-829.38 983.69,-828.4 985.38,-835.2"/>
<text text-anchor="middle" x="849" y="-896.68" font-family="Arial" font-size="8.00">attention output</text>
</g>
<!-- tp_l1_allreduce&#45;&gt;gpu0_l1_moe -->
<g id="edge23" class="edge">
<title>tp_l1_allreduce&#45;&gt;gpu0_l1_moe</title>
<path fill="none" stroke="black" d="M78.96,-750.15C67.1,-735.16 59.64,-717.94 72,-705.08 104.16,-671.62 730.1,-664.19 1015.41,-662.55"/>
<polygon fill="black" stroke="black" points="1015.85,-666.04 1025.83,-662.49 1015.81,-659.04 1015.85,-666.04"/>
<text text-anchor="middle" x="100" y="-707.68" font-family="Arial" font-size="8.00">attention output</text>
</g>
<!-- tp_l1_allreduce&#45;&gt;gpu1_l1_gate -->
<g id="edge45" class="edge">
<title>tp_l1_allreduce&#45;&gt;gpu1_l1_gate</title>
<path fill="none" stroke="black" d="M139.46,-819.46C156.71,-840.25 181.51,-864.63 210,-876.08 336.66,-926.97 2531.39,-891.62 2667,-876.08 2742.01,-867.48 2823.47,-850 2892.9,-832.57"/>
<polygon fill="black" stroke="black" points="2893.78,-835.96 2902.62,-830.11 2892.06,-829.17 2893.78,-835.96"/>
<text text-anchor="middle" x="1424" y="-896.68" font-family="Arial" font-size="8.00">attention output</text>
</g>
<!-- tp_l1_allreduce&#45;&gt;gpu1_l1_moe -->
<g id="edge46" class="edge">
<title>tp_l1_allreduce&#45;&gt;gpu1_l1_moe</title>
<path fill="none" stroke="black" d="M123.17,-747.33C129.19,-731.52 138.85,-714.43 154,-705.08 179.45,-689.38 2277.1,-687.8 2307,-687.08 2474.01,-683.04 2665.98,-674.83 2792.62,-668.92"/>
<polygon fill="black" stroke="black" points="2792.94,-672.41 2802.76,-668.44 2792.61,-665.41 2792.94,-672.41"/>
<text text-anchor="middle" x="182" y="-707.68" font-family="Arial" font-size="8.00">attention output</text>
</g>
<!-- ep_all2all&#45;&gt;gpu0_l0_moe -->
<g id="edge48" class="edge">
<title>ep_all2all&#45;&gt;gpu0_l0_moe</title>
<path fill="none" stroke="black" d="M2608.44,-578.79C2593.88,-583.12 2578.56,-587.17 2564,-590.08 2500.97,-602.69 2340.08,-612.03 2276,-617.08 2153.98,-626.69 2120.35,-620.21 1995.19,-635"/>
<polygon fill="black" stroke="black" points="1994.72,-631.53 1985.21,-636.2 1995.56,-638.48 1994.72,-631.53"/>
<text text-anchor="middle" x="2427" y="-610.68" font-family="Arial" font-size="8.00">routed tokens back</text>
</g>
<!-- ep_all2all&#45;&gt;gpu1_l0_moe -->
<g id="edge49" class="edge">
<title>ep_all2all&#45;&gt;gpu1_l0_moe</title>
<path fill="none" stroke="black" d="M2730.37,-584.71C2753.59,-596.97 2781.87,-609.88 2809,-617.08 2918.31,-646.08 2952.74,-622.08 3068.8,-635.04"/>
<polygon fill="black" stroke="black" points="3068.44,-638.52 3078.78,-636.22 3069.26,-631.57 3068.44,-638.52"/>
<text text-anchor="middle" x="2843" y="-610.68" font-family="Arial" font-size="8.00">routed tokens back</text>
</g>
<!-- load_balancer -->
<g id="node34" class="node">
<title>load_balancer</title>
<polygon fill="lightyellow" stroke="black" points="1566.07,-1003.08 1340.07,-1003.08 1281.93,-921.08 1507.93,-921.08 1566.07,-1003.08"/>
<text text-anchor="middle" x="1424" y="-970.58" font-family="Arial" font-size="10.00">Load Balancer</text>
<text text-anchor="middle" x="1424" y="-959.58" font-family="Arial" font-size="10.00">Input: GPU utilization stats</text>
<text text-anchor="middle" x="1424" y="-948.58" font-family="Arial" font-size="10.00">Output: balancing decisions</text>
</g>
<!-- load_balancer&#45;&gt;gpu0_l0_gate -->
<g id="edge50" class="edge">
<title>load_balancer&#45;&gt;gpu0_l0_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1308.2,-958.39C1129.54,-953.17 795.45,-938.86 682,-903.08 638.75,-889.44 594.9,-865 559.32,-841.89"/>
<polygon fill="black" stroke="black" points="561.2,-838.94 550.93,-836.37 557.35,-844.79 561.2,-838.94"/>
<text text-anchor="middle" x="699" y="-896.68" font-family="Arial" font-size="8.00">balancing</text>
</g>
<!-- load_balancer&#45;&gt;gpu0_l1_gate -->
<g id="edge51" class="edge">
<title>load_balancer&#45;&gt;gpu0_l1_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1309.21,-959.91C1120.32,-956.79 760.88,-945.3 722,-903.08 719.29,-900.14 719.54,-897.23 722,-894.08 723.07,-892.7 860.55,-858.23 980.29,-828.43"/>
<polygon fill="black" stroke="black" points="981.48,-831.74 990.34,-825.92 979.79,-824.94 981.48,-831.74"/>
<text text-anchor="middle" x="739" y="-896.68" font-family="Arial" font-size="8.00">balancing</text>
</g>
<!-- load_balancer&#45;&gt;gpu1_l0_gate -->
<g id="edge52" class="edge">
<title>load_balancer&#45;&gt;gpu1_l0_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1534.11,-957.88C1794.47,-950.14 2468.37,-929.12 3031,-903.08 3164.85,-896.88 3200.89,-913.72 3332,-886.08 3381.22,-875.7 3433.39,-857.83 3478.56,-839.98"/>
<polygon fill="black" stroke="black" points="3480.1,-843.13 3488.09,-836.17 3477.51,-836.63 3480.1,-843.13"/>
<text text-anchor="middle" x="3305" y="-896.68" font-family="Arial" font-size="8.00">balancing</text>
</g>
<!-- load_balancer&#45;&gt;gpu1_l1_gate -->
<g id="edge53" class="edge">
<title>load_balancer&#45;&gt;gpu1_l1_gate</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1523.57,-942.86C1617.63,-926.58 1762.87,-903.83 1890,-894.08 1976.09,-887.48 2581.39,-897.27 2667,-886.08 2743.6,-876.06 2826.67,-856.3 2896.86,-836.89"/>
<polygon fill="black" stroke="black" points="2897.98,-840.21 2906.67,-834.15 2896.1,-833.46 2897.98,-840.21"/>
<text text-anchor="middle" x="1907" y="-896.68" font-family="Arial" font-size="8.00">balancing</text>
</g>
<!-- remaining_gpus -->
<g id="node35" class="node">
<title>remaining_gpus</title>
<polygon fill="lightgreen" stroke="black" points="2526.5,-431.54 2377.5,-431.54 2377.5,-379.54 2526.5,-379.54 2526.5,-431.54"/>
<text text-anchor="middle" x="2452" y="-419.54" font-family="Arial" font-size="10.00">GPUs 2&#45;23</text>
<text text-anchor="middle" x="2452" y="-408.54" font-family="Arial" font-size="10.00">Same attention decomposition</text>
<text text-anchor="middle" x="2452" y="-397.54" font-family="Arial" font-size="10.00">Same parallel patterns</text>
<text text-anchor="middle" x="2452" y="-386.54" font-family="Arial" font-size="10.00">Complete connectivity</text>
</g>
<!-- pp_stage1 -->
<g id="node37" class="node">
<title>pp_stage1</title>
<ellipse fill="lightblue" stroke="black" cx="2452" cy="-297.77" rx="102.56" ry="36.54"/>
<text text-anchor="middle" x="2452" y="-311.77" font-family="Arial" font-size="10.00">PP Stage 1→2</text>
<text text-anchor="middle" x="2452" y="-300.77" font-family="Arial" font-size="10.00">GPUs: 8&#45;15 → 16&#45;23</text>
<text text-anchor="middle" x="2452" y="-289.77" font-family="Arial" font-size="10.00">Input: activations</text>
<text text-anchor="middle" x="2452" y="-278.77" font-family="Arial" font-size="10.00">Output: forwarded activations</text>
</g>
<!-- remaining_gpus&#45;&gt;pp_stage1 -->
<g id="edge57" class="edge">
<title>remaining_gpus&#45;&gt;pp_stage1</title>
<path fill="none" stroke="black" d="M2452,-379.47C2452,-369.17 2452,-356.9 2452,-345.08"/>
<polygon fill="black" stroke="black" points="2455.5,-344.87 2452,-334.87 2448.5,-344.87 2455.5,-344.87"/>
<text text-anchor="middle" x="2478" y="-355.14" font-family="Arial" font-size="8.00">stage 1 output</text>
</g>
<!-- dp_allreduce -->
<g id="node38" class="node">
<title>dp_allreduce</title>
<ellipse fill="lightblue" stroke="black" cx="2680" cy="-297.77" rx="107.46" ry="36.54"/>
<text text-anchor="middle" x="2680" y="-311.77" font-family="Arial" font-size="10.00">DP All&#45;Sum</text>
<text text-anchor="middle" x="2680" y="-300.77" font-family="Arial" font-size="10.00">GPUs: 0&#45;23</text>
<text text-anchor="middle" x="2680" y="-289.77" font-family="Arial" font-size="10.00">Input: gradient chunks</text>
<text text-anchor="middle" x="2680" y="-278.77" font-family="Arial" font-size="10.00">Output: synchronized gradients</text>
</g>
<!-- remaining_gpus&#45;&gt;dp_allreduce -->
<g id="edge58" class="edge">
<title>remaining_gpus&#45;&gt;dp_allreduce</title>
<path fill="none" stroke="black" d="M2506.03,-379.47C2536.61,-365.29 2575.22,-347.38 2608.3,-332.03"/>
<polygon fill="black" stroke="black" points="2609.88,-335.16 2617.48,-327.77 2606.93,-328.81 2609.88,-335.16"/>
<text text-anchor="middle" x="2576" y="-355.14" font-family="Arial" font-size="8.00">gradients</text>
</g>
<!-- output_aggregation -->
<g id="node39" class="node">
<title>output_aggregation</title>
<polygon fill="lightyellow" stroke="black" points="2578.47,-224 2377.29,-224 2325.53,-142 2526.71,-142 2578.47,-224"/>
<text text-anchor="middle" x="2452" y="-191.5" font-family="Arial" font-size="10.00">Output Aggregation</text>
<text text-anchor="middle" x="2452" y="-180.5" font-family="Arial" font-size="10.00">Input: distributed results</text>
<text text-anchor="middle" x="2452" y="-169.5" font-family="Arial" font-size="10.00">Output: final predictions</text>
</g>
<!-- remaining_gpus&#45;&gt;output_aggregation -->
<g id="edge59" class="edge">
<title>remaining_gpus&#45;&gt;output_aggregation</title>
<path fill="none" stroke="black" d="M2388.24,-379.42C2369.28,-368.6 2350.73,-353.89 2340,-334.54 2324.16,-305.95 2324.78,-289.93 2340,-261 2346.69,-248.27 2356.55,-237.24 2367.68,-227.82"/>
<polygon fill="black" stroke="black" points="2369.91,-230.52 2375.56,-221.56 2365.56,-225.04 2369.91,-230.52"/>
</g>
<!-- pp_stage0&#45;&gt;remaining_gpus -->
<g id="edge56" class="edge">
<title>pp_stage0&#45;&gt;remaining_gpus</title>
<path fill="none" stroke="black" d="M2452,-516.28C2452,-493.57 2452,-464.38 2452,-441.82"/>
<polygon fill="black" stroke="black" points="2455.5,-441.65 2452,-431.65 2448.5,-441.65 2455.5,-441.65"/>
<text text-anchor="middle" x="2490" y="-492.14" font-family="Arial" font-size="8.00">forwarded activations</text>
</g>
<!-- pp_stage1&#45;&gt;output_aggregation -->
<g id="edge60" class="edge">
<title>pp_stage1&#45;&gt;output_aggregation</title>
<path fill="none" stroke="black" d="M2452,-260.78C2452,-252.44 2452,-243.41 2452,-234.58"/>
<polygon fill="black" stroke="black" points="2455.5,-234.35 2452,-224.35 2448.5,-234.35 2455.5,-234.35"/>
</g>
<!-- final_output -->
<g id="node40" class="node">
<title>final_output</title>
<polygon fill="lightgreen" stroke="black" points="2715,-57 2459,-57 2459,-16 2715,-16 2715,-57"/>
<text text-anchor="middle" x="2587" y="-45" font-family="Arial" font-size="10.00">Final Output</text>
<text text-anchor="middle" x="2587" y="-34" font-family="Arial" font-size="10.00">Input: [batch_size=128, seq_len=10240, d_model=512]</text>
<text text-anchor="middle" x="2587" y="-23" font-family="Arial" font-size="10.00">Output: [batch_size=128, seq_len=10240, vocab_size]</text>
</g>
<!-- dp_allreduce&#45;&gt;final_output -->
<g id="edge62" class="edge">
<title>dp_allreduce&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M2667.17,-260.99C2648.6,-209.25 2614.62,-114.5 2597.48,-66.71"/>
<polygon fill="black" stroke="black" points="2600.76,-65.48 2594.09,-57.25 2594.17,-67.85 2600.76,-65.48"/>
<text text-anchor="middle" x="2676.5" y="-181.1" font-family="Arial" font-size="8.00">synchronized</text>
</g>
<!-- output_aggregation&#45;&gt;final_output -->
<g id="edge61" class="edge">
<title>output_aggregation&#45;&gt;final_output</title>
<path fill="none" stroke="black" d="M2489.61,-141.75C2512.54,-117.21 2541.23,-86.49 2561.52,-64.77"/>
<polygon fill="black" stroke="black" points="2564.32,-66.9 2568.59,-57.21 2559.2,-62.12 2564.32,-66.9"/>
<text text-anchor="middle" x="2543" y="-117.6" font-family="Arial" font-size="8.00">aggregated result</text>
</g>
</g>
</svg>
