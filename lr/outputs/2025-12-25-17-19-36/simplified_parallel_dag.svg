<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="2570pt" height="3029pt"
 viewBox="0.00 0.00 616.80 726.85" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(4.17 4.17) rotate(0) translate(4 722.85)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-722.85 612.8,-722.85 612.8,4 -4,4"/>
<!-- input -->
<g id="node1" class="node">
<title>input</title>
<polygon fill="none" stroke="black" points="181.43,-718.85 40.43,-718.85 40.43,-682.85 181.43,-682.85 181.43,-718.85"/>
<text text-anchor="middle" x="110.93" y="-703.85" font-family="Times,serif" font-size="10.00">Input</text>
<text text-anchor="middle" x="110.93" y="-692.85" font-family="Times,serif" font-size="10.00">[batch=128, seq=10240]</text>
</g>
<!-- dp_split -->
<g id="node2" class="node">
<title>dp_split</title>
<polygon fill="none" stroke="black" points="221.8,-645.85 45.44,-645.85 0.07,-585.85 176.43,-585.85 221.8,-645.85"/>
<text text-anchor="middle" x="110.93" y="-618.85" font-family="Times,serif" font-size="10.00">Data Parallel Split</text>
<text text-anchor="middle" x="110.93" y="-607.85" font-family="Times,serif" font-size="10.00">3 groups</text>
</g>
<!-- input&#45;&gt;dp_split -->
<g id="edge1" class="edge">
<title>input&#45;&gt;dp_split</title>
<path fill="none" stroke="black" d="M110.93,-682.66C110.93,-675 110.93,-665.63 110.93,-656.4"/>
<polygon fill="black" stroke="black" points="114.43,-656.12 110.93,-646.12 107.43,-656.12 114.43,-656.12"/>
</g>
<!-- pp_stage0 -->
<g id="node3" class="node">
<title>pp_stage0</title>
<polygon fill="none" stroke="black" points="235.43,-534.85 136.43,-534.85 136.43,-493.85 235.43,-493.85 235.43,-534.85"/>
<text text-anchor="middle" x="185.93" y="-522.85" font-family="Times,serif" font-size="10.00">Pipeline Stage 0</text>
<text text-anchor="middle" x="185.93" y="-511.85" font-family="Times,serif" font-size="10.00">Layers 0&#45;7</text>
<text text-anchor="middle" x="185.93" y="-500.85" font-family="Times,serif" font-size="10.00">GPUs: 0&#45;7</text>
</g>
<!-- dp_split&#45;&gt;pp_stage0 -->
<g id="edge2" class="edge">
<title>dp_split&#45;&gt;pp_stage0</title>
<path fill="none" stroke="black" d="M132.83,-585.81C142.9,-572.44 154.8,-556.65 164.78,-543.41"/>
<polygon fill="black" stroke="black" points="167.8,-545.22 171.02,-535.13 162.21,-541.01 167.8,-545.22"/>
<text text-anchor="middle" x="185.93" y="-556.65" font-family="Times,serif" font-size="14.00">group 0</text>
</g>
<!-- pp_stage1 -->
<g id="node4" class="node">
<title>pp_stage1</title>
<polygon fill="none" stroke="black" points="239.43,-193.43 140.43,-193.43 140.43,-152.43 239.43,-152.43 239.43,-193.43"/>
<text text-anchor="middle" x="189.93" y="-181.43" font-family="Times,serif" font-size="10.00">Pipeline Stage 1</text>
<text text-anchor="middle" x="189.93" y="-170.43" font-family="Times,serif" font-size="10.00">Layers 8&#45;15</text>
<text text-anchor="middle" x="189.93" y="-159.43" font-family="Times,serif" font-size="10.00">GPUs: 8&#45;15</text>
</g>
<!-- dp_split&#45;&gt;pp_stage1 -->
<g id="edge3" class="edge">
<title>dp_split&#45;&gt;pp_stage1</title>
<path fill="none" stroke="black" d="M103.68,-585.45C99.45,-565.74 94.93,-539.15 94.93,-515.35 94.93,-515.35 94.93,-515.35 94.93,-250.64 94.93,-227.74 111.85,-210.51 131.4,-198.24"/>
<polygon fill="black" stroke="black" points="133.32,-201.17 140.21,-193.11 129.8,-195.12 133.32,-201.17"/>
<text text-anchor="middle" x="122.93" y="-391.65" font-family="Times,serif" font-size="14.00">group 1</text>
</g>
<!-- tp_group0 -->
<g id="node5" class="node">
<title>tp_group0</title>
<polygon fill="none" stroke="black" points="355.43,-456.85 254.43,-456.85 254.43,-420.85 355.43,-420.85 355.43,-456.85"/>
<text text-anchor="middle" x="304.93" y="-441.85" font-family="Times,serif" font-size="10.00">TP Group (0,1)</text>
<text text-anchor="middle" x="304.93" y="-430.85" font-family="Times,serif" font-size="10.00">Attention + MoE</text>
</g>
<!-- pp_stage0&#45;&gt;tp_group0 -->
<g id="edge4" class="edge">
<title>pp_stage0&#45;&gt;tp_group0</title>
<path fill="none" stroke="black" d="M217.51,-493.85C233.2,-484.16 252.23,-472.4 268.53,-462.34"/>
<polygon fill="black" stroke="black" points="270.59,-465.18 277.26,-456.94 266.92,-459.22 270.59,-465.18"/>
</g>
<!-- tp_group1 -->
<g id="node6" class="node">
<title>tp_group1</title>
<polygon fill="none" stroke="black" points="236.43,-456.85 135.43,-456.85 135.43,-420.85 236.43,-420.85 236.43,-456.85"/>
<text text-anchor="middle" x="185.93" y="-441.85" font-family="Times,serif" font-size="10.00">TP Group (2,3)</text>
<text text-anchor="middle" x="185.93" y="-430.85" font-family="Times,serif" font-size="10.00">Attention + MoE</text>
</g>
<!-- pp_stage0&#45;&gt;tp_group1 -->
<g id="edge5" class="edge">
<title>pp_stage0&#45;&gt;tp_group1</title>
<path fill="none" stroke="black" d="M185.93,-493.66C185.93,-485.55 185.93,-476.03 185.93,-467.27"/>
<polygon fill="black" stroke="black" points="189.43,-467.1 185.93,-457.1 182.43,-467.1 189.43,-467.1"/>
</g>
<!-- dp_comm -->
<g id="node11" class="node">
<title>dp_comm</title>
<ellipse fill="none" stroke="black" cx="237.93" cy="-94.21" rx="65.52" ry="21.43"/>
<text text-anchor="middle" x="237.93" y="-97.21" font-family="Times,serif" font-size="10.00">DP All&#45;Reduce</text>
<text text-anchor="middle" x="237.93" y="-86.21" font-family="Times,serif" font-size="10.00">Across replicas</text>
</g>
<!-- pp_stage1&#45;&gt;dp_comm -->
<g id="edge12" class="edge">
<title>pp_stage1&#45;&gt;dp_comm</title>
<path fill="none" stroke="black" d="M202.29,-152.17C207.68,-143.56 214.1,-133.3 220,-123.87"/>
<polygon fill="black" stroke="black" points="223.11,-125.5 225.45,-115.17 217.18,-121.79 223.11,-125.5"/>
</g>
<!-- gate0 -->
<g id="node7" class="node">
<title>gate0</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="608.67,-369.85 480.24,-369.85 447.2,-309.85 575.63,-309.85 608.67,-369.85"/>
<text text-anchor="middle" x="527.93" y="-342.85" font-family="Times,serif" font-size="10.00">Gate Router</text>
<text text-anchor="middle" x="527.93" y="-331.85" font-family="Times,serif" font-size="10.00">GPU 0&#45;1</text>
</g>
<!-- tp_group0&#45;&gt;gate0 -->
<g id="edge6" class="edge">
<title>tp_group0&#45;&gt;gate0</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M344.03,-420.85C378.03,-406.06 427.85,-384.39 467.07,-367.33"/>
<polygon fill="black" stroke="black" points="468.5,-370.52 476.28,-363.32 465.71,-364.1 468.5,-370.52"/>
</g>
<!-- tp_comm -->
<g id="node9" class="node">
<title>tp_comm</title>
<ellipse fill="none" stroke="black" cx="185.93" cy="-339.85" rx="62.87" ry="21.43"/>
<text text-anchor="middle" x="185.93" y="-342.85" font-family="Times,serif" font-size="10.00">TP All&#45;Reduce</text>
<text text-anchor="middle" x="185.93" y="-331.85" font-family="Times,serif" font-size="10.00">Across pairs</text>
</g>
<!-- tp_group0&#45;&gt;tp_comm -->
<g id="edge8" class="edge">
<title>tp_group0&#45;&gt;tp_comm</title>
<path fill="none" stroke="black" d="M283.93,-420.73C265.44,-405.66 238.24,-383.49 217.19,-366.33"/>
<polygon fill="black" stroke="black" points="219.13,-363.4 209.17,-359.79 214.7,-368.82 219.13,-363.4"/>
</g>
<!-- gate1 -->
<g id="node8" class="node">
<title>gate1</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="428.67,-369.85 300.24,-369.85 267.2,-309.85 395.63,-309.85 428.67,-369.85"/>
<text text-anchor="middle" x="347.93" y="-342.85" font-family="Times,serif" font-size="10.00">Gate Router</text>
<text text-anchor="middle" x="347.93" y="-331.85" font-family="Times,serif" font-size="10.00">GPU 2&#45;3</text>
</g>
<!-- tp_group1&#45;&gt;gate1 -->
<g id="edge7" class="edge">
<title>tp_group1&#45;&gt;gate1</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M214.52,-420.73C235.74,-408.03 265.37,-390.29 291.31,-374.75"/>
<polygon fill="black" stroke="black" points="293.17,-377.72 299.95,-369.58 289.58,-371.72 293.17,-377.72"/>
</g>
<!-- tp_group1&#45;&gt;tp_comm -->
<g id="edge9" class="edge">
<title>tp_group1&#45;&gt;tp_comm</title>
<path fill="none" stroke="black" d="M185.93,-420.51C185.93,-406.92 185.93,-387.67 185.93,-371.5"/>
<polygon fill="black" stroke="black" points="189.43,-371.41 185.93,-361.41 182.43,-371.41 189.43,-371.41"/>
</g>
<!-- ep_comm -->
<g id="node12" class="node">
<title>ep_comm</title>
<ellipse fill="none" stroke="black" cx="347.93" cy="-251.64" rx="65.11" ry="21.43"/>
<text text-anchor="middle" x="347.93" y="-254.64" font-family="Times,serif" font-size="10.00">EP All&#45;to&#45;All</text>
<text text-anchor="middle" x="347.93" y="-243.64" font-family="Times,serif" font-size="10.00">Expert routing</text>
</g>
<!-- gate0&#45;&gt;ep_comm -->
<g id="edge13" class="edge">
<title>gate0&#45;&gt;ep_comm</title>
<path fill="none" stroke="black" d="M467.24,-309.79C442.67,-298.01 414.81,-284.67 392.2,-273.84"/>
<polygon fill="black" stroke="black" points="393.71,-270.68 383.18,-269.52 390.69,-277 393.71,-270.68"/>
</g>
<!-- gate1&#45;&gt;ep_comm -->
<g id="edge14" class="edge">
<title>gate1&#45;&gt;ep_comm</title>
<path fill="none" stroke="black" d="M347.93,-309.66C347.93,-301.12 347.93,-291.76 347.93,-283.14"/>
<polygon fill="black" stroke="black" points="351.43,-283.09 347.93,-273.09 344.43,-283.09 351.43,-283.09"/>
</g>
<!-- pp_comm -->
<g id="node10" class="node">
<title>pp_comm</title>
<ellipse fill="none" stroke="black" cx="189.93" cy="-251.64" rx="67.35" ry="21.43"/>
<text text-anchor="middle" x="189.93" y="-254.64" font-family="Times,serif" font-size="10.00">PP Send/Recv</text>
<text text-anchor="middle" x="189.93" y="-243.64" font-family="Times,serif" font-size="10.00">Stage0â†’Stage1</text>
</g>
<!-- tp_comm&#45;&gt;pp_comm -->
<g id="edge10" class="edge">
<title>tp_comm&#45;&gt;pp_comm</title>
<path fill="none" stroke="black" d="M186.88,-318.42C187.37,-307.9 187.97,-294.86 188.52,-283.17"/>
<polygon fill="black" stroke="black" points="192.02,-283.08 188.99,-272.92 185.03,-282.75 192.02,-283.08"/>
</g>
<!-- pp_comm&#45;&gt;pp_stage1 -->
<g id="edge11" class="edge">
<title>pp_comm&#45;&gt;pp_stage1</title>
<path fill="none" stroke="black" d="M189.93,-230.08C189.93,-222 189.93,-212.57 189.93,-203.77"/>
<polygon fill="black" stroke="black" points="193.43,-203.48 189.93,-193.48 186.43,-203.48 193.43,-203.48"/>
</g>
<!-- output -->
<g id="node13" class="node">
<title>output</title>
<polygon fill="none" stroke="black" points="363.93,-36 221.93,-36 221.93,0 363.93,0 363.93,-36"/>
<text text-anchor="middle" x="292.93" y="-21" font-family="Times,serif" font-size="10.00">Output</text>
<text text-anchor="middle" x="292.93" y="-10" font-family="Times,serif" font-size="10.00">[batch=128, predictions]</text>
</g>
<!-- dp_comm&#45;&gt;output -->
<g id="edge15" class="edge">
<title>dp_comm&#45;&gt;output</title>
<path fill="none" stroke="black" d="M252.67,-73.33C259.2,-64.52 266.96,-54.04 273.92,-44.65"/>
<polygon fill="black" stroke="black" points="276.88,-46.53 280.03,-36.41 271.26,-42.36 276.88,-46.53"/>
</g>
<!-- ep_comm&#45;&gt;output -->
<g id="edge16" class="edge">
<title>ep_comm&#45;&gt;output</title>
<path fill="none" stroke="black" d="M345.03,-230.41C340.02,-197.18 328.74,-129.12 312.93,-73 310.4,-64.01 307.05,-54.39 303.82,-45.79"/>
<polygon fill="black" stroke="black" points="307.01,-44.34 300.14,-36.28 300.48,-46.87 307.01,-44.34"/>
</g>
</g>
</svg>
