// 4-layer MoE with EP=16 deployment on 16 GPUs
digraph MoE_Cross_Node_Expert_Parallelism {
	rankdir=TB size="20,20"
	node [shape=rectangle]
	input [label="Model Input
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]" fillcolor=lightblue shape=ellipse style=filled]
	layer_0_input [label="Layer 0 Input
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_0_mha_qkv [label="MHA QKV Projection
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_0_mha_attention [label="MHA Attention
Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_0_mha_proj [label="MHA Output Projection
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_0_mha_residual [label="MHA Residual Add
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightcoral style=filled]
	layer_0_mha_layernorm [label="Layer Norm (Post-MHA)
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgray style=filled]
	layer_0_gate [label="Expert Gate
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, k=2]
GPU: all GPUs" fillcolor=orange shape=parallelogram style=filled]
	layer_0_token_split [label="Token Split by Expert
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192] per expert
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_0_expert_0 [label="Expert 0
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 0" fillcolor=lightcyan style=filled]
	layer_0_expert_0_gate_proj [label="Expert 0 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_0_expert_0_up_proj [label="Expert 0 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_0_expert_0_activation [label="Expert 0 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_0_expert_0_down_proj [label="Expert 0 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_0_expert_1 [label="Expert 1
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 1" fillcolor=lightcyan style=filled]
	layer_0_expert_1_gate_proj [label="Expert 1 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_0_expert_1_up_proj [label="Expert 1 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_0_expert_1_activation [label="Expert 1 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_0_expert_1_down_proj [label="Expert 1 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_0_expert_2 [label="Expert 2
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 2" fillcolor=lightcyan style=filled]
	layer_0_expert_2_gate_proj [label="Expert 2 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_0_expert_2_up_proj [label="Expert 2 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_0_expert_2_activation [label="Expert 2 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_0_expert_2_down_proj [label="Expert 2 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_0_expert_3 [label="Expert 3
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 3" fillcolor=lightcyan style=filled]
	layer_0_expert_3_gate_proj [label="Expert 3 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_0_expert_3_up_proj [label="Expert 3 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_0_expert_3_activation [label="Expert 3 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_0_expert_3_down_proj [label="Expert 3 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_0_expert_4 [label="Expert 4
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 4" fillcolor=lightcyan style=filled]
	layer_0_expert_4_gate_proj [label="Expert 4 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_0_expert_4_up_proj [label="Expert 4 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_0_expert_4_activation [label="Expert 4 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_0_expert_4_down_proj [label="Expert 4 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_0_expert_5 [label="Expert 5
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 5" fillcolor=lightcyan style=filled]
	layer_0_expert_5_gate_proj [label="Expert 5 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_0_expert_5_up_proj [label="Expert 5 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_0_expert_5_activation [label="Expert 5 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_0_expert_5_down_proj [label="Expert 5 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_0_expert_6 [label="Expert 6
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 6" fillcolor=lightcyan style=filled]
	layer_0_expert_6_gate_proj [label="Expert 6 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_0_expert_6_up_proj [label="Expert 6 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_0_expert_6_activation [label="Expert 6 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_0_expert_6_down_proj [label="Expert 6 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_0_expert_7 [label="Expert 7
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 7" fillcolor=lightcyan style=filled]
	layer_0_expert_7_gate_proj [label="Expert 7 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_0_expert_7_up_proj [label="Expert 7 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_0_expert_7_activation [label="Expert 7 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_0_expert_7_down_proj [label="Expert 7 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_0_expert_8 [label="Expert 8
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 8" fillcolor=lightcyan style=filled]
	layer_0_expert_8_gate_proj [label="Expert 8 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_0_expert_8_up_proj [label="Expert 8 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_0_expert_8_activation [label="Expert 8 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_0_expert_8_down_proj [label="Expert 8 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_0_expert_9 [label="Expert 9
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 9" fillcolor=lightcyan style=filled]
	layer_0_expert_9_gate_proj [label="Expert 9 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_0_expert_9_up_proj [label="Expert 9 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_0_expert_9_activation [label="Expert 9 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_0_expert_9_down_proj [label="Expert 9 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_0_expert_10 [label="Expert 10
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 10" fillcolor=lightcyan style=filled]
	layer_0_expert_10_gate_proj [label="Expert 10 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_0_expert_10_up_proj [label="Expert 10 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_0_expert_10_activation [label="Expert 10 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_0_expert_10_down_proj [label="Expert 10 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_0_expert_11 [label="Expert 11
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 11" fillcolor=lightcyan style=filled]
	layer_0_expert_11_gate_proj [label="Expert 11 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_0_expert_11_up_proj [label="Expert 11 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_0_expert_11_activation [label="Expert 11 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_0_expert_11_down_proj [label="Expert 11 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_0_expert_12 [label="Expert 12
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 12" fillcolor=lightcyan style=filled]
	layer_0_expert_12_gate_proj [label="Expert 12 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_0_expert_12_up_proj [label="Expert 12 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_0_expert_12_activation [label="Expert 12 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_0_expert_12_down_proj [label="Expert 12 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_0_expert_13 [label="Expert 13
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 13" fillcolor=lightcyan style=filled]
	layer_0_expert_13_gate_proj [label="Expert 13 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_0_expert_13_up_proj [label="Expert 13 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_0_expert_13_activation [label="Expert 13 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_0_expert_13_down_proj [label="Expert 13 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_0_expert_14 [label="Expert 14
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 14" fillcolor=lightcyan style=filled]
	layer_0_expert_14_gate_proj [label="Expert 14 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_0_expert_14_up_proj [label="Expert 14 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_0_expert_14_activation [label="Expert 14 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_0_expert_14_down_proj [label="Expert 14 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_0_expert_15 [label="Expert 15
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 15" fillcolor=lightcyan style=filled]
	layer_0_expert_15_gate_proj [label="Expert 15 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_0_expert_15_up_proj [label="Expert 15 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_0_expert_15_activation [label="Expert 15 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_0_expert_15_down_proj [label="Expert 15 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_0_expert_agg [label="Expert Output Aggregation
Input: [batch_size=variable, hidden_size=8192] from all experts
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_0_expert_residual [label="Expert Residual Add
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightcoral style=filled]
	layer_0_expert_layernorm [label="Layer Norm (Post-Experts)
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgray style=filled]
	layer_1_input [label="Layer 1 Input
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_1_mha_qkv [label="MHA QKV Projection
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_1_mha_attention [label="MHA Attention
Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_1_mha_proj [label="MHA Output Projection
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_1_mha_residual [label="MHA Residual Add
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightcoral style=filled]
	layer_1_mha_layernorm [label="Layer Norm (Post-MHA)
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgray style=filled]
	layer_1_gate [label="Expert Gate
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, k=2]
GPU: all GPUs" fillcolor=orange shape=parallelogram style=filled]
	layer_1_token_split [label="Token Split by Expert
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192] per expert
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_1_expert_0 [label="Expert 0
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 0" fillcolor=lightcyan style=filled]
	layer_1_expert_0_gate_proj [label="Expert 0 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_1_expert_0_up_proj [label="Expert 0 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_1_expert_0_activation [label="Expert 0 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_1_expert_0_down_proj [label="Expert 0 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_1_expert_1 [label="Expert 1
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 1" fillcolor=lightcyan style=filled]
	layer_1_expert_1_gate_proj [label="Expert 1 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_1_expert_1_up_proj [label="Expert 1 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_1_expert_1_activation [label="Expert 1 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_1_expert_1_down_proj [label="Expert 1 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_1_expert_2 [label="Expert 2
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 2" fillcolor=lightcyan style=filled]
	layer_1_expert_2_gate_proj [label="Expert 2 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_1_expert_2_up_proj [label="Expert 2 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_1_expert_2_activation [label="Expert 2 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_1_expert_2_down_proj [label="Expert 2 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_1_expert_3 [label="Expert 3
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 3" fillcolor=lightcyan style=filled]
	layer_1_expert_3_gate_proj [label="Expert 3 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_1_expert_3_up_proj [label="Expert 3 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_1_expert_3_activation [label="Expert 3 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_1_expert_3_down_proj [label="Expert 3 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_1_expert_4 [label="Expert 4
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 4" fillcolor=lightcyan style=filled]
	layer_1_expert_4_gate_proj [label="Expert 4 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_1_expert_4_up_proj [label="Expert 4 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_1_expert_4_activation [label="Expert 4 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_1_expert_4_down_proj [label="Expert 4 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_1_expert_5 [label="Expert 5
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 5" fillcolor=lightcyan style=filled]
	layer_1_expert_5_gate_proj [label="Expert 5 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_1_expert_5_up_proj [label="Expert 5 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_1_expert_5_activation [label="Expert 5 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_1_expert_5_down_proj [label="Expert 5 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_1_expert_6 [label="Expert 6
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 6" fillcolor=lightcyan style=filled]
	layer_1_expert_6_gate_proj [label="Expert 6 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_1_expert_6_up_proj [label="Expert 6 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_1_expert_6_activation [label="Expert 6 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_1_expert_6_down_proj [label="Expert 6 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_1_expert_7 [label="Expert 7
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 7" fillcolor=lightcyan style=filled]
	layer_1_expert_7_gate_proj [label="Expert 7 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_1_expert_7_up_proj [label="Expert 7 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_1_expert_7_activation [label="Expert 7 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_1_expert_7_down_proj [label="Expert 7 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_1_expert_8 [label="Expert 8
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 8" fillcolor=lightcyan style=filled]
	layer_1_expert_8_gate_proj [label="Expert 8 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_1_expert_8_up_proj [label="Expert 8 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_1_expert_8_activation [label="Expert 8 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_1_expert_8_down_proj [label="Expert 8 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_1_expert_9 [label="Expert 9
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 9" fillcolor=lightcyan style=filled]
	layer_1_expert_9_gate_proj [label="Expert 9 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_1_expert_9_up_proj [label="Expert 9 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_1_expert_9_activation [label="Expert 9 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_1_expert_9_down_proj [label="Expert 9 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_1_expert_10 [label="Expert 10
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 10" fillcolor=lightcyan style=filled]
	layer_1_expert_10_gate_proj [label="Expert 10 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_1_expert_10_up_proj [label="Expert 10 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_1_expert_10_activation [label="Expert 10 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_1_expert_10_down_proj [label="Expert 10 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_1_expert_11 [label="Expert 11
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 11" fillcolor=lightcyan style=filled]
	layer_1_expert_11_gate_proj [label="Expert 11 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_1_expert_11_up_proj [label="Expert 11 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_1_expert_11_activation [label="Expert 11 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_1_expert_11_down_proj [label="Expert 11 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_1_expert_12 [label="Expert 12
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 12" fillcolor=lightcyan style=filled]
	layer_1_expert_12_gate_proj [label="Expert 12 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_1_expert_12_up_proj [label="Expert 12 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_1_expert_12_activation [label="Expert 12 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_1_expert_12_down_proj [label="Expert 12 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_1_expert_13 [label="Expert 13
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 13" fillcolor=lightcyan style=filled]
	layer_1_expert_13_gate_proj [label="Expert 13 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_1_expert_13_up_proj [label="Expert 13 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_1_expert_13_activation [label="Expert 13 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_1_expert_13_down_proj [label="Expert 13 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_1_expert_14 [label="Expert 14
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 14" fillcolor=lightcyan style=filled]
	layer_1_expert_14_gate_proj [label="Expert 14 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_1_expert_14_up_proj [label="Expert 14 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_1_expert_14_activation [label="Expert 14 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_1_expert_14_down_proj [label="Expert 14 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_1_expert_15 [label="Expert 15
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 15" fillcolor=lightcyan style=filled]
	layer_1_expert_15_gate_proj [label="Expert 15 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_1_expert_15_up_proj [label="Expert 15 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_1_expert_15_activation [label="Expert 15 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_1_expert_15_down_proj [label="Expert 15 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_1_expert_agg [label="Expert Output Aggregation
Input: [batch_size=variable, hidden_size=8192] from all experts
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_1_expert_residual [label="Expert Residual Add
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightcoral style=filled]
	layer_1_expert_layernorm [label="Layer Norm (Post-Experts)
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgray style=filled]
	layer_2_input [label="Layer 2 Input
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_2_mha_qkv [label="MHA QKV Projection
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_2_mha_attention [label="MHA Attention
Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_2_mha_proj [label="MHA Output Projection
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_2_mha_residual [label="MHA Residual Add
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightcoral style=filled]
	layer_2_mha_layernorm [label="Layer Norm (Post-MHA)
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgray style=filled]
	layer_2_gate [label="Expert Gate
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, k=2]
GPU: all GPUs" fillcolor=orange shape=parallelogram style=filled]
	layer_2_token_split [label="Token Split by Expert
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192] per expert
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_2_expert_0 [label="Expert 0
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 0" fillcolor=lightcyan style=filled]
	layer_2_expert_0_gate_proj [label="Expert 0 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_2_expert_0_up_proj [label="Expert 0 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_2_expert_0_activation [label="Expert 0 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_2_expert_0_down_proj [label="Expert 0 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_2_expert_1 [label="Expert 1
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 1" fillcolor=lightcyan style=filled]
	layer_2_expert_1_gate_proj [label="Expert 1 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_2_expert_1_up_proj [label="Expert 1 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_2_expert_1_activation [label="Expert 1 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_2_expert_1_down_proj [label="Expert 1 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_2_expert_2 [label="Expert 2
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 2" fillcolor=lightcyan style=filled]
	layer_2_expert_2_gate_proj [label="Expert 2 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_2_expert_2_up_proj [label="Expert 2 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_2_expert_2_activation [label="Expert 2 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_2_expert_2_down_proj [label="Expert 2 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_2_expert_3 [label="Expert 3
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 3" fillcolor=lightcyan style=filled]
	layer_2_expert_3_gate_proj [label="Expert 3 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_2_expert_3_up_proj [label="Expert 3 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_2_expert_3_activation [label="Expert 3 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_2_expert_3_down_proj [label="Expert 3 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_2_expert_4 [label="Expert 4
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 4" fillcolor=lightcyan style=filled]
	layer_2_expert_4_gate_proj [label="Expert 4 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_2_expert_4_up_proj [label="Expert 4 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_2_expert_4_activation [label="Expert 4 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_2_expert_4_down_proj [label="Expert 4 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_2_expert_5 [label="Expert 5
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 5" fillcolor=lightcyan style=filled]
	layer_2_expert_5_gate_proj [label="Expert 5 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_2_expert_5_up_proj [label="Expert 5 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_2_expert_5_activation [label="Expert 5 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_2_expert_5_down_proj [label="Expert 5 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_2_expert_6 [label="Expert 6
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 6" fillcolor=lightcyan style=filled]
	layer_2_expert_6_gate_proj [label="Expert 6 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_2_expert_6_up_proj [label="Expert 6 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_2_expert_6_activation [label="Expert 6 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_2_expert_6_down_proj [label="Expert 6 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_2_expert_7 [label="Expert 7
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 7" fillcolor=lightcyan style=filled]
	layer_2_expert_7_gate_proj [label="Expert 7 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_2_expert_7_up_proj [label="Expert 7 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_2_expert_7_activation [label="Expert 7 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_2_expert_7_down_proj [label="Expert 7 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_2_expert_8 [label="Expert 8
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 8" fillcolor=lightcyan style=filled]
	layer_2_expert_8_gate_proj [label="Expert 8 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_2_expert_8_up_proj [label="Expert 8 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_2_expert_8_activation [label="Expert 8 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_2_expert_8_down_proj [label="Expert 8 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_2_expert_9 [label="Expert 9
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 9" fillcolor=lightcyan style=filled]
	layer_2_expert_9_gate_proj [label="Expert 9 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_2_expert_9_up_proj [label="Expert 9 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_2_expert_9_activation [label="Expert 9 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_2_expert_9_down_proj [label="Expert 9 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_2_expert_10 [label="Expert 10
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 10" fillcolor=lightcyan style=filled]
	layer_2_expert_10_gate_proj [label="Expert 10 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_2_expert_10_up_proj [label="Expert 10 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_2_expert_10_activation [label="Expert 10 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_2_expert_10_down_proj [label="Expert 10 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_2_expert_11 [label="Expert 11
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 11" fillcolor=lightcyan style=filled]
	layer_2_expert_11_gate_proj [label="Expert 11 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_2_expert_11_up_proj [label="Expert 11 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_2_expert_11_activation [label="Expert 11 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_2_expert_11_down_proj [label="Expert 11 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_2_expert_12 [label="Expert 12
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 12" fillcolor=lightcyan style=filled]
	layer_2_expert_12_gate_proj [label="Expert 12 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_2_expert_12_up_proj [label="Expert 12 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_2_expert_12_activation [label="Expert 12 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_2_expert_12_down_proj [label="Expert 12 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_2_expert_13 [label="Expert 13
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 13" fillcolor=lightcyan style=filled]
	layer_2_expert_13_gate_proj [label="Expert 13 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_2_expert_13_up_proj [label="Expert 13 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_2_expert_13_activation [label="Expert 13 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_2_expert_13_down_proj [label="Expert 13 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_2_expert_14 [label="Expert 14
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 14" fillcolor=lightcyan style=filled]
	layer_2_expert_14_gate_proj [label="Expert 14 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_2_expert_14_up_proj [label="Expert 14 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_2_expert_14_activation [label="Expert 14 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_2_expert_14_down_proj [label="Expert 14 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_2_expert_15 [label="Expert 15
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 15" fillcolor=lightcyan style=filled]
	layer_2_expert_15_gate_proj [label="Expert 15 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_2_expert_15_up_proj [label="Expert 15 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_2_expert_15_activation [label="Expert 15 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_2_expert_15_down_proj [label="Expert 15 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_2_expert_agg [label="Expert Output Aggregation
Input: [batch_size=variable, hidden_size=8192] from all experts
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_2_expert_residual [label="Expert Residual Add
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightcoral style=filled]
	layer_2_expert_layernorm [label="Layer Norm (Post-Experts)
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgray style=filled]
	layer_3_input [label="Layer 3 Input
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_3_mha_qkv [label="MHA QKV Projection
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, heads=16, d_k=512]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_3_mha_attention [label="MHA Attention
Input: [batch_size=1024, seq_len=10000, heads=16, d_k=512]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_3_mha_proj [label="MHA Output Projection
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgreen style=filled]
	layer_3_mha_residual [label="MHA Residual Add
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightcoral style=filled]
	layer_3_mha_layernorm [label="Layer Norm (Post-MHA)
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgray style=filled]
	layer_3_gate [label="Expert Gate
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, k=2]
GPU: all GPUs" fillcolor=orange shape=parallelogram style=filled]
	layer_3_token_split [label="Token Split by Expert
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192] per expert
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_3_expert_0 [label="Expert 0
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 0" fillcolor=lightcyan style=filled]
	layer_3_expert_0_gate_proj [label="Expert 0 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_3_expert_0_up_proj [label="Expert 0 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_3_expert_0_activation [label="Expert 0 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_3_expert_0_down_proj [label="Expert 0 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 0" fillcolor=lightsteelblue style=filled]
	layer_3_expert_1 [label="Expert 1
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 1" fillcolor=lightcyan style=filled]
	layer_3_expert_1_gate_proj [label="Expert 1 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_3_expert_1_up_proj [label="Expert 1 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_3_expert_1_activation [label="Expert 1 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_3_expert_1_down_proj [label="Expert 1 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 1" fillcolor=lightsteelblue style=filled]
	layer_3_expert_2 [label="Expert 2
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 2" fillcolor=lightcyan style=filled]
	layer_3_expert_2_gate_proj [label="Expert 2 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_3_expert_2_up_proj [label="Expert 2 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_3_expert_2_activation [label="Expert 2 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_3_expert_2_down_proj [label="Expert 2 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 2" fillcolor=lightsteelblue style=filled]
	layer_3_expert_3 [label="Expert 3
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 3" fillcolor=lightcyan style=filled]
	layer_3_expert_3_gate_proj [label="Expert 3 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_3_expert_3_up_proj [label="Expert 3 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_3_expert_3_activation [label="Expert 3 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_3_expert_3_down_proj [label="Expert 3 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 3" fillcolor=lightsteelblue style=filled]
	layer_3_expert_4 [label="Expert 4
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 4" fillcolor=lightcyan style=filled]
	layer_3_expert_4_gate_proj [label="Expert 4 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_3_expert_4_up_proj [label="Expert 4 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_3_expert_4_activation [label="Expert 4 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_3_expert_4_down_proj [label="Expert 4 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 4" fillcolor=lightsteelblue style=filled]
	layer_3_expert_5 [label="Expert 5
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 5" fillcolor=lightcyan style=filled]
	layer_3_expert_5_gate_proj [label="Expert 5 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_3_expert_5_up_proj [label="Expert 5 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_3_expert_5_activation [label="Expert 5 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_3_expert_5_down_proj [label="Expert 5 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 5" fillcolor=lightsteelblue style=filled]
	layer_3_expert_6 [label="Expert 6
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 6" fillcolor=lightcyan style=filled]
	layer_3_expert_6_gate_proj [label="Expert 6 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_3_expert_6_up_proj [label="Expert 6 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_3_expert_6_activation [label="Expert 6 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_3_expert_6_down_proj [label="Expert 6 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 6" fillcolor=lightsteelblue style=filled]
	layer_3_expert_7 [label="Expert 7
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 7" fillcolor=lightcyan style=filled]
	layer_3_expert_7_gate_proj [label="Expert 7 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_3_expert_7_up_proj [label="Expert 7 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_3_expert_7_activation [label="Expert 7 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_3_expert_7_down_proj [label="Expert 7 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 7" fillcolor=lightsteelblue style=filled]
	layer_3_expert_8 [label="Expert 8
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 8" fillcolor=lightcyan style=filled]
	layer_3_expert_8_gate_proj [label="Expert 8 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_3_expert_8_up_proj [label="Expert 8 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_3_expert_8_activation [label="Expert 8 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_3_expert_8_down_proj [label="Expert 8 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 8" fillcolor=lightsteelblue style=filled]
	layer_3_expert_9 [label="Expert 9
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 9" fillcolor=lightcyan style=filled]
	layer_3_expert_9_gate_proj [label="Expert 9 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_3_expert_9_up_proj [label="Expert 9 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_3_expert_9_activation [label="Expert 9 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_3_expert_9_down_proj [label="Expert 9 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 9" fillcolor=lightsteelblue style=filled]
	layer_3_expert_10 [label="Expert 10
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 10" fillcolor=lightcyan style=filled]
	layer_3_expert_10_gate_proj [label="Expert 10 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_3_expert_10_up_proj [label="Expert 10 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_3_expert_10_activation [label="Expert 10 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_3_expert_10_down_proj [label="Expert 10 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 10" fillcolor=lightsteelblue style=filled]
	layer_3_expert_11 [label="Expert 11
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 11" fillcolor=lightcyan style=filled]
	layer_3_expert_11_gate_proj [label="Expert 11 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_3_expert_11_up_proj [label="Expert 11 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_3_expert_11_activation [label="Expert 11 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_3_expert_11_down_proj [label="Expert 11 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 11" fillcolor=lightsteelblue style=filled]
	layer_3_expert_12 [label="Expert 12
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 12" fillcolor=lightcyan style=filled]
	layer_3_expert_12_gate_proj [label="Expert 12 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_3_expert_12_up_proj [label="Expert 12 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_3_expert_12_activation [label="Expert 12 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_3_expert_12_down_proj [label="Expert 12 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 12" fillcolor=lightsteelblue style=filled]
	layer_3_expert_13 [label="Expert 13
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 13" fillcolor=lightcyan style=filled]
	layer_3_expert_13_gate_proj [label="Expert 13 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_3_expert_13_up_proj [label="Expert 13 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_3_expert_13_activation [label="Expert 13 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_3_expert_13_down_proj [label="Expert 13 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 13" fillcolor=lightsteelblue style=filled]
	layer_3_expert_14 [label="Expert 14
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 14" fillcolor=lightcyan style=filled]
	layer_3_expert_14_gate_proj [label="Expert 14 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_3_expert_14_up_proj [label="Expert 14 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_3_expert_14_activation [label="Expert 14 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_3_expert_14_down_proj [label="Expert 14 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 14" fillcolor=lightsteelblue style=filled]
	layer_3_expert_15 [label="Expert 15
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, hidden_size=8192]
GPU: 15" fillcolor=lightcyan style=filled]
	layer_3_expert_15_gate_proj [label="Expert 15 Gate Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_3_expert_15_up_proj [label="Expert 15 Up Proj
Input: [batch_size=variable, hidden_size=8192]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_3_expert_15_activation [label="Expert 15 GELU Activation
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, ffn_hidden=32768]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_3_expert_15_down_proj [label="Expert 15 Down Proj
Input: [batch_size=variable, ffn_hidden=32768]
Output: [batch_size=variable, hidden_size=8192]
GPU: 15" fillcolor=lightsteelblue style=filled]
	layer_3_expert_agg [label="Expert Output Aggregation
Input: [batch_size=variable, hidden_size=8192] from all experts
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightyellow shape=parallelogram style=filled]
	layer_3_expert_residual [label="Expert Residual Add
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightcoral style=filled]
	layer_3_expert_layernorm [label="Layer Norm (Post-Experts)
Input: [batch_size=1024, seq_len=10000, hidden_size=8192]
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]
GPU: all GPUs" fillcolor=lightgray style=filled]
	output [label="Model Output
Output: [batch_size=1024, seq_len=10000, hidden_size=8192]" fillcolor=lightblue shape=ellipse style=filled]
	input -> layer_0_input
	layer_0_input -> layer_0_mha_qkv
	layer_0_mha_qkv -> layer_0_mha_attention
	layer_0_mha_attention -> layer_0_mha_proj
	layer_0_input -> layer_0_mha_residual
	layer_0_mha_proj -> layer_0_mha_residual
	layer_0_mha_residual -> layer_0_mha_layernorm
	layer_0_mha_layernorm -> layer_0_gate
	layer_0_mha_layernorm -> layer_0_token_split
	layer_0_gate -> layer_0_token_split [style=dashed]
	layer_0_token_split -> layer_0_expert_0
	layer_0_expert_0 -> layer_0_expert_0_gate_proj
	layer_0_expert_0_gate_proj -> layer_0_expert_0_activation
	layer_0_expert_0 -> layer_0_expert_0_up_proj
	layer_0_expert_0_up_proj -> layer_0_expert_0_activation
	layer_0_expert_0_activation -> layer_0_expert_0_down_proj
	layer_0_expert_0_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_1
	layer_0_expert_1 -> layer_0_expert_1_gate_proj
	layer_0_expert_1_gate_proj -> layer_0_expert_1_activation
	layer_0_expert_1 -> layer_0_expert_1_up_proj
	layer_0_expert_1_up_proj -> layer_0_expert_1_activation
	layer_0_expert_1_activation -> layer_0_expert_1_down_proj
	layer_0_expert_1_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_2
	layer_0_expert_2 -> layer_0_expert_2_gate_proj
	layer_0_expert_2_gate_proj -> layer_0_expert_2_activation
	layer_0_expert_2 -> layer_0_expert_2_up_proj
	layer_0_expert_2_up_proj -> layer_0_expert_2_activation
	layer_0_expert_2_activation -> layer_0_expert_2_down_proj
	layer_0_expert_2_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_3
	layer_0_expert_3 -> layer_0_expert_3_gate_proj
	layer_0_expert_3_gate_proj -> layer_0_expert_3_activation
	layer_0_expert_3 -> layer_0_expert_3_up_proj
	layer_0_expert_3_up_proj -> layer_0_expert_3_activation
	layer_0_expert_3_activation -> layer_0_expert_3_down_proj
	layer_0_expert_3_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_4
	layer_0_expert_4 -> layer_0_expert_4_gate_proj
	layer_0_expert_4_gate_proj -> layer_0_expert_4_activation
	layer_0_expert_4 -> layer_0_expert_4_up_proj
	layer_0_expert_4_up_proj -> layer_0_expert_4_activation
	layer_0_expert_4_activation -> layer_0_expert_4_down_proj
	layer_0_expert_4_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_5
	layer_0_expert_5 -> layer_0_expert_5_gate_proj
	layer_0_expert_5_gate_proj -> layer_0_expert_5_activation
	layer_0_expert_5 -> layer_0_expert_5_up_proj
	layer_0_expert_5_up_proj -> layer_0_expert_5_activation
	layer_0_expert_5_activation -> layer_0_expert_5_down_proj
	layer_0_expert_5_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_6
	layer_0_expert_6 -> layer_0_expert_6_gate_proj
	layer_0_expert_6_gate_proj -> layer_0_expert_6_activation
	layer_0_expert_6 -> layer_0_expert_6_up_proj
	layer_0_expert_6_up_proj -> layer_0_expert_6_activation
	layer_0_expert_6_activation -> layer_0_expert_6_down_proj
	layer_0_expert_6_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_7
	layer_0_expert_7 -> layer_0_expert_7_gate_proj
	layer_0_expert_7_gate_proj -> layer_0_expert_7_activation
	layer_0_expert_7 -> layer_0_expert_7_up_proj
	layer_0_expert_7_up_proj -> layer_0_expert_7_activation
	layer_0_expert_7_activation -> layer_0_expert_7_down_proj
	layer_0_expert_7_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_8
	layer_0_expert_8 -> layer_0_expert_8_gate_proj
	layer_0_expert_8_gate_proj -> layer_0_expert_8_activation
	layer_0_expert_8 -> layer_0_expert_8_up_proj
	layer_0_expert_8_up_proj -> layer_0_expert_8_activation
	layer_0_expert_8_activation -> layer_0_expert_8_down_proj
	layer_0_expert_8_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_9
	layer_0_expert_9 -> layer_0_expert_9_gate_proj
	layer_0_expert_9_gate_proj -> layer_0_expert_9_activation
	layer_0_expert_9 -> layer_0_expert_9_up_proj
	layer_0_expert_9_up_proj -> layer_0_expert_9_activation
	layer_0_expert_9_activation -> layer_0_expert_9_down_proj
	layer_0_expert_9_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_10
	layer_0_expert_10 -> layer_0_expert_10_gate_proj
	layer_0_expert_10_gate_proj -> layer_0_expert_10_activation
	layer_0_expert_10 -> layer_0_expert_10_up_proj
	layer_0_expert_10_up_proj -> layer_0_expert_10_activation
	layer_0_expert_10_activation -> layer_0_expert_10_down_proj
	layer_0_expert_10_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_11
	layer_0_expert_11 -> layer_0_expert_11_gate_proj
	layer_0_expert_11_gate_proj -> layer_0_expert_11_activation
	layer_0_expert_11 -> layer_0_expert_11_up_proj
	layer_0_expert_11_up_proj -> layer_0_expert_11_activation
	layer_0_expert_11_activation -> layer_0_expert_11_down_proj
	layer_0_expert_11_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_12
	layer_0_expert_12 -> layer_0_expert_12_gate_proj
	layer_0_expert_12_gate_proj -> layer_0_expert_12_activation
	layer_0_expert_12 -> layer_0_expert_12_up_proj
	layer_0_expert_12_up_proj -> layer_0_expert_12_activation
	layer_0_expert_12_activation -> layer_0_expert_12_down_proj
	layer_0_expert_12_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_13
	layer_0_expert_13 -> layer_0_expert_13_gate_proj
	layer_0_expert_13_gate_proj -> layer_0_expert_13_activation
	layer_0_expert_13 -> layer_0_expert_13_up_proj
	layer_0_expert_13_up_proj -> layer_0_expert_13_activation
	layer_0_expert_13_activation -> layer_0_expert_13_down_proj
	layer_0_expert_13_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_14
	layer_0_expert_14 -> layer_0_expert_14_gate_proj
	layer_0_expert_14_gate_proj -> layer_0_expert_14_activation
	layer_0_expert_14 -> layer_0_expert_14_up_proj
	layer_0_expert_14_up_proj -> layer_0_expert_14_activation
	layer_0_expert_14_activation -> layer_0_expert_14_down_proj
	layer_0_expert_14_down_proj -> layer_0_expert_agg
	layer_0_token_split -> layer_0_expert_15
	layer_0_expert_15 -> layer_0_expert_15_gate_proj
	layer_0_expert_15_gate_proj -> layer_0_expert_15_activation
	layer_0_expert_15 -> layer_0_expert_15_up_proj
	layer_0_expert_15_up_proj -> layer_0_expert_15_activation
	layer_0_expert_15_activation -> layer_0_expert_15_down_proj
	layer_0_expert_15_down_proj -> layer_0_expert_agg
	layer_0_mha_layernorm -> layer_0_expert_residual
	layer_0_expert_agg -> layer_0_expert_residual
	layer_0_expert_residual -> layer_0_expert_layernorm
	layer_0_expert_layernorm -> layer_1_input
	layer_1_input -> layer_1_mha_qkv
	layer_1_mha_qkv -> layer_1_mha_attention
	layer_1_mha_attention -> layer_1_mha_proj
	layer_1_input -> layer_1_mha_residual
	layer_1_mha_proj -> layer_1_mha_residual
	layer_1_mha_residual -> layer_1_mha_layernorm
	layer_1_mha_layernorm -> layer_1_gate
	layer_1_mha_layernorm -> layer_1_token_split
	layer_1_gate -> layer_1_token_split [style=dashed]
	layer_1_token_split -> layer_1_expert_0
	layer_1_expert_0 -> layer_1_expert_0_gate_proj
	layer_1_expert_0_gate_proj -> layer_1_expert_0_activation
	layer_1_expert_0 -> layer_1_expert_0_up_proj
	layer_1_expert_0_up_proj -> layer_1_expert_0_activation
	layer_1_expert_0_activation -> layer_1_expert_0_down_proj
	layer_1_expert_0_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_1
	layer_1_expert_1 -> layer_1_expert_1_gate_proj
	layer_1_expert_1_gate_proj -> layer_1_expert_1_activation
	layer_1_expert_1 -> layer_1_expert_1_up_proj
	layer_1_expert_1_up_proj -> layer_1_expert_1_activation
	layer_1_expert_1_activation -> layer_1_expert_1_down_proj
	layer_1_expert_1_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_2
	layer_1_expert_2 -> layer_1_expert_2_gate_proj
	layer_1_expert_2_gate_proj -> layer_1_expert_2_activation
	layer_1_expert_2 -> layer_1_expert_2_up_proj
	layer_1_expert_2_up_proj -> layer_1_expert_2_activation
	layer_1_expert_2_activation -> layer_1_expert_2_down_proj
	layer_1_expert_2_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_3
	layer_1_expert_3 -> layer_1_expert_3_gate_proj
	layer_1_expert_3_gate_proj -> layer_1_expert_3_activation
	layer_1_expert_3 -> layer_1_expert_3_up_proj
	layer_1_expert_3_up_proj -> layer_1_expert_3_activation
	layer_1_expert_3_activation -> layer_1_expert_3_down_proj
	layer_1_expert_3_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_4
	layer_1_expert_4 -> layer_1_expert_4_gate_proj
	layer_1_expert_4_gate_proj -> layer_1_expert_4_activation
	layer_1_expert_4 -> layer_1_expert_4_up_proj
	layer_1_expert_4_up_proj -> layer_1_expert_4_activation
	layer_1_expert_4_activation -> layer_1_expert_4_down_proj
	layer_1_expert_4_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_5
	layer_1_expert_5 -> layer_1_expert_5_gate_proj
	layer_1_expert_5_gate_proj -> layer_1_expert_5_activation
	layer_1_expert_5 -> layer_1_expert_5_up_proj
	layer_1_expert_5_up_proj -> layer_1_expert_5_activation
	layer_1_expert_5_activation -> layer_1_expert_5_down_proj
	layer_1_expert_5_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_6
	layer_1_expert_6 -> layer_1_expert_6_gate_proj
	layer_1_expert_6_gate_proj -> layer_1_expert_6_activation
	layer_1_expert_6 -> layer_1_expert_6_up_proj
	layer_1_expert_6_up_proj -> layer_1_expert_6_activation
	layer_1_expert_6_activation -> layer_1_expert_6_down_proj
	layer_1_expert_6_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_7
	layer_1_expert_7 -> layer_1_expert_7_gate_proj
	layer_1_expert_7_gate_proj -> layer_1_expert_7_activation
	layer_1_expert_7 -> layer_1_expert_7_up_proj
	layer_1_expert_7_up_proj -> layer_1_expert_7_activation
	layer_1_expert_7_activation -> layer_1_expert_7_down_proj
	layer_1_expert_7_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_8
	layer_1_expert_8 -> layer_1_expert_8_gate_proj
	layer_1_expert_8_gate_proj -> layer_1_expert_8_activation
	layer_1_expert_8 -> layer_1_expert_8_up_proj
	layer_1_expert_8_up_proj -> layer_1_expert_8_activation
	layer_1_expert_8_activation -> layer_1_expert_8_down_proj
	layer_1_expert_8_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_9
	layer_1_expert_9 -> layer_1_expert_9_gate_proj
	layer_1_expert_9_gate_proj -> layer_1_expert_9_activation
	layer_1_expert_9 -> layer_1_expert_9_up_proj
	layer_1_expert_9_up_proj -> layer_1_expert_9_activation
	layer_1_expert_9_activation -> layer_1_expert_9_down_proj
	layer_1_expert_9_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_10
	layer_1_expert_10 -> layer_1_expert_10_gate_proj
	layer_1_expert_10_gate_proj -> layer_1_expert_10_activation
	layer_1_expert_10 -> layer_1_expert_10_up_proj
	layer_1_expert_10_up_proj -> layer_1_expert_10_activation
	layer_1_expert_10_activation -> layer_1_expert_10_down_proj
	layer_1_expert_10_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_11
	layer_1_expert_11 -> layer_1_expert_11_gate_proj
	layer_1_expert_11_gate_proj -> layer_1_expert_11_activation
	layer_1_expert_11 -> layer_1_expert_11_up_proj
	layer_1_expert_11_up_proj -> layer_1_expert_11_activation
	layer_1_expert_11_activation -> layer_1_expert_11_down_proj
	layer_1_expert_11_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_12
	layer_1_expert_12 -> layer_1_expert_12_gate_proj
	layer_1_expert_12_gate_proj -> layer_1_expert_12_activation
	layer_1_expert_12 -> layer_1_expert_12_up_proj
	layer_1_expert_12_up_proj -> layer_1_expert_12_activation
	layer_1_expert_12_activation -> layer_1_expert_12_down_proj
	layer_1_expert_12_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_13
	layer_1_expert_13 -> layer_1_expert_13_gate_proj
	layer_1_expert_13_gate_proj -> layer_1_expert_13_activation
	layer_1_expert_13 -> layer_1_expert_13_up_proj
	layer_1_expert_13_up_proj -> layer_1_expert_13_activation
	layer_1_expert_13_activation -> layer_1_expert_13_down_proj
	layer_1_expert_13_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_14
	layer_1_expert_14 -> layer_1_expert_14_gate_proj
	layer_1_expert_14_gate_proj -> layer_1_expert_14_activation
	layer_1_expert_14 -> layer_1_expert_14_up_proj
	layer_1_expert_14_up_proj -> layer_1_expert_14_activation
	layer_1_expert_14_activation -> layer_1_expert_14_down_proj
	layer_1_expert_14_down_proj -> layer_1_expert_agg
	layer_1_token_split -> layer_1_expert_15
	layer_1_expert_15 -> layer_1_expert_15_gate_proj
	layer_1_expert_15_gate_proj -> layer_1_expert_15_activation
	layer_1_expert_15 -> layer_1_expert_15_up_proj
	layer_1_expert_15_up_proj -> layer_1_expert_15_activation
	layer_1_expert_15_activation -> layer_1_expert_15_down_proj
	layer_1_expert_15_down_proj -> layer_1_expert_agg
	layer_1_mha_layernorm -> layer_1_expert_residual
	layer_1_expert_agg -> layer_1_expert_residual
	layer_1_expert_residual -> layer_1_expert_layernorm
	layer_1_expert_layernorm -> layer_2_input
	layer_2_input -> layer_2_mha_qkv
	layer_2_mha_qkv -> layer_2_mha_attention
	layer_2_mha_attention -> layer_2_mha_proj
	layer_2_input -> layer_2_mha_residual
	layer_2_mha_proj -> layer_2_mha_residual
	layer_2_mha_residual -> layer_2_mha_layernorm
	layer_2_mha_layernorm -> layer_2_gate
	layer_2_mha_layernorm -> layer_2_token_split
	layer_2_gate -> layer_2_token_split [style=dashed]
	layer_2_token_split -> layer_2_expert_0
	layer_2_expert_0 -> layer_2_expert_0_gate_proj
	layer_2_expert_0_gate_proj -> layer_2_expert_0_activation
	layer_2_expert_0 -> layer_2_expert_0_up_proj
	layer_2_expert_0_up_proj -> layer_2_expert_0_activation
	layer_2_expert_0_activation -> layer_2_expert_0_down_proj
	layer_2_expert_0_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_1
	layer_2_expert_1 -> layer_2_expert_1_gate_proj
	layer_2_expert_1_gate_proj -> layer_2_expert_1_activation
	layer_2_expert_1 -> layer_2_expert_1_up_proj
	layer_2_expert_1_up_proj -> layer_2_expert_1_activation
	layer_2_expert_1_activation -> layer_2_expert_1_down_proj
	layer_2_expert_1_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_2
	layer_2_expert_2 -> layer_2_expert_2_gate_proj
	layer_2_expert_2_gate_proj -> layer_2_expert_2_activation
	layer_2_expert_2 -> layer_2_expert_2_up_proj
	layer_2_expert_2_up_proj -> layer_2_expert_2_activation
	layer_2_expert_2_activation -> layer_2_expert_2_down_proj
	layer_2_expert_2_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_3
	layer_2_expert_3 -> layer_2_expert_3_gate_proj
	layer_2_expert_3_gate_proj -> layer_2_expert_3_activation
	layer_2_expert_3 -> layer_2_expert_3_up_proj
	layer_2_expert_3_up_proj -> layer_2_expert_3_activation
	layer_2_expert_3_activation -> layer_2_expert_3_down_proj
	layer_2_expert_3_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_4
	layer_2_expert_4 -> layer_2_expert_4_gate_proj
	layer_2_expert_4_gate_proj -> layer_2_expert_4_activation
	layer_2_expert_4 -> layer_2_expert_4_up_proj
	layer_2_expert_4_up_proj -> layer_2_expert_4_activation
	layer_2_expert_4_activation -> layer_2_expert_4_down_proj
	layer_2_expert_4_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_5
	layer_2_expert_5 -> layer_2_expert_5_gate_proj
	layer_2_expert_5_gate_proj -> layer_2_expert_5_activation
	layer_2_expert_5 -> layer_2_expert_5_up_proj
	layer_2_expert_5_up_proj -> layer_2_expert_5_activation
	layer_2_expert_5_activation -> layer_2_expert_5_down_proj
	layer_2_expert_5_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_6
	layer_2_expert_6 -> layer_2_expert_6_gate_proj
	layer_2_expert_6_gate_proj -> layer_2_expert_6_activation
	layer_2_expert_6 -> layer_2_expert_6_up_proj
	layer_2_expert_6_up_proj -> layer_2_expert_6_activation
	layer_2_expert_6_activation -> layer_2_expert_6_down_proj
	layer_2_expert_6_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_7
	layer_2_expert_7 -> layer_2_expert_7_gate_proj
	layer_2_expert_7_gate_proj -> layer_2_expert_7_activation
	layer_2_expert_7 -> layer_2_expert_7_up_proj
	layer_2_expert_7_up_proj -> layer_2_expert_7_activation
	layer_2_expert_7_activation -> layer_2_expert_7_down_proj
	layer_2_expert_7_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_8
	layer_2_expert_8 -> layer_2_expert_8_gate_proj
	layer_2_expert_8_gate_proj -> layer_2_expert_8_activation
	layer_2_expert_8 -> layer_2_expert_8_up_proj
	layer_2_expert_8_up_proj -> layer_2_expert_8_activation
	layer_2_expert_8_activation -> layer_2_expert_8_down_proj
	layer_2_expert_8_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_9
	layer_2_expert_9 -> layer_2_expert_9_gate_proj
	layer_2_expert_9_gate_proj -> layer_2_expert_9_activation
	layer_2_expert_9 -> layer_2_expert_9_up_proj
	layer_2_expert_9_up_proj -> layer_2_expert_9_activation
	layer_2_expert_9_activation -> layer_2_expert_9_down_proj
	layer_2_expert_9_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_10
	layer_2_expert_10 -> layer_2_expert_10_gate_proj
	layer_2_expert_10_gate_proj -> layer_2_expert_10_activation
	layer_2_expert_10 -> layer_2_expert_10_up_proj
	layer_2_expert_10_up_proj -> layer_2_expert_10_activation
	layer_2_expert_10_activation -> layer_2_expert_10_down_proj
	layer_2_expert_10_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_11
	layer_2_expert_11 -> layer_2_expert_11_gate_proj
	layer_2_expert_11_gate_proj -> layer_2_expert_11_activation
	layer_2_expert_11 -> layer_2_expert_11_up_proj
	layer_2_expert_11_up_proj -> layer_2_expert_11_activation
	layer_2_expert_11_activation -> layer_2_expert_11_down_proj
	layer_2_expert_11_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_12
	layer_2_expert_12 -> layer_2_expert_12_gate_proj
	layer_2_expert_12_gate_proj -> layer_2_expert_12_activation
	layer_2_expert_12 -> layer_2_expert_12_up_proj
	layer_2_expert_12_up_proj -> layer_2_expert_12_activation
	layer_2_expert_12_activation -> layer_2_expert_12_down_proj
	layer_2_expert_12_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_13
	layer_2_expert_13 -> layer_2_expert_13_gate_proj
	layer_2_expert_13_gate_proj -> layer_2_expert_13_activation
	layer_2_expert_13 -> layer_2_expert_13_up_proj
	layer_2_expert_13_up_proj -> layer_2_expert_13_activation
	layer_2_expert_13_activation -> layer_2_expert_13_down_proj
	layer_2_expert_13_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_14
	layer_2_expert_14 -> layer_2_expert_14_gate_proj
	layer_2_expert_14_gate_proj -> layer_2_expert_14_activation
	layer_2_expert_14 -> layer_2_expert_14_up_proj
	layer_2_expert_14_up_proj -> layer_2_expert_14_activation
	layer_2_expert_14_activation -> layer_2_expert_14_down_proj
	layer_2_expert_14_down_proj -> layer_2_expert_agg
	layer_2_token_split -> layer_2_expert_15
	layer_2_expert_15 -> layer_2_expert_15_gate_proj
	layer_2_expert_15_gate_proj -> layer_2_expert_15_activation
	layer_2_expert_15 -> layer_2_expert_15_up_proj
	layer_2_expert_15_up_proj -> layer_2_expert_15_activation
	layer_2_expert_15_activation -> layer_2_expert_15_down_proj
	layer_2_expert_15_down_proj -> layer_2_expert_agg
	layer_2_mha_layernorm -> layer_2_expert_residual
	layer_2_expert_agg -> layer_2_expert_residual
	layer_2_expert_residual -> layer_2_expert_layernorm
	layer_2_expert_layernorm -> layer_3_input
	layer_3_input -> layer_3_mha_qkv
	layer_3_mha_qkv -> layer_3_mha_attention
	layer_3_mha_attention -> layer_3_mha_proj
	layer_3_input -> layer_3_mha_residual
	layer_3_mha_proj -> layer_3_mha_residual
	layer_3_mha_residual -> layer_3_mha_layernorm
	layer_3_mha_layernorm -> layer_3_gate
	layer_3_mha_layernorm -> layer_3_token_split
	layer_3_gate -> layer_3_token_split [style=dashed]
	layer_3_token_split -> layer_3_expert_0
	layer_3_expert_0 -> layer_3_expert_0_gate_proj
	layer_3_expert_0_gate_proj -> layer_3_expert_0_activation
	layer_3_expert_0 -> layer_3_expert_0_up_proj
	layer_3_expert_0_up_proj -> layer_3_expert_0_activation
	layer_3_expert_0_activation -> layer_3_expert_0_down_proj
	layer_3_expert_0_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_1
	layer_3_expert_1 -> layer_3_expert_1_gate_proj
	layer_3_expert_1_gate_proj -> layer_3_expert_1_activation
	layer_3_expert_1 -> layer_3_expert_1_up_proj
	layer_3_expert_1_up_proj -> layer_3_expert_1_activation
	layer_3_expert_1_activation -> layer_3_expert_1_down_proj
	layer_3_expert_1_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_2
	layer_3_expert_2 -> layer_3_expert_2_gate_proj
	layer_3_expert_2_gate_proj -> layer_3_expert_2_activation
	layer_3_expert_2 -> layer_3_expert_2_up_proj
	layer_3_expert_2_up_proj -> layer_3_expert_2_activation
	layer_3_expert_2_activation -> layer_3_expert_2_down_proj
	layer_3_expert_2_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_3
	layer_3_expert_3 -> layer_3_expert_3_gate_proj
	layer_3_expert_3_gate_proj -> layer_3_expert_3_activation
	layer_3_expert_3 -> layer_3_expert_3_up_proj
	layer_3_expert_3_up_proj -> layer_3_expert_3_activation
	layer_3_expert_3_activation -> layer_3_expert_3_down_proj
	layer_3_expert_3_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_4
	layer_3_expert_4 -> layer_3_expert_4_gate_proj
	layer_3_expert_4_gate_proj -> layer_3_expert_4_activation
	layer_3_expert_4 -> layer_3_expert_4_up_proj
	layer_3_expert_4_up_proj -> layer_3_expert_4_activation
	layer_3_expert_4_activation -> layer_3_expert_4_down_proj
	layer_3_expert_4_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_5
	layer_3_expert_5 -> layer_3_expert_5_gate_proj
	layer_3_expert_5_gate_proj -> layer_3_expert_5_activation
	layer_3_expert_5 -> layer_3_expert_5_up_proj
	layer_3_expert_5_up_proj -> layer_3_expert_5_activation
	layer_3_expert_5_activation -> layer_3_expert_5_down_proj
	layer_3_expert_5_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_6
	layer_3_expert_6 -> layer_3_expert_6_gate_proj
	layer_3_expert_6_gate_proj -> layer_3_expert_6_activation
	layer_3_expert_6 -> layer_3_expert_6_up_proj
	layer_3_expert_6_up_proj -> layer_3_expert_6_activation
	layer_3_expert_6_activation -> layer_3_expert_6_down_proj
	layer_3_expert_6_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_7
	layer_3_expert_7 -> layer_3_expert_7_gate_proj
	layer_3_expert_7_gate_proj -> layer_3_expert_7_activation
	layer_3_expert_7 -> layer_3_expert_7_up_proj
	layer_3_expert_7_up_proj -> layer_3_expert_7_activation
	layer_3_expert_7_activation -> layer_3_expert_7_down_proj
	layer_3_expert_7_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_8
	layer_3_expert_8 -> layer_3_expert_8_gate_proj
	layer_3_expert_8_gate_proj -> layer_3_expert_8_activation
	layer_3_expert_8 -> layer_3_expert_8_up_proj
	layer_3_expert_8_up_proj -> layer_3_expert_8_activation
	layer_3_expert_8_activation -> layer_3_expert_8_down_proj
	layer_3_expert_8_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_9
	layer_3_expert_9 -> layer_3_expert_9_gate_proj
	layer_3_expert_9_gate_proj -> layer_3_expert_9_activation
	layer_3_expert_9 -> layer_3_expert_9_up_proj
	layer_3_expert_9_up_proj -> layer_3_expert_9_activation
	layer_3_expert_9_activation -> layer_3_expert_9_down_proj
	layer_3_expert_9_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_10
	layer_3_expert_10 -> layer_3_expert_10_gate_proj
	layer_3_expert_10_gate_proj -> layer_3_expert_10_activation
	layer_3_expert_10 -> layer_3_expert_10_up_proj
	layer_3_expert_10_up_proj -> layer_3_expert_10_activation
	layer_3_expert_10_activation -> layer_3_expert_10_down_proj
	layer_3_expert_10_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_11
	layer_3_expert_11 -> layer_3_expert_11_gate_proj
	layer_3_expert_11_gate_proj -> layer_3_expert_11_activation
	layer_3_expert_11 -> layer_3_expert_11_up_proj
	layer_3_expert_11_up_proj -> layer_3_expert_11_activation
	layer_3_expert_11_activation -> layer_3_expert_11_down_proj
	layer_3_expert_11_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_12
	layer_3_expert_12 -> layer_3_expert_12_gate_proj
	layer_3_expert_12_gate_proj -> layer_3_expert_12_activation
	layer_3_expert_12 -> layer_3_expert_12_up_proj
	layer_3_expert_12_up_proj -> layer_3_expert_12_activation
	layer_3_expert_12_activation -> layer_3_expert_12_down_proj
	layer_3_expert_12_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_13
	layer_3_expert_13 -> layer_3_expert_13_gate_proj
	layer_3_expert_13_gate_proj -> layer_3_expert_13_activation
	layer_3_expert_13 -> layer_3_expert_13_up_proj
	layer_3_expert_13_up_proj -> layer_3_expert_13_activation
	layer_3_expert_13_activation -> layer_3_expert_13_down_proj
	layer_3_expert_13_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_14
	layer_3_expert_14 -> layer_3_expert_14_gate_proj
	layer_3_expert_14_gate_proj -> layer_3_expert_14_activation
	layer_3_expert_14 -> layer_3_expert_14_up_proj
	layer_3_expert_14_up_proj -> layer_3_expert_14_activation
	layer_3_expert_14_activation -> layer_3_expert_14_down_proj
	layer_3_expert_14_down_proj -> layer_3_expert_agg
	layer_3_token_split -> layer_3_expert_15
	layer_3_expert_15 -> layer_3_expert_15_gate_proj
	layer_3_expert_15_gate_proj -> layer_3_expert_15_activation
	layer_3_expert_15 -> layer_3_expert_15_up_proj
	layer_3_expert_15_up_proj -> layer_3_expert_15_activation
	layer_3_expert_15_activation -> layer_3_expert_15_down_proj
	layer_3_expert_15_down_proj -> layer_3_expert_agg
	layer_3_mha_layernorm -> layer_3_expert_residual
	layer_3_expert_agg -> layer_3_expert_residual
	layer_3_expert_residual -> layer_3_expert_layernorm
	layer_3_expert_layernorm -> output
}
