<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Layer_3_Detailed Pages: 1 -->
<svg width="3658pt" height="1282pt"
 viewBox="0.00 0.00 3657.50 1281.74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1277.74)">
<title>Layer_3_Detailed</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-1277.74 3653.5,-1277.74 3653.5,4 -4,4"/>
<!-- layer_input -->
<g id="node1" class="node">
<title>layer_input</title>
<ellipse fill="#e6ffe6" stroke="black" cx="2843.5" cy="-1246.87" rx="264.42" ry="26.74"/>
<text text-anchor="middle" x="2843.5" y="-1250.67" font-family="Times,serif" font-size="14.00">Layer 3 Input</text>
<text text-anchor="middle" x="2843.5" y="-1235.67" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- ln1 -->
<g id="node2" class="node">
<title>ln1</title>
<polygon fill="#e6f3ff" stroke="black" points="2225.5,-1184 1851.5,-1184 1851.5,-1146 2225.5,-1146 2225.5,-1184"/>
<text text-anchor="middle" x="2038.5" y="-1168.8" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="2038.5" y="-1153.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- layer_input&#45;&gt;ln1 -->
<g id="edge1" class="edge">
<title>layer_input&#45;&gt;ln1</title>
<path fill="none" stroke="black" d="M2659.07,-1227.57C2530.71,-1214.84 2359.97,-1197.9 2230.07,-1185.01"/>
<polygon fill="black" stroke="black" points="2230.3,-1181.51 2220.01,-1184.01 2229.61,-1188.48 2230.3,-1181.51"/>
</g>
<!-- residual1 -->
<g id="node29" class="node">
<title>residual1</title>
<polygon fill="#fff0e6" stroke="black" points="3140.5,-544 2766.5,-544 2766.5,-506 3140.5,-506 3140.5,-544"/>
<text text-anchor="middle" x="2953.5" y="-528.8" font-family="Times,serif" font-size="14.00">Residual Add 1</text>
<text text-anchor="middle" x="2953.5" y="-513.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- layer_input&#45;&gt;residual1 -->
<g id="edge43" class="edge">
<title>layer_input&#45;&gt;residual1</title>
<path fill="none" stroke="black" d="M3100.74,-1240.58C3336.62,-1228.51 3649.5,-1191.02 3649.5,-1077 3649.5,-1077 3649.5,-1077 3649.5,-747.5 3649.5,-636.85 3326.05,-574.13 3120.15,-545.41"/>
<polygon fill="black" stroke="black" points="3120.51,-541.92 3110.13,-544.02 3119.56,-548.86 3120.51,-541.92"/>
</g>
<!-- qkv_gpu_0 -->
<g id="node3" class="node">
<title>qkv_gpu_0</title>
<polygon fill="#e6f3ff" stroke="black" points="437,-1110 0,-1110 0,-1042 437,-1042 437,-1110"/>
<text text-anchor="middle" x="218.5" y="-1094.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="218.5" y="-1079.8" font-family="Times,serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="218.5" y="-1064.8" font-family="Times,serif" font-size="14.00">Heads: 0&#45;3</text>
<text text-anchor="middle" x="218.5" y="-1049.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- ln1&#45;&gt;qkv_gpu_0 -->
<g id="edge2" class="edge">
<title>ln1&#45;&gt;qkv_gpu_0</title>
<path fill="none" stroke="black" d="M1851.22,-1164.3C1555.18,-1163.28 960.9,-1155.21 447.39,-1110.04"/>
<polygon fill="black" stroke="black" points="447.45,-1106.53 437.18,-1109.14 446.83,-1113.5 447.45,-1106.53"/>
</g>
<!-- qkv_gpu_1 -->
<g id="node4" class="node">
<title>qkv_gpu_1</title>
<polygon fill="#e6f3ff" stroke="black" points="892,-1110 455,-1110 455,-1042 892,-1042 892,-1110"/>
<text text-anchor="middle" x="673.5" y="-1094.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="673.5" y="-1079.8" font-family="Times,serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="673.5" y="-1064.8" font-family="Times,serif" font-size="14.00">Heads: 4&#45;7</text>
<text text-anchor="middle" x="673.5" y="-1049.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- ln1&#45;&gt;qkv_gpu_1 -->
<g id="edge3" class="edge">
<title>ln1&#45;&gt;qkv_gpu_1</title>
<path fill="none" stroke="black" d="M1851.49,-1160.63C1628.06,-1155.35 1242.79,-1142.26 902.24,-1110.04"/>
<polygon fill="black" stroke="black" points="902.47,-1106.54 892.18,-1109.08 901.8,-1113.51 902.47,-1106.54"/>
</g>
<!-- qkv_gpu_2 -->
<g id="node5" class="node">
<title>qkv_gpu_2</title>
<polygon fill="#e6f3ff" stroke="black" points="1347,-1110 910,-1110 910,-1042 1347,-1042 1347,-1110"/>
<text text-anchor="middle" x="1128.5" y="-1094.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1128.5" y="-1079.8" font-family="Times,serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="1128.5" y="-1064.8" font-family="Times,serif" font-size="14.00">Heads: 8&#45;11</text>
<text text-anchor="middle" x="1128.5" y="-1049.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- ln1&#45;&gt;qkv_gpu_2 -->
<g id="edge4" class="edge">
<title>ln1&#45;&gt;qkv_gpu_2</title>
<path fill="none" stroke="black" d="M1851.48,-1152.47C1716.88,-1143.38 1530.77,-1129.23 1357.28,-1110.06"/>
<polygon fill="black" stroke="black" points="1357.52,-1106.57 1347.2,-1108.94 1356.75,-1113.52 1357.52,-1106.57"/>
</g>
<!-- qkv_gpu_3 -->
<g id="node6" class="node">
<title>qkv_gpu_3</title>
<polygon fill="#e6f3ff" stroke="black" points="1802,-1110 1365,-1110 1365,-1042 1802,-1042 1802,-1110"/>
<text text-anchor="middle" x="1583.5" y="-1094.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="1583.5" y="-1079.8" font-family="Times,serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="1583.5" y="-1064.8" font-family="Times,serif" font-size="14.00">Heads: 12&#45;15</text>
<text text-anchor="middle" x="1583.5" y="-1049.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- ln1&#45;&gt;qkv_gpu_3 -->
<g id="edge5" class="edge">
<title>ln1&#45;&gt;qkv_gpu_3</title>
<path fill="none" stroke="black" d="M1944.22,-1145.97C1892.81,-1136.14 1827.39,-1123.63 1766.41,-1111.97"/>
<polygon fill="black" stroke="black" points="1766.75,-1108.48 1756.27,-1110.04 1765.44,-1115.35 1766.75,-1108.48"/>
</g>
<!-- qkv_gpu_4 -->
<g id="node7" class="node">
<title>qkv_gpu_4</title>
<polygon fill="#e6f3ff" stroke="black" points="2257,-1110 1820,-1110 1820,-1042 2257,-1042 2257,-1110"/>
<text text-anchor="middle" x="2038.5" y="-1094.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="2038.5" y="-1079.8" font-family="Times,serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="2038.5" y="-1064.8" font-family="Times,serif" font-size="14.00">Heads: 16&#45;19</text>
<text text-anchor="middle" x="2038.5" y="-1049.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- ln1&#45;&gt;qkv_gpu_4 -->
<g id="edge6" class="edge">
<title>ln1&#45;&gt;qkv_gpu_4</title>
<path fill="none" stroke="black" d="M2038.5,-1145.97C2038.5,-1138.45 2038.5,-1129.36 2038.5,-1120.28"/>
<polygon fill="black" stroke="black" points="2042,-1120.12 2038.5,-1110.12 2035,-1120.12 2042,-1120.12"/>
</g>
<!-- qkv_gpu_5 -->
<g id="node8" class="node">
<title>qkv_gpu_5</title>
<polygon fill="#e6f3ff" stroke="black" points="2712,-1110 2275,-1110 2275,-1042 2712,-1042 2712,-1110"/>
<text text-anchor="middle" x="2493.5" y="-1094.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="2493.5" y="-1079.8" font-family="Times,serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="2493.5" y="-1064.8" font-family="Times,serif" font-size="14.00">Heads: 20&#45;23</text>
<text text-anchor="middle" x="2493.5" y="-1049.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- ln1&#45;&gt;qkv_gpu_5 -->
<g id="edge7" class="edge">
<title>ln1&#45;&gt;qkv_gpu_5</title>
<path fill="none" stroke="black" d="M2132.78,-1145.97C2184.19,-1136.14 2249.61,-1123.63 2310.59,-1111.97"/>
<polygon fill="black" stroke="black" points="2311.56,-1115.35 2320.73,-1110.04 2310.25,-1108.48 2311.56,-1115.35"/>
</g>
<!-- qkv_gpu_6 -->
<g id="node9" class="node">
<title>qkv_gpu_6</title>
<polygon fill="#e6f3ff" stroke="black" points="3167,-1110 2730,-1110 2730,-1042 3167,-1042 3167,-1110"/>
<text text-anchor="middle" x="2948.5" y="-1094.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="2948.5" y="-1079.8" font-family="Times,serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="2948.5" y="-1064.8" font-family="Times,serif" font-size="14.00">Heads: 24&#45;27</text>
<text text-anchor="middle" x="2948.5" y="-1049.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- ln1&#45;&gt;qkv_gpu_6 -->
<g id="edge8" class="edge">
<title>ln1&#45;&gt;qkv_gpu_6</title>
<path fill="none" stroke="black" d="M2225.79,-1152.51C2360.6,-1143.45 2546.98,-1129.3 2719.81,-1110.17"/>
<polygon fill="black" stroke="black" points="2720.31,-1113.63 2729.86,-1109.05 2719.54,-1106.68 2720.31,-1113.63"/>
</g>
<!-- qkv_gpu_7 -->
<g id="node10" class="node">
<title>qkv_gpu_7</title>
<polygon fill="#e6f3ff" stroke="black" points="3622,-1110 3185,-1110 3185,-1042 3622,-1042 3622,-1110"/>
<text text-anchor="middle" x="3403.5" y="-1094.8" font-family="Times,serif" font-size="14.00">QKV Projection</text>
<text text-anchor="middle" x="3403.5" y="-1079.8" font-family="Times,serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="3403.5" y="-1064.8" font-family="Times,serif" font-size="14.00">Heads: 28&#45;31</text>
<text text-anchor="middle" x="3403.5" y="-1049.8" font-family="Times,serif" font-size="14.00">Output: [batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- ln1&#45;&gt;qkv_gpu_7 -->
<g id="edge9" class="edge">
<title>ln1&#45;&gt;qkv_gpu_7</title>
<path fill="none" stroke="black" d="M2225.67,-1160.68C2449.31,-1155.44 2834.92,-1142.38 3174.83,-1110.13"/>
<polygon fill="black" stroke="black" points="3175.25,-1113.61 3184.88,-1109.17 3174.59,-1106.64 3175.25,-1113.61"/>
</g>
<!-- attn_0 -->
<g id="node11" class="node">
<title>attn_0</title>
<polygon fill="#e6f3ff" stroke="black" points="466.5,-1006 88.5,-1006 88.5,-953 466.5,-953 466.5,-1006"/>
<text text-anchor="middle" x="277.5" y="-990.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="277.5" y="-975.8" font-family="Times,serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="277.5" y="-960.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- qkv_gpu_0&#45;&gt;attn_0 -->
<g id="edge10" class="edge">
<title>qkv_gpu_0&#45;&gt;attn_0</title>
<path fill="none" stroke="black" d="M239.14,-1041.95C244.62,-1033.17 250.55,-1023.66 256.08,-1014.82"/>
<polygon fill="black" stroke="black" points="259.1,-1016.57 261.43,-1006.24 253.17,-1012.87 259.1,-1016.57"/>
</g>
<!-- attn_1 -->
<g id="node12" class="node">
<title>attn_1</title>
<polygon fill="#e6f3ff" stroke="black" points="891.5,-1006 513.5,-1006 513.5,-953 891.5,-953 891.5,-1006"/>
<text text-anchor="middle" x="702.5" y="-990.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="702.5" y="-975.8" font-family="Times,serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="702.5" y="-960.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- qkv_gpu_1&#45;&gt;attn_1 -->
<g id="edge11" class="edge">
<title>qkv_gpu_1&#45;&gt;attn_1</title>
<path fill="none" stroke="black" d="M683.64,-1041.95C686.23,-1033.53 689.01,-1024.45 691.63,-1015.92"/>
<polygon fill="black" stroke="black" points="695.01,-1016.82 694.6,-1006.24 688.32,-1014.77 695.01,-1016.82"/>
</g>
<!-- attn_2 -->
<g id="node13" class="node">
<title>attn_2</title>
<polygon fill="#e6f3ff" stroke="black" points="1346.5,-1006 968.5,-1006 968.5,-953 1346.5,-953 1346.5,-1006"/>
<text text-anchor="middle" x="1157.5" y="-990.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1157.5" y="-975.8" font-family="Times,serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="1157.5" y="-960.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- qkv_gpu_2&#45;&gt;attn_2 -->
<g id="edge12" class="edge">
<title>qkv_gpu_2&#45;&gt;attn_2</title>
<path fill="none" stroke="black" d="M1138.64,-1041.95C1141.23,-1033.53 1144.01,-1024.45 1146.63,-1015.92"/>
<polygon fill="black" stroke="black" points="1150.01,-1016.82 1149.6,-1006.24 1143.32,-1014.77 1150.01,-1016.82"/>
</g>
<!-- attn_3 -->
<g id="node14" class="node">
<title>attn_3</title>
<polygon fill="#e6f3ff" stroke="black" points="1787.5,-1006 1409.5,-1006 1409.5,-953 1787.5,-953 1787.5,-1006"/>
<text text-anchor="middle" x="1598.5" y="-990.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="1598.5" y="-975.8" font-family="Times,serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="1598.5" y="-960.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- qkv_gpu_3&#45;&gt;attn_3 -->
<g id="edge13" class="edge">
<title>qkv_gpu_3&#45;&gt;attn_3</title>
<path fill="none" stroke="black" d="M1588.75,-1041.95C1590.07,-1033.62 1591.49,-1024.65 1592.83,-1016.2"/>
<polygon fill="black" stroke="black" points="1596.3,-1016.66 1594.41,-1006.24 1589.39,-1015.56 1596.3,-1016.66"/>
</g>
<!-- attn_4 -->
<g id="node15" class="node">
<title>attn_4</title>
<polygon fill="#e6f3ff" stroke="black" points="2198.5,-1006 1820.5,-1006 1820.5,-953 2198.5,-953 2198.5,-1006"/>
<text text-anchor="middle" x="2009.5" y="-990.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2009.5" y="-975.8" font-family="Times,serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="2009.5" y="-960.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- qkv_gpu_4&#45;&gt;attn_4 -->
<g id="edge14" class="edge">
<title>qkv_gpu_4&#45;&gt;attn_4</title>
<path fill="none" stroke="black" d="M2028.36,-1041.95C2025.77,-1033.53 2022.99,-1024.45 2020.37,-1015.92"/>
<polygon fill="black" stroke="black" points="2023.68,-1014.77 2017.4,-1006.24 2016.99,-1016.82 2023.68,-1014.77"/>
</g>
<!-- attn_5 -->
<g id="node16" class="node">
<title>attn_5</title>
<polygon fill="#e6f3ff" stroke="black" points="2638.5,-1006 2260.5,-1006 2260.5,-953 2638.5,-953 2638.5,-1006"/>
<text text-anchor="middle" x="2449.5" y="-990.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2449.5" y="-975.8" font-family="Times,serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="2449.5" y="-960.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- qkv_gpu_5&#45;&gt;attn_5 -->
<g id="edge15" class="edge">
<title>qkv_gpu_5&#45;&gt;attn_5</title>
<path fill="none" stroke="black" d="M2478.11,-1041.95C2474.11,-1033.35 2469.78,-1024.06 2465.74,-1015.37"/>
<polygon fill="black" stroke="black" points="2468.88,-1013.82 2461.48,-1006.24 2462.53,-1016.78 2468.88,-1013.82"/>
</g>
<!-- attn_6 -->
<g id="node17" class="node">
<title>attn_6</title>
<polygon fill="#e6f3ff" stroke="black" points="3086.5,-1006 2708.5,-1006 2708.5,-953 3086.5,-953 3086.5,-1006"/>
<text text-anchor="middle" x="2897.5" y="-990.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="2897.5" y="-975.8" font-family="Times,serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="2897.5" y="-960.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- qkv_gpu_6&#45;&gt;attn_6 -->
<g id="edge16" class="edge">
<title>qkv_gpu_6&#45;&gt;attn_6</title>
<path fill="none" stroke="black" d="M2930.66,-1041.95C2925.97,-1033.26 2920.9,-1023.86 2916.17,-1015.09"/>
<polygon fill="black" stroke="black" points="2919.22,-1013.37 2911.39,-1006.24 2913.06,-1016.7 2919.22,-1013.37"/>
</g>
<!-- attn_7 -->
<g id="node18" class="node">
<title>attn_7</title>
<polygon fill="#e6f3ff" stroke="black" points="3537.5,-1006 3159.5,-1006 3159.5,-953 3537.5,-953 3537.5,-1006"/>
<text text-anchor="middle" x="3348.5" y="-990.8" font-family="Times,serif" font-size="14.00">Multi&#45;Head Attention</text>
<text text-anchor="middle" x="3348.5" y="-975.8" font-family="Times,serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="3348.5" y="-960.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, heads=4, d_k=128]</text>
</g>
<!-- qkv_gpu_7&#45;&gt;attn_7 -->
<g id="edge17" class="edge">
<title>qkv_gpu_7&#45;&gt;attn_7</title>
<path fill="none" stroke="black" d="M3384.26,-1041.95C3379.21,-1033.26 3373.74,-1023.86 3368.63,-1015.09"/>
<polygon fill="black" stroke="black" points="3371.53,-1013.12 3363.48,-1006.24 3365.48,-1016.64 3371.53,-1013.12"/>
</g>
<!-- attn_allreduce -->
<g id="node19" class="node">
<title>attn_allreduce</title>
<polygon fill="#e6ffe6" stroke="black" points="2325.49,-917 1708.28,-917 1549.51,-811 2166.72,-811 2325.49,-917"/>
<text text-anchor="middle" x="1937.5" y="-875.3" font-family="Times,serif" font-size="14.00">All&#45;Reduce Attention</text>
<text text-anchor="middle" x="1937.5" y="-860.3" font-family="Times,serif" font-size="14.00">Combine 8×4 heads</text>
<text text-anchor="middle" x="1937.5" y="-845.3" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- attn_0&#45;&gt;attn_allreduce -->
<g id="edge18" class="edge">
<title>attn_0&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M466.63,-956.53C479.44,-955.26 492.15,-954.07 504.5,-953 896.54,-918.96 1350.05,-893.44 1640.1,-878.87"/>
<polygon fill="black" stroke="black" points="1640.54,-882.36 1650.35,-878.36 1640.18,-875.36 1640.54,-882.36"/>
</g>
<!-- attn_1&#45;&gt;attn_allreduce -->
<g id="edge19" class="edge">
<title>attn_1&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M891.61,-959.54C914.48,-957.3 937.52,-955.08 959.5,-953 1193.99,-930.82 1460.23,-906.95 1655.65,-889.67"/>
<polygon fill="black" stroke="black" points="1656.13,-893.14 1665.78,-888.78 1655.51,-886.17 1656.13,-893.14"/>
</g>
<!-- attn_2&#45;&gt;attn_allreduce -->
<g id="edge20" class="edge">
<title>attn_2&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M1333.03,-952.96C1433.88,-938.28 1562.49,-919.57 1675.13,-903.18"/>
<polygon fill="black" stroke="black" points="1675.89,-906.6 1685.28,-901.7 1674.88,-899.68 1675.89,-906.6"/>
</g>
<!-- attn_3&#45;&gt;attn_allreduce -->
<g id="edge21" class="edge">
<title>attn_3&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M1675,-952.89C1704.01,-943.18 1738.28,-931.7 1772.31,-920.31"/>
<polygon fill="black" stroke="black" points="1773.53,-923.59 1781.9,-917.1 1771.31,-916.95 1773.53,-923.59"/>
</g>
<!-- attn_4&#45;&gt;attn_allreduce -->
<g id="edge22" class="edge">
<title>attn_4&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M1993.16,-952.75C1988.02,-944.63 1982.1,-935.3 1976.08,-925.82"/>
<polygon fill="black" stroke="black" points="1978.86,-923.67 1970.55,-917.1 1972.95,-927.42 1978.86,-923.67"/>
</g>
<!-- attn_5&#45;&gt;attn_allreduce -->
<g id="edge23" class="edge">
<title>attn_5&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M2334.28,-952.96C2289.03,-942.93 2235.26,-931.01 2182.15,-919.23"/>
<polygon fill="black" stroke="black" points="2182.76,-915.78 2172.24,-917.04 2181.25,-922.62 2182.76,-915.78"/>
</g>
<!-- attn_6&#45;&gt;attn_allreduce -->
<g id="edge24" class="edge">
<title>attn_6&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M2708.41,-956.14C2598.87,-943.19 2456.89,-926.41 2324.67,-910.77"/>
<polygon fill="black" stroke="black" points="2324.7,-907.25 2314.36,-909.56 2323.88,-914.21 2324.7,-907.25"/>
</g>
<!-- attn_7&#45;&gt;attn_allreduce -->
<g id="edge25" class="edge">
<title>attn_7&#45;&gt;attn_allreduce</title>
<path fill="none" stroke="black" d="M3159.28,-958.92C3137.77,-956.84 3116.17,-954.83 3095.5,-953 2826.98,-929.27 2523.08,-906.32 2294,-889.81"/>
<polygon fill="black" stroke="black" points="2294.06,-886.31 2283.83,-889.08 2293.55,-893.29 2294.06,-886.31"/>
</g>
<!-- attn_proj_0 -->
<g id="node20" class="node">
<title>attn_proj_0</title>
<polygon fill="#e6f3ff" stroke="black" points="877.5,-775 503.5,-775 503.5,-722 877.5,-722 877.5,-775"/>
<text text-anchor="middle" x="690.5" y="-759.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="690.5" y="-744.8" font-family="Times,serif" font-size="14.00">GPU: 0</text>
<text text-anchor="middle" x="690.5" y="-729.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- attn_allreduce&#45;&gt;attn_proj_0 -->
<g id="edge26" class="edge">
<title>attn_allreduce&#45;&gt;attn_proj_0</title>
<path fill="none" stroke="black" d="M1589.78,-837.91C1387.66,-822.33 1127.9,-800.63 887.71,-775.11"/>
<polygon fill="black" stroke="black" points="888.05,-771.63 877.73,-774.05 887.31,-778.59 888.05,-771.63"/>
</g>
<!-- attn_proj_1 -->
<g id="node21" class="node">
<title>attn_proj_1</title>
<polygon fill="#e6f3ff" stroke="black" points="1269.5,-775 895.5,-775 895.5,-722 1269.5,-722 1269.5,-775"/>
<text text-anchor="middle" x="1082.5" y="-759.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1082.5" y="-744.8" font-family="Times,serif" font-size="14.00">GPU: 1</text>
<text text-anchor="middle" x="1082.5" y="-729.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- attn_allreduce&#45;&gt;attn_proj_1 -->
<g id="edge27" class="edge">
<title>attn_allreduce&#45;&gt;attn_proj_1</title>
<path fill="none" stroke="black" d="M1550.34,-811.6C1456.76,-799.18 1360.59,-786.42 1279.96,-775.71"/>
<polygon fill="black" stroke="black" points="1280.08,-772.2 1269.71,-774.35 1279.16,-779.14 1280.08,-772.2"/>
</g>
<!-- attn_proj_2 -->
<g id="node22" class="node">
<title>attn_proj_2</title>
<polygon fill="#e6f3ff" stroke="black" points="1661.5,-775 1287.5,-775 1287.5,-722 1661.5,-722 1661.5,-775"/>
<text text-anchor="middle" x="1474.5" y="-759.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1474.5" y="-744.8" font-family="Times,serif" font-size="14.00">GPU: 2</text>
<text text-anchor="middle" x="1474.5" y="-729.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- attn_allreduce&#45;&gt;attn_proj_2 -->
<g id="edge28" class="edge">
<title>attn_allreduce&#45;&gt;attn_proj_2</title>
<path fill="none" stroke="black" d="M1725.31,-810.98C1678.17,-799.43 1629.96,-787.61 1588.57,-777.46"/>
<polygon fill="black" stroke="black" points="1589.29,-774.04 1578.75,-775.05 1587.62,-780.84 1589.29,-774.04"/>
</g>
<!-- attn_proj_3 -->
<g id="node23" class="node">
<title>attn_proj_3</title>
<polygon fill="#e6f3ff" stroke="black" points="2053.5,-775 1679.5,-775 1679.5,-722 2053.5,-722 2053.5,-775"/>
<text text-anchor="middle" x="1866.5" y="-759.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="1866.5" y="-744.8" font-family="Times,serif" font-size="14.00">GPU: 3</text>
<text text-anchor="middle" x="1866.5" y="-729.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- attn_allreduce&#45;&gt;attn_proj_3 -->
<g id="edge29" class="edge">
<title>attn_allreduce&#45;&gt;attn_proj_3</title>
<path fill="none" stroke="black" d="M1904.91,-810.9C1899.12,-801.64 1893.23,-792.22 1887.85,-783.63"/>
<polygon fill="black" stroke="black" points="1890.73,-781.64 1882.46,-775.01 1884.8,-785.35 1890.73,-781.64"/>
</g>
<!-- attn_proj_4 -->
<g id="node24" class="node">
<title>attn_proj_4</title>
<polygon fill="#e6f3ff" stroke="black" points="2445.5,-775 2071.5,-775 2071.5,-722 2445.5,-722 2445.5,-775"/>
<text text-anchor="middle" x="2258.5" y="-759.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="2258.5" y="-744.8" font-family="Times,serif" font-size="14.00">GPU: 4</text>
<text text-anchor="middle" x="2258.5" y="-729.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- attn_allreduce&#45;&gt;attn_proj_4 -->
<g id="edge30" class="edge">
<title>attn_allreduce&#45;&gt;attn_proj_4</title>
<path fill="none" stroke="black" d="M2084.85,-810.9C2116.4,-799.74 2148.63,-788.35 2176.63,-778.45"/>
<polygon fill="black" stroke="black" points="2178.08,-781.65 2186.34,-775.01 2175.75,-775.05 2178.08,-781.65"/>
</g>
<!-- attn_proj_5 -->
<g id="node25" class="node">
<title>attn_proj_5</title>
<polygon fill="#e6f3ff" stroke="black" points="2837.5,-775 2463.5,-775 2463.5,-722 2837.5,-722 2837.5,-775"/>
<text text-anchor="middle" x="2650.5" y="-759.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="2650.5" y="-744.8" font-family="Times,serif" font-size="14.00">GPU: 5</text>
<text text-anchor="middle" x="2650.5" y="-729.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- attn_allreduce&#45;&gt;attn_proj_5 -->
<g id="edge31" class="edge">
<title>attn_allreduce&#45;&gt;attn_proj_5</title>
<path fill="none" stroke="black" d="M2185.62,-823.5C2282.87,-808.02 2392.01,-790.65 2480.09,-776.63"/>
<polygon fill="black" stroke="black" points="2480.85,-780.05 2490.18,-775.02 2479.75,-773.14 2480.85,-780.05"/>
</g>
<!-- attn_proj_6 -->
<g id="node26" class="node">
<title>attn_proj_6</title>
<polygon fill="#e6f3ff" stroke="black" points="3229.5,-775 2855.5,-775 2855.5,-722 3229.5,-722 3229.5,-775"/>
<text text-anchor="middle" x="3042.5" y="-759.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="3042.5" y="-744.8" font-family="Times,serif" font-size="14.00">GPU: 6</text>
<text text-anchor="middle" x="3042.5" y="-729.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- attn_allreduce&#45;&gt;attn_proj_6 -->
<g id="edge32" class="edge">
<title>attn_allreduce&#45;&gt;attn_proj_6</title>
<path fill="none" stroke="black" d="M2209.21,-839.05C2387.25,-822.78 2625.31,-799.96 2845.14,-775.14"/>
<polygon fill="black" stroke="black" points="2845.72,-778.6 2855.26,-774 2844.93,-771.64 2845.72,-778.6"/>
</g>
<!-- attn_proj_7 -->
<g id="node27" class="node">
<title>attn_proj_7</title>
<polygon fill="#e6f3ff" stroke="black" points="3621.5,-775 3247.5,-775 3247.5,-722 3621.5,-722 3621.5,-775"/>
<text text-anchor="middle" x="3434.5" y="-759.8" font-family="Times,serif" font-size="14.00">Output Projection</text>
<text text-anchor="middle" x="3434.5" y="-744.8" font-family="Times,serif" font-size="14.00">GPU: 7</text>
<text text-anchor="middle" x="3434.5" y="-729.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- attn_allreduce&#45;&gt;attn_proj_7 -->
<g id="edge33" class="edge">
<title>attn_allreduce&#45;&gt;attn_proj_7</title>
<path fill="none" stroke="black" d="M2223.45,-848.75C2484.88,-834.53 2882.41,-809.9 3237.31,-775.09"/>
<polygon fill="black" stroke="black" points="3237.66,-778.58 3247.27,-774.11 3236.98,-771.61 3237.66,-778.58"/>
</g>
<!-- broadcast_to_moe -->
<g id="node28" class="node">
<title>broadcast_to_moe</title>
<polygon fill="#e6ffe6" stroke="black" points="2646.49,-686 2029.28,-686 1870.51,-580 2487.72,-580 2646.49,-686"/>
<text text-anchor="middle" x="2258.5" y="-644.3" font-family="Times,serif" font-size="14.00">Broadcast to MoE GPUs</text>
<text text-anchor="middle" x="2258.5" y="-629.3" font-family="Times,serif" font-size="14.00">From GPUs 0&#45;7 to GPUs 8&#45;15</text>
<text text-anchor="middle" x="2258.5" y="-614.3" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- attn_proj_0&#45;&gt;broadcast_to_moe -->
<g id="edge34" class="edge">
<title>attn_proj_0&#45;&gt;broadcast_to_moe</title>
<path fill="none" stroke="black" d="M877.73,-722.87C880.67,-722.57 883.6,-722.28 886.5,-722 1255.66,-686.19 1682.17,-661.43 1960.4,-647.5"/>
<polygon fill="black" stroke="black" points="1960.83,-650.98 1970.64,-646.99 1960.48,-643.99 1960.83,-650.98"/>
</g>
<!-- attn_proj_1&#45;&gt;broadcast_to_moe -->
<g id="edge35" class="edge">
<title>attn_proj_1&#45;&gt;broadcast_to_moe</title>
<path fill="none" stroke="black" d="M1269.74,-722.98C1272.68,-722.64 1275.6,-722.32 1278.5,-722 1512.26,-696.31 1778.02,-672.8 1973.75,-656.56"/>
<polygon fill="black" stroke="black" points="1974.22,-660.03 1983.9,-655.72 1973.64,-653.05 1974.22,-660.03"/>
</g>
<!-- attn_proj_2&#45;&gt;broadcast_to_moe -->
<g id="edge36" class="edge">
<title>attn_proj_2&#45;&gt;broadcast_to_moe</title>
<path fill="none" stroke="black" d="M1650.93,-721.96C1752.62,-707.24 1882.4,-688.45 1995.88,-672.02"/>
<polygon fill="black" stroke="black" points="1996.72,-675.43 2006.11,-670.54 1995.72,-668.51 1996.72,-675.43"/>
</g>
<!-- attn_proj_3&#45;&gt;broadcast_to_moe -->
<g id="edge37" class="edge">
<title>attn_proj_3&#45;&gt;broadcast_to_moe</title>
<path fill="none" stroke="black" d="M1954.96,-721.89C1988.86,-712.07 2028.98,-700.46 2068.75,-688.94"/>
<polygon fill="black" stroke="black" points="2069.94,-692.24 2078.58,-686.1 2068,-685.51 2069.94,-692.24"/>
</g>
<!-- attn_proj_4&#45;&gt;broadcast_to_moe -->
<g id="edge38" class="edge">
<title>attn_proj_4&#45;&gt;broadcast_to_moe</title>
<path fill="none" stroke="black" d="M2258.5,-721.75C2258.5,-714.05 2258.5,-705.25 2258.5,-696.27"/>
<polygon fill="black" stroke="black" points="2262,-696.1 2258.5,-686.1 2255,-696.1 2262,-696.1"/>
</g>
<!-- attn_proj_5&#45;&gt;broadcast_to_moe -->
<g id="edge39" class="edge">
<title>attn_proj_5&#45;&gt;broadcast_to_moe</title>
<path fill="none" stroke="black" d="M2562.04,-721.89C2528.14,-712.07 2488.02,-700.46 2448.25,-688.94"/>
<polygon fill="black" stroke="black" points="2449,-685.51 2438.42,-686.1 2447.06,-692.24 2449,-685.51"/>
</g>
<!-- attn_proj_6&#45;&gt;broadcast_to_moe -->
<g id="edge40" class="edge">
<title>attn_proj_6&#45;&gt;broadcast_to_moe</title>
<path fill="none" stroke="black" d="M2866.07,-721.96C2795.34,-711.72 2711.03,-699.51 2628.06,-687.5"/>
<polygon fill="black" stroke="black" points="2628.34,-684.01 2617.95,-686.04 2627.34,-690.93 2628.34,-684.01"/>
</g>
<!-- attn_proj_7&#45;&gt;broadcast_to_moe -->
<g id="edge41" class="edge">
<title>attn_proj_7&#45;&gt;broadcast_to_moe</title>
<path fill="none" stroke="black" d="M3247.26,-722.98C3244.32,-722.64 3241.4,-722.32 3238.5,-722 3034.46,-699.58 2806.05,-678.81 2621.1,-663.09"/>
<polygon fill="black" stroke="black" points="2621.2,-659.59 2610.94,-662.23 2620.6,-666.56 2621.2,-659.59"/>
</g>
<!-- broadcast_to_moe&#45;&gt;residual1 -->
<g id="edge42" class="edge">
<title>broadcast_to_moe&#45;&gt;residual1</title>
<path fill="none" stroke="black" d="M2508.92,-593.81C2616.04,-577.47 2736.55,-559.09 2825.05,-545.59"/>
<polygon fill="black" stroke="black" points="2825.78,-549.02 2835.13,-544.05 2824.72,-542.1 2825.78,-549.02"/>
</g>
<!-- ln2 -->
<g id="node30" class="node">
<title>ln2</title>
<polygon fill="#ffe6e6" stroke="black" points="3033.5,-470 2659.5,-470 2659.5,-432 3033.5,-432 3033.5,-470"/>
<text text-anchor="middle" x="2846.5" y="-454.8" font-family="Times,serif" font-size="14.00">LayerNorm</text>
<text text-anchor="middle" x="2846.5" y="-439.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- residual1&#45;&gt;ln2 -->
<g id="edge44" class="edge">
<title>residual1&#45;&gt;ln2</title>
<path fill="none" stroke="black" d="M2926.5,-505.83C2913.07,-496.79 2896.65,-485.75 2882.2,-476.02"/>
<polygon fill="black" stroke="black" points="2883.74,-472.84 2873.49,-470.16 2879.83,-478.65 2883.74,-472.84"/>
</g>
<!-- residual2 -->
<g id="node41" class="node">
<title>residual2</title>
<polygon fill="#fff0e6" stroke="black" points="3140.5,-38 2766.5,-38 2766.5,0 3140.5,0 3140.5,-38"/>
<text text-anchor="middle" x="2953.5" y="-22.8" font-family="Times,serif" font-size="14.00">Residual Add 2</text>
<text text-anchor="middle" x="2953.5" y="-7.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- residual1&#45;&gt;residual2 -->
<g id="edge63" class="edge">
<title>residual1&#45;&gt;residual2</title>
<path fill="none" stroke="black" d="M3140.93,-516.08C3347.08,-502.12 3649.5,-463.78 3649.5,-359 3649.5,-359 3649.5,-359 3649.5,-249 3649.5,-136.05 3314.55,-69.6 3109.38,-39.5"/>
<polygon fill="black" stroke="black" points="3109.8,-36.02 3099.4,-38.05 3108.8,-42.95 3109.8,-36.02"/>
</g>
<!-- gate -->
<g id="node31" class="node">
<title>gate</title>
<polygon fill="#ffe6e6" stroke="black" points="2571.7,-396 2073.47,-396 1945.3,-320 2443.53,-320 2571.7,-396"/>
<text text-anchor="middle" x="2258.5" y="-361.8" font-family="Times,serif" font-size="14.00">Gate (Top&#45;2)</text>
<text text-anchor="middle" x="2258.5" y="-346.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, top_k=2]</text>
</g>
<!-- ln2&#45;&gt;gate -->
<g id="edge45" class="edge">
<title>ln2&#45;&gt;gate</title>
<path fill="none" stroke="black" d="M2729.98,-431.97C2666.25,-422.1 2584.73,-409.49 2507.47,-397.53"/>
<polygon fill="black" stroke="black" points="2508,-394.07 2497.58,-396 2506.93,-400.99 2508,-394.07"/>
</g>
<!-- expert_group_8 -->
<g id="node32" class="node">
<title>expert_group_8</title>
<polygon fill="#ffe6e6" stroke="black" points="877.5,-284 503.5,-284 503.5,-216 877.5,-216 877.5,-284"/>
<text text-anchor="middle" x="690.5" y="-268.8" font-family="Times,serif" font-size="14.00">Expert Group</text>
<text text-anchor="middle" x="690.5" y="-253.8" font-family="Times,serif" font-size="14.00">GPU: 8</text>
<text text-anchor="middle" x="690.5" y="-238.8" font-family="Times,serif" font-size="14.00">Experts: 0&#45;1</text>
<text text-anchor="middle" x="690.5" y="-223.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- gate&#45;&gt;expert_group_8 -->
<g id="edge46" class="edge">
<title>gate&#45;&gt;expert_group_8</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1999.22,-351.98C1725.18,-344.64 1280.34,-326.95 887.83,-284.1"/>
<polygon fill="black" stroke="black" points="888.01,-280.6 877.69,-282.99 887.25,-287.56 888.01,-280.6"/>
</g>
<!-- expert_group_9 -->
<g id="node33" class="node">
<title>expert_group_9</title>
<polygon fill="#ffe6e6" stroke="black" points="1269.5,-284 895.5,-284 895.5,-216 1269.5,-216 1269.5,-284"/>
<text text-anchor="middle" x="1082.5" y="-268.8" font-family="Times,serif" font-size="14.00">Expert Group</text>
<text text-anchor="middle" x="1082.5" y="-253.8" font-family="Times,serif" font-size="14.00">GPU: 9</text>
<text text-anchor="middle" x="1082.5" y="-238.8" font-family="Times,serif" font-size="14.00">Experts: 2&#45;3</text>
<text text-anchor="middle" x="1082.5" y="-223.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- gate&#45;&gt;expert_group_9 -->
<g id="edge47" class="edge">
<title>gate&#45;&gt;expert_group_9</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1984.58,-343.39C1790.38,-332.11 1523.56,-313.32 1279.82,-284.12"/>
<polygon fill="black" stroke="black" points="1280.05,-280.63 1269.7,-282.9 1279.21,-287.58 1280.05,-280.63"/>
</g>
<!-- expert_group_10 -->
<g id="node34" class="node">
<title>expert_group_10</title>
<polygon fill="#ffe6e6" stroke="black" points="1661.5,-284 1287.5,-284 1287.5,-216 1661.5,-216 1661.5,-284"/>
<text text-anchor="middle" x="1474.5" y="-268.8" font-family="Times,serif" font-size="14.00">Expert Group</text>
<text text-anchor="middle" x="1474.5" y="-253.8" font-family="Times,serif" font-size="14.00">GPU: 10</text>
<text text-anchor="middle" x="1474.5" y="-238.8" font-family="Times,serif" font-size="14.00">Experts: 4&#45;5</text>
<text text-anchor="middle" x="1474.5" y="-223.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- gate&#45;&gt;expert_group_10 -->
<g id="edge48" class="edge">
<title>gate&#45;&gt;expert_group_10</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1946.52,-320.82C1860.32,-310.15 1766.59,-297.94 1671.8,-284.17"/>
<polygon fill="black" stroke="black" points="1672.13,-280.68 1661.73,-282.7 1671.12,-287.61 1672.13,-280.68"/>
</g>
<!-- expert_group_11 -->
<g id="node35" class="node">
<title>expert_group_11</title>
<polygon fill="#ffe6e6" stroke="black" points="2053.5,-284 1679.5,-284 1679.5,-216 2053.5,-216 2053.5,-284"/>
<text text-anchor="middle" x="1866.5" y="-268.8" font-family="Times,serif" font-size="14.00">Expert Group</text>
<text text-anchor="middle" x="1866.5" y="-253.8" font-family="Times,serif" font-size="14.00">GPU: 11</text>
<text text-anchor="middle" x="1866.5" y="-238.8" font-family="Times,serif" font-size="14.00">Experts: 6&#45;7</text>
<text text-anchor="middle" x="1866.5" y="-223.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- gate&#45;&gt;expert_group_11 -->
<g id="edge49" class="edge">
<title>gate&#45;&gt;expert_group_11</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2121.4,-319.93C2081.52,-309.14 2038.06,-297.39 1998.51,-286.7"/>
<polygon fill="black" stroke="black" points="1999.37,-283.3 1988.81,-284.07 1997.55,-290.06 1999.37,-283.3"/>
</g>
<!-- expert_group_12 -->
<g id="node36" class="node">
<title>expert_group_12</title>
<polygon fill="#ffe6e6" stroke="black" points="2445.5,-284 2071.5,-284 2071.5,-216 2445.5,-216 2445.5,-284"/>
<text text-anchor="middle" x="2258.5" y="-268.8" font-family="Times,serif" font-size="14.00">Expert Group</text>
<text text-anchor="middle" x="2258.5" y="-253.8" font-family="Times,serif" font-size="14.00">GPU: 12</text>
<text text-anchor="middle" x="2258.5" y="-238.8" font-family="Times,serif" font-size="14.00">Experts: 8&#45;9</text>
<text text-anchor="middle" x="2258.5" y="-223.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- gate&#45;&gt;expert_group_12 -->
<g id="edge50" class="edge">
<title>gate&#45;&gt;expert_group_12</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2258.5,-319.93C2258.5,-311.69 2258.5,-302.89 2258.5,-294.43"/>
<polygon fill="black" stroke="black" points="2262,-294.33 2258.5,-284.33 2255,-294.33 2262,-294.33"/>
</g>
<!-- expert_group_13 -->
<g id="node37" class="node">
<title>expert_group_13</title>
<polygon fill="#ffe6e6" stroke="black" points="2837.5,-284 2463.5,-284 2463.5,-216 2837.5,-216 2837.5,-284"/>
<text text-anchor="middle" x="2650.5" y="-268.8" font-family="Times,serif" font-size="14.00">Expert Group</text>
<text text-anchor="middle" x="2650.5" y="-253.8" font-family="Times,serif" font-size="14.00">GPU: 13</text>
<text text-anchor="middle" x="2650.5" y="-238.8" font-family="Times,serif" font-size="14.00">Experts: 10&#45;11</text>
<text text-anchor="middle" x="2650.5" y="-223.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- gate&#45;&gt;expert_group_13 -->
<g id="edge51" class="edge">
<title>gate&#45;&gt;expert_group_13</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2395.6,-319.93C2435.48,-309.14 2478.94,-297.39 2518.49,-286.7"/>
<polygon fill="black" stroke="black" points="2519.45,-290.06 2528.19,-284.07 2517.63,-283.3 2519.45,-290.06"/>
</g>
<!-- expert_group_14 -->
<g id="node38" class="node">
<title>expert_group_14</title>
<polygon fill="#ffe6e6" stroke="black" points="3229.5,-284 2855.5,-284 2855.5,-216 3229.5,-216 3229.5,-284"/>
<text text-anchor="middle" x="3042.5" y="-268.8" font-family="Times,serif" font-size="14.00">Expert Group</text>
<text text-anchor="middle" x="3042.5" y="-253.8" font-family="Times,serif" font-size="14.00">GPU: 14</text>
<text text-anchor="middle" x="3042.5" y="-238.8" font-family="Times,serif" font-size="14.00">Experts: 12&#45;13</text>
<text text-anchor="middle" x="3042.5" y="-223.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- gate&#45;&gt;expert_group_14 -->
<g id="edge52" class="edge">
<title>gate&#45;&gt;expert_group_14</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2466.29,-333.43C2576.1,-320.42 2713.37,-303.31 2845,-284.2"/>
<polygon fill="black" stroke="black" points="2845.88,-287.61 2855.27,-282.7 2844.87,-280.68 2845.88,-287.61"/>
</g>
<!-- expert_group_15 -->
<g id="node39" class="node">
<title>expert_group_15</title>
<polygon fill="#ffe6e6" stroke="black" points="3621.5,-284 3247.5,-284 3247.5,-216 3621.5,-216 3621.5,-284"/>
<text text-anchor="middle" x="3434.5" y="-268.8" font-family="Times,serif" font-size="14.00">Expert Group</text>
<text text-anchor="middle" x="3434.5" y="-253.8" font-family="Times,serif" font-size="14.00">GPU: 15</text>
<text text-anchor="middle" x="3434.5" y="-238.8" font-family="Times,serif" font-size="14.00">Experts: 14&#45;15</text>
<text text-anchor="middle" x="3434.5" y="-223.8" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- gate&#45;&gt;expert_group_15 -->
<g id="edge53" class="edge">
<title>gate&#45;&gt;expert_group_15</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M2487.79,-345.93C2684.24,-335.02 2974.84,-315.54 3237.19,-284.12"/>
<polygon fill="black" stroke="black" points="3237.79,-287.58 3247.3,-282.9 3236.95,-280.63 3237.79,-287.58"/>
</g>
<!-- expert_agg -->
<g id="node40" class="node">
<title>expert_agg</title>
<polygon fill="#fff0e6" stroke="black" points="2646.49,-180 2029.28,-180 1870.51,-74 2487.72,-74 2646.49,-180"/>
<text text-anchor="middle" x="2258.5" y="-138.3" font-family="Times,serif" font-size="14.00">Expert Aggregation</text>
<text text-anchor="middle" x="2258.5" y="-123.3" font-family="Times,serif" font-size="14.00">Aggregate 16 experts</text>
<text text-anchor="middle" x="2258.5" y="-108.3" font-family="Times,serif" font-size="14.00">[batch_size=B, seq_len=2048, hidden_dim=4096]</text>
</g>
<!-- expert_group_8&#45;&gt;expert_agg -->
<g id="edge54" class="edge">
<title>expert_group_8&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M877.7,-217.05C880.65,-216.69 883.59,-216.34 886.5,-216 1253.17,-173.49 1677.53,-150.22 1956.06,-138.47"/>
<polygon fill="black" stroke="black" points="1956.48,-141.95 1966.32,-138.04 1956.18,-134.96 1956.48,-141.95"/>
</g>
<!-- expert_group_9&#45;&gt;expert_agg -->
<g id="edge55" class="edge">
<title>expert_group_9&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M1269.71,-217.16C1272.66,-216.76 1275.59,-216.37 1278.5,-216 1510.39,-186.11 1774.45,-163.03 1970,-148.02"/>
<polygon fill="black" stroke="black" points="1970.43,-151.49 1980.14,-147.24 1969.9,-144.51 1970.43,-151.49"/>
</g>
<!-- expert_group_10&#45;&gt;expert_agg -->
<g id="edge56" class="edge">
<title>expert_group_10&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M1661.74,-217.4C1664.68,-216.93 1667.6,-216.46 1670.5,-216 1776.92,-199.08 1894.33,-181.32 1996.07,-166.23"/>
<polygon fill="black" stroke="black" points="1996.8,-169.66 2006.18,-164.73 1995.78,-162.73 1996.8,-169.66"/>
</g>
<!-- expert_group_11&#45;&gt;expert_agg -->
<g id="edge57" class="edge">
<title>expert_group_11&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M1973.62,-215.94C2006.6,-205.76 2043.84,-194.26 2080.26,-183.02"/>
<polygon fill="black" stroke="black" points="2081.48,-186.31 2090,-180.01 2079.41,-179.62 2081.48,-186.31"/>
</g>
<!-- expert_group_12&#45;&gt;expert_agg -->
<g id="edge58" class="edge">
<title>expert_group_12&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M2258.5,-215.94C2258.5,-207.9 2258.5,-199.05 2258.5,-190.15"/>
<polygon fill="black" stroke="black" points="2262,-190.13 2258.5,-180.13 2255,-190.13 2262,-190.13"/>
</g>
<!-- expert_group_13&#45;&gt;expert_agg -->
<g id="edge59" class="edge">
<title>expert_group_13&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M2543.38,-215.94C2510.4,-205.76 2473.16,-194.26 2436.74,-183.02"/>
<polygon fill="black" stroke="black" points="2437.59,-179.62 2427,-180.01 2435.52,-186.31 2437.59,-179.62"/>
</g>
<!-- expert_group_14&#45;&gt;expert_agg -->
<g id="edge60" class="edge">
<title>expert_group_14&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M2855.26,-217.4C2852.32,-216.93 2849.4,-216.46 2846.5,-216 2774.31,-204.52 2697.06,-192.66 2623.07,-181.5"/>
<polygon fill="black" stroke="black" points="2623.54,-178.03 2613.13,-180.01 2622.49,-184.96 2623.54,-178.03"/>
</g>
<!-- expert_group_15&#45;&gt;expert_agg -->
<g id="edge61" class="edge">
<title>expert_group_15&#45;&gt;expert_agg</title>
<path fill="none" stroke="black" d="M3247.29,-217.16C3244.34,-216.76 3241.41,-216.37 3238.5,-216 3032.84,-189.49 2801.86,-168.34 2615.83,-153.42"/>
<polygon fill="black" stroke="black" points="2615.85,-149.91 2605.6,-152.6 2615.29,-156.89 2615.85,-149.91"/>
</g>
<!-- expert_agg&#45;&gt;residual2 -->
<g id="edge62" class="edge">
<title>expert_agg&#45;&gt;residual2</title>
<path fill="none" stroke="black" d="M2508.92,-87.81C2616.04,-71.47 2736.55,-53.09 2825.05,-39.59"/>
<polygon fill="black" stroke="black" points="2825.78,-43.02 2835.13,-38.05 2824.72,-36.1 2825.78,-43.02"/>
</g>
</g>
</svg>
